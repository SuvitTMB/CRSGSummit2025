<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRSG Summit 2025 Dashboard</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: #ffffff; /* (แก้ไข) เปลี่ยนเป็นสีขาว */
        }
        /* เพิ่ม: Style สำหรับ Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            height: 1.5rem; /* เพิ่มความสูง */
        }
        .progress-bar {
            height: 100%;
            background-color: #3b82f6;
            width: 0%;
            transition: width 0.3s ease-in-out;
            text-align: center;
            color: white;
            line-height: 1.5rem; /* จัดกลางข้อความแนวตั้ง */
            font-size: 0.875rem; /* ขนาดตัวอักษร */
        }
         /* (เพิ่ม) Style สำหรับ Edit Modal Inputs */
        #editEmployeeModal input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            margin-top: 0.25rem;
        }
         /* (เพิ่ม) Style สำหรับ Dropdown ฟ้าอ่อน */
        select.light-blue-bg {
             background-color: #ffffff; /* (แก้ไข) เปลี่ยนเป็นสีขาว */
             padding-left: 0.75rem; /* px-3 */
             padding-right: 0.75rem; /* px-3 */
             padding-top: 0.5rem; /* py-2 */
             padding-bottom: 0.5rem; /* py-2 */
        }
         /* (เพิ่ม) Style หัวตารางสีเทา */
        thead.table-header-gray {
             background-color: #e5e7eb; /* gray-200 */
        }
    </style>
    <!-- Chart.js CDN --><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body class="flex flex-col items-center min-h-screen py-10 bg-white">

    <div class="w-[90%] max-w-6xl p-0 bg-white rounded-lg"> <!-- (แก้ไข) w-[90%], p-0 -->
        <!-- Header (แก้ไข: จัดกลาง, ปรับ pt) --><div class="flex flex-col items-center mb-6 pt-6 px-8"> <!-- (แก้ไข) pt-6 (1.5rem) -->
            <div class="text-center">
                <!-- (แก้ไข) text-2xl และ style color -->
                <h1 class="text-2xl font-bold" style="color: #0056ff;">CRSG Summit 2025</h1>
               <!-- ลบ Subtitle ออกแล้ว --></div>
            <div class="text-center mt-2">
                <p id="currentDateTime" class="text-sm text-gray-600 font-medium"></p>
            </div>
        </div>
        
        <!-- Tab Navigation (แก้ไข: ปรับ space, เปลี่ยนชื่อ, เพิ่มแท็บ) --><div class="mb-6 border-b border-gray-200 px-8"> <!-- (แก้ไข) เพิ่ม px-8 -->
            <nav class="-mb-px flex space-x-1" aria-label="Tabs"> <!-- แก้ไข: space-x-1 --><button id="tab-dashboard" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-700 bg-gray-300 border-blue-600">
                    ข้อมูล Dashboard
                </button>
                <button id="tab-team-list" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลสมาชิกทีม <!-- (แก้ไข) เปลี่ยนชื่อ --></button>
                <!-- (เพิ่ม) แท็บใหม่ -->
                <button id="tab-group-view" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลจัดกลุ่ม
                </button>
                <button id="tab-employee-list" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลพนักงาน CRSG <!-- เพิ่ม: แท็บใหม่ -->
                </button>
                <!-- (เพิ่ม) แท็บใหม่สำหรับลงทะเบียน -->
                <button id="tab-register" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ลงทะเบียนเข้าร่วมงาน
                </button>
            </nav>
        </div>

        <!-- Dashboard Content --><div id="dashboard-content" class="px-8 pb-8"> <!-- (แก้ไข) เพิ่ม px-8 pb-8 -->
            <!-- ภาพรวมผู้ลงทะเบียน (แก้ไข: โครงสร้างใหม่ 50/50, ปรับกล่องซ้าย) --><h2 class="text-lg font-semibold text-gray-800 mb-4">ภาพรวมผู้ลงทะเบียน</h2>
            <div class="flex flex-col lg:flex-row gap-6 mb-8">
                
                <!-- กล่องที่ 1 (40%) --><div class="lg:w-2/5"> <!-- (แก้ไข) lg:w-1/2 -> lg:w-2/5 -->
                     <!-- (แก้ไข) ปรับโครงสร้างกล่องซ้าย (เปลี่ยน 4 กล่องเป็น 1 กราฟ) -->
                     <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center h-full">
                         <p class="text-gray-600 text-sm mb-4">สัดส่วนผู้ลงทะเบียน</p>
                         <div class="relative w-64 h-64"> <!-- (แก้ไข) ทำให้ใหญ่ขึ้น -->
                             <canvas id="registrationBreakdownChart"></canvas>
                             <div class="absolute inset-0 flex flex-col items-center justify-center">
                                 <span id="breakdownCenterTotal" class="text-3xl font-bold text-gray-900">0</span>
                                 <span class="text-sm text-gray-500">ผู้ลงทะเบียน</span>
                             </div>
                         </div>
                     </div>
                </div>

                <!-- กล่องที่ 2 (60%) : กราฟวงกลมและสรุปยอด (แก้ไข: เพิ่มกล่อง Participants) --><div class="lg:w-3/5"> <!-- (แก้ไข) lg:w-1/2 -> lg:w-3/5 -->
                    <div class="flex gap-6 h-full">
                         <!-- กล่องซ้าย (w-2/3) : กราฟวงกลม -->
                         <div class="w-2/3 bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center"> <!-- (แก้ไข) w-[65%] -> w-2/3 -->
                            <p class="text-gray-600 text-sm mb-4">เป้าหมายผู้ลงทะเบียน</p>
                            <div class="relative w-64 h-64"> <!-- (แก้ไข) 48 -> 64 (ปรับขนาดให้เท่ากราฟแรก) -->
                                <canvas id="registrationDonutChart"></canvas>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <span id="donutPercentage" class="text-3xl font-bold text-gray-900">0%</span>
                                    <span class="text-sm text-gray-500">ผู้เข้าร่วมกิจกรรม</span>
                                </div>
                            </div>
                        </div>
                         <!-- กล่องขวา (w-1/3) : สรุปยอด (แก้ไข: ปรับ spacing) -->
                         <div class="w-1/3 flex flex-col justify-between space-y-2"> <!-- (แก้ไข) w-[35%] -> w-1/3 -->
                            <!-- จำนวนเป้าหมาย --><div class="h-1/4 bg-blue-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> <!-- แก้ไข h-1/4, p-3 -->
                                <p class="text-blue-700 text-xs">จำนวนเป้าหมาย</p> <!-- แก้ไข text-xs -->
                                <p id="targetCount" class="text-lg font-bold text-blue-800 mt-1">0</p> <!-- แก้ไข text-lg -->
                            </div>
                            <!-- (เพิ่ม) ผู้เข้าร่วมกิจกรรม --><div class="h-1/4 bg-green-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> <!-- แก้ไข h-1/4, p-3 -->
                                <p class="text-green-700 text-xs">ผู้เข้าร่วมกิจกรรม</p> <!-- แก้ไข text-xs -->
                                <p id="participantsCountBox" class="text-lg font-bold text-green-800 mt-1">0</p> <!-- (เพิ่ม) ID ใหม่, แก้ไข text-lg -->
                            </div>
                             <!-- ผู้ร่วมงาน (ย้ายมา) --><div class="h-1/4 bg-yellow-50 p-3 rounded-lg flex flex-col justify-center items-center text-center">
                                <p class="text-yellow-700 text-xs">ผู้ร่วมงาน</p>
                                <p id="attendeesCount" class="text-lg font-bold text-yellow-800 mt-1">0</p>
                            </div>
                            <!-- จำนวนคงเหลือ --><div class="h-1/4 bg-red-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> <!-- แก้ไข h-1/4, p-3 -->
                                <p class="text-red-700 text-xs">จำนวนคงเหลือ</p> <!-- แก้ไข text-xs -->
                                <p id="remainingCount" class="text-lg font-bold text-red-800 mt-1">0</p> <!-- แก้ไข text-lg -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- สรุปข้อมูลผู้ลงทะเบียน (แก้ไข: ย้ายปุ่ม, แบ่งกราฟเป็น ซ้าย/ขวา) --><div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                     <h2 class="text-lg font-semibold text-gray-800">สรุปข้อมูลผู้ลงทะเบียน</h2>
                     <!-- (แก้ไข) ปรับสไตล์ปุ่ม -->
                     <button id="randomizeButton" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                         สุ่มเลือกผู้ร่วมงาน
                     </button>
                 </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <!-- แบ่งเป็น 2 คอลัมน์ -->
                    <!-- กล่องซ้าย: กราฟแท่ง 1 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <p class="text-gray-600 text-sm mb-4">กราฟแสดงข้อมูลสถิติ (ส่วนที่ 1)</p>
                        <div class="h-[25rem]"> <!-- (แก้ไข) เพิ่มความสูง -->
                            <canvas id="teamBarChart1"></canvas> 
                        </div>
                    </div>
                    <!-- กล่องขวา: กราฟแท่ง 2 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                         <p class="text-gray-600 text-sm mb-4">กราฟแสดงข้อมูลสถิติ (ส่วนที่ 2)</p>
                        <div class="h-[25rem]"> <!-- (แก้ไข) เพิ่มความสูง -->
                            <canvas id="teamBarChart2"></canvas> 
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- สรุปข้อมูลผู้ร่วมงานและรายชื่อล่าสุด (แก้ไข: เพิ่มคอลัมน์) --><h2 class="text-lg font-semibold text-gray-800 mb-4">สรุปข้อมูลผู้ร่วมงานและรายชื่อล่าสุด</h2>
            <div class="bg-white shadow-md rounded-lg overflow-hidden border border-gray-200">
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm">
                        <thead class="table-header-gray"> <!-- (แก้ไข) เปลี่ยนจาก bg-gray-50 -->
                            <tr>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">กลุ่ม</th> <!-- (BU_th) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th> <!-- (แก้ไข) Check_Manager -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ทีม</th> <!-- (เพิ่ม) Check_Place -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลบรายการ</th>
                            </tr>
                        </thead>
                        <tbody id="latestRegistrationsTableBody" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="7" class="p-6 text-center text-gray-500">กำลังโหลดข้อมูล...</td> <!-- (แก้ไข) colspan="7" -->
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- (เพิ่ม) ปุ่ม Download CSV -->
            <div class="mt-6 text-center">
                <button id="downloadCsvButton" class="px-5 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                    Download File CSV (ผู้ลงทะเบียน)
                </button>
            </div>
            
        </div>

        <!-- (เพิ่ม) Register Content -->
        <div id="register-content" class="hidden pb-8 px-6">
             <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center">
                <h2 class="text-xl font-semibold text-gray-800 text-center mb-6">สแกน QR Code เพื่อลงทะเบียนเข้าร่วมงาน</h2>
                <img 
                    src="./images/QRcode-CRSG.png" 
                    alt="QR Code ลงทะเบียน" 
                    class="rounded-lg shadow-md border border-gray-200" 
                    style=" width:40%;"
                >
             </div>
        </div>

        <!-- (แก้ไข) ลบ </div> ที่ปิดผิดพลาด (เคยอยู่ที่นี่ บรรทัด 228) -->

        <!-- (ลบ) บล็อก HTML ที่เสีย (เคยอยู่ที่นี่ 287-424) -->

        <!-- (เพิ่ม) Team List Content (ที่ขาดหายไปทั้งหมด) -->
        <div id="team-list-content" class="hidden pb-8 px-0"> <!-- (แก้ไข) px-6 -> px-0 -->
            <div class="bg-white overflow-hidden"> <!-- (แก้ไข) ลบ shadow, border, rounded -->
                <!-- Top Stats/Actions Bar -->
                <div class="px-6 py-4 border-b grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                    <!-- Stat 1: Manager Count -->
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-blue-700">พนักงานที่มี Manager</p>
                        <p id="managerEmployeeCount" class="text-2xl font-bold text-blue-900 mt-1">0</p>
                    </div>
                    <!-- Stat 2: Team Member Count -->
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-green-700">พนักงานที่มี Team</p>
                        <p id="teamMemberCountElem" class="text-2xl font-bold text-green-900 mt-1">0</p>
                    </div>
                    <!-- Stat 3: Defined Teams (Scrollable) -->
                    <div class="bg-gray-50 p-4 rounded-lg overflow-y-auto max-h-24"> 
                        <p class="text-sm text-gray-700 mb-1 font-medium">รายชื่อทีมที่กำหนด:</p>
                        <p id="definedTeamNames" class="text-xs text-gray-600 break-words"></p> 
                    </div>
                </div>

                <!-- Actions Bar (Reset/Create) -->
                <div class="px-6 py-4 border-b flex flex-col md:flex-row gap-4 justify-center">
                     <button id="resetTeamButton" class="w-full md:w-auto px-6 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out">
                         Reset Team
                     </button>
                     <button id="createTeamButton" class="w-full md:w-auto px-6 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
                         Random Team
                     </button>
                </div>
                
                <!-- Progress Bar -->
                <div id="teamCreationProgressContainer" class="hidden p-6 border-b">
                    <p class="text-sm text-gray-600 mb-2">กำลังสร้างทีม...</p>
                    <div class="progress-bar-container">
                        <div id="teamCreationProgressBar" class="progress-bar">0%</div>
                    </div>
                    <p id="teamCreationStatus" class="text-xs text-gray-500 mt-1"></p>
                </div>
                
                <!-- Team Member Table Section -->
                 <div class="p-6">
                     <div class="flex justify-between items-center mb-4">
                         <h3 class="text-lg font-semibold">ข้อมูลสมาชิกในแต่ละทีม</h3>
                         <div>
                             <label for="teamSelect" class="text-sm font-medium mr-2">เลือกทีม:</label>
                             <select id="teamSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm light-blue-bg">
                                 <option value="">-- กรุณาเลือก --</option>
                                 <!-- Options will be populated by JS -->
                             </select>
                         </div>
                     </div>
                     <div class="overflow-x-auto border rounded-lg">
                        <table class="min-w-full text-sm">
                            <thead class="table-header-gray">
                                <tr>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับ</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">แก้ไข</th>
                                </tr>
                            </thead>
                            <tbody id="selectedTeamTableBody" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="p-6 text-center text-gray-500">กรุณาเลือกทีม</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                 </div>
            </div>
        </div>
        
        <!-- (เพิ่ม) Group View Content --><div id="group-view-content" class="hidden pb-8 px-6">
             <div class="bg-white overflow-hidden">
                
                <!-- (ย้ายมา) Add Member Section -->
                <div class="p-6 border-b bg-gray-50">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">เพิ่มสมาชิกลงทีม</h3>
                    <!-- (แก้ไข) space-x-2 -->
                    <div class="flex items-end space-x-2">
                        <div class="flex-grow">
                            <label for="searchEmployeeIdInput" class="block text-sm font-medium text-gray-700">รหัสพนักงาน</label>
                            <!-- (แก้ไข) เพิ่ม bg-blue-50 และ style padding -->
                            <input type="text" id="searchEmployeeIdInput" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm bg-blue-50" placeholder="ใส่รหัสพนักงาน 5-6 หลัก" style="padding: 5px;">
                        </div>
                        <button id="searchEmployeeButton" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            ค้นหาข้อมูล
                        </button>
                    </div>
                    <p id="searchEmployeeError" class="text-red-600 text-sm mt-2"></p>
                </div>
                
                <!-- (แก้ไข) เพิ่ม Flexbox, Dropdown -->
                <div class="px-6 py-4 border-b flex justify-between items-center">
                    <div>
                        <h2 class="text-xl font-semibold">ข้อมูลจัดกลุ่ม (Team View)</h2>
                        <p class="text-sm text-gray-600">แสดงจำนวนสมาชิกในแต่ละทีม (คลิกเพื่อดูรายชื่อ)</p>
                    </div>
                    <div>
                         <label for="groupViewManagerFilter" class="text-sm font-medium mr-2">กรองตามสังกัด:</label>
                         <select id="groupViewManagerFilter" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm light-blue-bg">
                             <option value="">-- ดูทั้งหมด --</option>
                             <!-- Options will be populated by JS -->
                         </select>
                    </div>
                </div>
                
                <!-- (เพิ่ม) Grid for Team Boxes -->
                <div id="teamBoxesContainer" class="p-6 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <!-- Team boxes will be populated by JS -->
                    <p class="text-gray-500">กำลังโหลดข้อมูล...</p>
                </div>
             </div>
        </div>
        
        <!-- Employee List Content (แก้ไข: ลบกรอบ, ปรับ padding, เพิ่ม filter, แก้ไข table, ปรับ Style) --><div id="employee-list-content" class="hidden pb-8 px-0"> <!-- (แก้ไข) px-0 -->
             <div class="bg-white overflow-hidden"> <!-- (แก้ไข) ลบ shadow, border, rounded -->
                <div class="px-6 py-4 border-b flex justify-between items-center"> <!-- (แก้ไข) เพิ่ม px-6, flex -->
                    <div>
                        <h2 class="text-xl font-semibold">ข้อมูลพนักงาน CRSG ทั้งหมด</h2>
                        <p class="text-sm text-gray-600">แสดงรายชื่อพนักงานทั้งหมดในระบบ</p>
                    </div>
                     <!-- (เพิ่ม) Filter Dropdown -->
                     <div>
                         <label for="managerFilterSelect" class="text-sm font-medium mr-2">กรองตามสังกัด:</label> <!-- (แก้ไข) Label -->
                         <select id="managerFilterSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm light-blue-bg">
                             <option value="">-- ทั้งหมด --</option>
                             <!-- Manager Options will be populated by JS -->
                         </select>
                     </div>
                </div>
                
                <div class="overflow-x-auto p-6"> <!-- (แก้ไข) เพิ่ม p-6 -->
                    <table class="min-w-full text-sm">
                        <thead class="table-header-gray"> <!-- (แก้ไข) เพิ่ม class -->
                            <tr>
                                <!-- (เพิ่ม) คอลัมน์ลำดับที่ -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับที่</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัส</th> <!-- (แก้ไข) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th> <!-- (แก้ไข) -->
                                <!-- <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ตำแหน่ง</th> --> <!-- (ลบ) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ทีม</th> <!-- (แก้ไข) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th> <!-- (แก้ไข) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">แก้ไข</th> <!-- (เพิ่ม) -->
                            </tr>
                        </thead>
                        <tbody id="employeeListTableBody" class="divide-y divide-gray-200"> <!-- (แก้ไข) ลบ bg-white -->
                            <tr>
                                <td colspan="6" class="p-6 text-center text-gray-500">กรุณาเลือกสังกัด</td> <!-- (แก้ไข) colspan="6", ข้อความ -->
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- *** เพิ่ม: Lightbox/Modal สำหรับสุ่มเลือก *** --><div id="randomizeModal" class="hidden fixed inset-0 z-40 overflow-y-auto bg-gray-600 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl mx-4">
            <!-- แถวที่ 1: Title --><h3 class="text-xl font-semibold text-center text-gray-900 mb-4">ระบบสุ่มเลือกผู้ร่วมกิจกรรม</h3>
            
            <!-- แถวที่ 2: Stats --><div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <p class="text-sm text-blue-700">ผู้เข้าร่วมกิจกรรม (ที่สุ่มได้)</p>
                    <p id="modalParticipantsCount" class="text-3xl font-bold text-blue-900">0</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <p class="text-sm text-green-700">ผู้ได้รับการสุ่มแล้ว</p>
                    <p id="modalDrawnCount" class="text-3xl font-bold text-green-900">0</p>
                </div>
            </div>
            
            <!-- แถวที่ 3: 5 Digits --><div class="flex justify-center space-x-2 mb-6">
                <div id="digit1" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit2" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit3" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit4" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit5" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
            </div>
            
            <!-- แถวที่ 4: Button --><div class="mb-6">
                <button id="startRandomizeButton" class="w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400">
                    สุ่มเลือกผู้ร่วมกิจกรรม
                </button>
                <p id="randomizeError" class="text-red-600 text-sm text-center mt-2"></p>
            </div>
            
            <!-- แถวที่ 5: Table --><h4 class="text-lg font-semibold text-gray-800 mb-2">ข้อมูลผู้ที่ได้รับการสุ่มเลือก</h4>
            <div class="h-48 overflow-y-auto border rounded-lg">
                <table class="min-w-full text-sm">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน (BU)</th>
                            <th class="px-4 py-2 text-center font-medium text-gray-600 uppercase tracking-wider">ยกเลิก</th>
                        </tr>
                    </thead>
                    <tbody id="drawnWinnersTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Data will be populated by JS --></tbody>
                </table>
            </div>
            
            <!-- แถวที่ 6: Close Button --><div class="mt-6 text-right">
                <button id="closeRandomizeModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ปิดหน้านี้
                </button>
            </div>
        </div>
    </div>
    
    <!-- *** เพิ่ม: Lightbox/Modal 2 สำหรับแสดงผู้ชนะ *** --><div id="winnerDetailModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-lg w-full text-center">
            <h3 class="text-2xl font-bold text-blue-600 mb-4">ยินดีด้วย!</h3>
            <p class="text-lg text-gray-700">ผู้โชคดีคือ:</p>
            <p id="winnerName" class="text-3xl font-extrabold text-gray-900 my-2"></p>
            <p id="winnerEmployeeId" class="text-base text-gray-500 mb-1"></p>
            <p id="winnerTeam" class="text-base text-gray-500 mb-1"></p>
            <p id="winnerBU" class="text-base text-gray-500 mb-6"></p>
            
            <div class="flex justify-center space-x-4">
                <button id="cancelWinnerButton" class="px-4 py-2 text-xs bg-red-100 text-red-700 rounded-md hover:bg-red-200">
                    ยกเลิกการสุ่ม
                </button>
                <button id="closeWinnerModalButton" class="px-4 py-2 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    ปิดหน้าต่าง
                </button>
            </div>
        </div>
    </div>
    
    <!-- *** เพิ่ม: Lightbox/Modal 3 สำหรับยืนยันการยกเลิก/Reset *** --><div id="confirmModal" class="hidden fixed inset-0 z-[60] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center"> <!-- (แก้ไข) z-50 -> z-[60] (สูงสุด) -->
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-sm w-full">
            <h3 id="confirmTitle" class="text-lg font-semibold text-gray-900 mb-4">ยืนยัน</h3> <!-- (แก้ไข) เพิ่ม ID -->
            <p id="confirmText" class="text-sm text-gray-700 mb-6"></p> <!-- (แก้ไข) เปลี่ยน ID -->
            <div class="flex justify-end space-x-3">
                <button id="closeConfirmButton" class="px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ไม่
                </button> <!-- (แก้ไข) เปลี่ยน ID -->
                <button id="confirmActionButton" class="px-3 py-1.5 text-xs bg-red-600 text-white rounded-md hover:bg-red-700">
                    <!-- Text will be set by JS -->
                </button> <!-- (แก้ไข) เปลี่ยน ID -->
            </div>
        </div>
    </div>

    <!-- *** (เพิ่ม) Lightbox/Modal 4 สำหรับแก้ไขข้อมูลพนักงาน *** -->
    <div id="editEmployeeModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">แก้ไขข้อมูลพนักงาน</h3>
            <div class="space-y-4">
                <div>
                    <span class="text-sm font-medium text-gray-700">รหัสพนักงาน:</span>
                    <span id="editEmpId" class="text-sm text-gray-900 ml-2"></span>
                </div>
                 <div>
                    <span class="text-sm font-medium text-gray-700">ชื่อ-นามสกุล:</span>
                    <span id="editEmpName" class="text-sm text-gray-900 ml-2"></span>
                </div>
                 <div>
                    <label for="editEmpManager" class="block text-sm font-medium text-gray-700">Manager (Check_Manager)</label>
                    <input type="text" id="editEmpManager">
                </div>
                 <div>
                    <label for="editEmpTeam" class="block text-sm font-medium text-gray-700">ทีม (Check_Place)</label>
                    <input type="text" id="editEmpTeam">
                </div>
                <!-- สามารถเพิ่ม Fields อื่นๆ ที่ต้องการแสดง (แต่แก้ไขไม่ได้) ตรงนี้ -->
                 <p id="editError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                 <button id="closeEditModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ยกเลิกการแก้ไข
                 </button>
                 <button id="saveEditModalButton" class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    บันทึกรายการ
                 </button>
            </div>
        </div>
    </div>

    <!-- *** (เพิ่ม) Lightbox/Modal 5 สำหรับแก้ไขสมาชิกทีม (จากแท็บ Team List / Group View) (ส่วนนี้ขาดหายไป) *** -->
    <div id="editTeamMemberModal" class="hidden fixed inset-0 z-[51] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center p-4"> <!-- (แก้ไข) z-50 -> z-[51] -->
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">แก้ไขข้อมูลสมาชิกทีม</h3>
            <div class="space-y-4">
                <div>
                    <p class="text-sm text-gray-600">รหัสพนักงาน: <span id="editMemberEmpId" class="font-medium text-gray-900"></span></p>
                    <p class="text-sm text-gray-600">ชื่อ: <span id="editMemberEmpName" class="font-medium text-gray-900"></span></p>
                </div>
                <div>
                    <label for="editMemberTeamSelect" class="block text-sm font-medium text-gray-700">ทีม (Check_Place):</label>
                    <select id="editMemberTeamSelect" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm mt-1 light-blue-bg">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                <p id="editMemberError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-between">
                <div>
                     <button id="deleteEditMemberModalButton" class="px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md hover:bg-red-200 disabled:bg-gray-400">
                        ยกเลิกการเป็นสมาชิกทีม <!-- (แก้ไข) เปลี่ยนชื่อปุ่ม -->
                    </button>
                </div>
                <div class="flex space-x-3">
                    <button id="closeEditMemberModalButton" class="px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 disabled:bg-gray-400">
                        ยกเลิก
                    </button>
                    <button id="saveEditMemberModalButton" class="px-3 py-1.5 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400">
                        บันทึกรายการ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- *** (เพิ่ม) Lightbox/Modal 6 สำหรับแสดงสมาชิกในทีม (Group View) *** -->
    <div id="groupViewModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-6xl w-full"> <!-- (แก้ไข) max-w-6xl (กว้างขึ้น) -->
            <div class="flex justify-between items-center mb-4">
                 <h3 id="groupViewModalTitle" class="text-xl font-semibold text-gray-900">สมาชิกในทีม</h3>
                 <!-- (เพิ่ม) ปุ่มปิด -->
                 <button id="closeGroupViewModalButton" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">&times;</button>
            </div>
            
            <!-- (เพิ่ม) Table container -->
            <div class="max-h-[60vh] overflow-y-auto border rounded-lg">
                 <table class="min-w-full text-sm">
                    <thead class="table-header-gray sticky top-0"> <!-- (เพิ่ม) sticky top-0 -->
                        <tr>
                            <!-- (เพิ่ม) ต้องเหมือนกับตารางใน "ข้อมูลสมาชิกทีม" -->
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับ</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">แก้ไข</th>
                        </tr>
                    </thead>
                    <tbody id="groupViewTableBody" class="divide-y divide-gray-200">
                        <tr><td colspan="7" class="p-6 text-center text-gray-500">กำลังโหลด...</td></tr>
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>

    <!-- (เพิ่ม) Lightbox/Modal 7 สำหรับเพิ่ม/แก้ไขสมาชิก (Group View) -->
    <div id="addMemberModal" class="hidden fixed inset-0 z-[51] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center p-4"> <!-- z-index 51 -->
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">เพิ่ม/แก้ไข สมาชิกในทีม</h3>
            <div class="space-y-4">
                <!-- ข้อมูลพนักงาน (Read-only) -->
                <div class="bg-gray-50 p-4 rounded-lg border">
                    <p class="text-sm text-gray-600">รหัสพนักงาน: <span id="addMemberEmpId" class="font-medium text-gray-900"></span></p>
                    <p class="text-sm text-gray-600">ชื่อ: <span id="addMemberEmpName" class="font-medium text-gray-900"></span></p>
                    <p class="text-sm text-gray-600">สายงาน: <span id="addMemberEmpBU" class="font-medium text-gray-900"></span></p>
                </div>
                
                <!-- Dropdown สังกัด -->
                <div>
                    <label for="addMemberManagerSelect" class="block text-sm font-medium text-gray-700">สังกัด (Check_Manager):</label>
                    <select id="addMemberManagerSelect" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm mt-1 bg-white">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                
                <!-- Dropdown ทีม -->
                <div>
                    <label for="addMemberTeamSelect" class="block text-sm font-medium text-gray-700">ทีม (Check_Place):</label>
                    <select id="addMemberTeamSelect" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm mt-1 bg-white">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                
                <p id="addMemberError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="closeAddMemberModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ยกเลิกรายการ
                </button>
                <button id="saveAddMemberModalButton" class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    บันทึกข้อมูล
                </button>
            </div>
        </div>
    </div>


    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
        // นำเข้า Firebase modules
const _0x29918f=_0x3d6d;(function(_0x18b885,_0x40b2ee){const _0x505957=_0x3d6d,_0x5edf6e=_0x18b885();while(!![]){try{const _0x14de36=-parseInt(_0x505957(0x153))/0x1+-parseInt(_0x505957(0x18e))/0x2*(parseInt(_0x505957(0xeb))/0x3)+-parseInt(_0x505957(0x123))/0x4+-parseInt(_0x505957(0x101))/0x5*(parseInt(_0x505957(0x1bb))/0x6)+parseInt(_0x505957(0x13e))/0x7*(-parseInt(_0x505957(0x188))/0x8)+-parseInt(_0x505957(0x1ed))/0x9+parseInt(_0x505957(0x203))/0xa;if(_0x14de36===_0x40b2ee)break;else _0x5edf6e['push'](_0x5edf6e['shift']());}catch(_0x1b6fb2){_0x5edf6e['push'](_0x5edf6e['shift']());}}}(_0x50ea,0x7f352));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';import{getAuth,signInAnonymously}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';import{getFirestore,collection,query,where,onSnapshot,orderBy,limit,setLogLevel,doc,updateDoc,serverTimestamp,writeBatch,Timestamp}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';const firebaseConfig={'apiKey':'AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','authDomain':_0x29918f(0x1e8),'databaseURL':'https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','projectId':'ttb-register','storageBucket':'ttb-register.firebasestorage.app','messagingSenderId':_0x29918f(0xe9),'appId':'1:1070273157855:web:5c8120e1df27e233d8676a','measurementId':'G-9DJLWJ5LQ1'};let db,auth,donutChart,barChart1,barChart2,registrationBreakdownChart;const currentDateTimeElement=document[_0x29918f(0x205)](_0x29918f(0x184)),attendeesCount=document[_0x29918f(0x205)](_0x29918f(0x185)),latestRegistrationsTableBody=document[_0x29918f(0x205)]('latestRegistrationsTableBody'),donutPercentage=document[_0x29918f(0x205)](_0x29918f(0x216)),targetCountElem=document[_0x29918f(0x205)](_0x29918f(0xf7)),remainingCountElem=document['getElementById']('remainingCount'),participantsCountBoxElem=document[_0x29918f(0x205)](_0x29918f(0x1b8)),breakdownCenterTotal=document[_0x29918f(0x205)](_0x29918f(0x211)),tabDashboard=document['getElementById']('tab-dashboard'),tabTeamList=document[_0x29918f(0x205)](_0x29918f(0xec)),tabGroupView=document[_0x29918f(0x205)](_0x29918f(0x149)),tabEmployeeList=document[_0x29918f(0x205)]('tab-employee-list'),tabRegister=document[_0x29918f(0x205)](_0x29918f(0x174)),dashboardContent=document[_0x29918f(0x205)]('dashboard-content'),teamListContent=document[_0x29918f(0x205)](_0x29918f(0x1f0)),groupViewContent=document[_0x29918f(0x205)]('group-view-content'),employeeListContent=document[_0x29918f(0x205)]('employee-list-content'),registerContent=document[_0x29918f(0x205)](_0x29918f(0x16b));let calculatedTarget=0x0;const latestRegistrationsLimit=0x5,teamNames=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','AA','BB','CC','DD','EE','FF','GG','HH','II','JJ','KK','LL','MM','NN','OO','PP','QQ'],teamSize=0xa;let employeesWithManager=[],currentConfirmAction=null;const managerEmployeeCountElem=document[_0x29918f(0x205)](_0x29918f(0x129)),definedTeamNamesElem=document[_0x29918f(0x205)](_0x29918f(0x1a9)),resetTeamButton=document['getElementById'](_0x29918f(0xf6)),createTeamButton=document[_0x29918f(0x205)](_0x29918f(0x11e)),teamCreationProgressContainer=document[_0x29918f(0x205)](_0x29918f(0x166)),teamCreationProgressBar=document[_0x29918f(0x205)](_0x29918f(0x1e4)),teamCreationStatus=document[_0x29918f(0x205)](_0x29918f(0x18b)),teamSelect=document[_0x29918f(0x205)]('teamSelect'),selectedTeamTableBody=document[_0x29918f(0x205)](_0x29918f(0x1ac)),teamMemberCountElem=document[_0x29918f(0x205)](_0x29918f(0x195)),confirmModal=document['getElementById'](_0x29918f(0x179)),confirmTitle=document['getElementById'](_0x29918f(0x135)),confirmText=document['getElementById'](_0x29918f(0x130)),closeConfirmButton=document[_0x29918f(0x205)](_0x29918f(0x21f)),confirmActionButton=document[_0x29918f(0x205)](_0x29918f(0x11b)),editEmployeeModal=document[_0x29918f(0x205)]('editEmployeeModal'),editEmpId=document[_0x29918f(0x205)](_0x29918f(0xf3)),editEmpName=document[_0x29918f(0x205)](_0x29918f(0x1b9)),editEmpManager=document['getElementById'](_0x29918f(0x189)),editEmpTeam=document[_0x29918f(0x205)](_0x29918f(0x107)),editError=document[_0x29918f(0x205)]('editError'),closeEditModalButton=document[_0x29918f(0x205)](_0x29918f(0xfb)),saveEditModalButton=document[_0x29918f(0x205)](_0x29918f(0xee));let currentEditingDocId=null;const editTeamMemberModal=document[_0x29918f(0x205)](_0x29918f(0x113)),editMemberEmpId=document['getElementById'](_0x29918f(0x17a)),editMemberEmpName=document[_0x29918f(0x205)](_0x29918f(0x1d5)),editMemberTeamSelect=document['getElementById'](_0x29918f(0x16d)),editMemberError=document[_0x29918f(0x205)]('editMemberError'),closeEditMemberModalButton=document[_0x29918f(0x205)](_0x29918f(0x1da)),saveEditMemberModalButton=document[_0x29918f(0x205)](_0x29918f(0x151)),deleteEditMemberModalButton=document[_0x29918f(0x205)](_0x29918f(0x232)),groupViewModal=document['getElementById'](_0x29918f(0x235)),groupViewModalTitle=document['getElementById'](_0x29918f(0x11c)),closeGroupViewModalButton=document[_0x29918f(0x205)](_0x29918f(0x1dc)),groupViewTableBody=document[_0x29918f(0x205)]('groupViewTableBody'),teamBoxesContainer=document['getElementById']('teamBoxesContainer'),groupViewManagerFilter=document['getElementById'](_0x29918f(0x1fa)),addMemberModal=document[_0x29918f(0x205)]('addMemberModal'),searchEmployeeIdInput=document[_0x29918f(0x205)](_0x29918f(0x219)),searchEmployeeButton=document[_0x29918f(0x205)](_0x29918f(0x191)),searchEmployeeError=document['getElementById']('searchEmployeeError'),addMemberEmpId=document[_0x29918f(0x205)]('addMemberEmpId'),addMemberEmpName=document[_0x29918f(0x205)](_0x29918f(0x1e0)),addMemberEmpBU=document['getElementById'](_0x29918f(0xf9)),addMemberManagerSelect=document[_0x29918f(0x205)](_0x29918f(0x104)),addMemberTeamSelect=document['getElementById'](_0x29918f(0x170)),addMemberError=document['getElementById'](_0x29918f(0x168)),closeAddMemberModalButton=document[_0x29918f(0x205)](_0x29918f(0xe8)),saveAddMemberModalButton=document[_0x29918f(0x205)](_0x29918f(0x15e));let currentAddingDocId=null,allEmployeesData=[],currentParticipants=[],availableToDraw=[],alreadyDrawn=[],randomizationInterval=null,docIdToCancel=null;const randomizeButton=document[_0x29918f(0x205)](_0x29918f(0x233)),randomizeModal=document[_0x29918f(0x205)]('randomizeModal'),closeRandomizeModalButton=document[_0x29918f(0x205)]('closeRandomizeModalButton'),modalParticipantsCount=document[_0x29918f(0x205)]('modalParticipantsCount'),modalDrawnCount=document['getElementById'](_0x29918f(0x23c)),digits=[document[_0x29918f(0x205)]('digit1'),document['getElementById']('digit2'),document[_0x29918f(0x205)](_0x29918f(0x19d)),document[_0x29918f(0x205)](_0x29918f(0x220)),document['getElementById'](_0x29918f(0x237))],startRandomizeButton=document[_0x29918f(0x205)](_0x29918f(0x16e)),randomizeError=document['getElementById'](_0x29918f(0x196)),drawnWinnersTableBody=document[_0x29918f(0x205)]('drawnWinnersTableBody'),winnerDetailModal=document[_0x29918f(0x205)](_0x29918f(0x16f)),winnerName=document['getElementById'](_0x29918f(0x11d)),winnerEmployeeId=document[_0x29918f(0x205)](_0x29918f(0x145)),winnerTeam=document[_0x29918f(0x205)](_0x29918f(0x156)),winnerBU=document[_0x29918f(0x205)](_0x29918f(0x127)),cancelWinnerButton=document[_0x29918f(0x205)](_0x29918f(0x167)),closeWinnerModalButton=document[_0x29918f(0x205)]('closeWinnerModalButton'),managerFilterSelect=document[_0x29918f(0x205)](_0x29918f(0x13d)),employeeListTableBody=document[_0x29918f(0x205)](_0x29918f(0x102)),downloadCsvButton=document[_0x29918f(0x205)]('downloadCsvButton');try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel(_0x29918f(0x1f6)),await signInAnonymously(auth),console[_0x29918f(0x1fb)](_0x29918f(0x1fe)),initializeCharts(),populateTeamUI(),listenToAllCrsgData(),setupModalListeners(),setupTeamTabListeners(),setupEmployeeListListeners(),setupEditTeamMemberModalListeners(),setupGroupViewListeners(),setupAddMemberModalListeners(),updateCurrentDateTime(),setInterval(updateCurrentDateTime,0x3e8);}catch(_0x1bc0f9){console[_0x29918f(0x1e2)]('Firebase\x20initialization\x20failed:',_0x1bc0f9),document[_0x29918f(0x1b4)][_0x29918f(0x1f8)]=_0x29918f(0x110)+_0x1bc0f9[_0x29918f(0x1c0)]+_0x29918f(0x171);}function formatThaiTimestamp(_0x188231){const _0x41e8b8=_0x29918f;if(!_0x188231||typeof _0x188231[_0x41e8b8(0xf5)]!=='function')return _0x41e8b8(0x17e);return _0x188231['toLocaleString'](_0x41e8b8(0x1cf),{'year':_0x41e8b8(0x1b6),'month':_0x41e8b8(0x1a8),'day':_0x41e8b8(0x1b6),'hour':_0x41e8b8(0x22a),'minute':'2-digit','second':_0x41e8b8(0x22a)});}function _0x3d6d(_0x468333,_0x41ea3f){const _0x50eadb=_0x50ea();return _0x3d6d=function(_0x3d6d13,_0x5b2440){_0x3d6d13=_0x3d6d13-0xe8;let _0x3371b0=_0x50eadb[_0x3d6d13];return _0x3371b0;},_0x3d6d(_0x468333,_0x41ea3f);}function updateCurrentDateTime(){const _0x18ea3e=_0x29918f,_0x2d46ee=new Date();currentDateTimeElement[_0x18ea3e(0x23d)]=_0x18ea3e(0x10e)+_0x2d46ee[_0x18ea3e(0x14d)]('th-TH',{'day':_0x18ea3e(0x1b6),'month':'long','year':_0x18ea3e(0x1b6)})+_0x18ea3e(0x231)+_0x2d46ee[_0x18ea3e(0x1f2)]('th-TH',{'hour':_0x18ea3e(0x22a),'minute':_0x18ea3e(0x22a),'second':_0x18ea3e(0x22a)});}function initializeCharts(){const _0x82977c=_0x29918f,_0x2453c4=document['getElementById']('registrationDonutChart')['getContext']('2d');donutChart=new Chart(_0x2453c4,{'type':_0x82977c(0x1af),'data':{'labels':[_0x82977c(0x140),_0x82977c(0xed)],'datasets':[{'data':[0x0,calculatedTarget],'backgroundColor':['#3B82F6',_0x82977c(0x148)],'hoverOffset':0x4}]},'options':{'responsive':!![],'maintainAspectRatio':![],'cutout':_0x82977c(0x108),'plugins':{'legend':{'display':![]},'tooltip':{'callbacks':{'label':_0x3e5a27=>_0x3e5a27[_0x82977c(0x1e3)]+':\x20'+_0x3e5a27[_0x82977c(0x1ca)]+_0x82977c(0x1e9)}},'datalabels':{'formatter':(_0xc0bd27,_0x5361ac)=>{const _0x14605e=_0x82977c,_0x271d14=_0x5361ac[_0x14605e(0x176)][_0x14605e(0x1d8)][_0x14605e(0x1e1)][0x0][_0x14605e(0x1d8)],_0x1fb3a3=_0x271d14['reduce']((_0x133ef7,_0x236017)=>_0x133ef7+_0x236017,0x0);if(_0xc0bd27===0x0||_0x1fb3a3===0x0)return'';const _0x482b09=(_0xc0bd27/_0x1fb3a3*0x64)[_0x14605e(0x1cb)](0x0)+'%';return _0x482b09;},'anchor':_0x82977c(0x14f),'align':_0x82977c(0x14f),'offset':0x8,'color':_0x304ebd=>_0x304ebd['dataset'][_0x82977c(0x116)][_0x304ebd[_0x82977c(0xf2)]],'font':{'weight':_0x82977c(0x200),'size':0xe}}}},'plugins':[ChartDataLabels]});const _0x29c80a=document['getElementById']('registrationBreakdownChart')['getContext']('2d');registrationBreakdownChart=new Chart(_0x29c80a,{'type':'doughnut','data':{'labels':[_0x82977c(0x10a),'ผู้ร่วมงาน'],'datasets':[{'data':[0x0,0x0],'backgroundColor':[_0x82977c(0x1eb),'#10B981'],'hoverOffset':0x4}]},'options':{'responsive':!![],'maintainAspectRatio':![],'cutout':'80%','plugins':{'legend':{'display':![]},'tooltip':{'callbacks':{'label':_0x570bd1=>_0x570bd1[_0x82977c(0x1e3)]+':\x20'+_0x570bd1[_0x82977c(0x1ca)]+_0x82977c(0x1e9)}},'datalabels':{'formatter':(_0x26933e,_0xac0555)=>{const _0xa5765d=_0x82977c,_0x24a68e=_0xac0555[_0xa5765d(0x176)]['data'][_0xa5765d(0x1e1)][0x0][_0xa5765d(0x1d8)],_0x102b5d=_0x24a68e['reduce']((_0x252600,_0x191600)=>_0x252600+_0x191600,0x0);if(_0x26933e===0x0||_0x102b5d===0x0)return'';const _0x1a1c0b=(_0x26933e/_0x102b5d*0x64)[_0xa5765d(0x1cb)](0x0)+'%';return _0x1a1c0b;},'anchor':_0x82977c(0x14f),'align':'end','offset':0x8,'color':_0x1faac5=>_0x1faac5[_0x82977c(0x22b)]['backgroundColor'][_0x1faac5[_0x82977c(0xf2)]],'font':{'weight':_0x82977c(0x200),'size':0xe}}}},'plugins':[ChartDataLabels]});const _0x1ef16b={'indexAxis':'y','responsive':!![],'maintainAspectRatio':![],'scales':{'x':{'beginAtZero':!![],'stacked':!![],'title':{'display':!![],'text':_0x82977c(0x1ba)},'ticks':{'stepSize':0x1}},'y':{'stacked':!![],'title':{'display':![]}}},'plugins':{'legend':{'display':!![],'position':_0x82977c(0x1df)},'datalabels':{'anchor':'center','align':_0x82977c(0x20f),'color':_0x1b6337=>{const _0x7d9c07=_0x82977c,_0x2f4f5a=_0x1b6337[_0x7d9c07(0x22b)][_0x7d9c07(0x1d8)][_0x1b6337[_0x7d9c07(0xf2)]];return _0x2f4f5a>0x0?_0x7d9c07(0x230):_0x7d9c07(0x190);},'font':{'weight':_0x82977c(0x200)},'formatter':_0x2dcd7b=>_0x2dcd7b>0x0?_0x2dcd7b:''}}},_0x4695c3=document[_0x82977c(0x205)](_0x82977c(0x22e))[_0x82977c(0x1b5)]('2d');barChart1=new Chart(_0x4695c3,{'type':_0x82977c(0x193),'data':{'labels':[],'datasets':[{'label':_0x82977c(0x140),'data':[],'backgroundColor':'#3B82F6','borderColor':_0x82977c(0x14c),'borderWidth':0x1},{'label':'ยังไม่ลงทะเบียน','data':[],'backgroundColor':_0x82977c(0x187),'borderColor':_0x82977c(0x198),'borderWidth':0x1}]},'options':{..._0x1ef16b},'plugins':[ChartDataLabels]});const _0x2c83b5=document[_0x82977c(0x205)](_0x82977c(0x20e))[_0x82977c(0x1b5)]('2d');barChart2=new Chart(_0x2c83b5,{'type':_0x82977c(0x193),'data':{'labels':[],'datasets':[{'label':_0x82977c(0x140),'data':[],'backgroundColor':_0x82977c(0x1eb),'borderColor':'#2563EB','borderWidth':0x1},{'label':_0x82977c(0xed),'data':[],'backgroundColor':_0x82977c(0x187),'borderColor':_0x82977c(0x198),'borderWidth':0x1}]},'options':{..._0x1ef16b},'plugins':[ChartDataLabels]});}function populateTeamUI(){const _0x303fbd=_0x29918f;definedTeamNamesElem[_0x303fbd(0x23d)]=teamNames[_0x303fbd(0x1f1)](',\x20'),teamSelect[_0x303fbd(0x1f8)]='<option\x20value=\x22\x22>--\x20กรุณาเลือก\x20--</option>',teamNames[_0x303fbd(0x202)](_0x411f25=>{const _0x586000=_0x303fbd,_0x442e21=document[_0x586000(0xf8)]('option');_0x442e21[_0x586000(0x1ad)]=_0x411f25,_0x442e21[_0x586000(0x23d)]=_0x411f25,teamSelect[_0x586000(0x17f)](_0x442e21);});}function listenToAllCrsgData(){const _0x4034e9=_0x29918f;try{const _0x4227f7='crsg',_0x10100d=collection(db,_0x4227f7);onSnapshot(_0x10100d,_0x382b74=>{const _0x1abbd3=_0x3d6d,_0x1ec1d5=[],_0xb2844e=[],_0x3762d4={};let _0x4ea3f8=0x0,_0x458616=0x0,_0x3da7db=0x0;const _0x29fcd0=new Set();_0x382b74['forEach'](_0x21d645=>{const _0x9857bc=_0x3d6d,_0x4bdb10=_0x21d645[_0x9857bc(0x1d8)](),_0x38b6d9=_0x21d645['id'];_0x1ec1d5['push']({'id':_0x21d645['id'],..._0x4bdb10});const _0x21f69a=_0x4bdb10['Check_Manager']&&_0x4bdb10[_0x9857bc(0x223)][_0x9857bc(0x13b)]()!=='',_0x577443=_0x4bdb10[_0x9857bc(0x182)]&&_0x4bdb10[_0x9857bc(0x182)][_0x9857bc(0x13b)]()!=='';_0x21f69a&&(_0x4ea3f8++,_0x29fcd0[_0x9857bc(0x183)](_0x4bdb10['Check_Manager'][_0x9857bc(0x13b)]()));_0x577443&&_0x458616++;_0x21f69a&&_0x577443&&_0x3da7db++;const _0x2bc879=_0x4bdb10[_0x9857bc(0x182)];_0x577443&&_0x2bc879&&(!_0x3762d4[_0x2bc879]&&(_0x3762d4[_0x2bc879]={'total':0x0,'registered':0x0}),_0x4bdb10['DateLogin']&&_0x3762d4[_0x2bc879][_0x9857bc(0x1ef)]++),_0x4bdb10[_0x9857bc(0x236)]&&_0xb2844e[_0x9857bc(0x173)]({'id':_0x21d645['id'],..._0x4bdb10});}),_0x1ec1d5[_0x1abbd3(0x202)](_0x1e5df9=>{const _0x289d1d=_0x1abbd3,_0x22d72e=_0x1e5df9[_0x289d1d(0x182)];_0x22d72e&&_0x22d72e[_0x289d1d(0x13b)]()!==''&&_0x3762d4[_0x22d72e]&&_0x3762d4[_0x22d72e][_0x289d1d(0x159)]++;}),allEmployeesData=_0x1ec1d5,employeesWithManager=_0x1ec1d5[_0x1abbd3(0x1c8)](_0xe5bda2=>_0xe5bda2['Check_Manager']&&_0xe5bda2[_0x1abbd3(0x223)][_0x1abbd3(0x13b)]()!==''),managerEmployeeCountElem[_0x1abbd3(0x23d)]=employeesWithManager[_0x1abbd3(0x139)],teamMemberCountElem[_0x1abbd3(0x23d)]=_0x458616,populateManagerFilter(_0x29fcd0);const _0x38c097=_0xb2844e[_0x1abbd3(0x139)],_0x2e73e2=_0xb2844e[_0x1abbd3(0x1c8)](_0x43759d=>_0x43759d[_0x1abbd3(0x236)]&&_0x43759d[_0x1abbd3(0x182)]&&_0x43759d[_0x1abbd3(0x182)]['trim']()!==''),_0x23c194=_0xb2844e[_0x1abbd3(0x1c8)](_0x465c4e=>_0x465c4e['DateLogin']&&(!_0x465c4e[_0x1abbd3(0x182)]||_0x465c4e[_0x1abbd3(0x182)][_0x1abbd3(0x13b)]()===''));attendeesCount[_0x1abbd3(0x23d)]=_0x23c194[_0x1abbd3(0x139)];!randomizeModal[_0x1abbd3(0x1bf)]['contains'](_0x1abbd3(0x142))&&(updateRandomizerDataBasedOnAllEmployees(),updateModalUI());const _0x5520e1=_0xb2844e[_0x1abbd3(0x139)];calculatedTarget=_0x3da7db;const _0x2d4a6c=calculatedTarget-_0x5520e1,_0x52fc3c=calculatedTarget>0x0?(_0x5520e1/calculatedTarget*0x64)[_0x1abbd3(0x1cb)](0x0):0x0;donutChart['data'][_0x1abbd3(0x1e1)][0x0][_0x1abbd3(0x1d8)]=[_0x5520e1,Math[_0x1abbd3(0x204)](0x0,_0x2d4a6c)],donutChart[_0x1abbd3(0x164)](),donutPercentage[_0x1abbd3(0x23d)]=_0x52fc3c+'%',targetCountElem[_0x1abbd3(0x23d)]=calculatedTarget;const _0x277f0b=_0x2e73e2['length'];participantsCountBoxElem[_0x1abbd3(0x23d)]=_0x277f0b,remainingCountElem[_0x1abbd3(0x23d)]=Math[_0x1abbd3(0x204)](0x0,calculatedTarget-_0x277f0b);const _0xbfb30f=_0x2e73e2[_0x1abbd3(0x139)],_0x5cd80d=_0x23c194[_0x1abbd3(0x139)];breakdownCenterTotal[_0x1abbd3(0x23d)]=_0x38c097,registrationBreakdownChart[_0x1abbd3(0x1d8)][_0x1abbd3(0x1e1)][0x0]['data']=[_0xbfb30f,_0x5cd80d],registrationBreakdownChart[_0x1abbd3(0x164)]();const _0x29a480={};teamNames['forEach'](_0x3f8355=>{_0x3762d4[_0x3f8355]&&(_0x29a480[_0x3f8355]=_0x3762d4[_0x3f8355]);});const _0x54d9a1=Object[_0x1abbd3(0x17b)](_0x29a480),_0x260498=_0x54d9a1[_0x1abbd3(0x120)](_0x605e25=>_0x29a480[_0x605e25][_0x1abbd3(0x1ef)]),_0x497653=_0x54d9a1[_0x1abbd3(0x120)](_0x50a628=>Math['max'](0x0,_0x29a480[_0x50a628]['total']-_0x29a480[_0x50a628][_0x1abbd3(0x1ef)])),_0x1c8259=Math[_0x1abbd3(0x169)](_0x54d9a1[_0x1abbd3(0x139)]/0x2),_0x53d355=_0x54d9a1['slice'](0x0,_0x1c8259),_0x57e347=_0x260498[_0x1abbd3(0x20b)](0x0,_0x1c8259),_0x358bba=_0x497653[_0x1abbd3(0x20b)](0x0,_0x1c8259),_0x2d5514=_0x54d9a1[_0x1abbd3(0x20b)](_0x1c8259),_0x316c5d=_0x260498['slice'](_0x1c8259),_0x4b0341=_0x497653[_0x1abbd3(0x20b)](_0x1c8259);barChart1['data'][_0x1abbd3(0x17c)]=_0x53d355,barChart1[_0x1abbd3(0x1d8)][_0x1abbd3(0x1e1)][0x0][_0x1abbd3(0x1d8)]=_0x57e347,barChart1[_0x1abbd3(0x1d8)][_0x1abbd3(0x1e1)][0x1][_0x1abbd3(0x1d8)]=_0x358bba,barChart1[_0x1abbd3(0x164)](),barChart2['data']['labels']=_0x2d5514,barChart2['data']['datasets'][0x0][_0x1abbd3(0x1d8)]=_0x316c5d,barChart2['data'][_0x1abbd3(0x1e1)][0x1]['data']=_0x4b0341,barChart2[_0x1abbd3(0x164)](),updateLatestRegistrationsTable(_0xb2844e),displaySelectedTeamMembers(),updateEmployeeListTable(_0x1ec1d5),updateGroupView(_0x1ec1d5);},_0x235ffa=>{const _0x3890a6=_0x3d6d;console[_0x3890a6(0x1e2)]('Error\x20listening\x20to\x20snapshot:\x20',_0x235ffa);});}catch(_0x18a1e7){console[_0x4034e9(0x1e2)](_0x4034e9(0x1b7),_0x18a1e7);}}function _0x50ea(){const _0x381f7a=['ไม่พบรหัสพนักงานนี้ในระบบ','push','tab-register','members','chart','Employee\x20data\x20updated\x20successfully.','FullName_th','confirmModal','editMemberEmpId','keys','labels','addEventListener','N/A','appendChild','</p>\x20<!--\x20(แก้ไข)\x20เพิ่ม\x20\x22ทีม\x22,\x20\x22text-xl\x22\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22p-4\x20text-center\x20','Showing\x20Reset\x20Team\x20confirmation...','Check_Place','add','currentDateTime','attendeesCount','Error\x20updating\x20RandomTime:\x20','#BFDBFE','3453016MiUAon','editEmpManager','สังกัด\x20(Check_Manager)','teamCreationStatus','ยืนยันการ\x20Reset\x20Team','from','4wzbBXL','Normal\x20group\x20employees\x20(initial):\x20','#6b7280','searchEmployeeButton','Adding\x20remaining\x20','bar','Position_th','teamMemberCountElem','randomizeError','</td>\x20<!--\x20(แก้ไข)\x20ใช้\x20FullName_th\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','#93C5FD','Editing:','Department_th','กำลังลบข้อมูล\x20....','px-3\x20py-1.5\x20text-xs\x20bg-red-600\x20text-white\x20rounded-md\x20hover:bg-red-700','digit3','querySelector','Could\x20not\x20assign\x20employee\x20(all\x20teams\x20full?):','ยืนยัน\x20Reset\x20Team','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x22>','replace','click','NickName','.csv','<tr><td\x20colspan=\x224\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>ยังไม่มีผู้ได้รับการสุ่ม</td></tr>','visibility','short','definedTeamNames','change','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20font-medium\x22>','selectedTeamTableBody','value','removeChild','doughnut','Distributing\x20N=','Error\x20resetting\x20teams:\x20','ยกเลิก','div','body','getContext','numeric','Error\x20setting\x20up\x20listener:\x20','participantsCountBox','editEmpName','จำนวนผู้เข้าร่วม','372gocdBa','setAttribute','เกิดข้อผิดพลาดในการอัปเดต:\x20','รหัสพนักงาน','classList','message','Final\x20teams\x20status:','indexOf','สมาชิกในทีม\x20',']\x20หรือไม่?\x20(ข้อมูล\x20ทีม\x20จะถูกล้างค่า)','ยืนยันการยกเลิกการสุ่ม','text/csv;charset=utf-8;','<p\x20class=\x22text-gray-500\x22>ไม่พบข้อมูลทีม</p>','filter','\x20members)','parsed','toFixed',']\x20ใช่หรือไม่?\x20(พนักงานจะกลับเข้าไปอยู่ในกลุ่มที่สุ่มได้อีกครั้ง)','ดำเนินการเสร็จแล้ว','border-blue-600','th-TH','option','bg-orange-100','เวลาที่ลงทะเบียน','function','has','editMemberEmpName','--\x20ไม่ระบุทีม\x20--','ลบรายการ','data','find','closeEditMemberModalButton','Team\x20member\x20fields\x20blanked\x20successfully.','closeGroupViewModalButton','random','bg-red-200','bottom','addMemberEmpName','datasets','error','label','teamCreationProgressBar','Normal\x20group\x20employees\x20(final):\x20','RandomTime','bg-green-200','ttb-register.firebaseapp.com','\x20คน','Error\x20saving\x20team\x20member\x20changes:','#3B82F6','\x20with\x20RandomTime:','5865417oJdezN','สร้างทีมสำเร็จ!','registered','team-list-content','join','toLocaleTimeString','commit','button','bg-gray-300','Debug','ชื่อเล่น','innerHTML','Invalid\x20employee\x20data\x20for\x20cancel\x20registration.','groupViewManagerFilter','log','Processing\x20Large\x20Group:\x20','กำลังเตรียมข้อมูล...','Admin\x20Signed\x20in\x20anonymously','disabled','bold','<tr><td\x20colspan=\x226\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>กรุณาเลือกสังกัด</td></tr>','forEach','36829260HOpcVZ','max','getElementById','เกิดข้อผิดพลาดในการรีเซ็ต:\x20','Total\x20to\x20assign:\x20','NO_MANAGER','round','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x20<!--\x20(เพิ่ม)\x20Cell\x20ใหม่สำหรับปุ่ม\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','slice','contains','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','teamBarChart2','center','</td>\x20<!--\x20(เพิ่ม)\x20สังกัด\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','breakdownCenterTotal','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ไม่พบสมาชิกในทีม\x20','text-gray-500','</td>\x20<!--\x20(แก้ไข)\x20นี่คือ\x20\x22กลุ่ม\x22\x20(BU_th)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','กรุณาใส่รหัสพนักงาน','donutPercentage','bg-orange-200','rounded-lg\x20shadow-sm\x20border\x20border-gray-200\x20cursor-pointer\x20hover:shadow-md\x20transition-shadow\x20overflow-hidden','searchEmployeeIdInput','Finished\x20Rule\x203\x20&\x204.\x20Final\x20team\x20assignments:','ไม่มีพนักงานที่ต้องจัดทีมใหม่','Mismatch\x20in\x20assigned\x20count!','cells','กำลังบันทึกข้อมูลทีม...','closeConfirmButton','digit4','remove','ยกเลิกการลงทะเบียน','Check_Manager','Registration\x20canceled\x20successfully.','<tr><td\x20colspan=\x226\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ไม่พบข้อมูลพนักงานสำหรับสังกัด:\x20','สำเร็จ','</td>\x20-->\x20<!--\x20(ลบ)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','className','localeCompare','2-digit','dataset','employeeId','ตำแหน่ง\x20(Position_th)','teamBarChart1','Error\x20deleting\x20(blanking)\x20team\x20member:','#ffffff','\x20เวลา\x20','deleteEditMemberModalButton','randomizeButton','pop','groupViewModal','DateLogin','digit5','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียนแล้ว</span>','คุณต้องการลบข้อมูลทีม\x20(Check_Place),\x20สถานะลงทะเบียน\x20(DateLogin),\x20ชื่อเล่น\x20(NickName),\x20และเวลาที่สุ่ม\x20(RandomTime)\x20ของพนักงานทั้งหมดหรือไม่?\x20(ข้อมูลพนักงานจะไม่ถูกลบ)','No\x20data\x20to\x20download\x20based\x20on\x20criteria.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','modalDrawnCount','textContent','</td>\x20<!--\x20(เพิ่ม)\x20ลำดับ\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ยังไม่มีผู้ลงทะเบียน</td></tr>','กำลังดำเนินการ...','closeAddMemberModalButton','1070273157855','docId','777966FThiCb','tab-team-list','ยังไม่ลงทะเบียน','saveEditModalButton','escape','UNKNOWN','warn','dataIndex','editEmpId','เกิดข้อผิดพลาด:\x20','toLocaleString','resetTeamButton','targetCount','createElement','addMemberEmpBU','bg-green-100','closeEditModalButton','Error\x20canceling\x20registration:','href','</td></tr>','Error\x20saving\x20employee\x20changes:','ยืนยันการยกเลิกการเป็นสมาชิกทีม','11065wgDfuJ','employeeListTableBody','bg-gray-100','addMemberManagerSelect','toDate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22>','editEmpTeam','80%','Update\x20successful','ผู้เข้าร่วมกิจกรรม','managers','ไม่','CRSG_Registered_Users_','วันที่\x20','onclick','<p\x20class=\x22text-red-600\x20text-center\x20text-lg\x20mt-10\x22>เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','crsg','floor','editTeamMemberModal','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>กรุณาเลือกทีม</td></tr>','bg-red-100','backgroundColor','กำลังจัดสรรกลุ่มใหญ่\x20(Rule\x202)...','<p\x20class=\x22text-xl\x20font-bold\x20text-gray-900\x20text-center\x22>','</td>\x20<!--\x20(เพิ่ม)\x20นี่คือ\x20\x22ทีม\x22\x20(Check_Place)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20(ลบ)\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','parse','confirmActionButton','groupViewModalTitle','winnerName','createTeamButton','คุณต้องการยกเลิกการลงทะเบียนของ\x20[','map','แก้ไข','Generating\x20CSV...','1992340ZdypSk','Employee\x20data\x20updated\x20via\x20Add\x20Member\x20modal.','.\x20Need\x20','width','winnerBU','entries','managerEmployeeCount','border-transparent','includes','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','สายงาน:\x20','toMillis','confirmText','</span><span\x20class=\x22text-xl\x20font-bold\x20text-gray-400\x22>\x20/\x20','ใช่,\x20ยืนยันยกเลิก','ไม่เหลือผู้เข้าร่วมกิจกรรมให้สุ่มแล้ว','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','confirmTitle','Creating\x20teams\x20based\x20on\x20new\x20rules...','กลุ่ม\x20(BU)','text-white\x20bg-red-500\x20hover:bg-red-600\x20text-xs\x20py-1\x20px-3\x20rounded\x20shadow','length','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20(เพิ่ม)\x20Cell\x20สำหรับปุ่มลบ\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','trim','text-white\x20bg-orange-500\x20hover:bg-orange-600\x20text-xs\x20py-1\x20px-3\x20rounded\x20shadow','managerFilterSelect','7fmmXDq','BU_th','ลงทะเบียนแล้ว','stringify','hidden','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','คุณต้องการยกเลิกการเป็นสมาชิกทีมของ\x20[','winnerEmployeeId','กำลังรีเซ็ตข้อมูลทีมและสถานะลงทะเบียน...','bg-white','#E5E7EB','tab-group-view','ปิดหน้าต่าง','กำลังจัดสรรกลุ่มปกติ\x20(Rule\x203)...','#2563EB','toLocaleDateString','hover:text-gray-700','end','hover:bg-gray-50','saveEditMemberModalButton','\x20for\x20','924609BcgroD','ทีม:\x20','style','winnerTeam','download','--\x20ไม่ระบุสังกัด\x20--','total','00000','set','</span>','ไม่พบพนักงานที่เข้าเงื่อนไข\x20(มี\x20Manager\x20และยังไม่มีทีม)\x20สำหรับจัดทีม','saveAddMemberModalButton','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>','sort','Large\x20group\x20managers:\x20','Finished\x20Rule\x202.\x20Teams\x20status:',']\x20หรือไม่?\x20(สถานะจะเปลี่ยนเป็น\x20\x27ยังไม่ลงทะเบียน\x27)','update','Error\x20updating\x20team\x20assignments:\x20','teamCreationProgressContainer','cancelWinnerButton','addMemberError','ceil','<span\x20class=\x22text-xl\x20font-bold\x20text-gray-900\x22>','register-content','reduce','editMemberTeamSelect','startRandomizeButton','winnerDetailModal','addMemberTeamSelect','</p>'];_0x50ea=function(){return _0x381f7a;};return _0x50ea();}function updateLatestRegistrationsTable(_0x5ac42b){const _0x3dd781=_0x29918f;latestRegistrationsTableBody['innerHTML']='';if(_0x5ac42b['length']===0x0){latestRegistrationsTableBody[_0x3dd781(0x1f8)]=_0x3dd781(0x23f);return;}_0x5ac42b[_0x3dd781(0x160)]((_0x1e995b,_0x55d375)=>{const _0x22a8c7=_0x3dd781,_0x19be57=_0x1e995b['DateLogin']?_0x1e995b['DateLogin'][_0x22a8c7(0x12f)]():0x0,_0x486474=_0x55d375['DateLogin']?_0x55d375[_0x22a8c7(0x236)][_0x22a8c7(0x12f)]():0x0;return _0x486474-_0x19be57;});const _0x287d29=_0x5ac42b['slice'](0x0,0x1e);_0x287d29['forEach']((_0x2be6f8,_0x3efc15)=>{const _0x571721=_0x3dd781,_0x34e7e5=document[_0x571721(0xf8)]('tr');_0x34e7e5['className']=_0x3efc15%0x2===0x0?_0x571721(0x147):'bg-gray-100';const _0x122916=!!_0x2be6f8[_0x571721(0x236)];_0x34e7e5[_0x571721(0x1f8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x2be6f8[_0x571721(0x22c)]||'')+_0x571721(0x1ab)+(_0x2be6f8[_0x571721(0x178)]||'')+_0x571721(0x197)+(_0x2be6f8[_0x571721(0x13f)]||'')+_0x571721(0x214)+(_0x2be6f8['Check_Manager']||'')+'</td>\x20<!--\x20(แก้ไข)\x20นี่คือ\x20\x22สังกัด\x22\x20(Check_Manager)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x2be6f8[_0x571721(0x182)]||'')+_0x571721(0x119)+(_0x2be6f8[_0x571721(0x19a)]||'')+'</td>\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20(เพิ่ม)\x20สถานะ\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x122916?_0x571721(0x12c):'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>')+_0x571721(0x13a);const _0x34e329=document[_0x571721(0xf8)]('button');_0x34e329[_0x571721(0x23d)]=_0x571721(0x1d7),_0x34e329[_0x571721(0x228)]=_0x571721(0x138),_0x34e329[_0x571721(0x10f)]=()=>showConfirmCancelRegistration(_0x2be6f8),_0x34e7e5[_0x571721(0x21d)][0x6]['appendChild'](_0x34e329),latestRegistrationsTableBody[_0x571721(0x17f)](_0x34e7e5);});}function updateEmployeeListTable(_0x3913ec){const _0x3c413=_0x29918f,_0x26a053=managerFilterSelect[_0x3c413(0x1ad)];employeeListTableBody['innerHTML']='';const _0x5b5a6e=_0x26a053?_0x3913ec[_0x3c413(0x1c8)](_0x13ff11=>{const _0x244a3f=_0x3c413;if(_0x26a053===_0x244a3f(0x208))return!_0x13ff11['Check_Manager']||_0x13ff11[_0x244a3f(0x223)][_0x244a3f(0x13b)]()==='';return _0x13ff11['Check_Manager']===_0x26a053;}):[];if(!_0x26a053){employeeListTableBody['innerHTML']=_0x3c413(0x201);return;}if(_0x5b5a6e[_0x3c413(0x139)]===0x0){employeeListTableBody['innerHTML']=_0x3c413(0x225)+_0x26a053+_0x3c413(0xfe);return;}_0x5b5a6e['sort']((_0x2da517,_0x471197)=>{const _0x49e18a=_0x3c413,_0x2551aa=teamNames[_0x49e18a(0x1c2)](_0x2da517['Check_Place']||''),_0x463202=teamNames[_0x49e18a(0x1c2)](_0x471197[_0x49e18a(0x182)]||''),_0xd35289=_0x2da517[_0x49e18a(0x178)]||'',_0x1a03d6=_0x471197[_0x49e18a(0x178)]||'',_0x5832a4=_0x2551aa===-0x1?Infinity:_0x2551aa,_0x4d410a=_0x463202===-0x1?Infinity:_0x463202;if(_0x5832a4<_0x4d410a)return-0x1;if(_0x5832a4>_0x4d410a)return 0x1;if(_0xd35289<_0x1a03d6)return-0x1;if(_0xd35289>_0x1a03d6)return 0x1;return 0x0;}),_0x5b5a6e[_0x3c413(0x202)]((_0x23cfd5,_0x358f52)=>{const _0x13d87f=_0x3c413,_0x237532=document[_0x13d87f(0xf8)]('tr');_0x237532[_0x13d87f(0x228)]=_0x358f52%0x2===0x0?_0x13d87f(0x147):_0x13d87f(0x103);const _0x35bb9f=_0x23cfd5['DateLogin']instanceof Timestamp,_0x27baaf=document['createElement'](_0x13d87f(0x1f4));_0x27baaf[_0x13d87f(0x23d)]='แก้ไข',_0x27baaf[_0x13d87f(0x228)]=_0x13d87f(0x13c),_0x27baaf[_0x13d87f(0x10f)]=()=>showEditModal(_0x23cfd5),_0x237532[_0x13d87f(0x1f8)]=_0x13d87f(0x106)+(_0x358f52+0x1)+_0x13d87f(0x12d)+(_0x23cfd5[_0x13d87f(0x22c)]||'')+_0x13d87f(0x1ab)+(_0x23cfd5[_0x13d87f(0x178)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x23cfd5[_0x13d87f(0x194)]||'')+_0x13d87f(0x227)+(_0x23cfd5[_0x13d87f(0x182)]||'')+_0x13d87f(0x143)+(_0x35bb9f?'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>':'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>')+_0x13d87f(0x20d),_0x237532['cells'][0x5]['appendChild'](_0x27baaf),employeeListTableBody[_0x13d87f(0x17f)](_0x237532);});}function setActiveTab(_0x506e5d,_0x3c6a90){const _0x4acc1f=_0x29918f;[tabDashboard,tabTeamList,tabGroupView,tabEmployeeList,tabRegister][_0x4acc1f(0x202)](_0x166e78=>{const _0x5dacff=_0x4acc1f;_0x166e78[_0x5dacff(0x1bf)]['add'](_0x5dacff(0x103),_0x5dacff(0x12a),_0x5dacff(0x213),'hover:text-gray-700','hover:border-gray-300'),_0x166e78[_0x5dacff(0x1bf)][_0x5dacff(0x221)]('bg-gray-300',_0x5dacff(0x1ce),'text-gray-700');}),[dashboardContent,teamListContent,groupViewContent,employeeListContent,registerContent][_0x4acc1f(0x202)](_0x5ca13c=>{const _0x2426e5=_0x4acc1f;_0x5ca13c[_0x2426e5(0x1bf)]['add'](_0x2426e5(0x142));}),_0x506e5d['classList'][_0x4acc1f(0x183)](_0x4acc1f(0x1f5),_0x4acc1f(0x1ce),'text-gray-700'),_0x506e5d[_0x4acc1f(0x1bf)][_0x4acc1f(0x221)](_0x4acc1f(0x103),_0x4acc1f(0x12a),'text-gray-500',_0x4acc1f(0x14e),'hover:border-gray-300'),_0x3c6a90[_0x4acc1f(0x1bf)][_0x4acc1f(0x221)]('hidden');}tabDashboard[_0x29918f(0x17d)]('click',()=>setActiveTab(tabDashboard,dashboardContent)),tabTeamList[_0x29918f(0x17d)](_0x29918f(0x1a3),()=>setActiveTab(tabTeamList,teamListContent)),tabGroupView[_0x29918f(0x17d)](_0x29918f(0x1a3),()=>setActiveTab(tabGroupView,groupViewContent)),tabEmployeeList[_0x29918f(0x17d)](_0x29918f(0x1a3),()=>setActiveTab(tabEmployeeList,employeeListContent)),tabRegister[_0x29918f(0x17d)](_0x29918f(0x1a3),()=>setActiveTab(tabRegister,registerContent));function shuffleArray(_0x200821){const _0x286a00=_0x29918f;for(let _0x4aa6f6=_0x200821[_0x286a00(0x139)]-0x1;_0x4aa6f6>0x0;_0x4aa6f6--){const _0x2999f6=Math['floor'](Math[_0x286a00(0x1dd)]()*(_0x4aa6f6+0x1));[_0x200821[_0x4aa6f6],_0x200821[_0x2999f6]]=[_0x200821[_0x2999f6],_0x200821[_0x4aa6f6]];}return _0x200821;}async function handleResetTeam(){const _0x2bc8cd=_0x29918f;console['log'](_0x2bc8cd(0x181)),currentConfirmAction=async()=>{const _0x57b815=_0x2bc8cd;confirmTitle[_0x57b815(0x23d)]=_0x57b815(0x240),confirmText['textContent']=_0x57b815(0x19b),confirmActionButton['disabled']=!![],closeConfirmButton[_0x57b815(0x1ff)]=!![],teamCreationStatus['textContent']=_0x57b815(0x146),teamCreationProgressContainer['classList'][_0x57b815(0x221)](_0x57b815(0x142)),teamCreationProgressBar[_0x57b815(0x155)][_0x57b815(0x126)]='0%',teamCreationProgressBar['textContent']='0%',resetTeamButton[_0x57b815(0x1ff)]=!![],createTeamButton[_0x57b815(0x1ff)]=!![];try{const _0x4bfdd4=writeBatch(db),_0x2bd71b=allEmployeesData[_0x57b815(0x139)];let _0xddf524=0x0;allEmployeesData[_0x57b815(0x202)](_0x5a1c32=>{const _0x2fe9b0=_0x57b815,_0x159cae=doc(db,'crsg',_0x5a1c32['id']);_0x4bfdd4['update'](_0x159cae,{'Check_Place':'','DateLogin':null,'NickName':'','RandomTime':null}),_0xddf524++;const _0x4e76a5=Math[_0x2fe9b0(0x209)](_0xddf524/_0x2bd71b*0x64);teamCreationProgressBar[_0x2fe9b0(0x155)][_0x2fe9b0(0x126)]=_0x4e76a5+'%',teamCreationProgressBar[_0x2fe9b0(0x23d)]=_0x4e76a5+'%';}),await _0x4bfdd4[_0x57b815(0x1f3)](),confirmTitle[_0x57b815(0x23d)]=_0x57b815(0x226),confirmText[_0x57b815(0x23d)]=_0x57b815(0x1cd),confirmActionButton['classList'][_0x57b815(0x183)](_0x57b815(0x142)),closeConfirmButton['textContent']=_0x57b815(0x14a),closeConfirmButton[_0x57b815(0x1ff)]=![],teamCreationStatus[_0x57b815(0x23d)]='รีเซ็ตข้อมูลทีมและสถานะลงทะเบียนสำเร็จ!',console[_0x57b815(0x1fb)]('Teams\x20and\x20login\x20status\x20reset\x20successfully.');}catch(_0x40bf79){console[_0x57b815(0x1e2)](_0x57b815(0x1b1),_0x40bf79),confirmTitle['textContent']='เกิดข้อผิดพลาด',confirmText[_0x57b815(0x23d)]=_0x57b815(0xf4)+_0x40bf79[_0x57b815(0x1c0)],closeConfirmButton[_0x57b815(0x23d)]=_0x57b815(0x14a),closeConfirmButton[_0x57b815(0x1ff)]=![],teamCreationStatus[_0x57b815(0x23d)]=_0x57b815(0x206)+_0x40bf79['message'];}finally{resetTeamButton[_0x57b815(0x1ff)]=![],createTeamButton[_0x57b815(0x1ff)]=![];}},confirmTitle['textContent']=_0x2bc8cd(0x18c),confirmText['textContent']=_0x2bc8cd(0x239),confirmActionButton[_0x2bc8cd(0x23d)]=_0x2bc8cd(0x1a0),confirmActionButton['className']=_0x2bc8cd(0x19c),confirmActionButton[_0x2bc8cd(0x1ff)]=![],confirmActionButton[_0x2bc8cd(0x1bf)][_0x2bc8cd(0x221)](_0x2bc8cd(0x142)),confirmActionButton[_0x2bc8cd(0x10f)]=()=>{const _0x4fba7a=_0x2bc8cd;typeof currentConfirmAction===_0x4fba7a(0x1d3)&&currentConfirmAction();},closeConfirmButton[_0x2bc8cd(0x23d)]='ไม่',closeConfirmButton['disabled']=![],closeConfirmButton['classList'][_0x2bc8cd(0x221)](_0x2bc8cd(0x142)),confirmModal['classList'][_0x2bc8cd(0x221)]('hidden');}async function handleCreateTeam(){const _0x3fb3aa=_0x29918f;console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x136)),teamCreationStatus['textContent']=_0x3fb3aa(0x1fd),teamCreationProgressContainer[_0x3fb3aa(0x1bf)][_0x3fb3aa(0x221)](_0x3fb3aa(0x142)),teamCreationProgressBar['style'][_0x3fb3aa(0x126)]='0%',teamCreationProgressBar[_0x3fb3aa(0x23d)]='0%',resetTeamButton[_0x3fb3aa(0x1ff)]=!![],createTeamButton[_0x3fb3aa(0x1ff)]=!![];const _0x4b1cbf=allEmployeesData['filter'](_0x4bc588=>_0x4bc588[_0x3fb3aa(0x223)]&&_0x4bc588[_0x3fb3aa(0x223)][_0x3fb3aa(0x13b)]()!==''&&(!_0x4bc588[_0x3fb3aa(0x182)]||_0x4bc588['Check_Place']['trim']()==='')),_0x5d5a05=_0x4b1cbf[_0x3fb3aa(0x139)];if(_0x5d5a05===0x0){teamCreationStatus[_0x3fb3aa(0x23d)]=_0x3fb3aa(0x15d),resetTeamButton[_0x3fb3aa(0x1ff)]=![],createTeamButton[_0x3fb3aa(0x1ff)]=![];return;}const _0x1ab103=Math['ceil'](_0x5d5a05/teamSize),_0x527511=teamNames[_0x3fb3aa(0x20b)](0x0,_0x1ab103),_0x2d214b=_0x527511[_0x527511['length']-0x1];console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x207)+_0x5d5a05+_0x3fb3aa(0x125)+_0x1ab103+'\x20teams:\x20'+_0x527511['join'](',\x20'));const _0xd0584d=_0x4b1cbf[_0x3fb3aa(0x16c)]((_0x36d784,_0x3b11b1)=>{const _0x5ed86a=_0x3fb3aa,_0x58cb95=_0x3b11b1[_0x5ed86a(0x223)]||_0x5ed86a(0xf0);return _0x36d784[_0x58cb95]=(_0x36d784[_0x58cb95]||0x0)+0x1,_0x36d784;},{});console[_0x3fb3aa(0x1fb)]('Manager\x20counts:',_0xd0584d);const _0x566c4a=new Map(),_0x4f7e40=[];_0x4b1cbf[_0x3fb3aa(0x202)](_0x42b655=>{const _0x5aa991=_0x3fb3aa,_0x2e3843=_0x42b655[_0x5aa991(0x223)]||'UNKNOWN';_0xd0584d[_0x2e3843]>_0x1ab103?(!_0x566c4a[_0x5aa991(0x1d4)](_0x2e3843)&&_0x566c4a[_0x5aa991(0x15b)](_0x2e3843,[]),_0x566c4a['get'](_0x2e3843)[_0x5aa991(0x173)](_0x42b655)):_0x4f7e40[_0x5aa991(0x173)](_0x42b655);}),console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x161)+_0x566c4a['size']),console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x18f)+_0x4f7e40['length']);const _0x5132b9={};_0x527511[_0x3fb3aa(0x202)](_0x182be0=>{_0x5132b9[_0x182be0]={'members':[],'managers':{}};});const _0x23d2cd={};let _0x11a0a8=0x0;teamCreationStatus['textContent']=_0x3fb3aa(0x117);let _0x5ee035=0x0;for(const [_0x2a3dd8,_0x3e4e9a]of _0x566c4a[_0x3fb3aa(0x128)]()){console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x1fc)+_0x2a3dd8+'\x20('+_0x3e4e9a[_0x3fb3aa(0x139)]+_0x3fb3aa(0x1c9)),shuffleArray(_0x3e4e9a);while(_0x3e4e9a['length']>_0x1ab103){const _0x4786a5=_0x3e4e9a[_0x3fb3aa(0x139)]>_0x1ab103*0x2?0x2:0x1;console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x1b0)+_0x4786a5+_0x3fb3aa(0x152)+_0x2a3dd8+'.\x20Remaining:\x20'+_0x3e4e9a[_0x3fb3aa(0x139)]);for(let _0x3a050c=0x0;_0x3a050c<_0x1ab103*_0x4786a5;_0x3a050c++){if(_0x3e4e9a[_0x3fb3aa(0x139)]===0x0)break;const _0x1ace93=_0x3e4e9a[_0x3fb3aa(0x234)]();let _0x547cb1=_0x527511[_0x5ee035],_0x1dca1d=_0x5132b9[_0x547cb1],_0x32b4f3=0x0;while(_0x547cb1!==_0x2d214b&&_0x1dca1d[_0x3fb3aa(0x175)][_0x3fb3aa(0x139)]>=teamSize&&_0x32b4f3<_0x1ab103){_0x5ee035=(_0x5ee035+0x1)%_0x1ab103,_0x547cb1=_0x527511[_0x5ee035],_0x1dca1d=_0x5132b9[_0x547cb1],_0x32b4f3++;}_0x547cb1!==_0x2d214b&&_0x1dca1d['members'][_0x3fb3aa(0x139)]>=teamSize&&(_0x547cb1=_0x2d214b,_0x1dca1d=_0x5132b9[_0x2d214b]);_0x1dca1d[_0x3fb3aa(0x175)]['push'](_0x1ace93),_0x1dca1d[_0x3fb3aa(0x10b)][_0x1ace93[_0x3fb3aa(0x223)]]=(_0x1dca1d[_0x3fb3aa(0x10b)][_0x1ace93['Check_Manager']]||0x0)+0x1,_0x23d2cd[_0x1ace93['id']]=_0x547cb1,_0x11a0a8++;const _0x1e091e=Math[_0x3fb3aa(0x209)](_0x11a0a8/_0x5d5a05*0x64);teamCreationProgressBar['style'][_0x3fb3aa(0x126)]=_0x1e091e+'%',teamCreationProgressBar[_0x3fb3aa(0x23d)]=_0x1e091e+'%',_0x5ee035=(_0x5ee035+0x1)%_0x1ab103;}}_0x3e4e9a[_0x3fb3aa(0x139)]>0x0&&(console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x192)+_0x3e4e9a[_0x3fb3aa(0x139)]+'\x20from\x20'+_0x2a3dd8+'\x20to\x20normal\x20group.'),_0x4f7e40[_0x3fb3aa(0x173)](..._0x3e4e9a));}console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x162),JSON[_0x3fb3aa(0x11a)](JSON[_0x3fb3aa(0x141)](_0x5132b9))),console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x1e5)+_0x4f7e40[_0x3fb3aa(0x139)]),teamCreationStatus[_0x3fb3aa(0x23d)]=_0x3fb3aa(0x14b),shuffleArray(_0x4f7e40);for(const _0x577d1f of _0x4f7e40){let _0x1d3f39=![];const _0x5a3f30=_0x577d1f['Check_Manager']||_0x3fb3aa(0xf0);for(const _0x13cd26 of _0x527511){const _0x413ef5=_0x5132b9[_0x13cd26],_0x3a3bce=_0x13cd26!==_0x2d214b&&_0x413ef5[_0x3fb3aa(0x175)][_0x3fb3aa(0x139)]>=teamSize;if(!_0x3a3bce&&!_0x413ef5[_0x3fb3aa(0x10b)][_0x5a3f30]){_0x413ef5[_0x3fb3aa(0x175)]['push'](_0x577d1f),_0x413ef5['managers'][_0x5a3f30]=0x1,_0x23d2cd[_0x577d1f['id']]=_0x13cd26,_0x1d3f39=!![];break;}}if(!_0x1d3f39)for(const _0x57b6dd of _0x527511){const _0x46478f=_0x5132b9[_0x57b6dd],_0x24869f=_0x57b6dd!==_0x2d214b&&_0x46478f[_0x3fb3aa(0x175)][_0x3fb3aa(0x139)]>=teamSize;if(!_0x24869f){_0x46478f['members'][_0x3fb3aa(0x173)](_0x577d1f),_0x46478f[_0x3fb3aa(0x10b)][_0x5a3f30]=(_0x46478f['managers'][_0x5a3f30]||0x0)+0x1,_0x23d2cd[_0x577d1f['id']]=_0x57b6dd,_0x1d3f39=!![];break;}}if(_0x1d3f39){_0x11a0a8++;const _0x2008b1=Math[_0x3fb3aa(0x209)](_0x11a0a8/_0x5d5a05*0x64);teamCreationProgressBar[_0x3fb3aa(0x155)]['width']=_0x2008b1+'%',teamCreationProgressBar['textContent']=_0x2008b1+'%';}else console[_0x3fb3aa(0x1e2)](_0x3fb3aa(0x19f),_0x577d1f);}console['log'](_0x3fb3aa(0x21a),_0x23d2cd),console[_0x3fb3aa(0x1fb)](_0x3fb3aa(0x1c1),_0x5132b9);if(Object[_0x3fb3aa(0x17b)](_0x23d2cd)[_0x3fb3aa(0x139)]>0x0){teamCreationStatus[_0x3fb3aa(0x23d)]=_0x3fb3aa(0x21e);try{const _0x573bde=writeBatch(db);Object[_0x3fb3aa(0x17b)](_0x23d2cd)['forEach'](_0x5a6799=>{const _0x2c6d57=_0x23d2cd[_0x5a6799],_0x413fb8=doc(db,'crsg',_0x5a6799);_0x573bde['update'](_0x413fb8,{'Check_Place':_0x2c6d57});}),await _0x573bde[_0x3fb3aa(0x1f3)](),_0x11a0a8<_0x5d5a05?(teamCreationStatus[_0x3fb3aa(0x23d)]='สร้างทีมสำเร็จบางส่วน\x20('+_0x11a0a8+'/'+_0x5d5a05+').',console[_0x3fb3aa(0x1e2)](_0x3fb3aa(0x21c))):teamCreationStatus['textContent']=_0x3fb3aa(0x1ee),console['log']('Teams\x20assignment\x20updated\x20successfully.'),displaySelectedTeamMembers();}catch(_0x19b402){console[_0x3fb3aa(0x1e2)](_0x3fb3aa(0x165),_0x19b402),teamCreationStatus['textContent']='เกิดข้อผิดพลาดในการบันทึก:\x20'+_0x19b402[_0x3fb3aa(0x1c0)];}finally{resetTeamButton['disabled']=![],createTeamButton[_0x3fb3aa(0x1ff)]=![];}}else teamCreationStatus[_0x3fb3aa(0x23d)]=_0x3fb3aa(0x21b),resetTeamButton['disabled']=![],createTeamButton[_0x3fb3aa(0x1ff)]=![];}function displaySelectedTeamMembers(){const _0x4e3100=_0x29918f,_0x53a375=teamSelect[_0x4e3100(0x1ad)];selectedTeamTableBody[_0x4e3100(0x1f8)]='';if(!_0x53a375){selectedTeamTableBody[_0x4e3100(0x1f8)]=_0x4e3100(0x114);return;}const _0x572cbb=allEmployeesData[_0x4e3100(0x1c8)](_0x6e7296=>_0x6e7296[_0x4e3100(0x182)]===_0x53a375);if(_0x572cbb[_0x4e3100(0x139)]===0x0){selectedTeamTableBody[_0x4e3100(0x1f8)]=_0x4e3100(0x212)+_0x53a375+'</td></tr>';return;}_0x572cbb[_0x4e3100(0x160)]((_0x18605c,_0x1e08d9)=>(_0x18605c[_0x4e3100(0x178)]||'')['localeCompare'](_0x1e08d9[_0x4e3100(0x178)]||'')),_0x572cbb[_0x4e3100(0x202)]((_0x41b6dd,_0x48799e)=>{const _0x4d984b=_0x4e3100,_0x5672b1=document['createElement']('tr');_0x5672b1[_0x4d984b(0x228)]=_0x48799e%0x2===0x0?_0x4d984b(0x147):_0x4d984b(0x103);const _0x46dedd=!!_0x41b6dd[_0x4d984b(0x236)];_0x5672b1[_0x4d984b(0x1f8)]=_0x4d984b(0x106)+(_0x48799e+0x1)+_0x4d984b(0x23e)+(_0x41b6dd['employeeId']||'')+_0x4d984b(0x1ab)+(_0x41b6dd[_0x4d984b(0x178)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x41b6dd[_0x4d984b(0x13f)]||'')+_0x4d984b(0x12d)+(_0x41b6dd['Check_Manager']||'')+_0x4d984b(0x210)+(_0x46dedd?'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียนแล้ว</span>':'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>')+_0x4d984b(0x20a);const _0x36a3d6=document[_0x4d984b(0xf8)]('button');_0x36a3d6[_0x4d984b(0x23d)]='แก้ไข',_0x36a3d6['className']=_0x4d984b(0x13c),_0x36a3d6[_0x4d984b(0x10f)]=()=>showEditTeamMemberModal(_0x41b6dd),_0x5672b1['cells'][0x6][_0x4d984b(0x17f)](_0x36a3d6),selectedTeamTableBody[_0x4d984b(0x17f)](_0x5672b1);});}function showEditTeamMemberModal(_0x197ad2){const _0x2d0e86=_0x29918f;console[_0x2d0e86(0x1fb)]('Editing\x20team\x20member:',_0x197ad2),currentEditingDocId=_0x197ad2['id'],editMemberEmpId[_0x2d0e86(0x23d)]=_0x197ad2[_0x2d0e86(0x22c)]||'N/A',editMemberEmpName['textContent']=_0x197ad2[_0x2d0e86(0x178)]||_0x2d0e86(0x17e),editMemberError['textContent']='',editMemberTeamSelect[_0x2d0e86(0x1f8)]='';const _0xb0accf=document['createElement'](_0x2d0e86(0x1d0));_0xb0accf['value']='',_0xb0accf[_0x2d0e86(0x23d)]=_0x2d0e86(0x1d6),editMemberTeamSelect['appendChild'](_0xb0accf),teamNames[_0x2d0e86(0x202)](_0x412be5=>{const _0x1086a1=_0x2d0e86,_0xd16604=document['createElement']('option');_0xd16604[_0x1086a1(0x1ad)]=_0x412be5,_0xd16604[_0x1086a1(0x23d)]=_0x412be5,editMemberTeamSelect[_0x1086a1(0x17f)](_0xd16604);}),editMemberTeamSelect[_0x2d0e86(0x1ad)]=_0x197ad2[_0x2d0e86(0x182)]||'',editTeamMemberModal['classList']['remove'](_0x2d0e86(0x142));}function closeEditTeamMemberModal(){const _0x4214ad=_0x29918f;editTeamMemberModal[_0x4214ad(0x1bf)][_0x4214ad(0x183)](_0x4214ad(0x142)),currentEditingDocId=null;}async function saveEditTeamMemberChanges(){const _0x30fcec=_0x29918f;if(!currentEditingDocId)return;const _0x2f9c7b=editMemberTeamSelect['value'];editMemberError[_0x30fcec(0x23d)]='',saveEditMemberModalButton[_0x30fcec(0x1ff)]=!![],deleteEditMemberModalButton[_0x30fcec(0x1ff)]=!![],closeEditMemberModalButton['disabled']=!![];try{const _0x124c43=doc(db,_0x30fcec(0x111),currentEditingDocId);await updateDoc(_0x124c43,{'Check_Place':_0x2f9c7b}),console[_0x30fcec(0x1fb)]('Team\x20member\x20team\x20updated\x20successfully.'),closeEditTeamMemberModal();}catch(_0x50d185){console[_0x30fcec(0x1e2)](_0x30fcec(0x1ea),_0x50d185),editMemberError[_0x30fcec(0x23d)]=_0x30fcec(0xf4)+_0x50d185[_0x30fcec(0x1c0)];}finally{saveEditMemberModalButton[_0x30fcec(0x1ff)]=![],deleteEditMemberModalButton[_0x30fcec(0x1ff)]=![],closeEditMemberModalButton[_0x30fcec(0x1ff)]=![];}}function handleShowConfirmDeleteMember(){const _0x103994=_0x29918f;if(!currentEditingDocId)return;currentConfirmAction=async()=>{const _0x7d78d9=_0x3d6d;console[_0x7d78d9(0x1fb)]('Deleting\x20(blanking)\x20member:',currentEditingDocId),saveEditMemberModalButton[_0x7d78d9(0x1ff)]=!![],deleteEditMemberModalButton[_0x7d78d9(0x1ff)]=!![],closeEditMemberModalButton[_0x7d78d9(0x1ff)]=!![];try{const _0x118923=doc(db,_0x7d78d9(0x111),currentEditingDocId);await updateDoc(_0x118923,{'Check_Place':''}),console['log'](_0x7d78d9(0x1db)),closeEditTeamMemberModal(),confirmModal[_0x7d78d9(0x1bf)][_0x7d78d9(0x183)](_0x7d78d9(0x142));}catch(_0x49677f){console[_0x7d78d9(0x1e2)](_0x7d78d9(0x22f),_0x49677f),editMemberError[_0x7d78d9(0x23d)]=_0x7d78d9(0xf4)+_0x49677f[_0x7d78d9(0x1c0)],confirmModal[_0x7d78d9(0x1bf)][_0x7d78d9(0x183)]('hidden');}finally{saveEditMemberModalButton[_0x7d78d9(0x1ff)]=![],deleteEditMemberModalButton['disabled']=![],closeEditMemberModalButton[_0x7d78d9(0x1ff)]=![],currentConfirmAction=null;}},confirmTitle['textContent']=_0x103994(0x100),confirmText[_0x103994(0x23d)]=_0x103994(0x144)+editMemberEmpName[_0x103994(0x23d)]+_0x103994(0x1c4),confirmActionButton[_0x103994(0x23d)]='ยืนยัน',confirmActionButton['className']=_0x103994(0x19c),confirmActionButton[_0x103994(0x1ff)]=![],confirmActionButton[_0x103994(0x1bf)]['remove']('hidden'),confirmActionButton[_0x103994(0x10f)]=()=>{const _0x592c06=_0x103994;typeof currentConfirmAction===_0x592c06(0x1d3)&&currentConfirmAction();},closeConfirmButton[_0x103994(0x23d)]=_0x103994(0x10c),closeConfirmButton['disabled']=![],closeConfirmButton['classList'][_0x103994(0x221)](_0x103994(0x142)),confirmModal[_0x103994(0x1bf)]['remove'](_0x103994(0x142));}function setupEditTeamMemberModalListeners(){const _0x3d0040=_0x29918f;closeEditMemberModalButton[_0x3d0040(0x17d)](_0x3d0040(0x1a3),closeEditTeamMemberModal),saveEditMemberModalButton[_0x3d0040(0x17d)](_0x3d0040(0x1a3),saveEditTeamMemberChanges),deleteEditMemberModalButton[_0x3d0040(0x17d)](_0x3d0040(0x1a3),handleShowConfirmDeleteMember);}function updateGroupView(_0x3d39dd){const _0x356545=_0x29918f;teamBoxesContainer[_0x356545(0x1f8)]='';const _0xd7bea5=groupViewManagerFilter[_0x356545(0x1ad)],_0x5efd80=_0xd7bea5?_0x3d39dd[_0x356545(0x1c8)](_0x10c96f=>{const _0x311d09=_0x356545;if(_0xd7bea5===_0x311d09(0x208))return!_0x10c96f[_0x311d09(0x223)]||_0x10c96f['Check_Manager'][_0x311d09(0x13b)]()==='';return _0x10c96f[_0x311d09(0x223)]===_0xd7bea5;}):_0x3d39dd,_0x4fb0ce=teamNames[_0x356545(0x16c)]((_0x31d11f,_0x3801e6)=>{return _0x31d11f[_0x3801e6]={'total':0x0,'registered':0x0},_0x31d11f;},{});let _0x49d315=0x0;_0x5efd80[_0x356545(0x202)](_0x3eee0c=>{const _0x4eff1a=_0x356545,_0x266e25=_0x3eee0c['Check_Place'];if(_0x266e25&&teamNames[_0x4eff1a(0x12b)](_0x266e25))_0x4fb0ce[_0x266e25]['total']++,_0x3eee0c[_0x4eff1a(0x236)]&&_0x4fb0ce[_0x266e25]['registered']++;else(!_0x266e25||_0x266e25['trim']()==='')&&_0x49d315++;}),teamNames['forEach'](_0x108bd1=>{const _0x25b7d5=_0x356545,_0x63ab60=_0x4fb0ce[_0x108bd1],_0x11db03=_0x63ab60[_0x25b7d5(0x159)],_0x1548d4=_0x63ab60[_0x25b7d5(0x1ef)],_0x239727=document[_0x25b7d5(0xf8)](_0x25b7d5(0x1b3));_0x239727[_0x25b7d5(0x228)]=_0x25b7d5(0x218);let _0x415cc9='bg-gray-100',_0x5599e0=_0x25b7d5(0x147),_0x5eaffb;if(_0x1548d4>0x0&&_0x1548d4===_0x11db03)_0x415cc9=_0x25b7d5(0x1e7),_0x5599e0=_0x25b7d5(0xfa),_0x5eaffb=_0x25b7d5(0x16a)+_0x1548d4+_0x25b7d5(0x131)+_0x11db03+_0x25b7d5(0x15c);else _0x1548d4>0x0&&_0x1548d4<_0x11db03?(_0x1548d4<=0x5?(_0x415cc9=_0x25b7d5(0x1de),_0x5599e0=_0x25b7d5(0x115)):(_0x415cc9=_0x25b7d5(0x217),_0x5599e0=_0x25b7d5(0x1d1)),_0x5eaffb=_0x25b7d5(0x16a)+_0x1548d4+_0x25b7d5(0x131)+_0x11db03+_0x25b7d5(0x15c)):_0x5eaffb=_0x25b7d5(0x118)+_0x11db03+_0x25b7d5(0x171);_0x239727[_0x25b7d5(0x1f8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22p-3\x20text-center\x20'+_0x415cc9+'\x20rounded-t-lg\x22>\x20<!--\x20(แก้ไข)\x20พื้นหลังเทา\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xl\x20font-bold\x20text-blue-700\x20text-center\x22>ทีม\x20'+_0x108bd1+_0x25b7d5(0x180)+_0x5599e0+'\x20rounded-b-lg\x22>\x20<!--\x20(แก้ไข)\x20พื้นหลังขาว\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5eaffb+'\x20<!--\x20(แก้ไข)\x20ใช้ตัวแปร\x20countText\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20text-center\x20mt-1\x22>สมาชิก</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x239727[_0x25b7d5(0x17d)](_0x25b7d5(0x1a3),()=>showGroupViewModal(_0x108bd1,_0x3d39dd)),teamBoxesContainer['appendChild'](_0x239727);}),teamNames[_0x356545(0x139)]===0x0&&(teamBoxesContainer['innerHTML']=_0x356545(0x1c7));}function showGroupViewModal(_0x4f80c4,_0x54df28){const _0x498182=_0x29918f;groupViewModalTitle['textContent']=_0x498182(0x1c3)+_0x4f80c4,groupViewTableBody[_0x498182(0x1f8)]='';const _0x4c018f=_0x54df28[_0x498182(0x1c8)](_0x49d876=>_0x49d876[_0x498182(0x182)]===_0x4f80c4);if(_0x4c018f[_0x498182(0x139)]===0x0){groupViewTableBody['innerHTML']=_0x498182(0x212)+_0x4f80c4+_0x498182(0xfe),groupViewModal[_0x498182(0x1bf)][_0x498182(0x221)](_0x498182(0x142));return;}_0x4c018f[_0x498182(0x160)]((_0x45526e,_0x4e588d)=>{const _0x4f048c=_0x498182,_0x529ba5=_0x45526e[_0x4f048c(0x223)]||'',_0x56233f=_0x4e588d[_0x4f048c(0x223)]||'',_0x32e50e=_0x45526e[_0x4f048c(0x178)]||'',_0x3cad1a=_0x4e588d[_0x4f048c(0x178)]||'';if(_0x529ba5<_0x56233f)return-0x1;if(_0x529ba5>_0x56233f)return 0x1;return _0x32e50e[_0x4f048c(0x229)](_0x3cad1a);}),_0x4c018f[_0x498182(0x202)]((_0x3f6cf9,_0x176d4f)=>{const _0x2f22e5=_0x498182,_0x36b749=document[_0x2f22e5(0xf8)]('tr');_0x36b749[_0x2f22e5(0x228)]=_0x176d4f%0x2===0x0?_0x2f22e5(0x147):_0x2f22e5(0x103);const _0x117ea4=!!_0x3f6cf9[_0x2f22e5(0x236)];_0x36b749[_0x2f22e5(0x1f8)]=_0x2f22e5(0x106)+(_0x176d4f+0x1)+_0x2f22e5(0x12d)+(_0x3f6cf9[_0x2f22e5(0x22c)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20font-medium\x22>'+(_0x3f6cf9[_0x2f22e5(0x178)]||'')+_0x2f22e5(0x12d)+(_0x3f6cf9['BU_th']||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x3f6cf9[_0x2f22e5(0x223)]||'')+_0x2f22e5(0x134)+(_0x117ea4?_0x2f22e5(0x238):_0x2f22e5(0x15f))+_0x2f22e5(0x23b);const _0x2fdf73=document['createElement'](_0x2f22e5(0x1f4));_0x2fdf73[_0x2f22e5(0x23d)]=_0x2f22e5(0x121),_0x2fdf73[_0x2f22e5(0x228)]='text-white\x20bg-orange-500\x20hover:bg-orange-600\x20text-xs\x20py-1\x20px-3\x20rounded\x20shadow',_0x2fdf73[_0x2f22e5(0x10f)]=()=>showEditTeamMemberModal(_0x3f6cf9),_0x36b749[_0x2f22e5(0x21d)][0x6][_0x2f22e5(0x17f)](_0x2fdf73),groupViewTableBody['appendChild'](_0x36b749);}),groupViewModal[_0x498182(0x1bf)][_0x498182(0x221)]('hidden');}function setupGroupViewListeners(){const _0x484e2e=_0x29918f;closeGroupViewModalButton[_0x484e2e(0x17d)](_0x484e2e(0x1a3),()=>{const _0x540f66=_0x484e2e;groupViewModal[_0x540f66(0x1bf)][_0x540f66(0x183)](_0x540f66(0x142));}),groupViewManagerFilter[_0x484e2e(0x17d)](_0x484e2e(0x1aa),()=>updateGroupView(allEmployeesData));}function showConfirmCancelRegistration(_0x143e2a){const _0x99fea7=_0x29918f;if(!_0x143e2a||!_0x143e2a['id']){console[_0x99fea7(0x1e2)](_0x99fea7(0x1f9));return;}currentConfirmAction=async()=>{const _0x2d8f54=_0x99fea7;console['log']('Canceling\x20registration\x20for:',_0x143e2a[_0x2d8f54(0x178)]),confirmActionButton[_0x2d8f54(0x1ff)]=!![],closeConfirmButton['disabled']=!![];try{const _0x5c5dd1=doc(db,_0x2d8f54(0x111),_0x143e2a['id']);await updateDoc(_0x5c5dd1,{'DateLogin':null}),console['log'](_0x2d8f54(0x224)),confirmModal['classList'][_0x2d8f54(0x183)](_0x2d8f54(0x142));}catch(_0x4202f0){console[_0x2d8f54(0x1e2)](_0x2d8f54(0xfc),_0x4202f0),confirmText[_0x2d8f54(0x23d)]=_0x2d8f54(0xf4)+_0x4202f0[_0x2d8f54(0x1c0)],confirmActionButton[_0x2d8f54(0x1ff)]=![],closeConfirmButton[_0x2d8f54(0x1ff)]=![];}finally{currentConfirmAction=null;}},confirmTitle[_0x99fea7(0x23d)]='ยืนยันการยกเลิกการลงทะเบียน',confirmText[_0x99fea7(0x23d)]=_0x99fea7(0x11f)+_0x143e2a[_0x99fea7(0x178)]+_0x99fea7(0x163),confirmActionButton[_0x99fea7(0x23d)]=_0x99fea7(0x222),confirmActionButton[_0x99fea7(0x228)]=_0x99fea7(0x19c),confirmActionButton['disabled']=![],confirmActionButton[_0x99fea7(0x1bf)][_0x99fea7(0x221)](_0x99fea7(0x142)),confirmActionButton[_0x99fea7(0x10f)]=()=>{const _0x339243=_0x99fea7;typeof currentConfirmAction===_0x339243(0x1d3)&&currentConfirmAction();},closeConfirmButton[_0x99fea7(0x23d)]='ปิดหน้าต่าง',closeConfirmButton['disabled']=![],closeConfirmButton[_0x99fea7(0x1bf)][_0x99fea7(0x221)](_0x99fea7(0x142)),confirmModal['classList'][_0x99fea7(0x221)](_0x99fea7(0x142));}function updateRandomizerDataBasedOnAllEmployees(){const _0x5c1417=_0x29918f;currentParticipants=allEmployeesData[_0x5c1417(0x1c8)](_0x1ac4c1=>_0x1ac4c1[_0x5c1417(0x236)]&&_0x1ac4c1[_0x5c1417(0x182)]&&_0x1ac4c1[_0x5c1417(0x182)][_0x5c1417(0x13b)]()!==''),availableToDraw=currentParticipants[_0x5c1417(0x1c8)](_0x702a66=>!_0x702a66[_0x5c1417(0x1e6)]),alreadyDrawn=currentParticipants[_0x5c1417(0x1c8)](_0x5169fd=>_0x5169fd['RandomTime']),randomizeError[_0x5c1417(0x23d)]='';}function updateModalUI(){const _0x1942a=_0x29918f;modalParticipantsCount[_0x1942a(0x23d)]=availableToDraw[_0x1942a(0x139)],modalDrawnCount['textContent']=alreadyDrawn[_0x1942a(0x139)],renderDrawnWinnersTable(),startRandomizeButton[_0x1942a(0x1ff)]=availableToDraw[_0x1942a(0x139)]===0x0;}function renderDrawnWinnersTable(){const _0x2d3a51=_0x29918f;drawnWinnersTableBody[_0x2d3a51(0x1f8)]='';if(alreadyDrawn[_0x2d3a51(0x139)]===0x0){drawnWinnersTableBody[_0x2d3a51(0x1f8)]=_0x2d3a51(0x1a6);return;}alreadyDrawn[_0x2d3a51(0x160)]((_0x455b5d,_0x443f2b)=>(_0x443f2b['RandomTime']?_0x443f2b['RandomTime'][_0x2d3a51(0x105)]():0x0)-(_0x455b5d['RandomTime']?_0x455b5d[_0x2d3a51(0x1e6)][_0x2d3a51(0x105)]():0x0)),alreadyDrawn[_0x2d3a51(0x202)](_0x3652ee=>{const _0x48f9e3=_0x2d3a51,_0xb4925a=document['createElement']('tr');_0xb4925a[_0x48f9e3(0x228)]=_0x48f9e3(0x150);const _0x13d10a=document[_0x48f9e3(0xf8)](_0x48f9e3(0x1f4));_0x13d10a[_0x48f9e3(0x23d)]=_0x48f9e3(0x1b2),_0x13d10a[_0x48f9e3(0x228)]='text-red-600\x20hover:text-red-800\x20text-xs\x20py-1\x20px-2\x20rounded',_0x13d10a[_0x48f9e3(0x10f)]=()=>handleShowConfirmCancelRandom(_0x3652ee['id'],_0x3652ee['FullName_th']),_0xb4925a[_0x48f9e3(0x1f8)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x22>'+(_0x3652ee[_0x48f9e3(0x22c)]||'')+_0x48f9e3(0x1a1)+(_0x3652ee[_0x48f9e3(0x178)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x22>'+(_0x3652ee[_0x48f9e3(0x13f)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0xb4925a[_0x48f9e3(0x21d)][0x3][_0x48f9e3(0x17f)](_0x13d10a),drawnWinnersTableBody[_0x48f9e3(0x17f)](_0xb4925a);});}async function updateRandomTime(_0x50f83a,_0x578e7b){const _0x2656f2=_0x29918f;if(!_0x50f83a)return;console[_0x2656f2(0x1fb)]('Updating\x20doc\x20'+_0x50f83a+_0x2656f2(0x1ec),_0x578e7b);try{const _0x3fb972=doc(db,'crsg',_0x50f83a);await updateDoc(_0x3fb972,{'RandomTime':_0x578e7b}),console[_0x2656f2(0x1fb)](_0x2656f2(0x109));}catch(_0x21de60){console['error'](_0x2656f2(0x186),_0x21de60),randomizeError[_0x2656f2(0x23d)]=_0x2656f2(0x1bd)+_0x21de60['message'];}}function handleShowConfirmCancelRandom(_0x5a6d53,_0x1ce515){const _0x1da1f8=_0x29918f;docIdToCancel=_0x5a6d53,currentConfirmAction=async()=>{const _0x5e0019=_0x3d6d;await updateRandomTime(docIdToCancel,null),docIdToCancel=null,confirmModal[_0x5e0019(0x1bf)][_0x5e0019(0x183)](_0x5e0019(0x142)),!winnerDetailModal['classList'][_0x5e0019(0x20c)](_0x5e0019(0x142))&&winnerDetailModal[_0x5e0019(0x1bf)]['add'](_0x5e0019(0x142));},confirmTitle['textContent']=_0x1da1f8(0x1c5),confirmText[_0x1da1f8(0x23d)]='คุณต้องการยกเลิกการสุ่มของ\x20['+_0x1ce515+_0x1da1f8(0x1cc),confirmActionButton[_0x1da1f8(0x23d)]=_0x1da1f8(0x132),confirmActionButton[_0x1da1f8(0x228)]=_0x1da1f8(0x19c),confirmActionButton['disabled']=![],confirmActionButton[_0x1da1f8(0x1bf)]['remove'](_0x1da1f8(0x142)),confirmActionButton['onclick']=()=>{const _0x370a7e=_0x1da1f8;typeof currentConfirmAction===_0x370a7e(0x1d3)&&currentConfirmAction();},closeConfirmButton['textContent']='ไม่',closeConfirmButton[_0x1da1f8(0x1ff)]=![],closeConfirmButton['classList'][_0x1da1f8(0x221)](_0x1da1f8(0x142)),confirmModal[_0x1da1f8(0x1bf)]['remove'](_0x1da1f8(0x142));}async function handleRandomization(){const _0x760068=_0x29918f;if(availableToDraw['length']===0x0){randomizeError['textContent']=_0x760068(0x133);return;}startRandomizeButton['disabled']=!![],randomizeError[_0x760068(0x23d)]='';let _0x1f21fb=0x0;randomizationInterval=setInterval(()=>{const _0x469e5a=_0x760068;digits[_0x469e5a(0x202)](_0x38fe2f=>{const _0x5042d3=_0x469e5a;_0x38fe2f[_0x5042d3(0x23d)]=Math[_0x5042d3(0x112)](Math[_0x5042d3(0x1dd)]()*0xa);}),_0x1f21fb++;if(_0x1f21fb>0x14){clearInterval(randomizationInterval);const _0xb3ab1e=availableToDraw[Math['floor'](Math[_0x469e5a(0x1dd)]()*availableToDraw['length'])],_0x36751b=(_0xb3ab1e[_0x469e5a(0x22c)]||_0x469e5a(0x15a))[_0x469e5a(0x20b)](-0x5)['padStart'](0x5,'0');digits['forEach']((_0x51810b,_0x31a4ff)=>_0x51810b[_0x469e5a(0x23d)]=_0x36751b[_0x31a4ff]),updateRandomTime(_0xb3ab1e['id'],serverTimestamp())['then'](()=>{const _0x53e26e=_0x469e5a;winnerName[_0x53e26e(0x23d)]=_0xb3ab1e['FullName_th']||_0x53e26e(0x17e),winnerEmployeeId[_0x53e26e(0x23d)]='รหัส:\x20'+(_0xb3ab1e['employeeId']||'N/A'),winnerTeam[_0x53e26e(0x23d)]=_0x53e26e(0x154)+(_0xb3ab1e['Check_Place']||_0x53e26e(0x17e)),winnerBU[_0x53e26e(0x23d)]=_0x53e26e(0x12e)+(_0xb3ab1e['BU_th']||'N/A'),cancelWinnerButton[_0x53e26e(0x22b)][_0x53e26e(0xea)]=_0xb3ab1e['id'],winnerDetailModal[_0x53e26e(0x1bf)][_0x53e26e(0x221)](_0x53e26e(0x142)),startRandomizeButton[_0x53e26e(0x1ff)]=![];});}},0x64);}async function handleCancelWinner(){const _0x50176a=_0x29918f,_0x51426f=cancelWinnerButton[_0x50176a(0x22b)][_0x50176a(0xea)],_0x259760=alreadyDrawn[_0x50176a(0x1d9)](_0x27f15d=>_0x27f15d['id']===_0x51426f);handleShowConfirmCancelRandom(_0x51426f,_0x259760?.[_0x50176a(0x178)]||_0x50176a(0x17e));}function setupModalListeners(){const _0x1c76b2=_0x29918f;randomizeButton[_0x1c76b2(0x17d)]('click',()=>{const _0x46572e=_0x1c76b2;updateRandomizerDataBasedOnAllEmployees(),updateModalUI(),randomizeModal[_0x46572e(0x1bf)][_0x46572e(0x221)]('hidden');}),closeRandomizeModalButton[_0x1c76b2(0x17d)](_0x1c76b2(0x1a3),()=>{const _0x2c4561=_0x1c76b2;randomizeModal[_0x2c4561(0x1bf)][_0x2c4561(0x183)](_0x2c4561(0x142));}),startRandomizeButton[_0x1c76b2(0x17d)](_0x1c76b2(0x1a3),handleRandomization),closeWinnerModalButton[_0x1c76b2(0x17d)](_0x1c76b2(0x1a3),()=>{const _0x3282c9=_0x1c76b2;winnerDetailModal[_0x3282c9(0x1bf)][_0x3282c9(0x183)](_0x3282c9(0x142));}),cancelWinnerButton[_0x1c76b2(0x17d)]('click',handleCancelWinner),closeConfirmButton[_0x1c76b2(0x17d)](_0x1c76b2(0x1a3),()=>{const _0x595d90=_0x1c76b2;confirmModal[_0x595d90(0x1bf)][_0x595d90(0x183)](_0x595d90(0x142)),confirmTitle[_0x595d90(0x23d)]='ยืนยัน',confirmText[_0x595d90(0x23d)]='',confirmActionButton[_0x595d90(0x1ff)]=![],confirmActionButton[_0x595d90(0x1bf)]['remove'](_0x595d90(0x142)),closeConfirmButton['textContent']=_0x595d90(0x10c),closeConfirmButton[_0x595d90(0x1ff)]=![],currentConfirmAction=null,docIdToCancel=null;}),downloadCsvButton[_0x1c76b2(0x17d)](_0x1c76b2(0x1a3),handleDownloadCSV);}function setupTeamTabListeners(){const _0x55ee38=_0x29918f;resetTeamButton[_0x55ee38(0x17d)]('click',handleResetTeam),createTeamButton['addEventListener'](_0x55ee38(0x1a3),handleCreateTeam),teamSelect[_0x55ee38(0x17d)](_0x55ee38(0x1aa),displaySelectedTeamMembers);}function setupEmployeeListListeners(){const _0x6258dd=_0x29918f;managerFilterSelect[_0x6258dd(0x17d)]('change',()=>{updateEmployeeListTable(allEmployeesData);}),closeEditModalButton[_0x6258dd(0x17d)]('click',closeEditModal),saveEditModalButton[_0x6258dd(0x17d)](_0x6258dd(0x1a3),saveEmployeeChanges);}function populateManagerFilter(_0x26ca2c){const _0xb98f2f=_0x29918f,_0x1b8e7c=managerFilterSelect[_0xb98f2f(0x1ad)],_0x39178a=managerFilterSelect['querySelectorAll']('option');_0x39178a['forEach'](_0x3cabc2=>{const _0x31f648=_0xb98f2f;_0x3cabc2[_0x31f648(0x1ad)]!==''&&_0x3cabc2[_0x31f648(0x221)]();});const _0x4016b2=Array[_0xb98f2f(0x18d)](_0x26ca2c)[_0xb98f2f(0x160)]();_0x4016b2[_0xb98f2f(0x202)](_0x5bb82c=>{const _0x538f00=_0xb98f2f;if(_0x5bb82c&&_0x5bb82c[_0x538f00(0x13b)]()!==''){const _0x179940=document[_0x538f00(0xf8)](_0x538f00(0x1d0));_0x179940[_0x538f00(0x1ad)]=_0x5bb82c,_0x179940['textContent']=_0x5bb82c,managerFilterSelect[_0x538f00(0x17f)](_0x179940);}});if(_0x1b8e7c&&managerFilterSelect['querySelector']('option[value=\x22'+CSS[_0xb98f2f(0xef)](_0x1b8e7c)+'\x22]'))managerFilterSelect['value']=_0x1b8e7c;else _0x1b8e7c===''&&(managerFilterSelect[_0xb98f2f(0x1ad)]='');const _0x4cdedf=groupViewManagerFilter[_0xb98f2f(0x1ad)],_0x209130=groupViewManagerFilter['querySelectorAll'](_0xb98f2f(0x1d0));_0x209130[_0xb98f2f(0x202)](_0x4ea270=>{const _0x259d3a=_0xb98f2f;_0x4ea270[_0x259d3a(0x1ad)]!==''&&_0x4ea270[_0x259d3a(0x221)]();});if(!groupViewManagerFilter['querySelector']('option[value=\x22NO_MANAGER\x22]')){const _0x57f8e4=document['createElement'](_0xb98f2f(0x1d0));_0x57f8e4['value']='NO_MANAGER',_0x57f8e4[_0xb98f2f(0x23d)]=_0xb98f2f(0x158),groupViewManagerFilter[_0xb98f2f(0x17f)](_0x57f8e4);}_0x4016b2[_0xb98f2f(0x202)](_0x4e6140=>{const _0x2c1cf4=_0xb98f2f;if(_0x4e6140&&_0x4e6140[_0x2c1cf4(0x13b)]()!==''){const _0x5033d8=document['createElement']('option');_0x5033d8[_0x2c1cf4(0x1ad)]=_0x4e6140,_0x5033d8[_0x2c1cf4(0x23d)]=_0x4e6140,groupViewManagerFilter[_0x2c1cf4(0x17f)](_0x5033d8);}});if(_0x4cdedf&&groupViewManagerFilter[_0xb98f2f(0x19e)]('option[value=\x22'+CSS['escape'](_0x4cdedf)+'\x22]'))groupViewManagerFilter[_0xb98f2f(0x1ad)]=_0x4cdedf;else _0x4cdedf===''&&(groupViewManagerFilter[_0xb98f2f(0x1ad)]='');}function showEditModal(_0x178bdb){const _0x486f33=_0x29918f;console[_0x486f33(0x1fb)](_0x486f33(0x199),_0x178bdb),currentEditingDocId=_0x178bdb['id'],editEmpId[_0x486f33(0x23d)]=_0x178bdb[_0x486f33(0x22c)]||_0x486f33(0x17e),editEmpName[_0x486f33(0x23d)]=_0x178bdb['FullName_th']||'N/A',editEmpManager['value']=_0x178bdb[_0x486f33(0x223)]||'',editEmpTeam['value']=_0x178bdb[_0x486f33(0x182)]||'',editError[_0x486f33(0x23d)]='',editEmployeeModal[_0x486f33(0x1bf)][_0x486f33(0x221)](_0x486f33(0x142));}function closeEditModal(){const _0x327421=_0x29918f;editEmployeeModal[_0x327421(0x1bf)][_0x327421(0x183)](_0x327421(0x142)),currentEditingDocId=null;}async function saveEmployeeChanges(){const _0x373b64=_0x29918f;if(!currentEditingDocId)return;const _0x4154ad=editEmpManager[_0x373b64(0x1ad)],_0x59d754=editEmpTeam['value'];editError['textContent']='',saveEditModalButton[_0x373b64(0x1ff)]=!![];try{const _0x308e50=doc(db,_0x373b64(0x111),currentEditingDocId);await updateDoc(_0x308e50,{'Check_Manager':_0x4154ad,'Check_Place':_0x59d754}),console[_0x373b64(0x1fb)](_0x373b64(0x177)),closeEditModal();}catch(_0x2074ce){console[_0x373b64(0x1e2)](_0x373b64(0xff),_0x2074ce),editError[_0x373b64(0x23d)]=_0x373b64(0xf4)+_0x2074ce[_0x373b64(0x1c0)];}finally{saveEditModalButton[_0x373b64(0x1ff)]=![];}}function handleSearchEmployee(){const _0x4b946b=_0x29918f,_0x289924=searchEmployeeIdInput['value'][_0x4b946b(0x13b)]();searchEmployeeError[_0x4b946b(0x23d)]='';if(!_0x289924){searchEmployeeError[_0x4b946b(0x23d)]=_0x4b946b(0x215);return;}const _0x214464=allEmployeesData[_0x4b946b(0x1d9)](_0xeea6a=>_0xeea6a[_0x4b946b(0x22c)]===_0x289924);_0x214464?showAddMemberModal(_0x214464):searchEmployeeError[_0x4b946b(0x23d)]=_0x4b946b(0x172);}function showAddMemberModal(_0x3ca0c5){const _0x237545=_0x29918f;currentAddingDocId=_0x3ca0c5['id'],addMemberError[_0x237545(0x23d)]='',addMemberEmpId[_0x237545(0x23d)]=_0x3ca0c5['employeeId']||_0x237545(0x17e),addMemberEmpName['textContent']=_0x3ca0c5[_0x237545(0x178)]||_0x237545(0x17e),addMemberEmpBU['textContent']=_0x3ca0c5[_0x237545(0x13f)]||_0x237545(0x17e),addMemberManagerSelect['innerHTML']='';const _0x1be6fa=document[_0x237545(0xf8)]('option');_0x1be6fa['value']='',_0x1be6fa['textContent']=_0x237545(0x158),addMemberManagerSelect[_0x237545(0x17f)](_0x1be6fa);const _0x4fd01f=new Set(allEmployeesData[_0x237545(0x120)](_0xc47277=>_0xc47277[_0x237545(0x223)])[_0x237545(0x1c8)](Boolean)),_0x4c5444=Array['from'](_0x4fd01f)[_0x237545(0x160)]();_0x4c5444[_0x237545(0x202)](_0x517848=>{const _0x2c46c6=_0x237545,_0x524684=document[_0x2c46c6(0xf8)](_0x2c46c6(0x1d0));_0x524684[_0x2c46c6(0x1ad)]=_0x517848,_0x524684[_0x2c46c6(0x23d)]=_0x517848,addMemberManagerSelect[_0x2c46c6(0x17f)](_0x524684);}),addMemberManagerSelect['value']=_0x3ca0c5[_0x237545(0x223)]||'',addMemberTeamSelect['innerHTML']='';const _0x2c1292=document[_0x237545(0xf8)](_0x237545(0x1d0));_0x2c1292[_0x237545(0x1ad)]='',_0x2c1292[_0x237545(0x23d)]=_0x237545(0x1d6),addMemberTeamSelect[_0x237545(0x17f)](_0x2c1292),teamNames[_0x237545(0x202)](_0x484ae8=>{const _0x4eecc4=_0x237545,_0xebe831=document['createElement'](_0x4eecc4(0x1d0));_0xebe831[_0x4eecc4(0x1ad)]=_0x484ae8,_0xebe831[_0x4eecc4(0x23d)]=_0x484ae8,addMemberTeamSelect[_0x4eecc4(0x17f)](_0xebe831);}),addMemberTeamSelect[_0x237545(0x1ad)]=_0x3ca0c5[_0x237545(0x182)]||'',addMemberModal[_0x237545(0x1bf)][_0x237545(0x221)](_0x237545(0x142));}function closeAddMemberModal(){const _0x286ad2=_0x29918f;addMemberModal[_0x286ad2(0x1bf)][_0x286ad2(0x183)](_0x286ad2(0x142)),currentAddingDocId=null,searchEmployeeIdInput[_0x286ad2(0x1ad)]='',searchEmployeeError[_0x286ad2(0x23d)]='';}async function saveAddMemberChanges(){const _0x57f039=_0x29918f;if(!currentAddingDocId)return;const _0x2186c9=addMemberManagerSelect[_0x57f039(0x1ad)],_0x5a8fbe=addMemberTeamSelect[_0x57f039(0x1ad)];addMemberError[_0x57f039(0x23d)]='',saveAddMemberModalButton['disabled']=!![],closeAddMemberModalButton[_0x57f039(0x1ff)]=!![];try{const _0x14a32e=doc(db,'crsg',currentAddingDocId);await updateDoc(_0x14a32e,{'Check_Manager':_0x2186c9,'Check_Place':_0x5a8fbe}),console['log'](_0x57f039(0x124)),closeAddMemberModal();}catch(_0x2e6b27){console['error']('Error\x20saving\x20employee\x20changes:',_0x2e6b27),addMemberError['textContent']=_0x57f039(0xf4)+_0x2e6b27[_0x57f039(0x1c0)];}finally{saveAddMemberModalButton[_0x57f039(0x1ff)]=![],closeAddMemberModalButton[_0x57f039(0x1ff)]=![];}}function setupAddMemberModalListeners(){const _0x171cc4=_0x29918f;searchEmployeeButton[_0x171cc4(0x17d)](_0x171cc4(0x1a3),handleSearchEmployee),closeAddMemberModalButton[_0x171cc4(0x17d)](_0x171cc4(0x1a3),closeAddMemberModal),saveAddMemberModalButton[_0x171cc4(0x17d)](_0x171cc4(0x1a3),saveAddMemberChanges);}function handleDownloadCSV(){const _0x4b52cb=_0x29918f;console[_0x4b52cb(0x1fb)](_0x4b52cb(0x122));const _0x2cc9d4=allEmployeesData[_0x4b52cb(0x1c8)](_0x154120=>{const _0x5ad1da=_0x4b52cb,_0x2256ca=_0x154120[_0x5ad1da(0x223)]&&_0x154120[_0x5ad1da(0x223)]['trim']()!=='',_0x38e9c4=_0x154120[_0x5ad1da(0x182)]&&_0x154120[_0x5ad1da(0x182)]['trim']()!=='',_0x554fd6=!!_0x154120[_0x5ad1da(0x236)],_0x26807c=_0x2256ca&&_0x38e9c4,_0xf11fb1=_0x554fd6&&!_0x38e9c4;return _0x26807c||_0xf11fb1;});if(_0x2cc9d4[_0x4b52cb(0x139)]===0x0){console[_0x4b52cb(0xf1)](_0x4b52cb(0x23a));return;}const _0x38f34f=[_0x4b52cb(0x1be),'ชื่อ-นามสกุล',_0x4b52cb(0x1f7),_0x4b52cb(0x22d),'สายงาน\x20(Department_th)',_0x4b52cb(0x137),_0x4b52cb(0x18a),'ทีม\x20(Check_Place)',_0x4b52cb(0x1d2),'เวลาที่สุ่ม\x20(RandomTime)'],_0x1f54e1=_0x102d74=>{const _0x34e838=_0x4b52cb;if(_0x102d74===null||_0x102d74===undefined)return'\x22\x22';let _0x3f258a=String(_0x102d74);return(_0x3f258a[_0x34e838(0x12b)]('\x22')||_0x3f258a[_0x34e838(0x12b)](',')||_0x3f258a[_0x34e838(0x12b)]('\x0a'))&&(_0x3f258a='\x22'+_0x3f258a[_0x34e838(0x1a2)](/"/g,'\x22\x22')+'\x22'),_0x3f258a;};let _0x1cf795=_0x38f34f['join'](',')+'\x0a';_0x2cc9d4['forEach'](_0x2d3835=>{const _0x3d3aae=_0x4b52cb,_0x10293d=_0x2d3835[_0x3d3aae(0x236)]&&_0x2d3835['DateLogin'][_0x3d3aae(0x105)]?formatThaiTimestamp(_0x2d3835['DateLogin']['toDate']()):'',_0xd3bec3=_0x2d3835[_0x3d3aae(0x1e6)]&&_0x2d3835[_0x3d3aae(0x1e6)]['toDate']?formatThaiTimestamp(_0x2d3835[_0x3d3aae(0x1e6)][_0x3d3aae(0x105)]()):'',_0x192cc4=[_0x2d3835['employeeId']||'',_0x2d3835[_0x3d3aae(0x178)]||'',_0x2d3835[_0x3d3aae(0x1a4)]||'',_0x2d3835[_0x3d3aae(0x194)]||'',_0x2d3835[_0x3d3aae(0x19a)]||'',_0x2d3835['BU_th']||'',_0x2d3835['Check_Manager']||'',_0x2d3835[_0x3d3aae(0x182)]||'',_0x10293d,_0xd3bec3];_0x1cf795+=_0x192cc4[_0x3d3aae(0x120)](_0x1f54e1)['join'](',')+'\x0a';});const _0xb62936=new Uint8Array([0xef,0xbb,0xbf]),_0x5e0dcf=new Blob([_0xb62936,_0x1cf795],{'type':_0x4b52cb(0x1c6)}),_0x5847b9=document['createElement']('a'),_0x4d9cf4=URL['createObjectURL'](_0x5e0dcf);_0x5847b9[_0x4b52cb(0x1bc)](_0x4b52cb(0xfd),_0x4d9cf4);const _0x9a27cd=new Date()['toISOString']()['slice'](0x0,0xa);_0x5847b9['setAttribute'](_0x4b52cb(0x157),_0x4b52cb(0x10d)+_0x9a27cd+_0x4b52cb(0x1a5)),_0x5847b9['style'][_0x4b52cb(0x1a7)]=_0x4b52cb(0x142),document[_0x4b52cb(0x1b4)][_0x4b52cb(0x17f)](_0x5847b9),_0x5847b9[_0x4b52cb(0x1a3)](),document[_0x4b52cb(0x1b4)][_0x4b52cb(0x1ae)](_0x5847b9),console['log']('CSV\x20Download\x20triggered.');}
        
    </script>
</body>
</html>

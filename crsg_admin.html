<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRSG Summit 2025 Dashboard</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: #ffffff; /* (แก้ไข) เปลี่ยนเป็นสีขาว */
        }
        /* เพิ่ม: Style สำหรับ Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            height: 1.5rem; /* เพิ่มความสูง */
        }
        .progress-bar {
            height: 100%;
            background-color: #3b82f6;
            width: 0%;
            transition: width 0.3s ease-in-out;
            text-align: center;
            color: white;
            line-height: 1.5rem; /* จัดกลางข้อความแนวตั้ง */
            font-size: 0.875rem; /* ขนาดตัวอักษร */
        }
         /* (เพิ่ม) Style สำหรับ Edit Modal Inputs */
        #editEmployeeModal input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            margin-top: 0.25rem;
        }
         /* (เพิ่ม) Style สำหรับ Dropdown ฟ้าอ่อน */
        select.light-blue-bg {
             background-color: #ffffff; /* (แก้ไข) เปลี่ยนเป็นสีขาว */
             padding-left: 0.75rem; /* px-3 */
             padding-right: 0.75rem; /* px-3 */
             padding-top: 0.5rem; /* py-2 */
             padding-bottom: 0.5rem; /* py-2 */
        }
         /* (เพิ่ม) Style หัวตารางสีเทา */
        thead.table-header-gray {
             background-color: #e5e7eb; /* gray-200 */
        }
    </style>
    <!-- Chart.js CDN --><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body class="flex flex-col items-center min-h-screen py-10 bg-white">

    <div class="w-[90%] max-w-6xl p-0 bg-white rounded-lg"> <!-- (แก้ไข) w-[90%], p-0 -->
        <!-- Header (แก้ไข: จัดกลาง, ปรับ pt) --><div class="flex flex-col items-center mb-6 pt-0 px-8"> <!-- (แก้ไข) pt-6 (1.5rem) -->
            <div class="text-center">
                <!-- (แก้ไข) text-2xl และ style color -->
                <h1 class="text-2xl font-bold" style="color: #0056ff;">CRSG Summit 2025</h1>
               <!-- ลบ Subtitle ออกแล้ว --></div>
            <div class="text-center mt-2">
                <p id="currentDateTime" class="text-sm text-gray-600 font-medium"></p>
            </div>
        </div>
        
        <!-- Tab Navigation (แก้ไข: ปรับ space, เปลี่ยนชื่อ, เพิ่มแท็บ) --><div class="mb-6 border-b border-gray-200 px-8"> <!-- (แก้ไข) เพิ่ม px-8 -->
            <nav class="-mb-px flex space-x-1" aria-label="Tabs"> <!-- แก้ไข: space-x-1 --><button id="tab-dashboard" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-700 bg-gray-300 border-blue-600">
                    ข้อมูล Dashboard
                </button>
                <button id="tab-team-list" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลสมาชิกทีม <!-- (แก้ไข) เปลี่ยนชื่อ --></button>
                <!-- (เพิ่ม) แท็บใหม่ -->
                <button id="tab-group-view" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลจัดกลุ่ม
                </button>
                <button id="tab-employee-list" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลพนักงาน CRSG <!-- เพิ่ม: แท็บใหม่ -->
                </button>
                <!-- (เพิ่ม) แท็บใหม่สำหรับลงทะเบียน -->
                <button id="tab-register" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ลงทะเบียนเข้าร่วมงาน
                </button>
            </nav>
        </div>

        <!-- Dashboard Content --><div id="dashboard-content" class="px-8 pb-8"> <!-- (แก้ไข) เพิ่ม px-8 pb-8 -->
            <!-- ภาพรวมผู้ลงทะเบียน (แก้ไข: โครงสร้างใหม่ 50/50, ปรับกล่องซ้าย) --><h2 class="text-lg font-semibold text-gray-800 mb-4">ภาพรวมผู้ลงทะเบียน</h2>
            <div class="flex flex-col lg:flex-row gap-6 mb-8">
                
                <!-- กล่องที่ 1 (40%) --><div class="lg:w-2/5"> <!-- (แก้ไข) lg:w-1/2 -> lg:w-2/5 -->
                     <!-- (แก้ไข) ปรับโครงสร้างกล่องซ้าย (เปลี่ยน 4 กล่องเป็น 1 กราฟ) -->
                     <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center h-full">
                         <p class="text-gray-600 text-sm mb-4">สัดส่วนผู้ลงทะเบียน</p>
                         <div class="relative w-64 h-64"> <!-- (แก้ไข) ทำให้ใหญ่ขึ้น -->
                             <canvas id="registrationBreakdownChart"></canvas>
                             <div class="absolute inset-0 flex flex-col items-center justify-center">
                                 <span id="breakdownCenterTotal" class="text-3xl font-bold text-gray-900">0</span>
                                 <span class="text-sm text-gray-500">ผู้ลงทะเบียน</span>
                             </div>
                         </div>
                     </div>
                </div>

                <!-- กล่องที่ 2 (60%) : กราฟวงกลมและสรุปยอด (แก้ไข: เพิ่มกล่อง Participants) --><div class="lg:w-3/5"> <!-- (แก้ไข) lg:w-1/2 -> lg:w-3/5 -->
                    <div class="flex gap-6 h-full">
                         <!-- กล่องซ้าย (w-2/3) : กราฟวงกลม -->
                         <div class="w-2/3 bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center"> <!-- (แก้ไข) w-[65%] -> w-2/3 -->
                            <p class="text-gray-600 text-sm mb-4">เป้าหมายผู้ลงทะเบียน</p>
                            <div class="relative w-64 h-64"> <!-- (แก้ไข) 48 -> 64 (ปรับขนาดให้เท่ากราฟแรก) -->
                                <canvas id="registrationDonutChart"></canvas>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <span id="donutPercentage" class="text-3xl font-bold text-gray-900">0%</span>
                                    <span class="text-sm text-gray-500">ผู้เข้าร่วมกิจกรรม</span>
                                </div>
                            </div>
                        </div>
                         <!-- กล่องขวา (w-1/3) : สรุปยอด (แก้ไข: ปรับ spacing) -->
                         <div class="w-1/3 flex flex-col justify-between space-y-2"> <!-- (แก้ไข) w-[35%] -> w-1/3 -->
                            <!-- จำนวนเป้าหมาย --><div class="h-1/4 bg-blue-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> <!-- แก้ไข h-1/4, p-3 -->
                                <p class="text-blue-700 text-xs">จำนวนเป้าหมาย</p> <!-- แก้ไข text-xs -->
                                <p id="targetCount" class="text-lg font-bold text-blue-800 mt-1">0</p> <!-- แก้ไข text-lg -->
                            </div>
                            <!-- (เพิ่ม) ผู้เข้าร่วมกิจกรรม --><div class="h-1/4 bg-green-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> <!-- แก้ไข h-1/4, p-3 -->
                                <p class="text-green-700 text-xs">ผู้เข้าร่วมกิจกรรม</p> <!-- แก้ไข text-xs -->
                                <p id="participantsCountBox" class="text-lg font-bold text-green-800 mt-1">0</p> <!-- (เพิ่ม) ID ใหม่, แก้ไข text-lg -->
                            </div>
                             <!-- ผู้ร่วมงาน (ย้ายมา) --><div class="h-1/4 bg-yellow-50 p-3 rounded-lg flex flex-col justify-center items-center text-center">
                                <p class="text-yellow-700 text-xs">ผู้ร่วมงาน</p>
                                <p id="attendeesCount" class="text-lg font-bold text-yellow-800 mt-1">0</p>
                            </div>
                            <!-- จำนวนคงเหลือ --><div class="h-1/4 bg-red-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> <!-- แก้ไข h-1/4, p-3 -->
                                <p class="text-red-700 text-xs">จำนวนคงเหลือ</p> <!-- แก้ไข text-xs -->
                                <p id="remainingCount" class="text-lg font-bold text-red-800 mt-1">0</p> <!-- แก้ไข text-lg -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- สรุปข้อมูลผู้ลงทะเบียน (แก้ไข: ย้ายปุ่ม, แบ่งกราฟเป็น ซ้าย/ขวา) --><div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                     <h2 class="text-lg font-semibold text-gray-800">สรุปข้อมูลผู้ลงทะเบียน</h2>
                     <!-- (แก้ไข) ปรับสไตล์ปุ่ม -->
                     <button id="randomizeButton" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                         สุ่มเลือกผู้ร่วมงาน
                     </button>
                 </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <!-- แบ่งเป็น 2 คอลัมน์ -->
                    <!-- กล่องซ้าย: กราฟแท่ง 1 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <p class="text-gray-600 text-sm mb-4">กราฟแสดงข้อมูลสถิติ (ส่วนที่ 1)</p>
                        <div class="h-[25rem]"> <!-- (แก้ไข) เพิ่มความสูง -->
                            <canvas id="teamBarChart1"></canvas> 
                        </div>
                    </div>
                    <!-- กล่องขวา: กราฟแท่ง 2 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                         <p class="text-gray-600 text-sm mb-4">กราฟแสดงข้อมูลสถิติ (ส่วนที่ 2)</p>
                        <div class="h-[25rem]"> <!-- (แก้ไข) เพิ่มความสูง -->
                            <canvas id="teamBarChart2"></canvas> 
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- สรุปข้อมูลผู้ร่วมงานและรายชื่อล่าสุด (แก้ไข: เพิ่มคอลัมน์) --><h2 class="text-lg font-semibold text-gray-800 mb-4">สรุปข้อมูลผู้ร่วมงานและรายชื่อล่าสุด</h2>
            <div class="bg-white shadow-md rounded-lg overflow-hidden border border-gray-200">
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm">
                        <thead class="table-header-gray"> <!-- (แก้ไข) เปลี่ยนจาก bg-gray-50 -->
                            <tr>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">กลุ่ม</th> <!-- (BU_th) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th> <!-- (แก้ไข) Check_Manager -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ทีม</th> <!-- (เพิ่ม) Check_Place -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลบรายการ</th>
                            </tr>
                        </thead>
                        <tbody id="latestRegistrationsTableBody" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="7" class="p-6 text-center text-gray-500">กำลังโหลดข้อมูล...</td> <!-- (แก้ไข) colspan="7" -->
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- (เพิ่ม) ปุ่ม Download CSV -->
            <div class="mt-6 text-center">
                <button id="downloadCsvButton" class="px-5 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                    Download File CSV (ผู้ลงทะเบียน)
                </button>
            </div>
            
        </div>

        <!-- (เพิ่ม) Register Content -->
        <div id="register-content" class="hidden pb-8 px-6">
             <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center">
                <h2 class="text-xl font-semibold text-gray-800 text-center mb-6">สแกน QR Code เพื่อลงทะเบียนเข้าร่วมงาน</h2>
                <img 
                    src="./images/QRcode-CRSG.png" 
                    alt="QR Code ลงทะเบียน" 
                    class="rounded-lg shadow-md border border-gray-200" 
                    style=" width:40%;"
                >
             </div>
        </div>

        <!-- (เพิ่ม) Team List Content (ที่ขาดหายไปทั้งหมด) -->
        <div id="team-list-content" class="hidden pb-8 px-0"> <!-- (แก้ไข) px-6 -> px-0 -->
            <div class="bg-white overflow-hidden"> <!-- (แก้ไข) ลบ shadow, border, rounded -->
                <!-- Top Stats/Actions Bar -->
                <div class="px-6 py-4 border-b grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                    <!-- Stat 1: Manager Count -->
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-blue-700">พนักงานที่มี สังกัด</p>
                        <p id="managerEmployeeCount" class="text-2xl font-bold text-blue-900 mt-1">0</p>
                    </div>
                    <!-- Stat 2: Team Member Count -->
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-green-700">พนักงานที่มี ทีม</p>
                        <p id="teamMemberCountElem" class="text-2xl font-bold text-green-900 mt-1">0</p>
                    </div>
                    <!-- Stat 3: Defined Teams (Scrollable) -->
                    <div class="bg-gray-50 p-4 rounded-lg overflow-y-auto max-h-24"> 
                        <p class="text-sm text-gray-700 mb-1 font-medium">รายชื่อทีมที่กำหนด:</p>
                        <p id="definedTeamNames" class="text-xs text-gray-600 break-words"></p> 
                    </div>
                </div>

                <!-- Actions Bar (Reset/Create) -->
                <div class="px-6 py-4 border-b flex flex-col md:flex-row gap-4 justify-center">
                     <button id="resetTeamButton" class="w-full md:w-auto px-6 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out">
                         Reset Team
                     </button>
                     <button id="createTeamButton" class="w-full md:w-auto px-6 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
                         Random Team
                     </button>
                </div>
                
                <!-- Progress Bar -->
                <div id="teamCreationProgressContainer" class="hidden p-6 border-b">
                    <p class="text-sm text-gray-600 mb-2">กำลังสร้างทีม...</p>
                    <div class="progress-bar-container">
                        <div id="teamCreationProgressBar" class="progress-bar">0%</div>
                    </div>
                    <p id="teamCreationStatus" class="text-xs text-gray-500 mt-1"></p>
                </div>
                
                <!-- Team Member Table Section -->
                 <div class="p-6">
                     <!-- (แก้ไข) ปรับ Header ให้แสดง Stats -->
                     <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                         <div>
                             <h3 class="text-lg font-semibold">ข้อมูลสมาชิกในแต่ละทีม</h3>
                             <!-- (เพิ่ม) Stats Container -->
                             <div id="teamStatsContainer" class="hidden flex flex-wrap gap-2 mt-2 text-xs sm:text-sm">
                                 <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-gray-100 text-gray-700 font-medium border border-gray-200">
                                     ทั้งหมด: <span id="teamStatsTotal" class="ml-1 font-bold text-gray-900">0</span>
                                 </span>
                                 <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-green-50 text-green-700 font-medium border border-green-200">
                                     ลงทะเบียน: <span id="teamStatsRegistered" class="ml-1 font-bold text-green-800">0</span>
                                 </span>
                                 <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-red-50 text-red-700 font-medium border border-red-200">
                                     ยังไม่ลง: <span id="teamStatsUnregistered" class="ml-1 font-bold text-red-800">0</span>
                                 </span>
                                 <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-blue-50 text-blue-700 font-medium border border-blue-200">
                                     คิดเป็น: <span id="teamStatsPercent" class="ml-1 font-bold text-blue-800">0%</span>
                                 </span>
                             </div>
                         </div>
                         <div class="flex-shrink-0">
                             <label for="teamSelect" class="text-sm font-medium mr-2">เลือกทีม:</label>
                             <!-- (แก้ไข) เพิ่ม bg-[#f97316] และ text-white, ลบ light-blue-bg -->
                             <select id="teamSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm py-2 px-3 bg-[#f97316] text-white">
                                 <option value="" class="text-gray-700 bg-white">-- กรุณาเลือก --</option>
                                 <!-- Options will be populated by JS -->
                             </select>
                         </div>
                     </div>
                     <div class="overflow-x-auto border rounded-lg">
                        <table class="min-w-full text-sm">
                            <thead class="table-header-gray">
                                <tr>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับ</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">แก้ไข</th>
                                </tr>
                            </thead>
                            <tbody id="selectedTeamTableBody" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="p-6 text-center text-gray-500">กรุณาเลือกทีม</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                 </div>
            </div>
        </div>
        
        <!-- (เพิ่ม) Group View Content --><div id="group-view-content" class="hidden pb-8 px-6">
             <div class="bg-white overflow-hidden">
                
                <!-- (ย้ายมา) Add Member Section -->
                <div class="p-6 border-b bg-gray-50">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">เพิ่มสมาชิกลงทีม</h3>
                    <!-- (แก้ไข) space-x-2 -->
                    <div class="flex items-end space-x-2">
                        <div class="flex-grow">
                            <label for="searchEmployeeIdInput" class="block text-sm font-medium text-gray-700">รหัสพนักงาน</label>
                            <!-- (แก้ไข) เพิ่ม bg-blue-50 และ style padding -->
                            <input type="text" id="searchEmployeeIdInput" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm bg-blue-50" placeholder="ใส่รหัสพนักงาน 5-6 หลัก" style="padding: 5px;">
                        </div>
                        <button id="searchEmployeeButton" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            ค้นหาข้อมูล
                        </button>
                    </div>
                    <p id="searchEmployeeError" class="text-red-600 text-sm mt-2"></p>
                </div>
                
                <!-- (แก้ไข) เพิ่ม Flexbox, Dropdown -->
                <div class="px-6 py-4 border-b flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h2 class="text-xl font-semibold">ข้อมูลจัดกลุ่ม (Team View)</h2>
                        <p class="text-sm text-gray-600">แสดงจำนวนสมาชิกในแต่ละทีม (คลิกเพื่อดูรายชื่อ)</p>
                        
                        <!-- (เพิ่ม) Stats Container for Team View (Main Page) -->
                        <div id="gvOverallStatsContainer" class="hidden flex flex-wrap gap-2 mt-2 text-xs sm:text-sm">
                             <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-gray-100 text-gray-700 font-medium border border-gray-200">
                                 ทั้งหมด: <span id="gvOverallStatsTotal" class="ml-1 font-bold text-gray-900">0</span>
                             </span>
                             <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-green-50 text-green-700 font-medium border border-green-200">
                                 ลงทะเบียน: <span id="gvOverallStatsRegistered" class="ml-1 font-bold text-green-800">0</span>
                             </span>
                             <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-red-50 text-red-700 font-medium border border-red-200">
                                 ยังไม่ลง: <span id="gvOverallStatsUnregistered" class="ml-1 font-bold text-red-800">0</span>
                             </span>
                             <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-blue-50 text-blue-700 font-medium border border-blue-200">
                                 คิดเป็น: <span id="gvOverallStatsPercent" class="ml-1 font-bold text-blue-800">0%</span>
                             </span>
                        </div>
                    </div>
                    <div class="flex-shrink-0">
                         <label for="groupViewManagerFilter" class="text-sm font-medium mr-2">กรองตามสังกัด:</label>
                         <!-- (แก้ไข) ปรับสี Dropdown เป็นสีส้ม (#f97316) ตัวขาว -->
                         <select id="groupViewManagerFilter" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm py-2 px-3 bg-[#f97316] text-white">
                             <option value="" class="text-gray-700 bg-white">-- ดูทั้งหมด --</option>
                             <!-- Options will be populated by JS -->
                         </select>
                    </div>
                </div>
                
                <!-- (เพิ่ม) Grid for Team Boxes -->
                <div id="teamBoxesContainer" class="p-6 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <!-- Team boxes will be populated by JS -->
                    <p class="text-gray-500">กำลังโหลดข้อมูล...</p>
                </div>
             </div>
        </div>
        
        <!-- Employee List Content (แก้ไข: ลบกรอบ, ปรับ padding, เพิ่ม filter, แก้ไข table, ปรับ Style) --><div id="employee-list-content" class="hidden pb-8 px-0"> <!-- (แก้ไข) px-0 -->
             <div class="bg-white overflow-hidden"> <!-- (แก้ไข) ลบ shadow, border, rounded -->
                <!-- (แก้ไข) ปรับ Header ให้แสดง Stats และ Filter -->
                <div class="px-6 py-4 border-b flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h2 class="text-xl font-semibold">ข้อมูลพนักงาน CRSG ทั้งหมด</h2>
                        <p class="text-sm text-gray-600">แสดงรายชื่อพนักงานทั้งหมดในระบบ</p>
                        
                        <!-- (เพิ่ม) Stats Container for Employee List -->
                        <div id="empStatsContainer" class="hidden flex flex-wrap gap-2 mt-2 text-xs sm:text-sm">
                             <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-gray-100 text-gray-700 font-medium border border-gray-200">
                                 ทั้งหมด: <span id="empStatsTotal" class="ml-1 font-bold text-gray-900">0</span>
                             </span>
                             <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-green-50 text-green-700 font-medium border border-green-200">
                                 ลงทะเบียน: <span id="empStatsRegistered" class="ml-1 font-bold text-green-800">0</span>
                             </span>
                             <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-red-50 text-red-700 font-medium border border-red-200">
                                 ยังไม่ลง: <span id="empStatsUnregistered" class="ml-1 font-bold text-red-800">0</span>
                             </span>
                             <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-blue-50 text-blue-700 font-medium border border-blue-200">
                                 คิดเป็น: <span id="empStatsPercent" class="ml-1 font-bold text-blue-800">0%</span>
                             </span>
                        </div>
                    </div>
                     <!-- (เพิ่ม) Filter Dropdown -->
                     <div class="flex-shrink-0">
                         <label for="managerFilterSelect" class="text-sm font-medium mr-2">กรองตามสังกัด:</label> <!-- (แก้ไข) Label -->
                         <!-- (แก้ไข) ปรับสี Dropdown เป็นสีส้ม (#f97316) ตัวขาว -->
                         <select id="managerFilterSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm py-2 px-3 bg-[#f97316] text-white">
                             <option value="" class="text-gray-700 bg-white">-- ทั้งหมด --</option>
                             <!-- Manager Options will be populated by JS -->
                         </select>
                     </div>
                </div>
                
                <div class="overflow-x-auto p-6"> <!-- (แก้ไข) เพิ่ม p-6 -->
                    <table class="min-w-full text-sm">
                        <thead class="table-header-gray"> <!-- (แก้ไข) เพิ่ม class -->
                            <tr>
                                <!-- (เพิ่ม) คอลัมน์ลำดับที่ -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับที่</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัส</th> <!-- (แก้ไข) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th> <!-- (แก้ไข) -->
                                <!-- <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ตำแหน่ง</th> --> <!-- (ลบ) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ทีม</th> <!-- (แก้ไข) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th> <!-- (แก้ไข) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">แก้ไข</th> <!-- (เพิ่ม) -->
                            </tr>
                        </thead>
                        <tbody id="employeeListTableBody" class="divide-y divide-gray-200"> <!-- (แก้ไข) ลบ bg-white -->
                            <tr>
                                <td colspan="6" class="p-6 text-center text-gray-500">กรุณาเลือกสังกัด</td> <!-- (แก้ไข) colspan="6", ข้อความ -->
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- *** เพิ่ม: Lightbox/Modal สำหรับสุ่มเลือก *** --><div id="randomizeModal" class="hidden fixed inset-0 z-40 overflow-y-auto bg-gray-600 bg-opacity-75 flex items-center justify-center">
        <!-- (แก้ไข) ปรับ w-[65%], h-[80vh], flex-col -->
        <div class="bg-white rounded-lg shadow-xl p-6 w-[65%] h-[80vh] flex flex-col mx-4">
            <!-- แถวที่ 1: Title --><h3 class="text-xl font-semibold text-center text-gray-900 mb-4">ระบบสุ่มเลือกผู้ร่วมกิจกรรม</h3>
            
            <!-- แถวที่ 2: Stats --><div class="grid grid-cols-2 gap-4 mb-6 shrink-0"> <!-- shrink-0 เพื่อไม่ให้หด -->
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <p class="text-sm text-blue-700">ผู้เข้าร่วมกิจกรรม (ที่สุ่มได้)</p>
                    <p id="modalParticipantsCount" class="text-3xl font-bold text-blue-900">0</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <p class="text-sm text-green-700">ผู้ได้รับการสุ่มแล้ว</p>
                    <p id="modalDrawnCount" class="text-3xl font-bold text-green-900">0</p>
                </div>
            </div>
            
            <!-- แถวที่ 3: 5 Digits --><div class="flex justify-center space-x-2 mb-6 shrink-0">
                <!-- (แก้ไข) เพิ่ม font-bold -->
                <div id="digit1" class="w-16 h-20 bg-black text-white text-5xl font-mono font-bold rounded-lg flex items-center justify-center">0</div>
                <div id="digit2" class="w-16 h-20 bg-black text-white text-5xl font-mono font-bold rounded-lg flex items-center justify-center">0</div>
                <div id="digit3" class="w-16 h-20 bg-black text-white text-5xl font-mono font-bold rounded-lg flex items-center justify-center">0</div>
                <div id="digit4" class="w-16 h-20 bg-black text-white text-5xl font-mono font-bold rounded-lg flex items-center justify-center">0</div>
                <div id="digit5" class="w-16 h-20 bg-black text-white text-5xl font-mono font-bold rounded-lg flex items-center justify-center">0</div>
            </div>
            
            <!-- แถวที่ 4: Button --><div class="mb-6 flex flex-col items-center shrink-0"> <!-- (แก้ไข) จัดกลาง -->
                <!-- (แก้ไข) w-[40%] -->
                <button id="startRandomizeButton" class="w-[40%] px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400">
                    สุ่มเลือกผู้ร่วมกิจกรรม
                </button>
                <p id="randomizeError" class="text-red-600 text-sm text-center mt-2"></p>
            </div>
            
            <!-- แถวที่ 5: Table --><h4 class="text-lg font-semibold text-gray-800 mb-2 shrink-0">ข้อมูลผู้ที่ได้รับการสุ่มเลือก</h4>
            <!-- (แก้ไข) ปรับ h-48 เป็น flex-grow เพื่อให้ยืดเต็มพื้นที่ -->
            <div class="flex-grow overflow-y-auto border rounded-lg mb-4">
                <table class="min-w-full text-sm">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน (BU)</th>
                            <th class="px-4 py-2 text-center font-medium text-gray-600 uppercase tracking-wider">ยกเลิก</th>
                        </tr>
                    </thead>
                    <tbody id="drawnWinnersTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Data will be populated by JS --></tbody>
                </table>
            </div>
            
            <!-- แถวที่ 6: Close Button --><div class="mt-auto text-right shrink-0"> <!-- mt-auto ดันไปล่างสุด -->
                <button id="closeRandomizeModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ปิดหน้านี้
                </button>
            </div>
        </div>
    </div>
    
    <!-- *** เพิ่ม: Lightbox/Modal 2 สำหรับแสดงผู้ชนะ *** --><div id="winnerDetailModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-lg w-full text-center">
            <h3 class="text-2xl font-bold text-blue-600 mb-4">ยินดีด้วย!</h3>
            <p class="text-lg text-gray-700">ผู้โชคดีคือ:</p>
            <p id="winnerName" class="text-3xl font-extrabold text-gray-900 my-2"></p>
            <p id="winnerEmployeeId" class="text-base text-gray-500 mb-1"></p>
            <p id="winnerTeam" class="text-base text-gray-500 mb-1"></p>
            <p id="winnerBU" class="text-base text-gray-500 mb-6"></p>
            
            <div class="flex justify-center space-x-4">
                <button id="cancelWinnerButton" class="px-4 py-2 text-xs bg-red-100 text-red-700 rounded-md hover:bg-red-200">
                    ยกเลิกการสุ่ม
                </button>
                <button id="closeWinnerModalButton" class="px-4 py-2 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    ปิดหน้าต่าง
                </button>
            </div>
        </div>
    </div>
    
    <!-- *** เพิ่ม: Lightbox/Modal 3 สำหรับยืนยันการยกเลิก/Reset *** --><div id="confirmModal" class="hidden fixed inset-0 z-[60] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center"> <!-- (แก้ไข) z-50 -> z-[60] (สูงสุด) -->
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-sm w-full">
            <h3 id="confirmTitle" class="text-lg font-semibold text-gray-900 mb-4">ยืนยัน</h3> <!-- (แก้ไข) เพิ่ม ID -->
            <p id="confirmText" class="text-sm text-gray-700 mb-6"></p> <!-- (แก้ไข) เปลี่ยน ID -->
            <div class="flex justify-end space-x-3">
                <button id="closeConfirmButton" class="px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ไม่
                </button> <!-- (แก้ไข) เปลี่ยน ID -->
                <button id="confirmActionButton" class="px-3 py-1.5 text-xs bg-red-600 text-white rounded-md hover:bg-red-700">
                    <!-- Text will be set by JS -->
                </button> <!-- (แก้ไข) เปลี่ยน ID -->
            </div>
        </div>
    </div>

    <!-- *** (เพิ่ม) Lightbox/Modal 4 สำหรับแก้ไขข้อมูลพนักงาน *** -->
    <div id="editEmployeeModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">แก้ไขข้อมูลพนักงาน</h3>
            <div class="space-y-4">
                <div>
                    <span class="text-sm font-medium text-gray-700">รหัสพนักงาน:</span>
                    <span id="editEmpId" class="text-sm text-gray-900 ml-2"></span>
                </div>
                 <div>
                    <span class="text-sm font-medium text-gray-700">ชื่อ-นามสกุล:</span>
                    <span id="editEmpName" class="text-sm text-gray-900 ml-2"></span>
                </div>
                 <div>
                    <label for="editEmpManager" class="block text-sm font-medium text-gray-700">Manager (Check_Manager)</label>
                    <input type="text" id="editEmpManager">
                </div>
                 <div>
                    <label for="editEmpTeam" class="block text-sm font-medium text-gray-700">ทีม (Check_Place)</label>
                    <input type="text" id="editEmpTeam">
                </div>
                <!-- สามารถเพิ่ม Fields อื่นๆ ที่ต้องการแสดง (แต่แก้ไขไม่ได้) ตรงนี้ -->
                 <p id="editError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                 <button id="closeEditModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ยกเลิกการแก้ไข
                 </button>
                 <button id="saveEditModalButton" class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    บันทึกรายการ
                 </button>
            </div>
        </div>
    </div>

    <!-- *** (เพิ่ม) Lightbox/Modal 5 สำหรับแก้ไขสมาชิกทีม (จากแท็บ Team List / Group View) (ส่วนนี้ขาดหายไป) *** -->
    <div id="editTeamMemberModal" class="hidden fixed inset-0 z-[51] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center p-4"> <!-- (แก้ไข) z-50 -> z-[51] -->
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">แก้ไขข้อมูลสมาชิกทีม</h3>
            <div class="space-y-4">
                <div>
                    <p class="text-sm text-gray-600">รหัสพนักงาน: <span id="editMemberEmpId" class="font-medium text-gray-900"></span></p>
                    <p class="text-sm text-gray-600">ชื่อ: <span id="editMemberEmpName" class="font-medium text-gray-900"></span></p>
                </div>
                <div>
                    <label for="editMemberTeamSelect" class="block text-sm font-medium text-gray-700">ทีม (Check_Place):</label>
                    <select id="editMemberTeamSelect" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm mt-1 light-blue-bg">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                <p id="editMemberError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-between">
                <div>
                     <button id="deleteEditMemberModalButton" class="px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md hover:bg-red-200 disabled:bg-gray-400">
                        ยกเลิกการเป็นสมาชิกทีม <!-- (แก้ไข) เปลี่ยนชื่อปุ่ม -->
                    </button>
                </div>
                <div class="flex space-x-3">
                    <button id="closeEditMemberModalButton" class="px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 disabled:bg-gray-400">
                        ยกเลิก
                    </button>
                    <button id="saveEditMemberModalButton" class="px-3 py-1.5 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400">
                        บันทึกรายการ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- *** (เพิ่ม) Lightbox/Modal 6 สำหรับแสดงสมาชิกในทีม (Group View) *** -->
    <div id="groupViewModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-6xl w-full"> <!-- (แก้ไข) max-w-6xl (กว้างขึ้น) -->
            <div class="flex justify-between items-start mb-4"> <!-- (แก้ไข) items-start -->
                 <div>
                     <h3 id="groupViewModalTitle" class="text-xl font-semibold text-gray-900">สมาชิกในทีม</h3>
                     <!-- (เพิ่ม) Stats Container for Group View Modal -->
                     <div id="groupViewStatsContainer" class="hidden flex flex-wrap gap-2 mt-2 text-xs sm:text-sm">
                         <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-gray-100 text-gray-700 font-medium border border-gray-200">
                             ทั้งหมด: <span id="groupViewStatsTotal" class="ml-1 font-bold text-gray-900">0</span>
                         </span>
                         <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-green-50 text-green-700 font-medium border border-green-200">
                             ลงทะเบียน: <span id="groupViewStatsRegistered" class="ml-1 font-bold text-green-800">0</span>
                         </span>
                         <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-red-50 text-red-700 font-medium border border-red-200">
                             ยังไม่ลง: <span id="groupViewStatsUnregistered" class="ml-1 font-bold text-red-800">0</span>
                         </span>
                         <span class="inline-flex items-center px-2.5 py-1 rounded-md bg-blue-50 text-blue-700 font-medium border border-blue-200">
                             คิดเป็น: <span id="groupViewStatsPercent" class="ml-1 font-bold text-blue-800">0%</span>
                         </span>
                     </div>
                 </div>
                 <!-- (เพิ่ม) ปุ่มปิด -->
                 <button id="closeGroupViewModalButton" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">&times;</button>
            </div>
            
            <!-- (เพิ่ม) Table container -->
            <div class="max-h-[60vh] overflow-y-auto border rounded-lg">
                 <table class="min-w-full text-sm">
                    <thead class="table-header-gray sticky top-0"> <!-- (เพิ่ม) sticky top-0 -->
                        <tr>
                            <!-- (เพิ่ม) ต้องเหมือนกับตารางใน "ข้อมูลสมาชิกทีม" -->
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับ</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">แก้ไข</th>
                        </tr>
                    </thead>
                    <tbody id="groupViewTableBody" class="divide-y divide-gray-200">
                        <tr><td colspan="7" class="p-6 text-center text-gray-500">กำลังโหลด...</td></tr>
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>

    <!-- (เพิ่ม) Lightbox/Modal 7 สำหรับเพิ่ม/แก้ไขสมาชิก (Group View) -->
    <div id="addMemberModal" class="hidden fixed inset-0 z-[51] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center p-4"> <!-- z-index 51 -->
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">เพิ่ม/แก้ไข สมาชิกในทีม</h3>
            <div class="space-y-4">
                <!-- ข้อมูลพนักงาน (Read-only) -->
                <div class="bg-gray-50 p-4 rounded-lg border">
                    <p class="text-sm text-gray-600">รหัสพนักงาน: <span id="addMemberEmpId" class="font-medium text-gray-900"></span></p>
                    <p class="text-sm text-gray-600">ชื่อ: <span id="addMemberEmpName" class="font-medium text-gray-900"></span></p>
                    <p class="text-sm text-gray-600">สายงาน: <span id="addMemberEmpBU" class="font-medium text-gray-900"></span></p>
                </div>
                
                <!-- Dropdown สังกัด -->
                <div>
                    <label for="addMemberManagerSelect" class="block text-sm font-medium text-gray-700">สังกัด (Check_Manager):</label>
                    <select id="addMemberManagerSelect" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm mt-1 bg-white">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                
                <!-- Dropdown ทีม -->
                <div>
                    <label for="addMemberTeamSelect" class="block text-sm font-medium text-gray-700">ทีม (Check_Place):</label>
                    <select id="addMemberTeamSelect" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm mt-1 bg-white">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                
                <p id="addMemberError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="closeAddMemberModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ยกเลิกรายการ
                </button>
                <button id="saveAddMemberModalButton" class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    บันทึกข้อมูล
                </button>
            </div>
        </div>
    </div>


    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
        // นำเข้า Firebase modules
const _0x158961=_0x5162;(function(_0x1df82f,_0x496e73){const _0x478a27=_0x5162,_0x424f35=_0x1df82f();while(!![]){try{const _0x454d5d=-parseInt(_0x478a27(0xb8))/0x1+-parseInt(_0x478a27(0x14e))/0x2*(-parseInt(_0x478a27(0x1bf))/0x3)+-parseInt(_0x478a27(0x1d7))/0x4*(-parseInt(_0x478a27(0xa9))/0x5)+-parseInt(_0x478a27(0x1e3))/0x6+-parseInt(_0x478a27(0x1f9))/0x7+-parseInt(_0x478a27(0xc7))/0x8*(parseInt(_0x478a27(0xd0))/0x9)+parseInt(_0x478a27(0x1a7))/0xa;if(_0x454d5d===_0x496e73)break;else _0x424f35['push'](_0x424f35['shift']());}catch(_0x3d9164){_0x424f35['push'](_0x424f35['shift']());}}}(_0x13b5,0xa5d99));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';import{getAuth,signInAnonymously}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';import{getFirestore,collection,query,where,onSnapshot,orderBy,limit,setLogLevel,doc,updateDoc,serverTimestamp,writeBatch,Timestamp}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';const firebaseConfig={'apiKey':_0x158961(0xac),'authDomain':_0x158961(0xe2),'databaseURL':'https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','projectId':_0x158961(0xc8),'storageBucket':'ttb-register.firebasestorage.app','messagingSenderId':_0x158961(0x190),'appId':'1:1070273157855:web:5c8120e1df27e233d8676a','measurementId':_0x158961(0x8e)};let db,auth,donutChart,barChart1,barChart2,registrationBreakdownChart;const currentDateTimeElement=document[_0x158961(0x1c5)]('currentDateTime'),attendeesCount=document[_0x158961(0x1c5)]('attendeesCount'),latestRegistrationsTableBody=document[_0x158961(0x1c5)](_0x158961(0x1be)),donutPercentage=document['getElementById'](_0x158961(0x1ba)),targetCountElem=document['getElementById'](_0x158961(0x1b6)),remainingCountElem=document['getElementById'](_0x158961(0x13a)),participantsCountBoxElem=document['getElementById'](_0x158961(0xff)),breakdownCenterTotal=document[_0x158961(0x1c5)](_0x158961(0x158)),tabDashboard=document[_0x158961(0x1c5)](_0x158961(0x105)),tabTeamList=document[_0x158961(0x1c5)](_0x158961(0x14a)),tabGroupView=document[_0x158961(0x1c5)]('tab-group-view'),tabEmployeeList=document[_0x158961(0x1c5)](_0x158961(0x98)),tabRegister=document['getElementById'](_0x158961(0x171)),dashboardContent=document['getElementById'](_0x158961(0xdb)),teamListContent=document[_0x158961(0x1c5)]('team-list-content'),groupViewContent=document[_0x158961(0x1c5)]('group-view-content'),employeeListContent=document[_0x158961(0x1c5)]('employee-list-content'),registerContent=document[_0x158961(0x1c5)](_0x158961(0xe3));let calculatedTarget=0x0;const latestRegistrationsLimit=0x5,teamNames=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','AA','BB','CC','DD','EE','FF','GG','HH','II','JJ','KK','LL','MM','NN','OO','PP'],teamSize=0xa;let employeesWithManager=[],currentConfirmAction=null;const managerEmployeeCountElem=document[_0x158961(0x1c5)](_0x158961(0x153)),definedTeamNamesElem=document['getElementById'](_0x158961(0x17f)),resetTeamButton=document[_0x158961(0x1c5)](_0x158961(0x188)),createTeamButton=document[_0x158961(0x1c5)](_0x158961(0x206)),teamCreationProgressContainer=document[_0x158961(0x1c5)](_0x158961(0x139)),teamCreationProgressBar=document[_0x158961(0x1c5)](_0x158961(0x9a)),teamCreationStatus=document[_0x158961(0x1c5)]('teamCreationStatus'),teamSelect=document['getElementById'](_0x158961(0x106)),selectedTeamTableBody=document[_0x158961(0x1c5)](_0x158961(0x170)),teamMemberCountElem=document[_0x158961(0x1c5)](_0x158961(0x17a)),confirmModal=document[_0x158961(0x1c5)](_0x158961(0xeb)),confirmTitle=document['getElementById'](_0x158961(0x1a9)),confirmText=document[_0x158961(0x1c5)](_0x158961(0x1d4)),closeConfirmButton=document['getElementById'](_0x158961(0x1f2)),confirmActionButton=document['getElementById'](_0x158961(0xf0)),editEmployeeModal=document[_0x158961(0x1c5)]('editEmployeeModal'),editEmpId=document['getElementById']('editEmpId'),editEmpName=document[_0x158961(0x1c5)](_0x158961(0xb3)),editEmpManager=document[_0x158961(0x1c5)](_0x158961(0x13c)),editEmpTeam=document['getElementById']('editEmpTeam'),editError=document[_0x158961(0x1c5)](_0x158961(0x149)),closeEditModalButton=document[_0x158961(0x1c5)]('closeEditModalButton'),saveEditModalButton=document[_0x158961(0x1c5)]('saveEditModalButton');let currentEditingDocId=null;const editTeamMemberModal=document['getElementById']('editTeamMemberModal'),editMemberEmpId=document[_0x158961(0x1c5)](_0x158961(0x152)),editMemberEmpName=document[_0x158961(0x1c5)](_0x158961(0x90)),editMemberTeamSelect=document['getElementById'](_0x158961(0xe7)),editMemberError=document[_0x158961(0x1c5)]('editMemberError'),closeEditMemberModalButton=document[_0x158961(0x1c5)](_0x158961(0xdd)),saveEditMemberModalButton=document[_0x158961(0x1c5)](_0x158961(0x191)),deleteEditMemberModalButton=document[_0x158961(0x1c5)]('deleteEditMemberModalButton'),groupViewModal=document['getElementById'](_0x158961(0xf4)),groupViewModalTitle=document['getElementById'](_0x158961(0x185)),closeGroupViewModalButton=document[_0x158961(0x1c5)](_0x158961(0xfb)),groupViewTableBody=document[_0x158961(0x1c5)](_0x158961(0x173)),teamBoxesContainer=document['getElementById'](_0x158961(0x15f)),groupViewManagerFilter=document[_0x158961(0x1c5)](_0x158961(0x1a5)),addMemberModal=document[_0x158961(0x1c5)](_0x158961(0x91)),searchEmployeeIdInput=document['getElementById'](_0x158961(0x1d6)),searchEmployeeButton=document[_0x158961(0x1c5)](_0x158961(0x127)),searchEmployeeError=document[_0x158961(0x1c5)]('searchEmployeeError'),addMemberEmpId=document[_0x158961(0x1c5)](_0x158961(0x110)),addMemberEmpName=document[_0x158961(0x1c5)](_0x158961(0x183)),addMemberEmpBU=document[_0x158961(0x1c5)](_0x158961(0x1e0)),addMemberManagerSelect=document[_0x158961(0x1c5)](_0x158961(0x107)),addMemberTeamSelect=document[_0x158961(0x1c5)](_0x158961(0x103)),addMemberError=document[_0x158961(0x1c5)](_0x158961(0x189)),closeAddMemberModalButton=document['getElementById'](_0x158961(0x10a)),saveAddMemberModalButton=document[_0x158961(0x1c5)](_0x158961(0x1ae));let currentAddingDocId=null,allEmployeesData=[],currentParticipants=[],availableToDraw=[],alreadyDrawn=[],randomizationInterval=null,docIdToCancel=null;const randomizeButton=document['getElementById'](_0x158961(0x133)),randomizeModal=document[_0x158961(0x1c5)](_0x158961(0xc9)),closeRandomizeModalButton=document[_0x158961(0x1c5)]('closeRandomizeModalButton'),modalParticipantsCount=document[_0x158961(0x1c5)]('modalParticipantsCount'),modalDrawnCount=document['getElementById']('modalDrawnCount'),digits=[document['getElementById']('digit1'),document[_0x158961(0x1c5)](_0x158961(0x200)),document[_0x158961(0x1c5)]('digit3'),document[_0x158961(0x1c5)](_0x158961(0x1d2)),document[_0x158961(0x1c5)](_0x158961(0x164))],startRandomizeButton=document[_0x158961(0x1c5)]('startRandomizeButton'),randomizeError=document[_0x158961(0x1c5)]('randomizeError'),drawnWinnersTableBody=document['getElementById'](_0x158961(0x117)),winnerDetailModal=document[_0x158961(0x1c5)]('winnerDetailModal'),winnerName=document[_0x158961(0x1c5)](_0x158961(0xba)),winnerEmployeeId=document[_0x158961(0x1c5)](_0x158961(0xa1)),winnerTeam=document[_0x158961(0x1c5)](_0x158961(0x1ce)),winnerBU=document[_0x158961(0x1c5)](_0x158961(0x201)),cancelWinnerButton=document['getElementById'](_0x158961(0x204)),closeWinnerModalButton=document[_0x158961(0x1c5)](_0x158961(0x11b)),managerFilterSelect=document['getElementById'](_0x158961(0xa7)),employeeListTableBody=document[_0x158961(0x1c5)](_0x158961(0x186)),downloadCsvButton=document[_0x158961(0x1c5)](_0x158961(0xbe));try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel(_0x158961(0xed)),await signInAnonymously(auth),console[_0x158961(0x19f)](_0x158961(0x1af)),initializeCharts(),populateTeamUI(),listenToAllCrsgData(),setupModalListeners(),setupTeamTabListeners(),setupEmployeeListListeners(),setupEditTeamMemberModalListeners(),setupGroupViewListeners(),setupAddMemberModalListeners(),updateCurrentDateTime(),setInterval(updateCurrentDateTime,0x3e8);}catch(_0x3a0cfa){console[_0x158961(0xa6)]('Firebase\x20initialization\x20failed:',_0x3a0cfa),document[_0x158961(0x156)][_0x158961(0x1d3)]=_0x158961(0x1a0)+_0x3a0cfa[_0x158961(0x112)]+_0x158961(0xec);}function formatThaiTimestamp(_0x397dbe){const _0x58811e=_0x158961;if(!_0x397dbe||typeof _0x397dbe[_0x58811e(0xcb)]!==_0x58811e(0x19e))return _0x58811e(0x134);return _0x397dbe[_0x58811e(0xcb)](_0x58811e(0xdc),{'year':_0x58811e(0x15e),'month':'short','day':_0x58811e(0x15e),'hour':_0x58811e(0xc5),'minute':'2-digit','second':'2-digit'});}function updateCurrentDateTime(){const _0x52839d=_0x158961,_0x1c83ec=new Date();currentDateTimeElement[_0x52839d(0x180)]=_0x52839d(0xe1)+_0x1c83ec[_0x52839d(0xe6)](_0x52839d(0xdc),{'day':_0x52839d(0x15e),'month':_0x52839d(0xda),'year':'numeric'})+_0x52839d(0x207)+_0x1c83ec[_0x52839d(0xca)](_0x52839d(0xdc),{'hour':'2-digit','minute':_0x52839d(0xc5),'second':_0x52839d(0xc5)});}function initializeCharts(){const _0x37eeac=_0x158961,_0x2cdf1b=document[_0x37eeac(0x1c5)](_0x37eeac(0x160))['getContext']('2d');donutChart=new Chart(_0x2cdf1b,{'type':_0x37eeac(0x130),'data':{'labels':['ผู้เข้าร่วมกิจกรรม','เป้าหมายที่เหลือ'],'datasets':[{'data':[0x0,calculatedTarget],'backgroundColor':[_0x37eeac(0x115),_0x37eeac(0x1bc)],'hoverOffset':0x4}]},'options':{'responsive':!![],'maintainAspectRatio':![],'cutout':_0x37eeac(0x17b),'plugins':{'legend':{'display':![]},'tooltip':{'callbacks':{'label':_0x12abf9=>_0x12abf9['label']+':\x20'+_0x12abf9[_0x37eeac(0xe4)]+_0x37eeac(0x13e)}},'datalabels':{'formatter':(_0x5e2303,_0x348d74)=>{const _0x1e9d17=_0x37eeac,_0x1698c5=_0x348d74[_0x1e9d17(0xb6)][_0x1e9d17(0x162)][_0x1e9d17(0xab)][0x0][_0x1e9d17(0x162)],_0xfb3ee4=_0x1698c5[_0x1e9d17(0xb0)]((_0x24de58,_0x5b6509)=>_0x24de58+_0x5b6509,0x0);if(_0x5e2303===0x0||_0xfb3ee4===0x0)return'';const _0x4d30d9=(_0x5e2303/_0xfb3ee4*0x64)[_0x1e9d17(0x122)](0x0)+'%';return _0x4d30d9;},'anchor':'end','align':'end','offset':0x8,'color':_0x46512b=>_0x46512b[_0x37eeac(0x178)][_0x37eeac(0x1de)][_0x46512b['dataIndex']],'font':{'weight':_0x37eeac(0xbb),'size':0xe}}}},'plugins':[ChartDataLabels]});const _0x45f293=document[_0x37eeac(0x1c5)]('registrationBreakdownChart')['getContext']('2d');registrationBreakdownChart=new Chart(_0x45f293,{'type':_0x37eeac(0x130),'data':{'labels':[_0x37eeac(0x1c2),'ผู้ร่วมงาน'],'datasets':[{'data':[0x0,0x0],'backgroundColor':['#3B82F6',_0x37eeac(0x1b3)],'hoverOffset':0x4}]},'options':{'responsive':!![],'maintainAspectRatio':![],'cutout':_0x37eeac(0x17b),'plugins':{'legend':{'display':![]},'tooltip':{'callbacks':{'label':_0x8cfe6d=>_0x8cfe6d[_0x37eeac(0xf9)]+':\x20'+_0x8cfe6d[_0x37eeac(0xe4)]+_0x37eeac(0x13e)}},'datalabels':{'formatter':(_0x4793ee,_0x434311)=>{const _0x7c35f9=_0x37eeac,_0x50893f=_0x434311[_0x7c35f9(0xb6)][_0x7c35f9(0x162)][_0x7c35f9(0xab)][0x0][_0x7c35f9(0x162)],_0x5bdce1=_0x50893f[_0x7c35f9(0xb0)]((_0x1f6855,_0x5b89f2)=>_0x1f6855+_0x5b89f2,0x0);if(_0x4793ee===0x0||_0x5bdce1===0x0)return'';const _0x2ee91c=(_0x4793ee/_0x5bdce1*0x64)['toFixed'](0x0)+'%';return _0x2ee91c;},'anchor':_0x37eeac(0x165),'align':_0x37eeac(0x165),'offset':0x8,'color':_0x2d8fd4=>_0x2d8fd4[_0x37eeac(0x178)][_0x37eeac(0x1de)][_0x2d8fd4[_0x37eeac(0x1ad)]],'font':{'weight':'bold','size':0xe}}}},'plugins':[ChartDataLabels]});const _0x4b2716={'indexAxis':'y','responsive':!![],'maintainAspectRatio':![],'scales':{'x':{'beginAtZero':!![],'stacked':!![],'title':{'display':!![],'text':_0x37eeac(0xf3)},'ticks':{'stepSize':0x1}},'y':{'stacked':!![],'title':{'display':![]}}},'plugins':{'legend':{'display':!![],'position':_0x37eeac(0x203)},'datalabels':{'anchor':_0x37eeac(0x1d9),'align':_0x37eeac(0x1d9),'color':_0x18c74e=>{const _0x3467c9=_0x37eeac,_0x23e7ad=_0x18c74e[_0x3467c9(0x178)][_0x3467c9(0x162)][_0x18c74e[_0x3467c9(0x1ad)]];return _0x23e7ad>0x0?_0x3467c9(0x205):_0x3467c9(0x193);},'font':{'weight':_0x37eeac(0xbb)},'formatter':_0x523cb7=>_0x523cb7>0x0?_0x523cb7:''}}},_0x466bad=document['getElementById'](_0x37eeac(0x1b8))[_0x37eeac(0x16e)]('2d');barChart1=new Chart(_0x466bad,{'type':_0x37eeac(0x11e),'data':{'labels':[],'datasets':[{'label':'ลงทะเบียนแล้ว','data':[],'backgroundColor':_0x37eeac(0x208),'borderColor':_0x37eeac(0xf2),'borderWidth':0x1},{'label':_0x37eeac(0x1b1),'data':[],'backgroundColor':_0x37eeac(0x1ca),'borderColor':_0x37eeac(0x159),'borderWidth':0x1}]},'options':{..._0x4b2716},'plugins':[ChartDataLabels]});const _0x520a36=document['getElementById'](_0x37eeac(0x1ed))[_0x37eeac(0x16e)]('2d');barChart2=new Chart(_0x520a36,{'type':_0x37eeac(0x11e),'data':{'labels':[],'datasets':[{'label':_0x37eeac(0x12c),'data':[],'backgroundColor':_0x37eeac(0x208),'borderColor':'#2563EB','borderWidth':0x1},{'label':_0x37eeac(0x1b1),'data':[],'backgroundColor':'#BFDBFE','borderColor':_0x37eeac(0x159),'borderWidth':0x1}]},'options':{..._0x4b2716},'plugins':[ChartDataLabels]});}function populateTeamUI(){const _0x3838ea=_0x158961;definedTeamNamesElem[_0x3838ea(0x180)]=teamNames[_0x3838ea(0x120)](',\x20'),teamSelect[_0x3838ea(0x1d3)]='<option\x20value=\x22\x22\x20class=\x22text-gray-700\x20bg-white\x22>--\x20กรุณาเลือก\x20--</option>',teamNames['forEach'](_0x421b39=>{const _0x5ebc0f=_0x3838ea,_0x4561ef=document[_0x5ebc0f(0x146)](_0x5ebc0f(0x172));_0x4561ef['value']=_0x421b39,_0x4561ef[_0x5ebc0f(0x180)]=_0x421b39,_0x4561ef['className']=_0x5ebc0f(0x11d),teamSelect['appendChild'](_0x4561ef);});}function listenToAllCrsgData(){const _0x6d67e0=_0x158961;try{const _0x267476=_0x6d67e0(0x1ac),_0x190b48=collection(db,_0x267476);onSnapshot(_0x190b48,_0x1915d8=>{const _0x10a85f=_0x6d67e0,_0x14043c=[],_0x1fd914=[],_0x67bb8={};let _0xb1f035=0x0,_0xdef193=0x0,_0xebd112=0x0;const _0x15b986=new Set();_0x1915d8[_0x10a85f(0x1b9)](_0x15ab4d=>{const _0x57ae7b=_0x10a85f,_0x456587=_0x15ab4d[_0x57ae7b(0x162)](),_0x53065d=_0x15ab4d['id'];_0x14043c[_0x57ae7b(0x100)]({'id':_0x15ab4d['id'],..._0x456587});const _0x21bae1=_0x456587[_0x57ae7b(0x14d)]&&_0x456587[_0x57ae7b(0x14d)][_0x57ae7b(0x1fa)]()!=='',_0x3b7858=_0x456587[_0x57ae7b(0x1b4)]&&_0x456587[_0x57ae7b(0x1b4)][_0x57ae7b(0x1fa)]()!=='';_0x21bae1&&(_0xb1f035++,_0x15b986[_0x57ae7b(0x8c)](_0x456587[_0x57ae7b(0x14d)][_0x57ae7b(0x1fa)]()));_0x3b7858&&_0xdef193++;_0x21bae1&&_0x3b7858&&_0xebd112++;const _0x573fee=_0x456587[_0x57ae7b(0x1b4)];_0x3b7858&&_0x573fee&&(!_0x67bb8[_0x573fee]&&(_0x67bb8[_0x573fee]={'total':0x0,'registered':0x0}),_0x456587['DateLogin']&&_0x67bb8[_0x573fee][_0x57ae7b(0x168)]++),_0x456587['DateLogin']&&_0x1fd914[_0x57ae7b(0x100)]({'id':_0x15ab4d['id'],..._0x456587});}),_0x14043c[_0x10a85f(0x1b9)](_0x4a8ffd=>{const _0x2fc8d4=_0x10a85f,_0x29f46f=_0x4a8ffd[_0x2fc8d4(0x1b4)];_0x29f46f&&_0x29f46f['trim']()!==''&&_0x67bb8[_0x29f46f]&&_0x67bb8[_0x29f46f]['total']++;}),allEmployeesData=_0x14043c,employeesWithManager=_0x14043c[_0x10a85f(0x1f5)](_0x28aafa=>_0x28aafa[_0x10a85f(0x14d)]&&_0x28aafa[_0x10a85f(0x14d)]['trim']()!==''),managerEmployeeCountElem[_0x10a85f(0x180)]=employeesWithManager[_0x10a85f(0x142)],teamMemberCountElem['textContent']=_0xdef193,populateManagerFilter(_0x15b986);const _0x4be74f=_0x1fd914[_0x10a85f(0x142)],_0x3920a4=_0x1fd914['filter'](_0x4867bd=>_0x4867bd[_0x10a85f(0xfa)]&&_0x4867bd['Check_Place']&&_0x4867bd[_0x10a85f(0x1b4)]['trim']()!==''),_0x557e75=_0x1fd914['filter'](_0x2bab4e=>_0x2bab4e[_0x10a85f(0xfa)]&&(!_0x2bab4e[_0x10a85f(0x1b4)]||_0x2bab4e[_0x10a85f(0x1b4)]['trim']()===''));attendeesCount['textContent']=_0x557e75[_0x10a85f(0x142)];!randomizeModal[_0x10a85f(0xa8)][_0x10a85f(0x116)](_0x10a85f(0x95))&&(updateRandomizerDataBasedOnAllEmployees(),updateModalUI());const _0x526460=_0x3920a4[_0x10a85f(0x142)];calculatedTarget=_0xebd112;const _0x13a1bf=Math[_0x10a85f(0x1e4)](0x0,calculatedTarget-_0x526460);donutChart[_0x10a85f(0x162)]['datasets'][0x0][_0x10a85f(0x162)]=[_0x526460,_0x13a1bf],donutChart[_0x10a85f(0x144)]();const _0x57f6e3=calculatedTarget>0x0?(_0x526460/calculatedTarget*0x64)[_0x10a85f(0x122)](0x0):0x0;donutPercentage[_0x10a85f(0x180)]=_0x57f6e3+'%',targetCountElem[_0x10a85f(0x180)]=calculatedTarget;const _0x293cd9=_0x3920a4['length'];participantsCountBoxElem[_0x10a85f(0x180)]=_0x293cd9,remainingCountElem[_0x10a85f(0x180)]=Math[_0x10a85f(0x1e4)](0x0,calculatedTarget-_0x293cd9);const _0x5b7ff1=_0x3920a4[_0x10a85f(0x142)],_0x465d75=_0x557e75[_0x10a85f(0x142)];breakdownCenterTotal[_0x10a85f(0x180)]=_0x4be74f,registrationBreakdownChart[_0x10a85f(0x162)][_0x10a85f(0xab)][0x0][_0x10a85f(0x162)]=[_0x5b7ff1,_0x465d75],registrationBreakdownChart[_0x10a85f(0x144)]();const _0x26952c={};teamNames[_0x10a85f(0x1b9)](_0x24f152=>{_0x67bb8[_0x24f152]&&(_0x26952c[_0x24f152]=_0x67bb8[_0x24f152]);});const _0x49310a=Object[_0x10a85f(0x1dc)](_0x26952c),_0x19bcdd=_0x49310a[_0x10a85f(0x17e)](_0x108b23=>_0x26952c[_0x108b23][_0x10a85f(0x168)]),_0x358a4b=_0x49310a[_0x10a85f(0x17e)](_0x370625=>Math['max'](0x0,_0x26952c[_0x370625][_0x10a85f(0x1f3)]-_0x26952c[_0x370625][_0x10a85f(0x168)])),_0x3a81e1=Math[_0x10a85f(0x1e9)](_0x49310a[_0x10a85f(0x142)]/0x2),_0xa1734e=_0x49310a['slice'](0x0,_0x3a81e1),_0x3e9486=_0x19bcdd[_0x10a85f(0xfc)](0x0,_0x3a81e1),_0x3222f6=_0x358a4b['slice'](0x0,_0x3a81e1),_0x46fec4=_0x49310a[_0x10a85f(0xfc)](_0x3a81e1),_0x21769b=_0x19bcdd[_0x10a85f(0xfc)](_0x3a81e1),_0x40b629=_0x358a4b[_0x10a85f(0xfc)](_0x3a81e1);barChart1[_0x10a85f(0x162)][_0x10a85f(0x1ec)]=_0xa1734e,barChart1[_0x10a85f(0x162)][_0x10a85f(0xab)][0x0][_0x10a85f(0x162)]=_0x3e9486,barChart1['data'][_0x10a85f(0xab)][0x1][_0x10a85f(0x162)]=_0x3222f6,barChart1[_0x10a85f(0x144)](),barChart2[_0x10a85f(0x162)][_0x10a85f(0x1ec)]=_0x46fec4,barChart2[_0x10a85f(0x162)][_0x10a85f(0xab)][0x0]['data']=_0x21769b,barChart2[_0x10a85f(0x162)]['datasets'][0x1][_0x10a85f(0x162)]=_0x40b629,barChart2[_0x10a85f(0x144)](),updateLatestRegistrationsTable(_0x1fd914),displaySelectedTeamMembers(),updateEmployeeListTable(_0x14043c),updateGroupView(_0x14043c);},_0x48ff1b=>{const _0x54a426=_0x6d67e0;console[_0x54a426(0xa6)](_0x54a426(0x1a6),_0x48ff1b);});}catch(_0x36224f){console[_0x6d67e0(0xa6)](_0x6d67e0(0x9c),_0x36224f);}}function updateLatestRegistrationsTable(_0x4421ba){const _0x2efcf2=_0x158961;latestRegistrationsTableBody[_0x2efcf2(0x1d3)]='';if(_0x4421ba[_0x2efcf2(0x142)]===0x0){latestRegistrationsTableBody['innerHTML']=_0x2efcf2(0x1f6);return;}_0x4421ba[_0x2efcf2(0xef)]((_0x324d3e,_0x40d0ab)=>{const _0x2fa401=_0x2efcf2,_0x31fc7f=_0x324d3e[_0x2fa401(0xfa)]?_0x324d3e[_0x2fa401(0xfa)][_0x2fa401(0x150)]():0x0,_0x1bf265=_0x40d0ab['DateLogin']?_0x40d0ab['DateLogin'][_0x2fa401(0x150)]():0x0;return _0x1bf265-_0x31fc7f;});const _0x4cf594=_0x4421ba[_0x2efcf2(0xfc)](0x0,0x1e);_0x4cf594[_0x2efcf2(0x1b9)]((_0xbb5f5b,_0x24b97a)=>{const _0x146007=_0x2efcf2,_0x2e1eb9=document[_0x146007(0x146)]('tr');_0x2e1eb9[_0x146007(0x14c)]=_0x24b97a%0x2===0x0?_0x146007(0xd9):_0x146007(0xae);const _0x316744=!!_0xbb5f5b[_0x146007(0xfa)];_0x2e1eb9[_0x146007(0x1d3)]=_0x146007(0x19a)+(_0xbb5f5b[_0x146007(0x18f)]||'')+_0x146007(0x13d)+(_0xbb5f5b[_0x146007(0x1f7)]||'')+_0x146007(0xe8)+(_0xbb5f5b['BU_th']||'')+_0x146007(0x141)+(_0xbb5f5b['Check_Manager']||'')+_0x146007(0x148)+(_0xbb5f5b['Check_Place']||'')+_0x146007(0x104)+(_0xbb5f5b[_0x146007(0x12d)]||'')+_0x146007(0x16d)+(_0x316744?'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>':_0x146007(0x182))+_0x146007(0x1f0);const _0x26a70c=document[_0x146007(0x146)]('button');_0x26a70c[_0x146007(0x180)]='ลบรายการ',_0x26a70c['className']=_0x146007(0x118),_0x26a70c[_0x146007(0x126)]=()=>showConfirmCancelRegistration(_0xbb5f5b),_0x2e1eb9[_0x146007(0x1d0)][0x6]['appendChild'](_0x26a70c),latestRegistrationsTableBody[_0x146007(0x96)](_0x2e1eb9);});}function updateEmployeeListTable(_0x21d39c){const _0x2e1e7f=_0x158961,_0x1b2cd1=managerFilterSelect[_0x2e1e7f(0x16a)];employeeListTableBody['innerHTML']='';const _0x3b6730=document['getElementById'](_0x2e1e7f(0x1b2)),_0x1d8b6d=document[_0x2e1e7f(0x1c5)](_0x2e1e7f(0x1a1)),_0x157553=document[_0x2e1e7f(0x1c5)](_0x2e1e7f(0x18d)),_0x24b362=document[_0x2e1e7f(0x1c5)]('empStatsUnregistered'),_0x34c59d=document[_0x2e1e7f(0x1c5)](_0x2e1e7f(0xa0)),_0x5aebfc=_0x21d39c[_0x2e1e7f(0x1f5)](_0x12024a=>_0x12024a['Check_Manager']&&_0x12024a['Check_Manager'][_0x2e1e7f(0x1fa)]()!==''),_0x3c34ef=_0x1b2cd1?_0x5aebfc[_0x2e1e7f(0x1f5)](_0x57d9c4=>_0x57d9c4[_0x2e1e7f(0x14d)]===_0x1b2cd1):_0x5aebfc;if(_0x3c34ef[_0x2e1e7f(0x142)]===0x0){employeeListTableBody[_0x2e1e7f(0x1d3)]=_0x2e1e7f(0x1f1);if(_0x3b6730)_0x3b6730['classList'][_0x2e1e7f(0x8c)](_0x2e1e7f(0x95));return;}const _0x19a0b6=_0x3c34ef['length'],_0x4a631a=_0x3c34ef[_0x2e1e7f(0x1f5)](_0x1e7667=>_0x1e7667[_0x2e1e7f(0xfa)])['length'],_0x3b4a56=_0x19a0b6-_0x4a631a,_0x30f4c1=_0x19a0b6>0x0?(_0x4a631a/_0x19a0b6*0x64)[_0x2e1e7f(0x122)](0x1):0x0;_0x3b6730&&(_0x1d8b6d[_0x2e1e7f(0x180)]=_0x19a0b6,_0x157553[_0x2e1e7f(0x180)]=_0x4a631a,_0x24b362['textContent']=_0x3b4a56,_0x34c59d[_0x2e1e7f(0x180)]=_0x30f4c1+'%',_0x3b6730[_0x2e1e7f(0xa8)]['remove'](_0x2e1e7f(0x95))),_0x3c34ef[_0x2e1e7f(0xef)]((_0x54fc90,_0x347570)=>{const _0x2c06cc=_0x2e1e7f,_0x45b733=teamNames[_0x2c06cc(0xd7)](_0x54fc90[_0x2c06cc(0x1b4)]||''),_0x572d63=teamNames[_0x2c06cc(0xd7)](_0x347570[_0x2c06cc(0x1b4)]||''),_0xd5c2f5=_0x54fc90['FullName_th']||'',_0x805a2=_0x347570[_0x2c06cc(0x1f7)]||'',_0x2f5a25=_0x45b733===-0x1?Infinity:_0x45b733,_0x491342=_0x572d63===-0x1?Infinity:_0x572d63;if(_0x2f5a25<_0x491342)return-0x1;if(_0x2f5a25>_0x491342)return 0x1;if(_0xd5c2f5<_0x805a2)return-0x1;if(_0xd5c2f5>_0x805a2)return 0x1;return 0x0;}),_0x3c34ef[_0x2e1e7f(0x1b9)]((_0x4c225f,_0x20ae5e)=>{const _0x49fcd3=_0x2e1e7f,_0x1192b4=document[_0x49fcd3(0x146)]('tr'),_0x216e79=!!_0x4c225f[_0x49fcd3(0xfa)];_0x216e79?_0x1192b4['className']=_0x49fcd3(0xbd):_0x1192b4[_0x49fcd3(0x14c)]=_0x20ae5e%0x2===0x0?'bg-white':_0x49fcd3(0xae);const _0x3ae272=document[_0x49fcd3(0x146)](_0x49fcd3(0xa2));_0x3ae272[_0x49fcd3(0x180)]=_0x49fcd3(0x92),_0x3ae272[_0x49fcd3(0x14c)]=_0x49fcd3(0x12e),_0x3ae272[_0x49fcd3(0x126)]=()=>showEditModal(_0x4c225f),_0x1192b4[_0x49fcd3(0x1d3)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22>'+(_0x20ae5e+0x1)+_0x49fcd3(0x1e2)+(_0x4c225f[_0x49fcd3(0x18f)]||'')+_0x49fcd3(0x13d)+(_0x4c225f[_0x49fcd3(0x1f7)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x4c225f[_0x49fcd3(0xce)]||'')+_0x49fcd3(0x166)+(_0x4c225f[_0x49fcd3(0x1b4)]||'')+_0x49fcd3(0x184)+(_0x216e79?_0x49fcd3(0x17d):'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>')+_0x49fcd3(0xf1),_0x1192b4[_0x49fcd3(0x1d0)][0x5][_0x49fcd3(0x96)](_0x3ae272),employeeListTableBody[_0x49fcd3(0x96)](_0x1192b4);});}function setActiveTab(_0x5db5bc,_0x2cb6fb){const _0x1ea14b=_0x158961;[tabDashboard,tabTeamList,tabGroupView,tabEmployeeList,tabRegister]['forEach'](_0x1eb5f5=>{const _0x1765f1=_0x5162;_0x1eb5f5[_0x1765f1(0xa8)][_0x1765f1(0x8c)](_0x1765f1(0xae),_0x1765f1(0x143),_0x1765f1(0xa3),_0x1765f1(0xc0),_0x1765f1(0x1ab)),_0x1eb5f5[_0x1765f1(0xa8)][_0x1765f1(0xb9)](_0x1765f1(0x16c),_0x1765f1(0xb7),_0x1765f1(0xc4));}),[dashboardContent,teamListContent,groupViewContent,employeeListContent,registerContent][_0x1ea14b(0x1b9)](_0x87ec6=>{const _0x493234=_0x1ea14b;_0x87ec6[_0x493234(0xa8)][_0x493234(0x8c)]('hidden');}),_0x5db5bc[_0x1ea14b(0xa8)][_0x1ea14b(0x8c)](_0x1ea14b(0x16c),_0x1ea14b(0xb7),_0x1ea14b(0xc4)),_0x5db5bc[_0x1ea14b(0xa8)]['remove'](_0x1ea14b(0xae),_0x1ea14b(0x143),_0x1ea14b(0xa3),_0x1ea14b(0xc0),'hover:border-gray-300'),_0x2cb6fb[_0x1ea14b(0xa8)][_0x1ea14b(0xb9)](_0x1ea14b(0x95));}tabDashboard[_0x158961(0x135)](_0x158961(0xad),()=>setActiveTab(tabDashboard,dashboardContent)),tabTeamList['addEventListener']('click',()=>setActiveTab(tabTeamList,teamListContent)),tabGroupView['addEventListener'](_0x158961(0xad),()=>setActiveTab(tabGroupView,groupViewContent)),tabEmployeeList[_0x158961(0x135)](_0x158961(0xad),()=>setActiveTab(tabEmployeeList,employeeListContent)),tabRegister[_0x158961(0x135)](_0x158961(0xad),()=>setActiveTab(tabRegister,registerContent));function shuffleArray(_0x136a35){const _0xccb7e=_0x158961;for(let _0x1f7346=_0x136a35[_0xccb7e(0x142)]-0x1;_0x1f7346>0x0;_0x1f7346--){const _0x3dcc50=Math['floor'](Math[_0xccb7e(0xe0)]()*(_0x1f7346+0x1));[_0x136a35[_0x1f7346],_0x136a35[_0x3dcc50]]=[_0x136a35[_0x3dcc50],_0x136a35[_0x1f7346]];}return _0x136a35;}async function handleResetTeam(){const _0x3f4ec7=_0x158961;console[_0x3f4ec7(0x19f)](_0x3f4ec7(0x202)),currentConfirmAction=async()=>{const _0x397b80=_0x3f4ec7;confirmTitle['textContent']=_0x397b80(0x169),confirmText[_0x397b80(0x180)]='กำลังลบข้อมูล\x20....',confirmActionButton[_0x397b80(0x1fe)]=!![],closeConfirmButton['disabled']=!![],teamCreationStatus[_0x397b80(0x180)]=_0x397b80(0xfd),teamCreationProgressContainer[_0x397b80(0xa8)]['remove'](_0x397b80(0x95)),teamCreationProgressBar[_0x397b80(0x1aa)]['width']='0%',teamCreationProgressBar[_0x397b80(0x180)]='0%',resetTeamButton[_0x397b80(0x1fe)]=!![],createTeamButton[_0x397b80(0x1fe)]=!![];try{const _0x5db5a6=writeBatch(db),_0x51001a=allEmployeesData[_0x397b80(0x142)];let _0x4aa5cd=0x0;allEmployeesData[_0x397b80(0x1b9)](_0x51df53=>{const _0xb82cb=_0x397b80,_0x13e9b0=doc(db,_0xb82cb(0x1ac),_0x51df53['id']);_0x5db5a6[_0xb82cb(0x144)](_0x13e9b0,{'Check_Place':'','DateLogin':null,'NickName':'','RandomTime':null}),_0x4aa5cd++;const _0x549e25=Math[_0xb82cb(0x97)](_0x4aa5cd/_0x51001a*0x64);teamCreationProgressBar[_0xb82cb(0x1aa)][_0xb82cb(0x121)]=_0x549e25+'%',teamCreationProgressBar[_0xb82cb(0x180)]=_0x549e25+'%';}),await _0x5db5a6[_0x397b80(0x19d)](),confirmTitle['textContent']=_0x397b80(0xea),confirmText[_0x397b80(0x180)]=_0x397b80(0x123),confirmActionButton[_0x397b80(0xa8)][_0x397b80(0x8c)](_0x397b80(0x95)),closeConfirmButton['textContent']=_0x397b80(0x15a),closeConfirmButton[_0x397b80(0x1fe)]=![],teamCreationStatus['textContent']=_0x397b80(0x187),console[_0x397b80(0x19f)](_0x397b80(0x1c4));}catch(_0x5d0682){console[_0x397b80(0xa6)]('Error\x20resetting\x20teams:\x20',_0x5d0682),confirmTitle[_0x397b80(0x180)]=_0x397b80(0x1fc),confirmText[_0x397b80(0x180)]=_0x397b80(0x18a)+_0x5d0682['message'],closeConfirmButton['textContent']='ปิดหน้าต่าง',closeConfirmButton[_0x397b80(0x1fe)]=![],teamCreationStatus['textContent']=_0x397b80(0x1da)+_0x5d0682[_0x397b80(0x112)];}finally{resetTeamButton[_0x397b80(0x1fe)]=![],createTeamButton[_0x397b80(0x1fe)]=![];}},confirmTitle['textContent']=_0x3f4ec7(0x132),confirmText[_0x3f4ec7(0x180)]=_0x3f4ec7(0x9b),confirmActionButton[_0x3f4ec7(0x180)]=_0x3f4ec7(0x1c8),confirmActionButton[_0x3f4ec7(0x14c)]=_0x3f4ec7(0xbc),confirmActionButton[_0x3f4ec7(0x1fe)]=![],confirmActionButton[_0x3f4ec7(0xa8)][_0x3f4ec7(0xb9)](_0x3f4ec7(0x95)),confirmActionButton[_0x3f4ec7(0x126)]=()=>{typeof currentConfirmAction==='function'&&currentConfirmAction();},closeConfirmButton['textContent']=_0x3f4ec7(0x1fd),closeConfirmButton[_0x3f4ec7(0x1fe)]=![],closeConfirmButton[_0x3f4ec7(0xa8)][_0x3f4ec7(0xb9)](_0x3f4ec7(0x95)),confirmModal[_0x3f4ec7(0xa8)]['remove'](_0x3f4ec7(0x95));}async function handleCreateTeam(){const _0x1d5ce0=_0x158961;console[_0x1d5ce0(0x19f)](_0x1d5ce0(0x10d)),teamCreationStatus[_0x1d5ce0(0x180)]='กำลังเตรียมข้อมูล...',teamCreationProgressContainer[_0x1d5ce0(0xa8)][_0x1d5ce0(0xb9)](_0x1d5ce0(0x95)),teamCreationProgressBar['style'][_0x1d5ce0(0x121)]='0%',teamCreationProgressBar[_0x1d5ce0(0x180)]='0%',resetTeamButton['disabled']=!![],createTeamButton[_0x1d5ce0(0x1fe)]=!![];const _0x5dcc61=allEmployeesData[_0x1d5ce0(0x1f5)](_0x1f62e4=>_0x1f62e4[_0x1d5ce0(0x14d)]&&_0x1f62e4[_0x1d5ce0(0x14d)][_0x1d5ce0(0x1fa)]()!==''&&(!_0x1f62e4[_0x1d5ce0(0x1b4)]||_0x1f62e4[_0x1d5ce0(0x1b4)]['trim']()==='')),_0x644f2c=_0x5dcc61['length'];if(_0x644f2c===0x0){teamCreationStatus[_0x1d5ce0(0x180)]='ไม่พบพนักงานที่เข้าเงื่อนไข\x20(มี\x20Manager\x20และยังไม่มีทีม)\x20สำหรับจัดทีม',resetTeamButton[_0x1d5ce0(0x1fe)]=![],createTeamButton[_0x1d5ce0(0x1fe)]=![];return;}const _0x2751fc=Math['ceil'](_0x644f2c/teamSize),_0x2ab19a=teamNames[_0x1d5ce0(0xfc)](0x0,_0x2751fc),_0x321721=_0x2ab19a[_0x2ab19a[_0x1d5ce0(0x142)]-0x1];console[_0x1d5ce0(0x19f)](_0x1d5ce0(0x1c9)+_0x644f2c+_0x1d5ce0(0x93)+_0x2751fc+_0x1d5ce0(0xd6)+_0x2ab19a['join'](',\x20'));const _0xd73449=_0x5dcc61['reduce']((_0x375d02,_0x297a4f)=>{const _0x3ee2b6=_0x1d5ce0,_0x368519=_0x297a4f[_0x3ee2b6(0x14d)]||_0x3ee2b6(0x1ff);return _0x375d02[_0x368519]=(_0x375d02[_0x368519]||0x0)+0x1,_0x375d02;},{});console[_0x1d5ce0(0x19f)](_0x1d5ce0(0x157),_0xd73449);const _0x23e9ee=new Map(),_0x551641=[];_0x5dcc61['forEach'](_0x39a8d0=>{const _0x59ada8=_0x1d5ce0,_0x5d2e8d=_0x39a8d0['Check_Manager']||_0x59ada8(0x1ff);_0xd73449[_0x5d2e8d]>_0x2751fc?(!_0x23e9ee[_0x59ada8(0x1cd)](_0x5d2e8d)&&_0x23e9ee[_0x59ada8(0x128)](_0x5d2e8d,[]),_0x23e9ee['get'](_0x5d2e8d)[_0x59ada8(0x100)](_0x39a8d0)):_0x551641[_0x59ada8(0x100)](_0x39a8d0);}),console[_0x1d5ce0(0x19f)]('Large\x20group\x20managers:\x20'+_0x23e9ee[_0x1d5ce0(0x1a4)]),console[_0x1d5ce0(0x19f)]('Normal\x20group\x20employees\x20(initial):\x20'+_0x551641['length']);const _0x593ff5={};_0x2ab19a[_0x1d5ce0(0x1b9)](_0x1f72d1=>{_0x593ff5[_0x1f72d1]={'members':[],'managers':{}};});const _0x36b44a={};let _0x40aa70=0x0;teamCreationStatus[_0x1d5ce0(0x180)]=_0x1d5ce0(0x1c3);let _0x31d560=0x0;for(const [_0x3cd3cb,_0x453254]of _0x23e9ee[_0x1d5ce0(0x9d)]()){console[_0x1d5ce0(0x19f)](_0x1d5ce0(0x101)+_0x3cd3cb+'\x20('+_0x453254[_0x1d5ce0(0x142)]+_0x1d5ce0(0xc6)),shuffleArray(_0x453254);while(_0x453254[_0x1d5ce0(0x142)]>_0x2751fc){const _0x477154=_0x453254[_0x1d5ce0(0x142)]>_0x2751fc*0x2?0x2:0x1;console[_0x1d5ce0(0x19f)](_0x1d5ce0(0xb4)+_0x477154+'\x20for\x20'+_0x3cd3cb+_0x1d5ce0(0x1d1)+_0x453254['length']);for(let _0x517204=0x0;_0x517204<_0x2751fc*_0x477154;_0x517204++){if(_0x453254[_0x1d5ce0(0x142)]===0x0)break;const _0x4ba04a=_0x453254[_0x1d5ce0(0x1ef)]();let _0x2b4c76=_0x2ab19a[_0x31d560],_0x9b88ea=_0x593ff5[_0x2b4c76],_0x431cd7=0x0;while(_0x2b4c76!==_0x321721&&_0x9b88ea[_0x1d5ce0(0x10c)][_0x1d5ce0(0x142)]>=teamSize&&_0x431cd7<_0x2751fc){_0x31d560=(_0x31d560+0x1)%_0x2751fc,_0x2b4c76=_0x2ab19a[_0x31d560],_0x9b88ea=_0x593ff5[_0x2b4c76],_0x431cd7++;}_0x2b4c76!==_0x321721&&_0x9b88ea[_0x1d5ce0(0x10c)][_0x1d5ce0(0x142)]>=teamSize&&(_0x2b4c76=_0x321721,_0x9b88ea=_0x593ff5[_0x321721]);_0x9b88ea[_0x1d5ce0(0x10c)]['push'](_0x4ba04a),_0x9b88ea[_0x1d5ce0(0x9e)][_0x4ba04a[_0x1d5ce0(0x14d)]]=(_0x9b88ea['managers'][_0x4ba04a[_0x1d5ce0(0x14d)]]||0x0)+0x1,_0x36b44a[_0x4ba04a['id']]=_0x2b4c76,_0x40aa70++;const _0x214b37=Math[_0x1d5ce0(0x97)](_0x40aa70/_0x644f2c*0x64);teamCreationProgressBar['style'][_0x1d5ce0(0x121)]=_0x214b37+'%',teamCreationProgressBar[_0x1d5ce0(0x180)]=_0x214b37+'%',_0x31d560=(_0x31d560+0x1)%_0x2751fc;}}_0x453254[_0x1d5ce0(0x142)]>0x0&&(console['log'](_0x1d5ce0(0x17c)+_0x453254[_0x1d5ce0(0x142)]+_0x1d5ce0(0x18e)+_0x3cd3cb+_0x1d5ce0(0xcf)),_0x551641[_0x1d5ce0(0x100)](..._0x453254));}console[_0x1d5ce0(0x19f)](_0x1d5ce0(0x140),JSON[_0x1d5ce0(0x11c)](JSON['stringify'](_0x593ff5))),console[_0x1d5ce0(0x19f)](_0x1d5ce0(0xe9)+_0x551641[_0x1d5ce0(0x142)]),teamCreationStatus[_0x1d5ce0(0x180)]=_0x1d5ce0(0x1e5),shuffleArray(_0x551641);for(const _0x4e259b of _0x551641){let _0x4c1504=![];const _0x4e35bc=_0x4e259b[_0x1d5ce0(0x14d)]||_0x1d5ce0(0x1ff);for(const _0x447da1 of _0x2ab19a){const _0x53dd0c=_0x593ff5[_0x447da1],_0x5a9283=_0x447da1!==_0x321721&&_0x53dd0c['members'][_0x1d5ce0(0x142)]>=teamSize;if(!_0x5a9283&&!_0x53dd0c[_0x1d5ce0(0x9e)][_0x4e35bc]){_0x53dd0c['members'][_0x1d5ce0(0x100)](_0x4e259b),_0x53dd0c[_0x1d5ce0(0x9e)][_0x4e35bc]=0x1,_0x36b44a[_0x4e259b['id']]=_0x447da1,_0x4c1504=!![];break;}}if(!_0x4c1504)for(const _0x410374 of _0x2ab19a){const _0x1781c2=_0x593ff5[_0x410374],_0x5c03e3=_0x410374!==_0x321721&&_0x1781c2[_0x1d5ce0(0x10c)][_0x1d5ce0(0x142)]>=teamSize;if(!_0x5c03e3){_0x1781c2[_0x1d5ce0(0x10c)][_0x1d5ce0(0x100)](_0x4e259b),_0x1781c2[_0x1d5ce0(0x9e)][_0x4e35bc]=(_0x1781c2['managers'][_0x4e35bc]||0x0)+0x1,_0x36b44a[_0x4e259b['id']]=_0x410374,_0x4c1504=!![];break;}}if(_0x4c1504){_0x40aa70++;const _0x2bd917=Math[_0x1d5ce0(0x97)](_0x40aa70/_0x644f2c*0x64);teamCreationProgressBar[_0x1d5ce0(0x1aa)]['width']=_0x2bd917+'%',teamCreationProgressBar[_0x1d5ce0(0x180)]=_0x2bd917+'%';}else console[_0x1d5ce0(0xa6)](_0x1d5ce0(0xf5),_0x4e259b);}console['log'](_0x1d5ce0(0xe5),_0x36b44a),console['log'](_0x1d5ce0(0x15d),_0x593ff5);if(Object['keys'](_0x36b44a)[_0x1d5ce0(0x142)]>0x0){teamCreationStatus[_0x1d5ce0(0x180)]='กำลังบันทึกข้อมูลทีม...';try{const _0x4bb6da=writeBatch(db);Object[_0x1d5ce0(0x1dc)](_0x36b44a)[_0x1d5ce0(0x1b9)](_0x2796cf=>{const _0x2aa155=_0x1d5ce0,_0x2da836=_0x36b44a[_0x2796cf],_0x525da0=doc(db,_0x2aa155(0x1ac),_0x2796cf);_0x4bb6da['update'](_0x525da0,{'Check_Place':_0x2da836});}),await _0x4bb6da[_0x1d5ce0(0x19d)](),_0x40aa70<_0x644f2c?(teamCreationStatus[_0x1d5ce0(0x180)]=_0x1d5ce0(0x1b7)+_0x40aa70+'/'+_0x644f2c+').',console[_0x1d5ce0(0xa6)]('Mismatch\x20in\x20assigned\x20count!')):teamCreationStatus[_0x1d5ce0(0x180)]=_0x1d5ce0(0x163),console['log'](_0x1d5ce0(0xa4)),displaySelectedTeamMembers();}catch(_0x2af560){console[_0x1d5ce0(0xa6)](_0x1d5ce0(0x177),_0x2af560),teamCreationStatus[_0x1d5ce0(0x180)]=_0x1d5ce0(0xde)+_0x2af560[_0x1d5ce0(0x112)];}finally{resetTeamButton['disabled']=![],createTeamButton[_0x1d5ce0(0x1fe)]=![];}}else teamCreationStatus[_0x1d5ce0(0x180)]='ไม่มีพนักงานที่ต้องจัดทีมใหม่',resetTeamButton[_0x1d5ce0(0x1fe)]=![],createTeamButton['disabled']=![];}function displaySelectedTeamMembers(){const _0x22fd13=_0x158961,_0x2001f8=teamSelect[_0x22fd13(0x16a)];selectedTeamTableBody['innerHTML']='';const _0x2c783c=document[_0x22fd13(0x1c5)](_0x22fd13(0x14f)),_0x14ee40=document[_0x22fd13(0x1c5)](_0x22fd13(0x11a)),_0x46d6d5=document[_0x22fd13(0x1c5)](_0x22fd13(0x1ee)),_0xaeaa01=document[_0x22fd13(0x1c5)](_0x22fd13(0x131)),_0x1e49c2=document['getElementById']('teamStatsPercent');if(!_0x2001f8){selectedTeamTableBody['innerHTML']=_0x22fd13(0x1fb);if(_0x2c783c)_0x2c783c[_0x22fd13(0xa8)][_0x22fd13(0x8c)](_0x22fd13(0x95));return;}const _0xbdce25=allEmployeesData['filter'](_0x15fa34=>_0x15fa34[_0x22fd13(0x1b4)]===_0x2001f8);if(_0xbdce25['length']===0x0){selectedTeamTableBody['innerHTML']=_0x22fd13(0x11f)+_0x2001f8+_0x22fd13(0xf7);if(_0x2c783c)_0x2c783c[_0x22fd13(0xa8)]['add'](_0x22fd13(0x95));return;}const _0x2c3ab8=_0xbdce25['length'],_0x41f009=_0xbdce25[_0x22fd13(0x1f5)](_0x323e23=>_0x323e23[_0x22fd13(0xfa)])[_0x22fd13(0x142)],_0x25bcda=_0x2c3ab8-_0x41f009,_0x245268=_0x2c3ab8>0x0?(_0x41f009/_0x2c3ab8*0x64)[_0x22fd13(0x122)](0x1):0x0;_0x2c783c&&(_0x14ee40[_0x22fd13(0x180)]=_0x2c3ab8,_0x46d6d5[_0x22fd13(0x180)]=_0x41f009,_0xaeaa01[_0x22fd13(0x180)]=_0x25bcda,_0x1e49c2[_0x22fd13(0x180)]=_0x245268+'%',_0x2c783c[_0x22fd13(0xa8)][_0x22fd13(0xb9)](_0x22fd13(0x95))),_0xbdce25[_0x22fd13(0xef)]((_0x47d9be,_0x5b3d95)=>(_0x47d9be['FullName_th']||'')[_0x22fd13(0x111)](_0x5b3d95['FullName_th']||'')),_0xbdce25[_0x22fd13(0x1b9)]((_0x594d46,_0x57b3a7)=>{const _0x271bef=_0x22fd13,_0x1c8b47=document[_0x271bef(0x146)]('tr'),_0x48b142=!!_0x594d46[_0x271bef(0xfa)];_0x48b142?_0x1c8b47[_0x271bef(0x14c)]=_0x271bef(0xbd):_0x1c8b47[_0x271bef(0x14c)]=_0x57b3a7%0x2===0x0?_0x271bef(0xd9):'bg-gray-50';_0x1c8b47[_0x271bef(0x1d3)]=_0x271bef(0x1bb)+(_0x57b3a7+0x1)+_0x271bef(0x1e2)+(_0x594d46[_0x271bef(0x18f)]||'')+_0x271bef(0x13d)+(_0x594d46[_0x271bef(0x1f7)]||'')+_0x271bef(0x1e2)+(_0x594d46[_0x271bef(0x124)]||'')+_0x271bef(0x1e2)+(_0x594d46[_0x271bef(0x14d)]||'')+_0x271bef(0x125)+(_0x48b142?_0x271bef(0x16f):_0x271bef(0x182))+_0x271bef(0x15b);const _0x472a39=document[_0x271bef(0x146)](_0x271bef(0xa2));_0x472a39[_0x271bef(0x180)]=_0x271bef(0x92),_0x472a39[_0x271bef(0x14c)]=_0x271bef(0x12e),_0x472a39[_0x271bef(0x126)]=()=>showEditTeamMemberModal(_0x594d46),_0x1c8b47[_0x271bef(0x1d0)][0x6][_0x271bef(0x96)](_0x472a39),selectedTeamTableBody['appendChild'](_0x1c8b47);});}function showEditTeamMemberModal(_0x4d5f49){const _0x112f6b=_0x158961;console[_0x112f6b(0x19f)]('Editing\x20team\x20member:',_0x4d5f49),currentEditingDocId=_0x4d5f49['id'],editMemberEmpId[_0x112f6b(0x180)]=_0x4d5f49[_0x112f6b(0x18f)]||_0x112f6b(0x134),editMemberEmpName[_0x112f6b(0x180)]=_0x4d5f49[_0x112f6b(0x1f7)]||_0x112f6b(0x134),editMemberError[_0x112f6b(0x180)]='',editMemberTeamSelect[_0x112f6b(0x1d3)]='';const _0x43f2bf=document[_0x112f6b(0x146)](_0x112f6b(0x172));_0x43f2bf[_0x112f6b(0x16a)]='',_0x43f2bf['textContent']=_0x112f6b(0x109),editMemberTeamSelect['appendChild'](_0x43f2bf),teamNames[_0x112f6b(0x1b9)](_0x174471=>{const _0x1ff7db=_0x112f6b,_0x2293f1=document[_0x1ff7db(0x146)](_0x1ff7db(0x172));_0x2293f1['value']=_0x174471,_0x2293f1[_0x1ff7db(0x180)]=_0x174471,editMemberTeamSelect[_0x1ff7db(0x96)](_0x2293f1);}),editMemberTeamSelect[_0x112f6b(0x16a)]=_0x4d5f49[_0x112f6b(0x1b4)]||'',editTeamMemberModal[_0x112f6b(0xa8)]['remove'](_0x112f6b(0x95));}function closeEditTeamMemberModal(){const _0x5890c3=_0x158961;editTeamMemberModal[_0x5890c3(0xa8)][_0x5890c3(0x8c)](_0x5890c3(0x95)),currentEditingDocId=null;}async function saveEditTeamMemberChanges(){const _0x56adba=_0x158961;if(!currentEditingDocId)return;const _0x1b6a9b=editMemberTeamSelect[_0x56adba(0x16a)];editMemberError['textContent']='',saveEditMemberModalButton['disabled']=!![],deleteEditMemberModalButton[_0x56adba(0x1fe)]=!![],closeEditMemberModalButton[_0x56adba(0x1fe)]=!![];try{const _0xefab1b=doc(db,_0x56adba(0x1ac),currentEditingDocId);await updateDoc(_0xefab1b,{'Check_Place':_0x1b6a9b}),console[_0x56adba(0x19f)](_0x56adba(0x145)),closeEditTeamMemberModal();}catch(_0x15be32){console['error']('Error\x20saving\x20team\x20member\x20changes:',_0x15be32),editMemberError[_0x56adba(0x180)]=_0x56adba(0x18a)+_0x15be32[_0x56adba(0x112)];}finally{saveEditMemberModalButton[_0x56adba(0x1fe)]=![],deleteEditMemberModalButton[_0x56adba(0x1fe)]=![],closeEditMemberModalButton[_0x56adba(0x1fe)]=![];}}function handleShowConfirmDeleteMember(){const _0x123287=_0x158961;if(!currentEditingDocId)return;currentConfirmAction=async()=>{const _0x586dd9=_0x5162;console[_0x586dd9(0x19f)](_0x586dd9(0x1cb),currentEditingDocId),saveEditMemberModalButton[_0x586dd9(0x1fe)]=!![],deleteEditMemberModalButton[_0x586dd9(0x1fe)]=!![],closeEditMemberModalButton['disabled']=!![];try{const _0xcc1a3c=doc(db,_0x586dd9(0x1ac),currentEditingDocId);await updateDoc(_0xcc1a3c,{'Check_Place':''}),console['log'](_0x586dd9(0x9f)),closeEditTeamMemberModal(),confirmModal[_0x586dd9(0xa8)][_0x586dd9(0x8c)](_0x586dd9(0x95));}catch(_0x2ce0f4){console['error'](_0x586dd9(0x1c7),_0x2ce0f4),editMemberError['textContent']=_0x586dd9(0x18a)+_0x2ce0f4[_0x586dd9(0x112)],confirmModal[_0x586dd9(0xa8)][_0x586dd9(0x8c)](_0x586dd9(0x95));}finally{saveEditMemberModalButton['disabled']=![],deleteEditMemberModalButton[_0x586dd9(0x1fe)]=![],closeEditMemberModalButton[_0x586dd9(0x1fe)]=![],currentConfirmAction=null;}},confirmTitle[_0x123287(0x180)]=_0x123287(0xc3),confirmText['textContent']=_0x123287(0x1a2)+editMemberEmpName[_0x123287(0x180)]+_0x123287(0xd1),confirmActionButton['textContent']=_0x123287(0x181),confirmActionButton[_0x123287(0x14c)]=_0x123287(0xbc),confirmActionButton[_0x123287(0x1fe)]=![],confirmActionButton[_0x123287(0xa8)][_0x123287(0xb9)](_0x123287(0x95)),confirmActionButton[_0x123287(0x126)]=()=>{const _0x3f8c7a=_0x123287;typeof currentConfirmAction===_0x3f8c7a(0x19e)&&currentConfirmAction();},closeConfirmButton[_0x123287(0x180)]=_0x123287(0x1fd),closeConfirmButton[_0x123287(0x1fe)]=![],closeConfirmButton[_0x123287(0xa8)]['remove'](_0x123287(0x95)),confirmModal['classList'][_0x123287(0xb9)]('hidden');}function setupEditTeamMemberModalListeners(){const _0x370dca=_0x158961;closeEditMemberModalButton['addEventListener'](_0x370dca(0xad),closeEditTeamMemberModal),saveEditMemberModalButton['addEventListener'](_0x370dca(0xad),saveEditTeamMemberChanges),deleteEditMemberModalButton[_0x370dca(0x135)](_0x370dca(0xad),handleShowConfirmDeleteMember);}function updateGroupView(_0x6529f6){const _0x260d83=_0x158961;teamBoxesContainer[_0x260d83(0x1d3)]='';const _0x59d453=document[_0x260d83(0x1c5)](_0x260d83(0x161)),_0x693853=document[_0x260d83(0x1c5)](_0x260d83(0x192)),_0x13f1ef=document[_0x260d83(0x1c5)]('gvOverallStatsRegistered'),_0x39215c=document[_0x260d83(0x1c5)]('gvOverallStatsUnregistered'),_0x527f61=document[_0x260d83(0x1c5)]('gvOverallStatsPercent'),_0x4e2833=groupViewManagerFilter[_0x260d83(0x16a)],_0x4683eb=_0x4e2833?_0x6529f6['filter'](_0xc7d4da=>{const _0x18ad7b=_0x260d83;if(_0x4e2833==='NO_MANAGER')return!_0xc7d4da[_0x18ad7b(0x14d)]||_0xc7d4da[_0x18ad7b(0x14d)]['trim']()==='';return _0xc7d4da[_0x18ad7b(0x14d)]===_0x4e2833;}):_0x6529f6,_0x4691fa=teamNames[_0x260d83(0xb0)]((_0x3c681d,_0x283d6c)=>{return _0x3c681d[_0x283d6c]={'total':0x0,'registered':0x0},_0x3c681d;},{});let _0x68168c=0x0,_0x5ba259=0x0;_0x4683eb[_0x260d83(0x1b9)](_0x369b0e=>{const _0x30608a=_0x260d83,_0x175ac4=_0x369b0e['Check_Place'];_0x175ac4&&teamNames[_0x30608a(0x119)](_0x175ac4)&&(_0x4691fa[_0x175ac4][_0x30608a(0x1f3)]++,_0x68168c++,_0x369b0e[_0x30608a(0xfa)]&&(_0x4691fa[_0x175ac4][_0x30608a(0x168)]++,_0x5ba259++));});if(_0x59d453){const _0x5cd317=_0x68168c-_0x5ba259,_0x128042=_0x68168c>0x0?(_0x5ba259/_0x68168c*0x64)[_0x260d83(0x122)](0x1):0x0;_0x693853[_0x260d83(0x180)]=_0x68168c,_0x13f1ef[_0x260d83(0x180)]=_0x5ba259,_0x39215c[_0x260d83(0x180)]=_0x5cd317,_0x527f61[_0x260d83(0x180)]=_0x128042+'%',_0x68168c>0x0?_0x59d453['classList']['remove'](_0x260d83(0x95)):_0x59d453[_0x260d83(0xa8)]['remove'](_0x260d83(0x95));}teamNames[_0x260d83(0x1b9)](_0x398a3b=>{const _0x2c042d=_0x260d83,_0x14531f=_0x4691fa[_0x398a3b],_0x107726=_0x14531f[_0x2c042d(0x1f3)],_0x39905a=_0x14531f[_0x2c042d(0x168)],_0x11993f=document[_0x2c042d(0x146)](_0x2c042d(0x151));_0x11993f[_0x2c042d(0x14c)]=_0x2c042d(0x12f);let _0x5f2a0b=_0x2c042d(0xae),_0x365322=_0x2c042d(0xd9),_0x2d2ef1;if(_0x39905a>0x0&&_0x39905a===_0x107726)_0x5f2a0b=_0x2c042d(0xd2),_0x365322=_0x2c042d(0xb1),_0x2d2ef1=_0x2c042d(0xbf)+_0x39905a+_0x2c042d(0xf8)+_0x107726+_0x2c042d(0x138);else _0x39905a>0x0&&_0x39905a<_0x107726?(_0x39905a<=0x5?(_0x5f2a0b=_0x2c042d(0x136),_0x365322='bg-red-100'):(_0x5f2a0b='bg-orange-200',_0x365322=_0x2c042d(0x1cc)),_0x2d2ef1=_0x2c042d(0xbf)+_0x39905a+_0x2c042d(0xf8)+_0x107726+_0x2c042d(0x138)):_0x2d2ef1=_0x2c042d(0x114)+_0x107726+_0x2c042d(0xec);_0x11993f[_0x2c042d(0x1d3)]=_0x2c042d(0xaf)+_0x5f2a0b+_0x2c042d(0x1c6)+_0x398a3b+_0x2c042d(0x108)+_0x365322+_0x2c042d(0x1bd)+_0x2d2ef1+_0x2c042d(0xd5),_0x11993f[_0x2c042d(0x135)]('click',()=>showGroupViewModal(_0x398a3b,_0x6529f6)),teamBoxesContainer[_0x2c042d(0x96)](_0x11993f);}),teamNames[_0x260d83(0x142)]===0x0&&(teamBoxesContainer[_0x260d83(0x1d3)]=_0x260d83(0xc1));}function showGroupViewModal(_0x4735ad,_0x4f3925){const _0x279855=_0x158961;groupViewModalTitle[_0x279855(0x180)]=_0x279855(0xee)+_0x4735ad,groupViewTableBody[_0x279855(0x1d3)]='';const _0x19e971=document[_0x279855(0x1c5)](_0x279855(0xcd)),_0x33f9d5=document[_0x279855(0x1c5)]('groupViewStatsTotal'),_0x2a0dff=document[_0x279855(0x1c5)]('groupViewStatsRegistered'),_0x4ca728=document[_0x279855(0x1c5)]('groupViewStatsUnregistered'),_0x44c5db=document[_0x279855(0x1c5)](_0x279855(0xd4)),_0x260628=_0x4f3925['filter'](_0x30e759=>_0x30e759[_0x279855(0x1b4)]===_0x4735ad);if(_0x260628[_0x279855(0x142)]===0x0){groupViewTableBody[_0x279855(0x1d3)]=_0x279855(0x11f)+_0x4735ad+'</td></tr>';if(_0x19e971)_0x19e971[_0x279855(0xa8)][_0x279855(0x8c)](_0x279855(0x95));groupViewModal[_0x279855(0xa8)][_0x279855(0xb9)](_0x279855(0x95));return;}const _0x43d81d=_0x260628[_0x279855(0x142)],_0x38f806=_0x260628['filter'](_0x12a9fe=>_0x12a9fe[_0x279855(0xfa)])[_0x279855(0x142)],_0x59b5dd=_0x43d81d-_0x38f806,_0x4c896e=_0x43d81d>0x0?(_0x38f806/_0x43d81d*0x64)[_0x279855(0x122)](0x1):0x0;_0x19e971&&(_0x33f9d5['textContent']=_0x43d81d,_0x2a0dff[_0x279855(0x180)]=_0x38f806,_0x4ca728[_0x279855(0x180)]=_0x59b5dd,_0x44c5db[_0x279855(0x180)]=_0x4c896e+'%',_0x19e971[_0x279855(0xa8)][_0x279855(0xb9)](_0x279855(0x95))),_0x260628[_0x279855(0xef)]((_0x7a95b1,_0x22a8fd)=>{const _0x1732ed=_0x279855,_0x357094=_0x7a95b1[_0x1732ed(0x14d)]||'',_0x3ba635=_0x22a8fd[_0x1732ed(0x14d)]||'',_0x212c0a=_0x7a95b1['FullName_th']||'',_0x59a158=_0x22a8fd['FullName_th']||'';if(_0x357094<_0x3ba635)return-0x1;if(_0x357094>_0x3ba635)return 0x1;return _0x212c0a[_0x1732ed(0x111)](_0x59a158);}),_0x260628[_0x279855(0x1b9)]((_0x3602c3,_0x44b849)=>{const _0x2f952a=_0x279855,_0x1d6cdb=document['createElement']('tr'),_0x52e111=!!_0x3602c3['DateLogin'];_0x52e111?_0x1d6cdb[_0x2f952a(0x14c)]='bg-yellow-100\x20hover:bg-yellow-200\x20transition-colors':_0x1d6cdb[_0x2f952a(0x14c)]=_0x44b849%0x2===0x0?_0x2f952a(0xd9):_0x2f952a(0xae);_0x1d6cdb[_0x2f952a(0x1d3)]=_0x2f952a(0x1bb)+(_0x44b849+0x1)+_0x2f952a(0x1e2)+(_0x3602c3['employeeId']||'')+_0x2f952a(0x13d)+(_0x3602c3[_0x2f952a(0x1f7)]||'')+_0x2f952a(0x1e2)+(_0x3602c3['BU_th']||'')+_0x2f952a(0x1e2)+(_0x3602c3[_0x2f952a(0x14d)]||'')+_0x2f952a(0x125)+(_0x52e111?_0x2f952a(0x16f):_0x2f952a(0x182))+_0x2f952a(0x15b);const _0x1b1b77=document[_0x2f952a(0x146)](_0x2f952a(0xa2));_0x1b1b77[_0x2f952a(0x180)]=_0x2f952a(0x92),_0x1b1b77[_0x2f952a(0x14c)]=_0x2f952a(0x12e),_0x1b1b77[_0x2f952a(0x126)]=()=>showEditTeamMemberModal(_0x3602c3),_0x1d6cdb[_0x2f952a(0x1d0)][0x6][_0x2f952a(0x96)](_0x1b1b77),groupViewTableBody[_0x2f952a(0x96)](_0x1d6cdb);}),groupViewModal[_0x279855(0xa8)]['remove'](_0x279855(0x95));}function setupGroupViewListeners(){const _0x104b73=_0x158961;closeGroupViewModalButton[_0x104b73(0x135)](_0x104b73(0xad),()=>{const _0x4cabc8=_0x104b73;groupViewModal['classList'][_0x4cabc8(0x8c)]('hidden');}),groupViewManagerFilter[_0x104b73(0x135)]('change',()=>updateGroupView(allEmployeesData));}function showConfirmCancelRegistration(_0x3020a1){const _0x1d8591=_0x158961;if(!_0x3020a1||!_0x3020a1['id']){console[_0x1d8591(0xa6)](_0x1d8591(0x10f));return;}currentConfirmAction=async()=>{const _0x2fb4c7=_0x1d8591;console['log'](_0x2fb4c7(0x8f),_0x3020a1[_0x2fb4c7(0x1f7)]),confirmActionButton[_0x2fb4c7(0x1fe)]=!![],closeConfirmButton[_0x2fb4c7(0x1fe)]=!![];try{const _0x4bda90=doc(db,_0x2fb4c7(0x1ac),_0x3020a1['id']);await updateDoc(_0x4bda90,{'DateLogin':null}),console[_0x2fb4c7(0x19f)](_0x2fb4c7(0x1ea)),confirmModal['classList'][_0x2fb4c7(0x8c)](_0x2fb4c7(0x95));}catch(_0x9136df){console[_0x2fb4c7(0xa6)](_0x2fb4c7(0x19b),_0x9136df),confirmText[_0x2fb4c7(0x180)]=_0x2fb4c7(0x18a)+_0x9136df[_0x2fb4c7(0x112)],confirmActionButton[_0x2fb4c7(0x1fe)]=![],closeConfirmButton[_0x2fb4c7(0x1fe)]=![];}finally{currentConfirmAction=null;}},confirmTitle[_0x1d8591(0x180)]=_0x1d8591(0xaa),confirmText[_0x1d8591(0x180)]='คุณต้องการยกเลิกการลงทะเบียนของ\x20['+_0x3020a1[_0x1d8591(0x1f7)]+_0x1d8591(0x10e),confirmActionButton[_0x1d8591(0x180)]=_0x1d8591(0x176),confirmActionButton[_0x1d8591(0x14c)]=_0x1d8591(0xbc),confirmActionButton[_0x1d8591(0x1fe)]=![],confirmActionButton[_0x1d8591(0xa8)][_0x1d8591(0xb9)](_0x1d8591(0x95)),confirmActionButton['onclick']=()=>{const _0x320404=_0x1d8591;typeof currentConfirmAction===_0x320404(0x19e)&&currentConfirmAction();},closeConfirmButton[_0x1d8591(0x180)]='ปิดหน้าต่าง',closeConfirmButton[_0x1d8591(0x1fe)]=![],closeConfirmButton[_0x1d8591(0xa8)][_0x1d8591(0xb9)](_0x1d8591(0x95)),confirmModal['classList']['remove']('hidden');}function updateRandomizerDataBasedOnAllEmployees(){const _0x91d844=_0x158961;currentParticipants=allEmployeesData['filter'](_0x11da1c=>_0x11da1c[_0x91d844(0xfa)]&&_0x11da1c[_0x91d844(0x1b4)]&&_0x11da1c[_0x91d844(0x1b4)][_0x91d844(0x1fa)]()!==''),availableToDraw=currentParticipants[_0x91d844(0x1f5)](_0x542e44=>!_0x542e44[_0x91d844(0x154)]),alreadyDrawn=currentParticipants[_0x91d844(0x1f5)](_0x552447=>_0x552447[_0x91d844(0x154)]),randomizeError[_0x91d844(0x180)]='';}function updateModalUI(){const _0x9b7323=_0x158961;modalParticipantsCount[_0x9b7323(0x180)]=availableToDraw['length'],modalDrawnCount[_0x9b7323(0x180)]=alreadyDrawn['length'],renderDrawnWinnersTable(),startRandomizeButton['disabled']=availableToDraw[_0x9b7323(0x142)]===0x0;}function _0x5162(_0x28da2e,_0x4c8ff6){const _0x13b5e6=_0x13b5();return _0x5162=function(_0x516244,_0x10dd0f){_0x516244=_0x516244-0x8c;let _0x11dbb9=_0x13b5e6[_0x516244];return _0x11dbb9;},_0x5162(_0x28da2e,_0x4c8ff6);}function renderDrawnWinnersTable(){const _0x108be5=_0x158961;drawnWinnersTableBody[_0x108be5(0x1d3)]='';if(alreadyDrawn[_0x108be5(0x142)]===0x0){drawnWinnersTableBody['innerHTML']=_0x108be5(0x1db);return;}alreadyDrawn[_0x108be5(0xef)]((_0x80de48,_0x3a02b5)=>(_0x3a02b5[_0x108be5(0x154)]?_0x3a02b5[_0x108be5(0x154)][_0x108be5(0x8d)]():0x0)-(_0x80de48[_0x108be5(0x154)]?_0x80de48[_0x108be5(0x154)][_0x108be5(0x8d)]():0x0)),alreadyDrawn[_0x108be5(0x1b9)](_0x582631=>{const _0x2d50e2=_0x108be5,_0x4c4d9f=document[_0x2d50e2(0x146)]('tr');_0x4c4d9f[_0x2d50e2(0x14c)]=_0x2d50e2(0x155);const _0x5916f5=document[_0x2d50e2(0x146)]('button');_0x5916f5[_0x2d50e2(0x180)]=_0x2d50e2(0x1b0),_0x5916f5[_0x2d50e2(0x14c)]='bg-red-600\x20text-white\x20hover:bg-red-700\x20text-xs\x20py-1\x20px-3\x20rounded\x20shadow\x20transition-colors',_0x5916f5[_0x2d50e2(0x126)]=()=>handleShowConfirmCancelRandom(_0x582631['id'],_0x582631[_0x2d50e2(0x1f7)]),_0x4c4d9f[_0x2d50e2(0x1d3)]=_0x2d50e2(0x196)+(_0x582631['employeeId']||'')+_0x2d50e2(0x1d5)+(_0x582631[_0x2d50e2(0x1f7)]||'')+_0x2d50e2(0x1d5)+(_0x582631[_0x2d50e2(0x124)]||'')+_0x2d50e2(0xa5),_0x4c4d9f[_0x2d50e2(0x1d0)][0x3][_0x2d50e2(0x96)](_0x5916f5),drawnWinnersTableBody[_0x2d50e2(0x96)](_0x4c4d9f);});}async function updateRandomTime(_0x21e293,_0x588737){const _0x593954=_0x158961;if(!_0x21e293)return;console[_0x593954(0x19f)](_0x593954(0x1a8)+_0x21e293+_0x593954(0x1b5),_0x588737);try{const _0x4b3283=doc(db,'crsg',_0x21e293);await updateDoc(_0x4b3283,{'RandomTime':_0x588737}),console['log'](_0x593954(0x147));}catch(_0x1b201d){console[_0x593954(0xa6)](_0x593954(0x174),_0x1b201d),randomizeError['textContent']=_0x593954(0x10b)+_0x1b201d['message'];}}function _0x13b5(){const _0x3a43b0=['24zbGYKp','ttb-register','randomizeModal','toLocaleTimeString','toLocaleString','removeChild','groupViewStatsContainer','Position_th','\x20to\x20normal\x20group.','2857455XSIKqd',']\x20หรือไม่?\x20(ข้อมูล\x20ทีม\x20จะถูกล้างค่า)','bg-green-200','NickName','groupViewStatsPercent','\x20<!--\x20(แก้ไข)\x20ใช้ตัวแปร\x20countText\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20text-center\x20mt-1\x22>สมาชิก</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20teams:\x20','indexOf','createObjectURL','bg-white','long','dashboard-content','th-TH','closeEditMemberModalButton','เกิดข้อผิดพลาดในการบันทึก:\x20','รหัส:\x20','random','วันที่\x20','ttb-register.firebaseapp.com','register-content','parsed','Finished\x20Rule\x203\x20&\x204.\x20Final\x20team\x20assignments:','toLocaleDateString','editMemberTeamSelect','</td>\x20<!--\x20(แก้ไข)\x20ใช้\x20FullName_th\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','Normal\x20group\x20employees\x20(final):\x20','สำเร็จ','confirmModal','</p>','Debug','สมาชิกในทีม\x20','sort','confirmActionButton','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','#2563EB','จำนวนผู้เข้าร่วม','groupViewModal','Could\x20not\x20assign\x20employee\x20(all\x20teams\x20full?):','padStart','</td></tr>','</span><span\x20class=\x22text-xl\x20font-bold\x20text-gray-400\x22>\x20/\x20','label','DateLogin','closeGroupViewModalButton','slice','กำลังรีเซ็ตข้อมูลทีมและสถานะลงทะเบียน...','--\x20ไม่ระบุสังกัด\x20--','participantsCountBox','push','Processing\x20Large\x20Group:\x20','Employee\x20data\x20updated\x20successfully.','addMemberTeamSelect','</td>\x20<!--\x20(เพิ่ม)\x20นี่คือ\x20\x22ทีม\x22\x20(Check_Place)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20(ลบ)\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','tab-dashboard','teamSelect','addMemberManagerSelect','</p>\x20<!--\x20(แก้ไข)\x20เพิ่ม\x20\x22ทีม\x22,\x20\x22text-xl\x22\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22p-4\x20text-center\x20','--\x20ไม่ระบุทีม\x20--','closeAddMemberModalButton','เกิดข้อผิดพลาดในการอัปเดต:\x20','members','Creating\x20teams\x20based\x20on\x20new\x20rules...',']\x20หรือไม่?\x20(สถานะจะเปลี่ยนเป็น\x20\x27ยังไม่ลงทะเบียน\x27)','Invalid\x20employee\x20data\x20for\x20cancel\x20registration.','addMemberEmpId','localeCompare','message','querySelectorAll','<p\x20class=\x22text-xl\x20font-bold\x20text-gray-900\x20text-center\x22>','#10B981','contains','drawnWinnersTableBody','text-white\x20bg-red-500\x20hover:bg-red-600\x20text-xs\x20py-1\x20px-3\x20rounded\x20shadow','includes','teamStatsTotal','closeWinnerModalButton','parse','text-gray-700\x20bg-white','bar','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ไม่พบสมาชิกในทีม\x20','join','width','toFixed','ดำเนินการเสร็จแล้ว','BU_th','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','onclick','searchEmployeeButton','set',']\x20ใช่หรือไม่?\x20(พนักงานจะกลับเข้าไปอยู่ในกลุ่มที่สุ่มได้อีกครั้ง)','รหัสพนักงาน','replace','ลงทะเบียนแล้ว','Department_th','text-white\x20bg-orange-500\x20hover:bg-orange-600\x20text-xs\x20py-1\x20px-3\x20rounded\x20shadow','rounded-lg\x20shadow-sm\x20border\x20border-gray-200\x20cursor-pointer\x20hover:shadow-md\x20transition-shadow\x20overflow-hidden','doughnut','teamStatsUnregistered','ยืนยันการ\x20Reset\x20Team','randomizeButton','N/A','addEventListener','bg-red-200','ทีม:\x20','</span>','teamCreationProgressContainer','remainingCount','setAttribute','editEmpManager','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20font-medium\x22>','\x20คน','href','Finished\x20Rule\x202.\x20Teams\x20status:','</td>\x20<!--\x20(แก้ไข)\x20นี่คือ\x20\x22กลุ่ม\x22\x20(BU_th)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','length','border-transparent','update','Team\x20member\x20team\x20updated\x20successfully.','createElement','Update\x20successful','</td>\x20<!--\x20(แก้ไข)\x20นี่คือ\x20\x22สังกัด\x22\x20(Check_Manager)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','editError','tab-team-list','Employee\x20data\x20updated\x20via\x20Add\x20Member\x20modal.','className','Check_Manager','76928xXKgUy','teamStatsContainer','toMillis','div','editMemberEmpId','managerEmployeeCount','RandomTime','hover:bg-gray-50','body','Manager\x20counts:','breakdownCenterTotal','#93C5FD','ปิดหน้าต่าง','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','กรุณาใส่รหัสพนักงาน','Final\x20teams\x20status:','numeric','teamBoxesContainer','registrationDonutChart','gvOverallStatsContainer','data','สร้างทีมสำเร็จ!','digit5','end','</td>\x20-->\x20<!--\x20(ลบ)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','toISOString','registered','กำลังดำเนินการ...','value','find','bg-gray-300','</td>\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20(เพิ่ม)\x20สถานะ\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','getContext','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียนแล้ว</span>','selectedTeamTableBody','tab-register','option','groupViewTableBody','Error\x20updating\x20RandomTime:\x20','ยืนยันการยกเลิกการสุ่ม','ยกเลิกการลงทะเบียน','Error\x20updating\x20team\x20assignments:\x20','dataset','NO_MANAGER','teamMemberCountElem','80%','Adding\x20remaining\x20','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>','map','definedTeamNames','textContent','ยืนยัน','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>','addMemberEmpName','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','groupViewModalTitle','employeeListTableBody','รีเซ็ตข้อมูลทีมและสถานะลงทะเบียนสำเร็จ!','resetTeamButton','addMemberError','เกิดข้อผิดพลาด:\x20','escape','.csv','empStatsRegistered','\x20from\x20','employeeId','1070273157855','saveEditMemberModalButton','gvOverallStatsTotal','#6b7280','Editing:','docId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x22>','option[value=\x22NO_MANAGER\x22]','Error\x20saving\x20employee\x20changes:','warn','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','Error\x20canceling\x20registration:','ทีม\x20(Check_Place)','commit','function','log','<p\x20class=\x22text-red-600\x20text-center\x20text-lg\x20mt-10\x22>เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','empStatsTotal','คุณต้องการยกเลิกการเป็นสมาชิกทีมของ\x20[','00000','size','groupViewManagerFilter','Error\x20listening\x20to\x20snapshot:\x20','28710220QZumKz','Updating\x20doc\x20','confirmTitle','style','hover:border-gray-300','crsg','dataIndex','saveAddMemberModalButton','Admin\x20Signed\x20in\x20anonymously','ยกเลิก','ยังไม่ลงทะเบียน','empStatsContainer','#F59E0B','Check_Place','\x20with\x20RandomTime:','targetCount','สร้างทีมสำเร็จบางส่วน\x20(','teamBarChart1','forEach','donutPercentage','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22>','#9CA3AF','\x20rounded-b-lg\x22>\x20<!--\x20(แก้ไข)\x20พื้นหลังขาว\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','latestRegistrationsTableBody','3fYaIur','download','คุณต้องการยกเลิกการสุ่มของ\x20[','ผู้เข้าร่วมกิจกรรม','กำลังจัดสรรกลุ่มใหญ่\x20(Rule\x202)...','Teams\x20and\x20login\x20status\x20reset\x20successfully.','getElementById','\x20rounded-t-lg\x22>\x20<!--\x20(แก้ไข)\x20พื้นหลังเทา\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xl\x20font-bold\x20text-blue-700\x20text-center\x22>ทีม\x20','Error\x20deleting\x20(blanking)\x20team\x20member:','ยืนยัน\x20Reset\x20Team','Total\x20to\x20assign:\x20','#BFDBFE','Deleting\x20(blanking)\x20member:','bg-orange-100','has','winnerTeam','option[value=\x22','cells','.\x20Remaining:\x20','digit4','innerHTML','confirmText','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x22>','searchEmployeeIdInput','126348QQWKgd','querySelector','center','เกิดข้อผิดพลาดในการรีเซ็ต:\x20','<tr><td\x20colspan=\x224\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>ยังไม่มีผู้ได้รับการสุ่ม</td></tr>','keys','ไม่พบรหัสพนักงานนี้ในระบบ','backgroundColor','ชื่อ-นามสกุล','addMemberEmpBU','ใช่,\x20ยืนยันยกเลิก','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','2412468PzIbKP','max','กำลังจัดสรรกลุ่มปกติ\x20(Rule\x203)...','floor','กลุ่ม\x20(BU)','เวลาที่ลงทะเบียน','ceil','Registration\x20canceled\x20successfully.','visibility','labels','teamBarChart2','teamStatsRegistered','pop','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20(เพิ่ม)\x20Cell\x20สำหรับปุ่มลบ\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ไม่พบข้อมูลพนักงานที่มีสังกัด</td></tr>','closeConfirmButton','total','Generating\x20CSV...','filter','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ยังไม่มีผู้ลงทะเบียน</td></tr>','FullName_th','CSV\x20Download\x20triggered.','9409820tRbRrg','trim','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>กรุณาเลือกทีม</td></tr>','เกิดข้อผิดพลาด','ไม่','disabled','UNKNOWN','digit2','winnerBU','Showing\x20Reset\x20Team\x20confirmation...','bottom','cancelWinnerButton','#ffffff','createTeamButton','\x20เวลา\x20','#3B82F6','add','toDate','G-9DJLWJ5LQ1','Canceling\x20registration\x20for:','editMemberEmpName','addMemberModal','แก้ไข','.\x20Need\x20','from','hidden','appendChild','round','tab-employee-list','then','teamCreationProgressBar','คุณต้องการลบข้อมูลทีม\x20(Check_Place),\x20สถานะลงทะเบียน\x20(DateLogin),\x20ชื่อเล่น\x20(NickName),\x20และเวลาที่สุ่ม\x20(RandomTime)\x20ของพนักงานทั้งหมดหรือไม่?\x20(ข้อมูลพนักงานจะไม่ถูกลบ)','Error\x20setting\x20up\x20listener:\x20','entries','managers','Team\x20member\x20fields\x20blanked\x20successfully.','empStatsPercent','winnerEmployeeId','button','text-gray-500','Teams\x20assignment\x20updated\x20successfully.','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','error','managerFilterSelect','classList','125NvDduJ','ยืนยันการยกเลิกการลงทะเบียน','datasets','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','click','bg-gray-100','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22p-3\x20text-center\x20','reduce','bg-green-100','เวลาที่สุ่ม\x20(RandomTime)','editEmpName','Distributing\x20N=','สังกัด\x20(Check_Manager)','chart','border-blue-600','321017ErdTGQ','remove','winnerName','bold','px-3\x20py-1.5\x20text-xs\x20bg-red-600\x20text-white\x20rounded-md\x20hover:bg-red-700','bg-yellow-100\x20hover:bg-yellow-200\x20transition-colors','downloadCsvButton','<span\x20class=\x22text-xl\x20font-bold\x20text-gray-900\x22>','hover:text-gray-700','<p\x20class=\x22text-gray-500\x22>ไม่พบข้อมูลทีม</p>','ตำแหน่ง\x20(Position_th)','ยืนยันการยกเลิกการเป็นสมาชิกทีม','text-gray-700','2-digit','\x20members)'];_0x13b5=function(){return _0x3a43b0;};return _0x13b5();}function handleShowConfirmCancelRandom(_0x50c5b2,_0x2f567b){const _0x36825a=_0x158961;docIdToCancel=_0x50c5b2,currentConfirmAction=async()=>{const _0x5d68c4=_0x5162;await updateRandomTime(docIdToCancel,null),docIdToCancel=null,confirmModal[_0x5d68c4(0xa8)][_0x5d68c4(0x8c)]('hidden'),!winnerDetailModal['classList'][_0x5d68c4(0x116)](_0x5d68c4(0x95))&&winnerDetailModal[_0x5d68c4(0xa8)]['add']('hidden');},confirmTitle[_0x36825a(0x180)]=_0x36825a(0x175),confirmText[_0x36825a(0x180)]=_0x36825a(0x1c1)+_0x2f567b+_0x36825a(0x129),confirmActionButton[_0x36825a(0x180)]=_0x36825a(0x1e1),confirmActionButton['className']=_0x36825a(0xbc),confirmActionButton[_0x36825a(0x1fe)]=![],confirmActionButton[_0x36825a(0xa8)]['remove'](_0x36825a(0x95)),confirmActionButton['onclick']=()=>{typeof currentConfirmAction==='function'&&currentConfirmAction();},closeConfirmButton[_0x36825a(0x180)]=_0x36825a(0x1fd),closeConfirmButton[_0x36825a(0x1fe)]=![],closeConfirmButton[_0x36825a(0xa8)][_0x36825a(0xb9)](_0x36825a(0x95)),confirmModal[_0x36825a(0xa8)][_0x36825a(0xb9)]('hidden');}async function handleRandomization(){const _0x5b2e0d=_0x158961;if(availableToDraw[_0x5b2e0d(0x142)]===0x0){randomizeError[_0x5b2e0d(0x180)]='ไม่เหลือผู้เข้าร่วมกิจกรรมให้สุ่มแล้ว';return;}startRandomizeButton['disabled']=!![],randomizeError[_0x5b2e0d(0x180)]='';let _0x3273a7=0x0;randomizationInterval=setInterval(()=>{const _0x211805=_0x5b2e0d;digits[_0x211805(0x1b9)](_0x2a1899=>{const _0xeff94e=_0x211805;_0x2a1899[_0xeff94e(0x180)]=Math['floor'](Math['random']()*0xa);}),_0x3273a7++;if(_0x3273a7>0x14){clearInterval(randomizationInterval);const _0x29478a=availableToDraw[Math[_0x211805(0x1e6)](Math[_0x211805(0xe0)]()*availableToDraw[_0x211805(0x142)])],_0x2fb6db=(_0x29478a[_0x211805(0x18f)]||_0x211805(0x1a3))[_0x211805(0xfc)](-0x5)[_0x211805(0xf6)](0x5,'0');digits[_0x211805(0x1b9)]((_0xad187,_0x3ff9d0)=>_0xad187[_0x211805(0x180)]=_0x2fb6db[_0x3ff9d0]),updateRandomTime(_0x29478a['id'],serverTimestamp())[_0x211805(0x99)](()=>{const _0x50295e=_0x211805;winnerName[_0x50295e(0x180)]=_0x29478a[_0x50295e(0x1f7)]||'N/A',winnerEmployeeId[_0x50295e(0x180)]=_0x50295e(0xdf)+(_0x29478a[_0x50295e(0x18f)]||_0x50295e(0x134)),winnerTeam[_0x50295e(0x180)]=_0x50295e(0x137)+(_0x29478a['Check_Place']||_0x50295e(0x134)),winnerBU['textContent']='สายงาน:\x20'+(_0x29478a['BU_th']||_0x50295e(0x134)),cancelWinnerButton['dataset'][_0x50295e(0x195)]=_0x29478a['id'],winnerDetailModal[_0x50295e(0xa8)][_0x50295e(0xb9)](_0x50295e(0x95)),startRandomizeButton[_0x50295e(0x1fe)]=![];});}},0x64);}async function handleCancelWinner(){const _0x59220c=_0x158961,_0x9d0ab1=cancelWinnerButton['dataset'][_0x59220c(0x195)],_0x97e9ae=alreadyDrawn[_0x59220c(0x16b)](_0xf7363e=>_0xf7363e['id']===_0x9d0ab1);handleShowConfirmCancelRandom(_0x9d0ab1,_0x97e9ae?.[_0x59220c(0x1f7)]||'N/A');}function setupModalListeners(){const _0x5a63bc=_0x158961;randomizeButton[_0x5a63bc(0x135)](_0x5a63bc(0xad),()=>{const _0x37f5fb=_0x5a63bc;updateRandomizerDataBasedOnAllEmployees(),updateModalUI(),randomizeModal['classList']['remove'](_0x37f5fb(0x95));}),closeRandomizeModalButton[_0x5a63bc(0x135)](_0x5a63bc(0xad),()=>{const _0x5c2e7d=_0x5a63bc;randomizeModal[_0x5c2e7d(0xa8)]['add']('hidden');}),startRandomizeButton[_0x5a63bc(0x135)]('click',handleRandomization),closeWinnerModalButton[_0x5a63bc(0x135)](_0x5a63bc(0xad),()=>{const _0x14998a=_0x5a63bc;winnerDetailModal[_0x14998a(0xa8)][_0x14998a(0x8c)](_0x14998a(0x95));}),cancelWinnerButton['addEventListener'](_0x5a63bc(0xad),handleCancelWinner),closeConfirmButton['addEventListener']('click',()=>{const _0x2f8f43=_0x5a63bc;confirmModal[_0x2f8f43(0xa8)][_0x2f8f43(0x8c)]('hidden'),confirmTitle[_0x2f8f43(0x180)]=_0x2f8f43(0x181),confirmText[_0x2f8f43(0x180)]='',confirmActionButton[_0x2f8f43(0x1fe)]=![],confirmActionButton['classList']['remove']('hidden'),closeConfirmButton[_0x2f8f43(0x180)]=_0x2f8f43(0x1fd),closeConfirmButton[_0x2f8f43(0x1fe)]=![],currentConfirmAction=null,docIdToCancel=null;}),downloadCsvButton[_0x5a63bc(0x135)]('click',handleDownloadCSV);}function setupTeamTabListeners(){const _0x327eb4=_0x158961;resetTeamButton[_0x327eb4(0x135)](_0x327eb4(0xad),handleResetTeam),createTeamButton[_0x327eb4(0x135)](_0x327eb4(0xad),handleCreateTeam),teamSelect[_0x327eb4(0x135)]('change',displaySelectedTeamMembers);}function setupEmployeeListListeners(){const _0x16041e=_0x158961;managerFilterSelect['addEventListener']('change',()=>{updateEmployeeListTable(allEmployeesData);}),closeEditModalButton[_0x16041e(0x135)]('click',closeEditModal),saveEditModalButton[_0x16041e(0x135)]('click',saveEmployeeChanges);}function populateManagerFilter(_0x5d4955){const _0x52bae9=_0x158961,_0x2efbd6=managerFilterSelect[_0x52bae9(0x16a)],_0x207a8b=managerFilterSelect['querySelectorAll'](_0x52bae9(0x172));_0x207a8b[_0x52bae9(0x1b9)](_0x2fc5a7=>{const _0x1e538f=_0x52bae9;_0x2fc5a7[_0x1e538f(0x16a)]!==''&&_0x2fc5a7[_0x1e538f(0xb9)]();});const _0x41fb93=Array[_0x52bae9(0x94)](_0x5d4955)['sort']();_0x41fb93[_0x52bae9(0x1b9)](_0x345572=>{const _0x2d1d4e=_0x52bae9;if(_0x345572&&_0x345572[_0x2d1d4e(0x1fa)]()!==''){const _0x252e73=document[_0x2d1d4e(0x146)](_0x2d1d4e(0x172));_0x252e73[_0x2d1d4e(0x16a)]=_0x345572,_0x252e73[_0x2d1d4e(0x180)]=_0x345572,_0x252e73[_0x2d1d4e(0x14c)]=_0x2d1d4e(0x11d),managerFilterSelect['appendChild'](_0x252e73);}});if(_0x2efbd6&&managerFilterSelect[_0x52bae9(0x1d8)](_0x52bae9(0x1cf)+CSS[_0x52bae9(0x18b)](_0x2efbd6)+'\x22]'))managerFilterSelect['value']=_0x2efbd6;else _0x2efbd6===''&&(managerFilterSelect[_0x52bae9(0x16a)]='');const _0x2c5bb6=groupViewManagerFilter[_0x52bae9(0x16a)],_0x204c2a=groupViewManagerFilter[_0x52bae9(0x113)](_0x52bae9(0x172));_0x204c2a[_0x52bae9(0x1b9)](_0x4af0fb=>{const _0x5c20cb=_0x52bae9;_0x4af0fb[_0x5c20cb(0x16a)]!==''&&_0x4af0fb[_0x5c20cb(0xb9)]();});if(!groupViewManagerFilter['querySelector'](_0x52bae9(0x197))){const _0x264062=document[_0x52bae9(0x146)](_0x52bae9(0x172));_0x264062['value']=_0x52bae9(0x179),_0x264062['textContent']=_0x52bae9(0xfe),_0x264062[_0x52bae9(0x14c)]=_0x52bae9(0x11d),groupViewManagerFilter[_0x52bae9(0x96)](_0x264062);}_0x41fb93[_0x52bae9(0x1b9)](_0x343b8d=>{const _0x55b913=_0x52bae9;if(_0x343b8d&&_0x343b8d[_0x55b913(0x1fa)]()!==''){const _0x33b96e=document[_0x55b913(0x146)]('option');_0x33b96e[_0x55b913(0x16a)]=_0x343b8d,_0x33b96e[_0x55b913(0x180)]=_0x343b8d,_0x33b96e[_0x55b913(0x14c)]=_0x55b913(0x11d),groupViewManagerFilter[_0x55b913(0x96)](_0x33b96e);}});if(_0x2c5bb6&&groupViewManagerFilter[_0x52bae9(0x1d8)](_0x52bae9(0x1cf)+CSS[_0x52bae9(0x18b)](_0x2c5bb6)+'\x22]'))groupViewManagerFilter['value']=_0x2c5bb6;else _0x2c5bb6===''&&(groupViewManagerFilter[_0x52bae9(0x16a)]='');}function showEditModal(_0x3aa6fa){const _0x4769b6=_0x158961;console['log'](_0x4769b6(0x194),_0x3aa6fa),currentEditingDocId=_0x3aa6fa['id'],editEmpId['textContent']=_0x3aa6fa['employeeId']||_0x4769b6(0x134),editEmpName[_0x4769b6(0x180)]=_0x3aa6fa[_0x4769b6(0x1f7)]||_0x4769b6(0x134),editEmpManager['value']=_0x3aa6fa[_0x4769b6(0x14d)]||'',editEmpTeam['value']=_0x3aa6fa['Check_Place']||'',editError[_0x4769b6(0x180)]='',editEmployeeModal[_0x4769b6(0xa8)][_0x4769b6(0xb9)](_0x4769b6(0x95));}function closeEditModal(){const _0x31b099=_0x158961;editEmployeeModal['classList'][_0x31b099(0x8c)](_0x31b099(0x95)),currentEditingDocId=null;}async function saveEmployeeChanges(){const _0x177a54=_0x158961;if(!currentEditingDocId)return;const _0x440010=editEmpManager['value'],_0x19c33d=editEmpTeam[_0x177a54(0x16a)];editError['textContent']='',saveEditModalButton[_0x177a54(0x1fe)]=!![];try{const _0x1e2aee=doc(db,_0x177a54(0x1ac),currentEditingDocId);await updateDoc(_0x1e2aee,{'Check_Manager':_0x440010,'Check_Place':_0x19c33d}),console[_0x177a54(0x19f)](_0x177a54(0x102)),closeEditModal();}catch(_0x374512){console[_0x177a54(0xa6)](_0x177a54(0x198),_0x374512),editError[_0x177a54(0x180)]=_0x177a54(0x18a)+_0x374512['message'];}finally{saveEditModalButton[_0x177a54(0x1fe)]=![];}}function handleSearchEmployee(){const _0x225539=_0x158961,_0x5e5bd9=searchEmployeeIdInput[_0x225539(0x16a)][_0x225539(0x1fa)]();searchEmployeeError[_0x225539(0x180)]='';if(!_0x5e5bd9){searchEmployeeError[_0x225539(0x180)]=_0x225539(0x15c);return;}const _0x44775c=allEmployeesData[_0x225539(0x16b)](_0x1d6c3d=>_0x1d6c3d[_0x225539(0x18f)]===_0x5e5bd9);_0x44775c?showAddMemberModal(_0x44775c):searchEmployeeError[_0x225539(0x180)]=_0x225539(0x1dd);}function showAddMemberModal(_0x25c099){const _0x3e8f72=_0x158961;currentAddingDocId=_0x25c099['id'],addMemberError[_0x3e8f72(0x180)]='',addMemberEmpId[_0x3e8f72(0x180)]=_0x25c099[_0x3e8f72(0x18f)]||_0x3e8f72(0x134),addMemberEmpName[_0x3e8f72(0x180)]=_0x25c099[_0x3e8f72(0x1f7)]||_0x3e8f72(0x134),addMemberEmpBU['textContent']=_0x25c099[_0x3e8f72(0x124)]||_0x3e8f72(0x134),addMemberManagerSelect[_0x3e8f72(0x1d3)]='';const _0x40824e=document[_0x3e8f72(0x146)]('option');_0x40824e['value']='',_0x40824e[_0x3e8f72(0x180)]=_0x3e8f72(0xfe),addMemberManagerSelect['appendChild'](_0x40824e);const _0x4083e2=new Set(allEmployeesData['map'](_0x52c1b8=>_0x52c1b8[_0x3e8f72(0x14d)])[_0x3e8f72(0x1f5)](Boolean)),_0x1bf07c=Array[_0x3e8f72(0x94)](_0x4083e2)[_0x3e8f72(0xef)]();_0x1bf07c[_0x3e8f72(0x1b9)](_0x5b8252=>{const _0x36d72f=_0x3e8f72,_0x379a9d=document[_0x36d72f(0x146)]('option');_0x379a9d[_0x36d72f(0x16a)]=_0x5b8252,_0x379a9d[_0x36d72f(0x180)]=_0x5b8252,addMemberManagerSelect['appendChild'](_0x379a9d);}),addMemberManagerSelect[_0x3e8f72(0x16a)]=_0x25c099[_0x3e8f72(0x14d)]||'',addMemberTeamSelect[_0x3e8f72(0x1d3)]='';const _0x55461e=document[_0x3e8f72(0x146)](_0x3e8f72(0x172));_0x55461e[_0x3e8f72(0x16a)]='',_0x55461e[_0x3e8f72(0x180)]='--\x20ไม่ระบุทีม\x20--',addMemberTeamSelect[_0x3e8f72(0x96)](_0x55461e),teamNames[_0x3e8f72(0x1b9)](_0x5cc372=>{const _0x5e7a49=_0x3e8f72,_0x3bf911=document['createElement'](_0x5e7a49(0x172));_0x3bf911[_0x5e7a49(0x16a)]=_0x5cc372,_0x3bf911[_0x5e7a49(0x180)]=_0x5cc372,addMemberTeamSelect[_0x5e7a49(0x96)](_0x3bf911);}),addMemberTeamSelect[_0x3e8f72(0x16a)]=_0x25c099[_0x3e8f72(0x1b4)]||'',addMemberModal[_0x3e8f72(0xa8)][_0x3e8f72(0xb9)](_0x3e8f72(0x95));}function closeAddMemberModal(){const _0x164c43=_0x158961;addMemberModal['classList'][_0x164c43(0x8c)](_0x164c43(0x95)),currentAddingDocId=null,searchEmployeeIdInput[_0x164c43(0x16a)]='',searchEmployeeError[_0x164c43(0x180)]='';}async function saveAddMemberChanges(){const _0x571be9=_0x158961;if(!currentAddingDocId)return;const _0x42a8b8=addMemberManagerSelect[_0x571be9(0x16a)],_0x3d78f1=addMemberTeamSelect['value'];addMemberError['textContent']='',saveAddMemberModalButton[_0x571be9(0x1fe)]=!![],closeAddMemberModalButton[_0x571be9(0x1fe)]=!![];try{const _0x43d681=doc(db,_0x571be9(0x1ac),currentAddingDocId);await updateDoc(_0x43d681,{'Check_Manager':_0x42a8b8,'Check_Place':_0x3d78f1}),console['log'](_0x571be9(0x14b)),closeAddMemberModal();}catch(_0x1b6e2a){console[_0x571be9(0xa6)](_0x571be9(0x198),_0x1b6e2a),addMemberError[_0x571be9(0x180)]=_0x571be9(0x18a)+_0x1b6e2a[_0x571be9(0x112)];}finally{saveAddMemberModalButton['disabled']=![],closeAddMemberModalButton[_0x571be9(0x1fe)]=![];}}function setupAddMemberModalListeners(){const _0x34a632=_0x158961;searchEmployeeButton['addEventListener']('click',handleSearchEmployee),closeAddMemberModalButton[_0x34a632(0x135)](_0x34a632(0xad),closeAddMemberModal),saveAddMemberModalButton[_0x34a632(0x135)](_0x34a632(0xad),saveAddMemberChanges);}function handleDownloadCSV(){const _0x1afed2=_0x158961;console[_0x1afed2(0x19f)](_0x1afed2(0x1f4));const _0x3cc473=allEmployeesData['filter'](_0x200e1d=>{const _0x404e3d=_0x1afed2,_0x4cc24f=_0x200e1d[_0x404e3d(0x14d)]&&_0x200e1d[_0x404e3d(0x14d)][_0x404e3d(0x1fa)]()!=='',_0x59d209=_0x200e1d[_0x404e3d(0x1b4)]&&_0x200e1d['Check_Place'][_0x404e3d(0x1fa)]()!=='',_0x540dac=!!_0x200e1d[_0x404e3d(0xfa)],_0x501806=_0x4cc24f&&_0x59d209,_0x5e294b=_0x540dac&&!_0x59d209;return _0x501806||_0x5e294b;});if(_0x3cc473['length']===0x0){console[_0x1afed2(0x199)]('No\x20data\x20to\x20download\x20based\x20on\x20criteria.');return;}const _0x2f118a=[_0x1afed2(0x12a),_0x1afed2(0x1df),'ชื่อเล่น',_0x1afed2(0xc2),'สายงาน\x20(Department_th)',_0x1afed2(0x1e7),_0x1afed2(0xb5),_0x1afed2(0x19c),_0x1afed2(0x1e8),_0x1afed2(0xb2)],_0x368695=_0x5c3cbc=>{const _0x57038e=_0x1afed2;if(_0x5c3cbc===null||_0x5c3cbc===undefined)return'\x22\x22';let _0x4b2597=String(_0x5c3cbc);return(_0x4b2597[_0x57038e(0x119)]('\x22')||_0x4b2597[_0x57038e(0x119)](',')||_0x4b2597['includes']('\x0a'))&&(_0x4b2597='\x22'+_0x4b2597[_0x57038e(0x12b)](/"/g,'\x22\x22')+'\x22'),_0x4b2597;};let _0x2ae66a=_0x2f118a[_0x1afed2(0x120)](',')+'\x0a';_0x3cc473['forEach'](_0xdce604=>{const _0x5131dd=_0x1afed2,_0x432a04=_0xdce604[_0x5131dd(0xfa)]&&_0xdce604[_0x5131dd(0xfa)][_0x5131dd(0x8d)]?formatThaiTimestamp(_0xdce604[_0x5131dd(0xfa)][_0x5131dd(0x8d)]()):'',_0x29cb6a=_0xdce604[_0x5131dd(0x154)]&&_0xdce604[_0x5131dd(0x154)][_0x5131dd(0x8d)]?formatThaiTimestamp(_0xdce604['RandomTime'][_0x5131dd(0x8d)]()):'',_0x373973=[_0xdce604[_0x5131dd(0x18f)]||'',_0xdce604['FullName_th']||'',_0xdce604[_0x5131dd(0xd3)]||'',_0xdce604[_0x5131dd(0xce)]||'',_0xdce604[_0x5131dd(0x12d)]||'',_0xdce604[_0x5131dd(0x124)]||'',_0xdce604[_0x5131dd(0x14d)]||'',_0xdce604[_0x5131dd(0x1b4)]||'',_0x432a04,_0x29cb6a];_0x2ae66a+=_0x373973[_0x5131dd(0x17e)](_0x368695)[_0x5131dd(0x120)](',')+'\x0a';});const _0x4880fd=new Uint8Array([0xef,0xbb,0xbf]),_0x15ea31=new Blob([_0x4880fd,_0x2ae66a],{'type':'text/csv;charset=utf-8;'}),_0x3ef4dc=document['createElement']('a'),_0x744bce=URL[_0x1afed2(0xd8)](_0x15ea31);_0x3ef4dc[_0x1afed2(0x13b)](_0x1afed2(0x13f),_0x744bce);const _0x466d88=new Date()[_0x1afed2(0x167)]()[_0x1afed2(0xfc)](0x0,0xa);_0x3ef4dc[_0x1afed2(0x13b)](_0x1afed2(0x1c0),'CRSG_Registered_Users_'+_0x466d88+_0x1afed2(0x18c)),_0x3ef4dc['style'][_0x1afed2(0x1eb)]=_0x1afed2(0x95),document[_0x1afed2(0x156)]['appendChild'](_0x3ef4dc),_0x3ef4dc[_0x1afed2(0xad)](),document[_0x1afed2(0x156)][_0x1afed2(0xcc)](_0x3ef4dc),console['log'](_0x1afed2(0x1f8));}
        
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRSG Summit 2025 Dashboard</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: #ffffff; /* (แก้ไข) เปลี่ยนเป็นสีขาว */
        }
        /* เพิ่ม: Style สำหรับ Progress Bar */
        .progress-bar-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            height: 1.5rem; /* เพิ่มความสูง */
        }
        .progress-bar {
            height: 100%;
            background-color: #3b82f6;
            width: 0%;
            transition: width 0.3s ease-in-out;
            text-align: center;
            color: white;
            line-height: 1.5rem; /* จัดกลางข้อความแนวตั้ง */
            font-size: 0.875rem; /* ขนาดตัวอักษร */
        }
         /* (เพิ่ม) Style สำหรับ Edit Modal Inputs */
        #editEmployeeModal input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            margin-top: 0.25rem;
        }
         /* (เพิ่ม) Style สำหรับ Dropdown ฟ้าอ่อน */
        select.light-blue-bg {
             background-color: #ffffff; /* (แก้ไข) เปลี่ยนเป็นสีขาว */
             padding-left: 0.75rem; /* px-3 */
             padding-right: 0.75rem; /* px-3 */
             padding-top: 0.5rem; /* py-2 */
             padding-bottom: 0.5rem; /* py-2 */
        }
         /* (เพิ่ม) Style หัวตารางสีเทา */
        thead.table-header-gray {
             background-color: #e5e7eb; /* gray-200 */
        }
    </style>
    <!-- Chart.js CDN --><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<body class="flex flex-col items-center min-h-screen py-10 bg-white">

    <div class="w-[90%] max-w-6xl p-0 bg-white rounded-lg"> <!-- (แก้ไข) w-[90%], p-0 -->
        <!-- Header (แก้ไข: จัดกลาง, ปรับ pt) --><div class="flex flex-col items-center mb-6 pt-6 px-8"> <!-- (แก้ไข) pt-6 (1.5rem) -->
            <div class="text-center">
                <!-- (แก้ไข) text-2xl และ style color -->
                <h1 class="text-2xl font-bold" style="color: #0056ff;">CRSG Summit 2025</h1>
               <!-- ลบ Subtitle ออกแล้ว --></div>
            <div class="text-center mt-2">
                <p id="currentDateTime" class="text-sm text-gray-600 font-medium"></p>
            </div>
        </div>
        
        <!-- Tab Navigation (แก้ไข: ปรับ space, เปลี่ยนชื่อ, เพิ่มแท็บ) --><div class="mb-6 border-b border-gray-200 px-8"> <!-- (แก้ไข) เพิ่ม px-8 -->
            <nav class="-mb-px flex space-x-1" aria-label="Tabs"> <!-- แก้ไข: space-x-1 --><button id="tab-dashboard" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-700 bg-gray-300 border-blue-600">
                    ข้อมูล Dashboard
                </button>
                <button id="tab-team-list" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลสมาชิกทีม <!-- (แก้ไข) เปลี่ยนชื่อ --></button>
                <!-- (เพิ่ม) แท็บใหม่ -->
                <button id="tab-group-view" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลจัดกลุ่ม
                </button>
                <button id="tab-employee-list" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ข้อมูลพนักงาน CRSG <!-- เพิ่ม: แท็บใหม่ -->
                </button>
                <!-- (เพิ่ม) แท็บใหม่สำหรับลงทะเบียน -->
                <button id="tab-register" class="whitespace-nowrap py-3 px-3 border-b-2 font-medium text-sm text-gray-500 bg-gray-100 border-transparent hover:text-gray-700 hover:border-gray-300">
                    ลงทะเบียนเข้าร่วมงาน
                </button>
            </nav>
        </div>

        <!-- Dashboard Content --><div id="dashboard-content" class="px-8 pb-8"> <!-- (แก้ไข) เพิ่ม px-8 pb-8 -->
            <!-- ภาพรวมผู้ลงทะเบียน (แก้ไข: โครงสร้างใหม่ 50/50, ปรับกล่องซ้าย) --><h2 class="text-lg font-semibold text-gray-800 mb-4">ภาพรวมผู้ลงทะเบียน</h2>
            <div class="flex flex-col lg:flex-row gap-6 mb-8">
                
                <!-- กล่องที่ 1 (40%) --><div class="lg:w-2/5"> <!-- (แก้ไข) lg:w-1/2 -> lg:w-2/5 -->
                     <!-- (แก้ไข) ปรับโครงสร้างกล่องซ้าย (เปลี่ยน 4 กล่องเป็น 1 กราฟ) -->
                     <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center h-full">
                         <p class="text-gray-600 text-sm mb-4">สัดส่วนผู้ลงทะเบียน</p>
                         <div class="relative w-64 h-64"> <!-- (แก้ไข) ทำให้ใหญ่ขึ้น -->
                             <canvas id="registrationBreakdownChart"></canvas>
                             <div class="absolute inset-0 flex flex-col items-center justify-center">
                                 <span id="breakdownCenterTotal" class="text-3xl font-bold text-gray-900">0</span>
                                 <span class="text-sm text-gray-500">ผู้ลงทะเบียน</span>
                             </div>
                         </div>
                     </div>
                </div>

                <!-- กล่องที่ 2 (60%) : กราฟวงกลมและสรุปยอด (แก้ไข: เพิ่มกล่อง Participants) --><div class="lg:w-3/5"> <!-- (แก้ไข) lg:w-1/2 -> lg:w-3/5 -->
                    <div class="flex gap-6 h-full">
                         <!-- กล่องซ้าย (w-2/3) : กราฟวงกลม -->
                         <div class="w-2/3 bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center justify-center"> <!-- (แก้ไข) w-[65%] -> w-2/3 -->
                            <p class="text-gray-600 text-sm mb-4">เป้าหมายผู้ลงทะเบียน</p>
                            <div class="relative w-64 h-64"> <!-- (แก้ไข) 48 -> 64 (ปรับขนาดให้เท่ากราฟแรก) -->
                                <canvas id="registrationDonutChart"></canvas>
                                <div class="absolute inset-0 flex flex-col items-center justify-center">
                                    <span id="donutPercentage" class="text-3xl font-bold text-gray-900">0%</span>
                                    <span class="text-sm text-gray-500">ผู้เข้าร่วมกิจกรรม</span>
                                </div>
                            </div>
                        </div>
                         <!-- กล่องขวา (w-1/3) : สรุปยอด (แก้ไข: ปรับ spacing) -->
                         <div class="w-1/3 flex flex-col justify-between space-y-2"> <!-- (แก้ไข) w-[35%] -> w-1/3 -->
                            <!-- จำนวนเป้าหมาย --><div class="h-1/4 bg-blue-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> <!-- แก้ไข h-1/4, p-3 -->
                                <p class="text-blue-700 text-xs">จำนวนเป้าหมาย</p> <!-- แก้ไข text-xs -->
                                <p id="targetCount" class="text-lg font-bold text-blue-800 mt-1">0</p> <!-- แก้ไข text-lg -->
                            </div>
                            <!-- (เพิ่ม) ผู้เข้าร่วมกิจกรรม --><div class="h-1/4 bg-green-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> <!-- แก้ไข h-1/4, p-3 -->
                                <p class="text-green-700 text-xs">ผู้เข้าร่วมกิจกรรม</p> <!-- แก้ไข text-xs -->
                                <p id="participantsCountBox" class="text-lg font-bold text-green-800 mt-1">0</p> <!-- (เพิ่ม) ID ใหม่, แก้ไข text-lg -->
                            </div>
                             <!-- ผู้ร่วมงาน (ย้ายมา) --><div class="h-1/4 bg-yellow-50 p-3 rounded-lg flex flex-col justify-center items-center text-center">
                                <p class="text-yellow-700 text-xs">ผู้ร่วมงาน</p>
                                <p id="attendeesCount" class="text-lg font-bold text-yellow-800 mt-1">0</p>
                            </div>
                            <!-- จำนวนคงเหลือ --><div class="h-1/4 bg-red-50 p-3 rounded-lg flex flex-col justify-center items-center text-center"> <!-- แก้ไข h-1/4, p-3 -->
                                <p class="text-red-700 text-xs">จำนวนคงเหลือ</p> <!-- แก้ไข text-xs -->
                                <p id="remainingCount" class="text-lg font-bold text-red-800 mt-1">0</p> <!-- แก้ไข text-lg -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- สรุปข้อมูลผู้ลงทะเบียน (แก้ไข: ย้ายปุ่ม, แบ่งกราฟเป็น ซ้าย/ขวา) --><div class="mb-8">
                <div class="flex justify-between items-center mb-4">
                     <h2 class="text-lg font-semibold text-gray-800">สรุปข้อมูลผู้ลงทะเบียน</h2>
                     <!-- (แก้ไข) ปรับสไตล์ปุ่ม -->
                     <button id="randomizeButton" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                         สุ่มเลือกผู้ร่วมงาน
                     </button>
                 </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> <!-- แบ่งเป็น 2 คอลัมน์ -->
                    <!-- กล่องซ้าย: กราฟแท่ง 1 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <p class="text-gray-600 text-sm mb-4">กราฟแสดงข้อมูลสถิติ (ส่วนที่ 1)</p>
                        <div class="h-[25rem]"> <!-- (แก้ไข) เพิ่มความสูง -->
                            <canvas id="teamBarChart1"></canvas> 
                        </div>
                    </div>
                    <!-- กล่องขวา: กราฟแท่ง 2 -->
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                         <p class="text-gray-600 text-sm mb-4">กราฟแสดงข้อมูลสถิติ (ส่วนที่ 2)</p>
                        <div class="h-[25rem]"> <!-- (แก้ไข) เพิ่มความสูง -->
                            <canvas id="teamBarChart2"></canvas> 
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- สรุปข้อมูลผู้ร่วมงานและรายชื่อล่าสุด (แก้ไข: เพิ่มคอลัมน์) --><h2 class="text-lg font-semibold text-gray-800 mb-4">สรุปข้อมูลผู้ร่วมงานและรายชื่อล่าสุด</h2>
            <div class="bg-white shadow-md rounded-lg overflow-hidden border border-gray-200">
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm">
                        <thead class="table-header-gray"> <!-- (แก้ไข) เปลี่ยนจาก bg-gray-50 -->
                            <tr>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">กลุ่ม</th> <!-- (BU_th) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th> <!-- (แก้ไข) Check_Manager -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ทีม</th> <!-- (เพิ่ม) Check_Place -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลบรายการ</th>
                            </tr>
                        </thead>
                        <tbody id="latestRegistrationsTableBody" class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td colspan="7" class="p-6 text-center text-gray-500">กำลังโหลดข้อมูล...</td> <!-- (แก้ไข) colspan="7" -->
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- (เพิ่ม) ปุ่ม Download CSV -->
            <div class="mt-6 text-center">
                <button id="downloadCsvButton" class="px-5 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out">
                    Download File CSV (ผู้ลงทะเบียน)
                </button>
            </div>
            
        </div>

        <!-- (เพิ่ม) Register Content -->
        <div id="register-content" class="hidden pb-8 px-6">
             <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 flex flex-col items-center">
                <h2 class="text-xl font-semibold text-gray-800 text-center mb-6">สแกน QR Code เพื่อลงทะเบียนเข้าร่วมงาน</h2>
                <img 
                    src="./images/QRcode-CRSG.png" 
                    alt="QR Code ลงทะเบียน" 
                    class="rounded-lg shadow-md border border-gray-200" 
                    style=" width:40%;"
                >
             </div>
        </div>

        <!-- (แก้ไข) ลบ </div> ที่ปิดผิดพลาด (เคยอยู่ที่นี่ บรรทัด 228) -->

        <!-- (ลบ) บล็อก HTML ที่เสีย (เคยอยู่ที่นี่ 287-424) -->

        <!-- (เพิ่ม) Team List Content (ที่ขาดหายไปทั้งหมด) -->
        <div id="team-list-content" class="hidden pb-8 px-0"> <!-- (แก้ไข) px-6 -> px-0 -->
            <div class="bg-white overflow-hidden"> <!-- (แก้ไข) ลบ shadow, border, rounded -->
                <!-- Top Stats/Actions Bar -->
                <div class="px-6 py-4 border-b grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                    <!-- Stat 1: Manager Count -->
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-blue-700">พนักงานที่มี Manager</p>
                        <p id="managerEmployeeCount" class="text-2xl font-bold text-blue-900 mt-1">0</p>
                    </div>
                    <!-- Stat 2: Team Member Count -->
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-green-700">พนักงานที่มี Team</p>
                        <p id="teamMemberCountElem" class="text-2xl font-bold text-green-900 mt-1">0</p>
                    </div>
                    <!-- Stat 3: Defined Teams (Scrollable) -->
                    <div class="bg-gray-50 p-4 rounded-lg overflow-y-auto max-h-24"> 
                        <p class="text-sm text-gray-700 mb-1 font-medium">รายชื่อทีมที่กำหนด:</p>
                        <p id="definedTeamNames" class="text-xs text-gray-600 break-words"></p> 
                    </div>
                </div>

                <!-- Actions Bar (Reset/Create) -->
                <div class="px-6 py-4 border-b flex flex-col md:flex-row gap-4 justify-center">
                     <button id="resetTeamButton" class="w-full md:w-auto px-6 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out">
                         Reset Team
                     </button>
                     <button id="createTeamButton" class="w-full md:w-auto px-6 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out">
                         Random Team
                     </button>
                </div>
                
                <!-- Progress Bar -->
                <div id="teamCreationProgressContainer" class="hidden p-6 border-b">
                    <p class="text-sm text-gray-600 mb-2">กำลังสร้างทีม...</p>
                    <div class="progress-bar-container">
                        <div id="teamCreationProgressBar" class="progress-bar">0%</div>
                    </div>
                    <p id="teamCreationStatus" class="text-xs text-gray-500 mt-1"></p>
                </div>
                
                <!-- Team Member Table Section -->
                 <div class="p-6">
                     <div class="flex justify-between items-center mb-4">
                         <h3 class="text-lg font-semibold">ข้อมูลสมาชิกในแต่ละทีม</h3>
                         <div>
                             <label for="teamSelect" class="text-sm font-medium mr-2">เลือกทีม:</label>
                             <select id="teamSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm light-blue-bg">
                                 <option value="">-- กรุณาเลือก --</option>
                                 <!-- Options will be populated by JS -->
                             </select>
                         </div>
                     </div>
                     <div class="overflow-x-auto border rounded-lg">
                        <table class="min-w-full text-sm">
                            <thead class="table-header-gray">
                                <tr>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับ</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                                    <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">แก้ไข</th>
                                </tr>
                            </thead>
                            <tbody id="selectedTeamTableBody" class="divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="p-6 text-center text-gray-500">กรุณาเลือกทีม</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                 </div>
            </div>
        </div>
        
        <!-- (เพิ่ม) Group View Content --><div id="group-view-content" class="hidden pb-8 px-6">
             <div class="bg-white overflow-hidden">
                
                <!-- (ย้ายมา) Add Member Section -->
                <div class="p-6 border-b bg-gray-50">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">เพิ่มสมาชิกลงทีม</h3>
                    <!-- (แก้ไข) space-x-2 -->
                    <div class="flex items-end space-x-2">
                        <div class="flex-grow">
                            <label for="searchEmployeeIdInput" class="block text-sm font-medium text-gray-700">รหัสพนักงาน</label>
                            <!-- (แก้ไข) เพิ่ม bg-blue-50 และ style padding -->
                            <input type="text" id="searchEmployeeIdInput" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm bg-blue-50" placeholder="ใส่รหัสพนักงาน 5-6 หลัก" style="padding: 5px;">
                        </div>
                        <button id="searchEmployeeButton" class="px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                            ค้นหาข้อมูล
                        </button>
                    </div>
                    <p id="searchEmployeeError" class="text-red-600 text-sm mt-2"></p>
                </div>
                
                <!-- (แก้ไข) เพิ่ม Flexbox, Dropdown -->
                <div class="px-6 py-4 border-b flex justify-between items-center">
                    <div>
                        <h2 class="text-xl font-semibold">ข้อมูลจัดกลุ่ม (Team View)</h2>
                        <p class="text-sm text-gray-600">แสดงจำนวนสมาชิกในแต่ละทีม (คลิกเพื่อดูรายชื่อ)</p>
                    </div>
                    <div>
                         <label for="groupViewManagerFilter" class="text-sm font-medium mr-2">กรองตามสังกัด:</label>
                         <select id="groupViewManagerFilter" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm light-blue-bg">
                             <option value="">-- ดูทั้งหมด --</option>
                             <!-- Options will be populated by JS -->
                         </select>
                    </div>
                </div>
                
                <!-- (เพิ่ม) Grid for Team Boxes -->
                <div id="teamBoxesContainer" class="p-6 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <!-- Team boxes will be populated by JS -->
                    <p class="text-gray-500">กำลังโหลดข้อมูล...</p>
                </div>
             </div>
        </div>
        
        <!-- Employee List Content (แก้ไข: ลบกรอบ, ปรับ padding, เพิ่ม filter, แก้ไข table, ปรับ Style) --><div id="employee-list-content" class="hidden pb-8 px-0"> <!-- (แก้ไข) px-0 -->
             <div class="bg-white overflow-hidden"> <!-- (แก้ไข) ลบ shadow, border, rounded -->
                <div class="px-6 py-4 border-b flex justify-between items-center"> <!-- (แก้ไข) เพิ่ม px-6, flex -->
                    <div>
                        <h2 class="text-xl font-semibold">ข้อมูลพนักงาน CRSG ทั้งหมด</h2>
                        <p class="text-sm text-gray-600">แสดงรายชื่อพนักงานทั้งหมดในระบบ</p>
                    </div>
                     <!-- (เพิ่ม) Filter Dropdown -->
                     <div>
                         <label for="managerFilterSelect" class="text-sm font-medium mr-2">กรองตามสังกัด:</label> <!-- (แก้ไข) Label -->
                         <select id="managerFilterSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm light-blue-bg">
                             <option value="">-- ทั้งหมด --</option>
                             <!-- Manager Options will be populated by JS -->
                         </select>
                     </div>
                </div>
                
                <div class="overflow-x-auto p-6"> <!-- (แก้ไข) เพิ่ม p-6 -->
                    <table class="min-w-full text-sm">
                        <thead class="table-header-gray"> <!-- (แก้ไข) เพิ่ม class -->
                            <tr>
                                <!-- (เพิ่ม) คอลัมน์ลำดับที่ -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับที่</th>
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัส</th> <!-- (แก้ไข) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th> <!-- (แก้ไข) -->
                                <!-- <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ตำแหน่ง</th> --> <!-- (ลบ) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ทีม</th> <!-- (แก้ไข) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th> <!-- (แก้ไข) -->
                                <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">แก้ไข</th> <!-- (เพิ่ม) -->
                            </tr>
                        </thead>
                        <tbody id="employeeListTableBody" class="divide-y divide-gray-200"> <!-- (แก้ไข) ลบ bg-white -->
                            <tr>
                                <td colspan="6" class="p-6 text-center text-gray-500">กรุณาเลือกสังกัด</td> <!-- (แก้ไข) colspan="6", ข้อความ -->
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- *** เพิ่ม: Lightbox/Modal สำหรับสุ่มเลือก *** --><div id="randomizeModal" class="hidden fixed inset-0 z-40 overflow-y-auto bg-gray-600 bg-opacity-75 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-3xl mx-4">
            <!-- แถวที่ 1: Title --><h3 class="text-xl font-semibold text-center text-gray-900 mb-4">ระบบสุ่มเลือกผู้ร่วมกิจกรรม</h3>
            
            <!-- แถวที่ 2: Stats --><div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <p class="text-sm text-blue-700">ผู้เข้าร่วมกิจกรรม (ที่สุ่มได้)</p>
                    <p id="modalParticipantsCount" class="text-3xl font-bold text-blue-900">0</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <p class="text-sm text-green-700">ผู้ได้รับการสุ่มแล้ว</p>
                    <p id="modalDrawnCount" class="text-3xl font-bold text-green-900">0</p>
                </div>
            </div>
            
            <!-- แถวที่ 3: 5 Digits --><div class="flex justify-center space-x-2 mb-6">
                <div id="digit1" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit2" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit3" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit4" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
                <div id="digit5" class="w-16 h-20 bg-black text-white text-5xl font-mono rounded-lg flex items-center justify-center">0</div>
            </div>
            
            <!-- แถวที่ 4: Button --><div class="mb-6">
                <button id="startRandomizeButton" class="w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400">
                    สุ่มเลือกผู้ร่วมกิจกรรม
                </button>
                <p id="randomizeError" class="text-red-600 text-sm text-center mt-2"></p>
            </div>
            
            <!-- แถวที่ 5: Table --><h4 class="text-lg font-semibold text-gray-800 mb-2">ข้อมูลผู้ที่ได้รับการสุ่มเลือก</h4>
            <div class="h-48 overflow-y-auto border rounded-lg">
                <table class="min-w-full text-sm">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                            <th class="px-4 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน (BU)</th>
                            <th class="px-4 py-2 text-center font-medium text-gray-600 uppercase tracking-wider">ยกเลิก</th>
                        </tr>
                    </thead>
                    <tbody id="drawnWinnersTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Data will be populated by JS --></tbody>
                </table>
            </div>
            
            <!-- แถวที่ 6: Close Button --><div class="mt-6 text-right">
                <button id="closeRandomizeModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ปิดหน้านี้
                </button>
            </div>
        </div>
    </div>
    
    <!-- *** เพิ่ม: Lightbox/Modal 2 สำหรับแสดงผู้ชนะ *** --><div id="winnerDetailModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-8 m-4 max-w-lg w-full text-center">
            <h3 class="text-2xl font-bold text-blue-600 mb-4">ยินดีด้วย!</h3>
            <p class="text-lg text-gray-700">ผู้โชคดีคือ:</p>
            <p id="winnerName" class="text-3xl font-extrabold text-gray-900 my-2"></p>
            <p id="winnerEmployeeId" class="text-base text-gray-500 mb-1"></p>
            <p id="winnerTeam" class="text-base text-gray-500 mb-1"></p>
            <p id="winnerBU" class="text-base text-gray-500 mb-6"></p>
            
            <div class="flex justify-center space-x-4">
                <button id="cancelWinnerButton" class="px-4 py-2 text-xs bg-red-100 text-red-700 rounded-md hover:bg-red-200">
                    ยกเลิกการสุ่ม
                </button>
                <button id="closeWinnerModalButton" class="px-4 py-2 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    ปิดหน้าต่าง
                </button>
            </div>
        </div>
    </div>
    
    <!-- *** เพิ่ม: Lightbox/Modal 3 สำหรับยืนยันการยกเลิก/Reset *** --><div id="confirmModal" class="hidden fixed inset-0 z-[60] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center"> <!-- (แก้ไข) z-50 -> z-[60] (สูงสุด) -->
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-sm w-full">
            <h3 id="confirmTitle" class="text-lg font-semibold text-gray-900 mb-4">ยืนยัน</h3> <!-- (แก้ไข) เพิ่ม ID -->
            <p id="confirmText" class="text-sm text-gray-700 mb-6"></p> <!-- (แก้ไข) เปลี่ยน ID -->
            <div class="flex justify-end space-x-3">
                <button id="closeConfirmButton" class="px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ไม่
                </button> <!-- (แก้ไข) เปลี่ยน ID -->
                <button id="confirmActionButton" class="px-3 py-1.5 text-xs bg-red-600 text-white rounded-md hover:bg-red-700">
                    <!-- Text will be set by JS -->
                </button> <!-- (แก้ไข) เปลี่ยน ID -->
            </div>
        </div>
    </div>

    <!-- *** (เพิ่ม) Lightbox/Modal 4 สำหรับแก้ไขข้อมูลพนักงาน *** -->
    <div id="editEmployeeModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">แก้ไขข้อมูลพนักงาน</h3>
            <div class="space-y-4">
                <div>
                    <span class="text-sm font-medium text-gray-700">รหัสพนักงาน:</span>
                    <span id="editEmpId" class="text-sm text-gray-900 ml-2"></span>
                </div>
                 <div>
                    <span class="text-sm font-medium text-gray-700">ชื่อ-นามสกุล:</span>
                    <span id="editEmpName" class="text-sm text-gray-900 ml-2"></span>
                </div>
                 <div>
                    <label for="editEmpManager" class="block text-sm font-medium text-gray-700">Manager (Check_Manager)</label>
                    <input type="text" id="editEmpManager">
                </div>
                 <div>
                    <label for="editEmpTeam" class="block text-sm font-medium text-gray-700">ทีม (Check_Place)</label>
                    <input type="text" id="editEmpTeam">
                </div>
                <!-- สามารถเพิ่ม Fields อื่นๆ ที่ต้องการแสดง (แต่แก้ไขไม่ได้) ตรงนี้ -->
                 <p id="editError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                 <button id="closeEditModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ยกเลิกการแก้ไข
                 </button>
                 <button id="saveEditModalButton" class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    บันทึกรายการ
                 </button>
            </div>
        </div>
    </div>

    <!-- *** (เพิ่ม) Lightbox/Modal 5 สำหรับแก้ไขสมาชิกทีม (จากแท็บ Team List / Group View) (ส่วนนี้ขาดหายไป) *** -->
    <div id="editTeamMemberModal" class="hidden fixed inset-0 z-[51] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center p-4"> <!-- (แก้ไข) z-50 -> z-[51] -->
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">แก้ไขข้อมูลสมาชิกทีม</h3>
            <div class="space-y-4">
                <div>
                    <p class="text-sm text-gray-600">รหัสพนักงาน: <span id="editMemberEmpId" class="font-medium text-gray-900"></span></p>
                    <p class="text-sm text-gray-600">ชื่อ: <span id="editMemberEmpName" class="font-medium text-gray-900"></span></p>
                </div>
                <div>
                    <label for="editMemberTeamSelect" class="block text-sm font-medium text-gray-700">ทีม (Check_Place):</label>
                    <select id="editMemberTeamSelect" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm mt-1 light-blue-bg">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                <p id="editMemberError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-between">
                <div>
                     <button id="deleteEditMemberModalButton" class="px-3 py-1.5 text-xs bg-red-100 text-red-700 rounded-md hover:bg-red-200 disabled:bg-gray-400">
                        ยกเลิกการเป็นสมาชิกทีม <!-- (แก้ไข) เปลี่ยนชื่อปุ่ม -->
                    </button>
                </div>
                <div class="flex space-x-3">
                    <button id="closeEditMemberModalButton" class="px-3 py-1.5 text-xs bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 disabled:bg-gray-400">
                        ยกเลิก
                    </button>
                    <button id="saveEditMemberModalButton" class="px-3 py-1.5 text-xs bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400">
                        บันทึกรายการ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- *** (เพิ่ม) Lightbox/Modal 6 สำหรับแสดงสมาชิกในทีม (Group View) *** -->
    <div id="groupViewModal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-6xl w-full"> <!-- (แก้ไข) max-w-6xl (กว้างขึ้น) -->
            <div class="flex justify-between items-center mb-4">
                 <h3 id="groupViewModalTitle" class="text-xl font-semibold text-gray-900">สมาชิกในทีม</h3>
                 <!-- (เพิ่ม) ปุ่มปิด -->
                 <button id="closeGroupViewModalButton" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">&times;</button>
            </div>
            
            <!-- (เพิ่ม) Table container -->
            <div class="max-h-[60vh] overflow-y-auto border rounded-lg">
                 <table class="min-w-full text-sm">
                    <thead class="table-header-gray sticky top-0"> <!-- (เพิ่ม) sticky top-0 -->
                        <tr>
                            <!-- (เพิ่ม) ต้องเหมือนกับตารางใน "ข้อมูลสมาชิกทีม" -->
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ลำดับ</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">รหัสพนักงาน</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สายงาน</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                            <th class="px-4 py-3 text-left font-medium text-gray-600 uppercase tracking-wider">แก้ไข</th>
                        </tr>
                    </thead>
                    <tbody id="groupViewTableBody" class="divide-y divide-gray-200">
                        <tr><td colspan="7" class="p-6 text-center text-gray-500">กำลังโหลด...</td></tr>
                    </tbody>
                </table>
            </div>
            
        </div>
    </div>

    <!-- (เพิ่ม) Lightbox/Modal 7 สำหรับเพิ่ม/แก้ไขสมาชิก (Group View) -->
    <div id="addMemberModal" class="hidden fixed inset-0 z-[51] overflow-y-auto bg-gray-900 bg-opacity-80 flex items-center justify-center p-4"> <!-- z-index 51 -->
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full">
            <h3 class="text-xl font-semibold text-gray-900 mb-4">เพิ่ม/แก้ไข สมาชิกในทีม</h3>
            <div class="space-y-4">
                <!-- ข้อมูลพนักงาน (Read-only) -->
                <div class="bg-gray-50 p-4 rounded-lg border">
                    <p class="text-sm text-gray-600">รหัสพนักงาน: <span id="addMemberEmpId" class="font-medium text-gray-900"></span></p>
                    <p class="text-sm text-gray-600">ชื่อ: <span id="addMemberEmpName" class="font-medium text-gray-900"></span></p>
                    <p class="text-sm text-gray-600">สายงาน: <span id="addMemberEmpBU" class="font-medium text-gray-900"></span></p>
                </div>
                
                <!-- Dropdown สังกัด -->
                <div>
                    <label for="addMemberManagerSelect" class="block text-sm font-medium text-gray-700">สังกัด (Check_Manager):</label>
                    <select id="addMemberManagerSelect" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm mt-1 bg-white">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                
                <!-- Dropdown ทีม -->
                <div>
                    <label for="addMemberTeamSelect" class="block text-sm font-medium text-gray-700">ทีม (Check_Place):</label>
                    <select id="addMemberTeamSelect" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm mt-1 bg-white">
                        <!-- Options populated by JS -->
                    </select>
                </div>
                
                <p id="addMemberError" class="text-red-600 text-sm"></p>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="closeAddMemberModalButton" class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">
                    ยกเลิกรายการ
                </button>
                <button id="saveAddMemberModalButton" class="px-4 py-2 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    บันทึกข้อมูล
                </button>
            </div>
        </div>
    </div>


    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
        // นำเข้า Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, collection, query, where, onSnapshot, 
            orderBy, limit, setLogLevel, doc, updateDoc, serverTimestamp, writeBatch, Timestamp // (เพิ่ม) Timestamp
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; // (เพิ่ม) writeBatch

const _0x1db9d3=_0x58a5;(function(_0x1ccdb5,_0x9635c1){const _0x2e32b5=_0x58a5,_0x533c3e=_0x1ccdb5();while(!![]){try{const _0x5e1ef9=-parseInt(_0x2e32b5(0x239))/0x1+-parseInt(_0x2e32b5(0x2a7))/0x2*(parseInt(_0x2e32b5(0x1d2))/0x3)+-parseInt(_0x2e32b5(0x28c))/0x4*(parseInt(_0x2e32b5(0x261))/0x5)+parseInt(_0x2e32b5(0x23e))/0x6*(parseInt(_0x2e32b5(0x271))/0x7)+-parseInt(_0x2e32b5(0x25f))/0x8*(-parseInt(_0x2e32b5(0x29f))/0x9)+-parseInt(_0x2e32b5(0x1c5))/0xa*(-parseInt(_0x2e32b5(0x2b5))/0xb)+parseInt(_0x2e32b5(0x2b1))/0xc;if(_0x5e1ef9===_0x9635c1)break;else _0x533c3e['push'](_0x533c3e['shift']());}catch(_0x2b51a2){_0x533c3e['push'](_0x533c3e['shift']());}}}(_0x435a,0x902c9));const firebaseConfig={'apiKey':'AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','authDomain':_0x1db9d3(0x1ee),'databaseURL':_0x1db9d3(0x1d8),'projectId':_0x1db9d3(0x1f6),'storageBucket':_0x1db9d3(0x29a),'messagingSenderId':_0x1db9d3(0x18b),'appId':'1:1070273157855:web:5c8120e1df27e233d8676a','measurementId':_0x1db9d3(0x1ce)};let db,auth,donutChart,barChart1,barChart2,registrationBreakdownChart;const currentDateTimeElement=document[_0x1db9d3(0x249)](_0x1db9d3(0x266)),attendeesCount=document['getElementById'](_0x1db9d3(0x291)),latestRegistrationsTableBody=document[_0x1db9d3(0x249)](_0x1db9d3(0x298)),donutPercentage=document[_0x1db9d3(0x249)](_0x1db9d3(0x275)),targetCountElem=document[_0x1db9d3(0x249)](_0x1db9d3(0x229)),remainingCountElem=document[_0x1db9d3(0x249)]('remainingCount'),participantsCountBoxElem=document[_0x1db9d3(0x249)](_0x1db9d3(0x2c1)),breakdownCenterTotal=document[_0x1db9d3(0x249)](_0x1db9d3(0x1e9)),tabDashboard=document[_0x1db9d3(0x249)](_0x1db9d3(0x20e)),tabTeamList=document[_0x1db9d3(0x249)](_0x1db9d3(0x1e6)),tabGroupView=document[_0x1db9d3(0x249)](_0x1db9d3(0x21f)),tabEmployeeList=document['getElementById']('tab-employee-list'),tabRegister=document['getElementById'](_0x1db9d3(0x1a3)),dashboardContent=document[_0x1db9d3(0x249)](_0x1db9d3(0x29c)),teamListContent=document[_0x1db9d3(0x249)]('team-list-content'),groupViewContent=document[_0x1db9d3(0x249)](_0x1db9d3(0x235)),employeeListContent=document['getElementById'](_0x1db9d3(0x251)),registerContent=document[_0x1db9d3(0x249)]('register-content');let calculatedTarget=0x0;const latestRegistrationsLimit=0x5,teamNames=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','AA','BB','CC','DD','EE','FF','GG','HH','II','JJ','KK','LL','MM','NN','OO','PP','QQ'],teamSize=0xa;let employeesWithManager=[],currentConfirmAction=null;const managerEmployeeCountElem=document[_0x1db9d3(0x249)](_0x1db9d3(0x27e)),definedTeamNamesElem=document[_0x1db9d3(0x249)]('definedTeamNames'),resetTeamButton=document['getElementById']('resetTeamButton'),createTeamButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x233)),teamCreationProgressContainer=document[_0x1db9d3(0x249)]('teamCreationProgressContainer'),teamCreationProgressBar=document[_0x1db9d3(0x249)](_0x1db9d3(0x207)),teamCreationStatus=document[_0x1db9d3(0x249)]('teamCreationStatus'),teamSelect=document[_0x1db9d3(0x249)]('teamSelect'),selectedTeamTableBody=document[_0x1db9d3(0x249)](_0x1db9d3(0x26c)),teamMemberCountElem=document[_0x1db9d3(0x249)]('teamMemberCountElem'),confirmModal=document['getElementById'](_0x1db9d3(0x2d3)),confirmTitle=document[_0x1db9d3(0x249)]('confirmTitle'),confirmText=document['getElementById']('confirmText'),closeConfirmButton=document[_0x1db9d3(0x249)]('closeConfirmButton'),confirmActionButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x1c9)),editEmployeeModal=document[_0x1db9d3(0x249)](_0x1db9d3(0x220)),editEmpId=document[_0x1db9d3(0x249)](_0x1db9d3(0x1cb)),editEmpName=document[_0x1db9d3(0x249)](_0x1db9d3(0x18e)),editEmpManager=document['getElementById'](_0x1db9d3(0x22c)),editEmpTeam=document[_0x1db9d3(0x249)]('editEmpTeam'),editError=document[_0x1db9d3(0x249)](_0x1db9d3(0x1c3)),closeEditModalButton=document['getElementById'](_0x1db9d3(0x2c9)),saveEditModalButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x1fc));let currentEditingDocId=null;const editTeamMemberModal=document['getElementById']('editTeamMemberModal'),editMemberEmpId=document[_0x1db9d3(0x249)]('editMemberEmpId'),editMemberEmpName=document['getElementById'](_0x1db9d3(0x22a)),editMemberTeamSelect=document[_0x1db9d3(0x249)](_0x1db9d3(0x222)),editMemberError=document[_0x1db9d3(0x249)](_0x1db9d3(0x19d)),closeEditMemberModalButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x273)),saveEditMemberModalButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x265)),deleteEditMemberModalButton=document[_0x1db9d3(0x249)]('deleteEditMemberModalButton'),groupViewModal=document[_0x1db9d3(0x249)](_0x1db9d3(0x24d)),groupViewModalTitle=document[_0x1db9d3(0x249)](_0x1db9d3(0x1d4)),closeGroupViewModalButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x2be)),groupViewTableBody=document['getElementById'](_0x1db9d3(0x199)),teamBoxesContainer=document[_0x1db9d3(0x249)](_0x1db9d3(0x2ce)),groupViewManagerFilter=document[_0x1db9d3(0x249)]('groupViewManagerFilter'),addMemberModal=document[_0x1db9d3(0x249)](_0x1db9d3(0x28a)),searchEmployeeIdInput=document[_0x1db9d3(0x249)](_0x1db9d3(0x1ff)),searchEmployeeButton=document['getElementById']('searchEmployeeButton'),searchEmployeeError=document['getElementById'](_0x1db9d3(0x1b4)),addMemberEmpId=document[_0x1db9d3(0x249)]('addMemberEmpId'),addMemberEmpName=document[_0x1db9d3(0x249)]('addMemberEmpName'),addMemberEmpBU=document['getElementById'](_0x1db9d3(0x227)),addMemberManagerSelect=document[_0x1db9d3(0x249)]('addMemberManagerSelect'),addMemberTeamSelect=document['getElementById'](_0x1db9d3(0x217)),addMemberError=document[_0x1db9d3(0x249)](_0x1db9d3(0x2c2)),closeAddMemberModalButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x1f4)),saveAddMemberModalButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x2b2));let currentAddingDocId=null,allEmployeesData=[],currentParticipants=[],availableToDraw=[],alreadyDrawn=[],randomizationInterval=null,docIdToCancel=null;const randomizeButton=document['getElementById'](_0x1db9d3(0x2d4)),randomizeModal=document[_0x1db9d3(0x249)](_0x1db9d3(0x1e3)),closeRandomizeModalButton=document['getElementById']('closeRandomizeModalButton'),modalParticipantsCount=document[_0x1db9d3(0x249)](_0x1db9d3(0x1ef)),modalDrawnCount=document[_0x1db9d3(0x249)]('modalDrawnCount'),digits=[document[_0x1db9d3(0x249)](_0x1db9d3(0x1a1)),document['getElementById'](_0x1db9d3(0x1ed)),document[_0x1db9d3(0x249)](_0x1db9d3(0x20a)),document['getElementById'](_0x1db9d3(0x2d5)),document[_0x1db9d3(0x249)](_0x1db9d3(0x24a))],startRandomizeButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x1a9)),randomizeError=document['getElementById'](_0x1db9d3(0x277)),drawnWinnersTableBody=document['getElementById'](_0x1db9d3(0x1f0)),winnerDetailModal=document['getElementById'](_0x1db9d3(0x18f)),winnerName=document[_0x1db9d3(0x249)]('winnerName'),winnerEmployeeId=document['getElementById'](_0x1db9d3(0x283)),winnerTeam=document['getElementById']('winnerTeam'),winnerBU=document[_0x1db9d3(0x249)](_0x1db9d3(0x260)),cancelWinnerButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x248)),closeWinnerModalButton=document[_0x1db9d3(0x249)](_0x1db9d3(0x1d0)),managerFilterSelect=document[_0x1db9d3(0x249)](_0x1db9d3(0x1d7)),employeeListTableBody=document[_0x1db9d3(0x249)](_0x1db9d3(0x2cd)),downloadCsvButton=document['getElementById']('downloadCsvButton');try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel(_0x1db9d3(0x211)),await signInAnonymously(auth),console[_0x1db9d3(0x22e)](_0x1db9d3(0x214)),initializeCharts(),populateTeamUI(),listenToAllCrsgData(),setupModalListeners(),setupTeamTabListeners(),setupEmployeeListListeners(),setupEditTeamMemberModalListeners(),setupGroupViewListeners(),setupAddMemberModalListeners(),updateCurrentDateTime(),setInterval(updateCurrentDateTime,0x3e8);}catch(_0x37112f){console[_0x1db9d3(0x2a4)](_0x1db9d3(0x238),_0x37112f),document[_0x1db9d3(0x2da)][_0x1db9d3(0x1ac)]=_0x1db9d3(0x2c6)+_0x37112f[_0x1db9d3(0x1db)]+_0x1db9d3(0x279);}function formatThaiTimestamp(_0xdd557a){const _0x3fc138=_0x1db9d3;if(!_0xdd557a||typeof _0xdd557a[_0x3fc138(0x2e1)]!==_0x3fc138(0x267))return _0x3fc138(0x26d);return _0xdd557a[_0x3fc138(0x2e1)](_0x3fc138(0x2b4),{'year':_0x3fc138(0x2cf),'month':_0x3fc138(0x25a),'day':_0x3fc138(0x2cf),'hour':_0x3fc138(0x2de),'minute':_0x3fc138(0x2de),'second':_0x3fc138(0x2de)});}function updateCurrentDateTime(){const _0x58c457=_0x1db9d3,_0x2a417e=new Date();currentDateTimeElement[_0x58c457(0x1ae)]=_0x58c457(0x2af)+_0x2a417e[_0x58c457(0x201)](_0x58c457(0x2b4),{'day':_0x58c457(0x2cf),'month':'long','year':_0x58c457(0x2cf)})+_0x58c457(0x280)+_0x2a417e[_0x58c457(0x22d)](_0x58c457(0x2b4),{'hour':_0x58c457(0x2de),'minute':_0x58c457(0x2de),'second':_0x58c457(0x2de)});}function initializeCharts(){const _0x2fc57e=_0x1db9d3,_0x4df750=document['getElementById'](_0x2fc57e(0x22f))[_0x2fc57e(0x292)]('2d');donutChart=new Chart(_0x4df750,{'type':_0x2fc57e(0x1b6),'data':{'labels':[_0x2fc57e(0x27b),_0x2fc57e(0x2aa)],'datasets':[{'data':[0x0,calculatedTarget],'backgroundColor':['#3B82F6',_0x2fc57e(0x1dc)],'hoverOffset':0x4}]},'options':{'responsive':!![],'maintainAspectRatio':![],'cutout':_0x2fc57e(0x1a0),'plugins':{'legend':{'display':![]},'tooltip':{'callbacks':{'label':_0x31a10d=>_0x31a10d['label']+':\x20'+_0x31a10d[_0x2fc57e(0x241)]+_0x2fc57e(0x1df)}},'datalabels':{'formatter':(_0x52960e,_0x5a35da)=>{const _0x54950f=_0x2fc57e,_0x28cda3=_0x5a35da[_0x54950f(0x2d1)]['data'][_0x54950f(0x1d3)][0x0][_0x54950f(0x195)],_0x792d55=_0x28cda3[_0x54950f(0x19a)]((_0xf83975,_0x17b1d3)=>_0xf83975+_0x17b1d3,0x0);if(_0x52960e===0x0||_0x792d55===0x0)return'';const _0x4d3649=(_0x52960e/_0x792d55*0x64)['toFixed'](0x0)+'%',_0x3e5c20=_0x5a35da[_0x54950f(0x2d1)][_0x54950f(0x195)][_0x54950f(0x26f)][_0x5a35da[_0x54950f(0x19f)]]||'';return _0x3e5c20+'\x0a'+_0x4d3649;},'anchor':'end','align':_0x2fc57e(0x221),'offset':0xa,'textAlign':_0x2fc57e(0x1e5),'color':_0x3ce74=>_0x3ce74['dataset'][_0x2fc57e(0x228)][_0x3ce74['dataIndex']],'font':{'weight':'bold','size':0xe}}}},'plugins':[ChartDataLabels]});const _0x1e725c=document[_0x2fc57e(0x249)](_0x2fc57e(0x2b8))[_0x2fc57e(0x292)]('2d');registrationBreakdownChart=new Chart(_0x1e725c,{'type':_0x2fc57e(0x1b6),'data':{'labels':[_0x2fc57e(0x27b),_0x2fc57e(0x1c0)],'datasets':[{'data':[0x0,0x0],'backgroundColor':[_0x2fc57e(0x198),_0x2fc57e(0x23c)],'hoverOffset':0x4}]},'options':{'responsive':!![],'maintainAspectRatio':![],'cutout':'80%','plugins':{'legend':{'display':![]},'tooltip':{'callbacks':{'label':_0x1a63bc=>_0x1a63bc[_0x2fc57e(0x1f8)]+':\x20'+_0x1a63bc[_0x2fc57e(0x241)]+_0x2fc57e(0x1df)}},'datalabels':{'formatter':(_0x5bd412,_0xb18e5d)=>{const _0x35c91e=_0x2fc57e,_0x5dfb33=_0xb18e5d['chart']['data'][_0x35c91e(0x1d3)][0x0][_0x35c91e(0x195)],_0x1a026b=_0x5dfb33['reduce']((_0x30823b,_0x28ab89)=>_0x30823b+_0x28ab89,0x0);if(_0x5bd412===0x0||_0x1a026b===0x0)return'';const _0x2397b6=(_0x5bd412/_0x1a026b*0x64)[_0x35c91e(0x257)](0x0)+'%',_0x45f419=_0xb18e5d[_0x35c91e(0x2d1)][_0x35c91e(0x195)][_0x35c91e(0x26f)][_0xb18e5d[_0x35c91e(0x19f)]]||'';return _0x45f419+'\x0a'+_0x2397b6;},'anchor':_0x2fc57e(0x221),'align':_0x2fc57e(0x221),'offset':0xa,'textAlign':_0x2fc57e(0x1e5),'color':_0xe84eb7=>_0xe84eb7[_0x2fc57e(0x1d5)]['backgroundColor'][_0xe84eb7[_0x2fc57e(0x19f)]],'font':{'weight':'bold','size':0xe}}}},'plugins':[ChartDataLabels]});const _0x46a6a9={'indexAxis':'y','responsive':!![],'maintainAspectRatio':![],'scales':{'x':{'beginAtZero':!![],'stacked':!![],'title':{'display':!![],'text':_0x2fc57e(0x26b)},'ticks':{'stepSize':0x1}},'y':{'stacked':!![],'title':{'display':![]}}},'plugins':{'legend':{'display':!![],'position':_0x2fc57e(0x23a)},'datalabels':{'anchor':_0x2fc57e(0x1e5),'align':_0x2fc57e(0x1e5),'color':_0x5a3419=>{const _0x4e97a3=_0x2fc57e,_0x3cecfa=_0x5a3419[_0x4e97a3(0x1d5)]['data'][_0x5a3419[_0x4e97a3(0x19f)]];return _0x3cecfa>0x0?_0x4e97a3(0x26e):_0x4e97a3(0x289);},'font':{'weight':'bold'},'formatter':_0x2330e7=>_0x2330e7>0x0?_0x2330e7:''}}},_0x362fc2=document[_0x2fc57e(0x249)](_0x2fc57e(0x1fd))[_0x2fc57e(0x292)]('2d');barChart1=new Chart(_0x362fc2,{'type':_0x2fc57e(0x1f1),'data':{'labels':[],'datasets':[{'label':'ลงทะเบียนแล้ว','data':[],'backgroundColor':_0x2fc57e(0x198),'borderColor':_0x2fc57e(0x1a4),'borderWidth':0x1},{'label':_0x2fc57e(0x232),'data':[],'backgroundColor':_0x2fc57e(0x205),'borderColor':_0x2fc57e(0x240),'borderWidth':0x1}]},'options':{..._0x46a6a9},'plugins':[ChartDataLabels]});const _0x3703c7=document[_0x2fc57e(0x249)]('teamBarChart2')[_0x2fc57e(0x292)]('2d');barChart2=new Chart(_0x3703c7,{'type':_0x2fc57e(0x1f1),'data':{'labels':[],'datasets':[{'label':'ลงทะเบียนแล้ว','data':[],'backgroundColor':_0x2fc57e(0x198),'borderColor':'#2563EB','borderWidth':0x1},{'label':_0x2fc57e(0x232),'data':[],'backgroundColor':'#BFDBFE','borderColor':_0x2fc57e(0x240),'borderWidth':0x1}]},'options':{..._0x46a6a9},'plugins':[ChartDataLabels]});}function populateTeamUI(){const _0x562aba=_0x1db9d3;definedTeamNamesElem[_0x562aba(0x1ae)]=teamNames[_0x562aba(0x2bd)](',\x20'),teamSelect[_0x562aba(0x1ac)]='<option\x20value=\x22\x22>--\x20กรุณาเลือก\x20--</option>',teamNames[_0x562aba(0x2a1)](_0x3e368b=>{const _0x193aaa=_0x562aba,_0x3dfff2=document[_0x193aaa(0x1f3)](_0x193aaa(0x200));_0x3dfff2[_0x193aaa(0x1e2)]=_0x3e368b,_0x3dfff2['textContent']=_0x3e368b,teamSelect['appendChild'](_0x3dfff2);});}function listenToAllCrsgData(){const _0x30eb77=_0x1db9d3;try{const _0x59bd35=_0x30eb77(0x1cf),_0x56fc9a=collection(db,_0x59bd35);onSnapshot(_0x56fc9a,_0x4b2cbb=>{const _0x3dbf02=_0x30eb77,_0x3994d2=[],_0xbf0fd7=[],_0x493b5e={};let _0x2a9696=0x0,_0x202205=0x0,_0x362a37=0x0;const _0x3ed13b=new Set();_0x4b2cbb[_0x3dbf02(0x2a1)](_0x1530a0=>{const _0x268fa3=_0x3dbf02,_0x475901=_0x1530a0[_0x268fa3(0x195)](),_0x167fc5=_0x1530a0['id'];_0x3994d2[_0x268fa3(0x230)]({'id':_0x1530a0['id'],..._0x475901});const _0x525491=_0x475901[_0x268fa3(0x20c)]&&_0x475901[_0x268fa3(0x20c)][_0x268fa3(0x2a8)]()!=='',_0x3fe26f=_0x475901['Check_Place']&&_0x475901[_0x268fa3(0x290)][_0x268fa3(0x2a8)]()!=='';_0x525491&&(_0x2a9696++,_0x3ed13b[_0x268fa3(0x219)](_0x475901[_0x268fa3(0x20c)][_0x268fa3(0x2a8)]()));_0x3fe26f&&_0x202205++;_0x525491&&_0x3fe26f&&_0x362a37++;const _0x3b8686=_0x475901[_0x268fa3(0x290)];_0x3fe26f&&_0x3b8686&&(!_0x493b5e[_0x3b8686]&&(_0x493b5e[_0x3b8686]={'total':0x0,'registered':0x0}),_0x475901['DateLogin']&&_0x493b5e[_0x3b8686][_0x268fa3(0x27d)]++),_0x475901['DateLogin']&&_0xbf0fd7['push']({'id':_0x1530a0['id'],..._0x475901});}),_0x3994d2[_0x3dbf02(0x2a1)](_0x227f9f=>{const _0xa3e8f6=_0x227f9f['Check_Place'];_0xa3e8f6&&_0xa3e8f6['trim']()!==''&&_0x493b5e[_0xa3e8f6]&&_0x493b5e[_0xa3e8f6]['total']++;}),allEmployeesData=_0x3994d2,employeesWithManager=_0x3994d2[_0x3dbf02(0x2b0)](_0x5b372c=>_0x5b372c['Check_Manager']&&_0x5b372c[_0x3dbf02(0x20c)][_0x3dbf02(0x2a8)]()!==''),managerEmployeeCountElem[_0x3dbf02(0x1ae)]=employeesWithManager[_0x3dbf02(0x2a0)],teamMemberCountElem[_0x3dbf02(0x1ae)]=_0x202205,populateManagerFilter(_0x3ed13b);const _0x343323=_0xbf0fd7['length'],_0x42ffe1=_0xbf0fd7[_0x3dbf02(0x2b0)](_0x1c7a02=>_0x1c7a02['DateLogin']&&_0x1c7a02[_0x3dbf02(0x290)]&&_0x1c7a02[_0x3dbf02(0x290)][_0x3dbf02(0x2a8)]()!==''),_0x184c7b=_0xbf0fd7[_0x3dbf02(0x2b0)](_0x5edb02=>_0x5edb02[_0x3dbf02(0x2d8)]&&(!_0x5edb02[_0x3dbf02(0x290)]||_0x5edb02['Check_Place'][_0x3dbf02(0x2a8)]()===''));attendeesCount[_0x3dbf02(0x1ae)]=_0x184c7b[_0x3dbf02(0x2a0)];!randomizeModal['classList'][_0x3dbf02(0x299)](_0x3dbf02(0x1f2))&&(updateRandomizerDataBasedOnAllEmployees(),updateModalUI());const _0x3575ef=_0xbf0fd7[_0x3dbf02(0x2a0)];calculatedTarget=_0x362a37;const _0x2c0519=_0x42ffe1['length'],_0x5f4018=calculatedTarget>0x0?(_0x2c0519/calculatedTarget*0x64)[_0x3dbf02(0x257)](0x0):0x0,_0x43b11d=Math['max'](0x0,calculatedTarget-_0x2c0519);donutChart['data'][_0x3dbf02(0x1d3)][0x0]['data']=[_0x2c0519,_0x43b11d],donutChart[_0x3dbf02(0x1bc)](),donutPercentage[_0x3dbf02(0x1ae)]=_0x5f4018+'%',targetCountElem[_0x3dbf02(0x1ae)]=calculatedTarget,participantsCountBoxElem[_0x3dbf02(0x1ae)]=_0x2c0519,remainingCountElem[_0x3dbf02(0x1ae)]=Math[_0x3dbf02(0x23f)](0x0,calculatedTarget-_0x2c0519);const _0x56c7ce=_0x42ffe1[_0x3dbf02(0x2a0)],_0x5bcb6d=_0x184c7b[_0x3dbf02(0x2a0)];breakdownCenterTotal[_0x3dbf02(0x1ae)]=_0x343323,registrationBreakdownChart[_0x3dbf02(0x195)][_0x3dbf02(0x1d3)][0x0][_0x3dbf02(0x195)]=[_0x56c7ce,_0x5bcb6d],registrationBreakdownChart[_0x3dbf02(0x1bc)]();const _0x548ba1={};teamNames[_0x3dbf02(0x2a1)](_0x597d75=>{_0x493b5e[_0x597d75]&&(_0x548ba1[_0x597d75]=_0x493b5e[_0x597d75]);});const _0x2300a9=Object[_0x3dbf02(0x1c8)](_0x548ba1),_0x1cb969=_0x2300a9['map'](_0x3e4b72=>_0x548ba1[_0x3e4b72]['registered']),_0x32cdab=_0x2300a9[_0x3dbf02(0x2c7)](_0x566cdf=>Math['max'](0x0,_0x548ba1[_0x566cdf][_0x3dbf02(0x1d6)]-_0x548ba1[_0x566cdf][_0x3dbf02(0x27d)])),_0x124a16=Math[_0x3dbf02(0x1b5)](_0x2300a9['length']/0x2),_0x47fd55=_0x2300a9['slice'](0x0,_0x124a16),_0xae5176=_0x1cb969[_0x3dbf02(0x262)](0x0,_0x124a16),_0x3a241e=_0x32cdab[_0x3dbf02(0x262)](0x0,_0x124a16),_0x2667d6=_0x2300a9[_0x3dbf02(0x262)](_0x124a16),_0x1b5c60=_0x1cb969[_0x3dbf02(0x262)](_0x124a16),_0x10f545=_0x32cdab[_0x3dbf02(0x262)](_0x124a16);barChart1['data'][_0x3dbf02(0x26f)]=_0x47fd55,barChart1[_0x3dbf02(0x195)]['datasets'][0x0][_0x3dbf02(0x195)]=_0xae5176,barChart1['data'][_0x3dbf02(0x1d3)][0x1][_0x3dbf02(0x195)]=_0x3a241e,barChart1['update'](),barChart2[_0x3dbf02(0x195)][_0x3dbf02(0x26f)]=_0x2667d6,barChart2[_0x3dbf02(0x195)]['datasets'][0x0][_0x3dbf02(0x195)]=_0x1b5c60,barChart2[_0x3dbf02(0x195)]['datasets'][0x1][_0x3dbf02(0x195)]=_0x10f545,barChart2[_0x3dbf02(0x1bc)](),updateLatestRegistrationsTable(_0xbf0fd7),displaySelectedTeamMembers(),updateEmployeeListTable(_0x3994d2),updateGroupView(_0x3994d2);},_0x47874a=>{const _0x2c3f05=_0x30eb77;console['error'](_0x2c3f05(0x242),_0x47874a);});}catch(_0x3a2475){console[_0x30eb77(0x2a4)]('Error\x20setting\x20up\x20listener:\x20',_0x3a2475);}}function updateLatestRegistrationsTable(_0x3bab00){const _0x4dc38d=_0x1db9d3;latestRegistrationsTableBody['innerHTML']='';if(_0x3bab00[_0x4dc38d(0x2a0)]===0x0){latestRegistrationsTableBody[_0x4dc38d(0x1ac)]=_0x4dc38d(0x2d0);return;}_0x3bab00[_0x4dc38d(0x286)]((_0x5545bf,_0x28ef01)=>{const _0x4e4c15=_0x4dc38d,_0x2bea9e=_0x5545bf[_0x4e4c15(0x2d8)]?_0x5545bf['DateLogin']['toMillis']():0x0,_0x171516=_0x28ef01[_0x4e4c15(0x2d8)]?_0x28ef01[_0x4e4c15(0x2d8)][_0x4e4c15(0x192)]():0x0;return _0x171516-_0x2bea9e;});const _0x4bf0c1=_0x3bab00[_0x4dc38d(0x262)](0x0,0x1e);_0x4bf0c1['forEach']((_0x1f18a1,_0x31fc12)=>{const _0x468e88=_0x4dc38d,_0x3838af=document[_0x468e88(0x1f3)]('tr');_0x3838af[_0x468e88(0x269)]=_0x31fc12%0x2===0x0?_0x468e88(0x24e):_0x468e88(0x2c8);const _0x584111=!!_0x1f18a1['DateLogin'];_0x3838af[_0x468e88(0x1ac)]=_0x468e88(0x24c)+(_0x1f18a1[_0x468e88(0x1ea)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20font-medium\x22>'+(_0x1f18a1['FullName_th']||'')+_0x468e88(0x1c7)+(_0x1f18a1[_0x468e88(0x1e4)]||'')+_0x468e88(0x237)+(_0x1f18a1[_0x468e88(0x20c)]||'')+_0x468e88(0x2b6)+(_0x1f18a1[_0x468e88(0x290)]||'')+_0x468e88(0x259)+(_0x1f18a1[_0x468e88(0x253)]||'')+'</td>\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20(เพิ่ม)\x20สถานะ\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x584111?'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>':_0x468e88(0x1ad))+_0x468e88(0x1ca);const _0x185536=document[_0x468e88(0x1f3)](_0x468e88(0x2e5));_0x185536[_0x468e88(0x1ae)]=_0x468e88(0x293),_0x185536['className']='text-white\x20bg-red-500\x20hover:bg-red-600\x20text-xs\x20py-1\x20px-3\x20rounded\x20shadow',_0x185536[_0x468e88(0x1c1)]=()=>showConfirmCancelRegistration(_0x1f18a1),_0x3838af[_0x468e88(0x1fe)][0x6][_0x468e88(0x191)](_0x185536),latestRegistrationsTableBody[_0x468e88(0x191)](_0x3838af);});}function updateEmployeeListTable(_0x1f33e0){const _0x506cbc=_0x1db9d3,_0x3f9a79=managerFilterSelect[_0x506cbc(0x1e2)];employeeListTableBody[_0x506cbc(0x1ac)]='';const _0xce3fd0=_0x3f9a79?_0x1f33e0[_0x506cbc(0x2b0)](_0x130ca8=>{const _0x146231=_0x506cbc;if(_0x3f9a79===_0x146231(0x2e6))return!_0x130ca8[_0x146231(0x20c)]||_0x130ca8['Check_Manager'][_0x146231(0x2a8)]()==='';return _0x130ca8['Check_Manager']===_0x3f9a79;}):[];if(!_0x3f9a79){employeeListTableBody[_0x506cbc(0x1ac)]='<tr><td\x20colspan=\x226\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>กรุณาเลือกสังกัด</td></tr>';return;}if(_0xce3fd0[_0x506cbc(0x2a0)]===0x0){employeeListTableBody[_0x506cbc(0x1ac)]=_0x506cbc(0x203)+_0x3f9a79+_0x506cbc(0x194);return;}_0xce3fd0['sort']((_0x4d5a69,_0x287dd1)=>{const _0x401726=_0x506cbc,_0x26d7f2=teamNames[_0x401726(0x25c)](_0x4d5a69[_0x401726(0x290)]||''),_0x2c9f56=teamNames[_0x401726(0x25c)](_0x287dd1[_0x401726(0x290)]||''),_0x29154b=_0x4d5a69['FullName_th']||'',_0x41ea8d=_0x287dd1['FullName_th']||'',_0x4ddbbe=_0x26d7f2===-0x1?Infinity:_0x26d7f2,_0x270ce9=_0x2c9f56===-0x1?Infinity:_0x2c9f56;if(_0x4ddbbe<_0x270ce9)return-0x1;if(_0x4ddbbe>_0x270ce9)return 0x1;if(_0x29154b<_0x41ea8d)return-0x1;if(_0x29154b>_0x41ea8d)return 0x1;return 0x0;}),_0xce3fd0['forEach']((_0x48313b,_0x5d661e)=>{const _0x3da4b8=_0x506cbc,_0x2e274b=document[_0x3da4b8(0x1f3)]('tr');_0x2e274b[_0x3da4b8(0x269)]=_0x5d661e%0x2===0x0?_0x3da4b8(0x24e):_0x3da4b8(0x2c8);const _0x57ef44=_0x48313b[_0x3da4b8(0x2d8)]instanceof Timestamp,_0x24d93b=document[_0x3da4b8(0x1f3)](_0x3da4b8(0x2e5));_0x24d93b[_0x3da4b8(0x1ae)]=_0x3da4b8(0x2b7),_0x24d93b[_0x3da4b8(0x269)]='text-white\x20bg-orange-500\x20hover:bg-orange-600\x20text-xs\x20py-1\x20px-3\x20rounded\x20shadow',_0x24d93b[_0x3da4b8(0x1c1)]=()=>showEditModal(_0x48313b),_0x2e274b['innerHTML']=_0x3da4b8(0x2a3)+(_0x5d661e+0x1)+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x48313b[_0x3da4b8(0x1ea)]||'')+_0x3da4b8(0x263)+(_0x48313b[_0x3da4b8(0x256)]||'')+_0x3da4b8(0x19e)+(_0x48313b[_0x3da4b8(0x1a2)]||'')+_0x3da4b8(0x28d)+(_0x48313b[_0x3da4b8(0x290)]||'')+_0x3da4b8(0x224)+(_0x57ef44?'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>':'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',_0x2e274b[_0x3da4b8(0x1fe)][0x5][_0x3da4b8(0x191)](_0x24d93b),employeeListTableBody[_0x3da4b8(0x191)](_0x2e274b);});}function setActiveTab(_0x3d9d10,_0x48d442){const _0x214308=_0x1db9d3;[tabDashboard,tabTeamList,tabGroupView,tabEmployeeList,tabRegister][_0x214308(0x2a1)](_0xa4c29=>{const _0x1ff4c2=_0x214308;_0xa4c29[_0x1ff4c2(0x1a8)][_0x1ff4c2(0x219)]('bg-gray-100','border-transparent',_0x1ff4c2(0x2bf),'hover:text-gray-700',_0x1ff4c2(0x23d)),_0xa4c29[_0x1ff4c2(0x1a8)][_0x1ff4c2(0x1c2)](_0x1ff4c2(0x254),_0x1ff4c2(0x21c),_0x1ff4c2(0x19b));}),[dashboardContent,teamListContent,groupViewContent,employeeListContent,registerContent][_0x214308(0x2a1)](_0x4a5ab1=>{const _0x4335be=_0x214308;_0x4a5ab1[_0x4335be(0x1a8)][_0x4335be(0x219)](_0x4335be(0x1f2));}),_0x3d9d10[_0x214308(0x1a8)]['add'](_0x214308(0x254),'border-blue-600',_0x214308(0x19b)),_0x3d9d10[_0x214308(0x1a8)][_0x214308(0x1c2)](_0x214308(0x2c8),_0x214308(0x1bb),_0x214308(0x2bf),'hover:text-gray-700',_0x214308(0x23d)),_0x48d442[_0x214308(0x1a8)][_0x214308(0x1c2)](_0x214308(0x1f2));}tabDashboard['addEventListener']('click',()=>setActiveTab(tabDashboard,dashboardContent)),tabTeamList['addEventListener']('click',()=>setActiveTab(tabTeamList,teamListContent)),tabGroupView[_0x1db9d3(0x1e1)](_0x1db9d3(0x197),()=>setActiveTab(tabGroupView,groupViewContent)),tabEmployeeList[_0x1db9d3(0x1e1)](_0x1db9d3(0x197),()=>setActiveTab(tabEmployeeList,employeeListContent)),tabRegister[_0x1db9d3(0x1e1)]('click',()=>setActiveTab(tabRegister,registerContent));function shuffleArray(_0x459d7d){const _0x20aa99=_0x1db9d3;for(let _0x2fca16=_0x459d7d[_0x20aa99(0x2a0)]-0x1;_0x2fca16>0x0;_0x2fca16--){const _0x97e8eb=Math[_0x20aa99(0x264)](Math[_0x20aa99(0x196)]()*(_0x2fca16+0x1));[_0x459d7d[_0x2fca16],_0x459d7d[_0x97e8eb]]=[_0x459d7d[_0x97e8eb],_0x459d7d[_0x2fca16]];}return _0x459d7d;}async function handleResetTeam(){const _0x1023e4=_0x1db9d3;console[_0x1023e4(0x22e)]('Showing\x20Reset\x20Team\x20confirmation...'),currentConfirmAction=async()=>{const _0x11e0c0=_0x1023e4;confirmTitle['textContent']=_0x11e0c0(0x1aa),confirmText[_0x11e0c0(0x1ae)]=_0x11e0c0(0x27c),confirmActionButton[_0x11e0c0(0x252)]=!![],closeConfirmButton[_0x11e0c0(0x252)]=!![],teamCreationStatus[_0x11e0c0(0x1ae)]=_0x11e0c0(0x2b9),teamCreationProgressContainer['classList']['remove']('hidden'),teamCreationProgressBar[_0x11e0c0(0x278)][_0x11e0c0(0x250)]='0%',teamCreationProgressBar[_0x11e0c0(0x1ae)]='0%',resetTeamButton[_0x11e0c0(0x252)]=!![],createTeamButton[_0x11e0c0(0x252)]=!![];try{const _0x33db0a=writeBatch(db),_0x324423=allEmployeesData[_0x11e0c0(0x2a0)];let _0x1ac1cf=0x0;allEmployeesData['forEach'](_0x394aaa=>{const _0x88a73f=_0x11e0c0,_0x4c3761=doc(db,_0x88a73f(0x1cf),_0x394aaa['id']);_0x33db0a[_0x88a73f(0x1bc)](_0x4c3761,{'Check_Place':'','DateLogin':null}),_0x1ac1cf++;const _0x2baa84=Math['round'](_0x1ac1cf/_0x324423*0x64);teamCreationProgressBar['style'][_0x88a73f(0x250)]=_0x2baa84+'%',teamCreationProgressBar[_0x88a73f(0x1ae)]=_0x2baa84+'%';}),await _0x33db0a[_0x11e0c0(0x1da)](),confirmTitle[_0x11e0c0(0x1ae)]=_0x11e0c0(0x2e4),confirmText[_0x11e0c0(0x1ae)]=_0x11e0c0(0x1fa),confirmActionButton[_0x11e0c0(0x1a8)][_0x11e0c0(0x219)](_0x11e0c0(0x1f2)),closeConfirmButton['textContent']=_0x11e0c0(0x231),closeConfirmButton[_0x11e0c0(0x252)]=![],teamCreationStatus['textContent']=_0x11e0c0(0x297),console[_0x11e0c0(0x22e)](_0x11e0c0(0x216));}catch(_0x1c95fc){console[_0x11e0c0(0x2a4)](_0x11e0c0(0x1ba),_0x1c95fc),confirmTitle[_0x11e0c0(0x1ae)]=_0x11e0c0(0x202),confirmText[_0x11e0c0(0x1ae)]=_0x11e0c0(0x26a)+_0x1c95fc[_0x11e0c0(0x1db)],closeConfirmButton[_0x11e0c0(0x1ae)]=_0x11e0c0(0x231),closeConfirmButton[_0x11e0c0(0x252)]=![],teamCreationStatus[_0x11e0c0(0x1ae)]=_0x11e0c0(0x223)+_0x1c95fc[_0x11e0c0(0x1db)];}finally{resetTeamButton[_0x11e0c0(0x252)]=![],createTeamButton[_0x11e0c0(0x252)]=![];}},confirmTitle[_0x1023e4(0x1ae)]=_0x1023e4(0x246),confirmText[_0x1023e4(0x1ae)]=_0x1023e4(0x2a6),confirmActionButton[_0x1023e4(0x1ae)]=_0x1023e4(0x1f7),confirmActionButton[_0x1023e4(0x269)]=_0x1023e4(0x1fb),confirmActionButton['disabled']=![],confirmActionButton[_0x1023e4(0x1a8)][_0x1023e4(0x1c2)]('hidden'),confirmActionButton[_0x1023e4(0x1c1)]=()=>{typeof currentConfirmAction==='function'&&currentConfirmAction();},closeConfirmButton[_0x1023e4(0x1ae)]=_0x1023e4(0x20f),closeConfirmButton[_0x1023e4(0x252)]=![],closeConfirmButton[_0x1023e4(0x1a8)][_0x1023e4(0x1c2)](_0x1023e4(0x1f2)),confirmModal[_0x1023e4(0x1a8)][_0x1023e4(0x1c2)](_0x1023e4(0x1f2));}async function handleCreateTeam(){const _0x17fe09=_0x1db9d3;console['log'](_0x17fe09(0x244)),teamCreationStatus[_0x17fe09(0x1ae)]=_0x17fe09(0x284),teamCreationProgressContainer['classList'][_0x17fe09(0x1c2)]('hidden'),teamCreationProgressBar['style'][_0x17fe09(0x250)]='0%',teamCreationProgressBar['textContent']='0%',resetTeamButton['disabled']=!![],createTeamButton['disabled']=!![];const _0x1072a9=allEmployeesData['filter'](_0x571bb8=>_0x571bb8[_0x17fe09(0x20c)]&&_0x571bb8['Check_Manager'][_0x17fe09(0x2a8)]()!==''&&(!_0x571bb8[_0x17fe09(0x290)]||_0x571bb8['Check_Place'][_0x17fe09(0x2a8)]()==='')),_0xa5875f=_0x1072a9['length'];if(_0xa5875f===0x0){teamCreationStatus[_0x17fe09(0x1ae)]='ไม่พบพนักงานที่เข้าเงื่อนไข\x20(มี\x20Manager\x20และยังไม่มีทีม)\x20สำหรับจัดทีม',resetTeamButton['disabled']=![],createTeamButton[_0x17fe09(0x252)]=![];return;}const _0x3d83cd=Math[_0x17fe09(0x1b5)](_0xa5875f/teamSize),_0x4f0acc=teamNames[_0x17fe09(0x262)](0x0,_0x3d83cd),_0x234582=_0x4f0acc[_0x4f0acc[_0x17fe09(0x2a0)]-0x1];console[_0x17fe09(0x22e)](_0x17fe09(0x272)+_0xa5875f+'.\x20Need\x20'+_0x3d83cd+_0x17fe09(0x245)+_0x4f0acc['join'](',\x20'));const _0x2fd91b=_0x1072a9[_0x17fe09(0x19a)]((_0x1419a6,_0x3a802d)=>{const _0x1217eb=_0x17fe09,_0x538d57=_0x3a802d[_0x1217eb(0x20c)]||_0x1217eb(0x2d6);return _0x1419a6[_0x538d57]=(_0x1419a6[_0x538d57]||0x0)+0x1,_0x1419a6;},{});console[_0x17fe09(0x22e)](_0x17fe09(0x20d),_0x2fd91b);const _0x554acd=new Map(),_0x369b4b=[];_0x1072a9[_0x17fe09(0x2a1)](_0x8189f6=>{const _0x2b5afc=_0x17fe09,_0x27f741=_0x8189f6['Check_Manager']||'UNKNOWN';_0x2fd91b[_0x27f741]>_0x3d83cd?(!_0x554acd['has'](_0x27f741)&&_0x554acd['set'](_0x27f741,[]),_0x554acd[_0x2b5afc(0x2d9)](_0x27f741)[_0x2b5afc(0x230)](_0x8189f6)):_0x369b4b['push'](_0x8189f6);}),console[_0x17fe09(0x22e)](_0x17fe09(0x28f)+_0x554acd[_0x17fe09(0x27f)]),console['log']('Normal\x20group\x20employees\x20(initial):\x20'+_0x369b4b[_0x17fe09(0x2a0)]);const _0x3fcf57={};_0x4f0acc[_0x17fe09(0x2a1)](_0x5373a7=>{_0x3fcf57[_0x5373a7]={'members':[],'managers':{}};});const _0x30fafe={};let _0x2af87e=0x0;teamCreationStatus[_0x17fe09(0x1ae)]=_0x17fe09(0x2db);let _0x45b972=0x0;for(const [_0x3f4e54,_0x28d3be]of _0x554acd[_0x17fe09(0x28b)]()){console[_0x17fe09(0x22e)](_0x17fe09(0x218)+_0x3f4e54+'\x20('+_0x28d3be[_0x17fe09(0x2a0)]+'\x20members)'),shuffleArray(_0x28d3be);while(_0x28d3be[_0x17fe09(0x2a0)]>_0x3d83cd){const _0x3ce117=_0x28d3be[_0x17fe09(0x2a0)]>_0x3d83cd*0x2?0x2:0x1;console[_0x17fe09(0x22e)]('Distributing\x20N='+_0x3ce117+_0x17fe09(0x21a)+_0x3f4e54+_0x17fe09(0x29d)+_0x28d3be[_0x17fe09(0x2a0)]);for(let _0x47214e=0x0;_0x47214e<_0x3d83cd*_0x3ce117;_0x47214e++){if(_0x28d3be['length']===0x0)break;const _0x5a5bab=_0x28d3be[_0x17fe09(0x21d)]();let _0x5ad849=_0x4f0acc[_0x45b972],_0x527523=_0x3fcf57[_0x5ad849],_0x46014e=0x0;while(_0x5ad849!==_0x234582&&_0x527523['members'][_0x17fe09(0x2a0)]>=teamSize&&_0x46014e<_0x3d83cd){_0x45b972=(_0x45b972+0x1)%_0x3d83cd,_0x5ad849=_0x4f0acc[_0x45b972],_0x527523=_0x3fcf57[_0x5ad849],_0x46014e++;}_0x5ad849!==_0x234582&&_0x527523[_0x17fe09(0x18a)]['length']>=teamSize&&(_0x5ad849=_0x234582,_0x527523=_0x3fcf57[_0x234582]);_0x527523[_0x17fe09(0x18a)][_0x17fe09(0x230)](_0x5a5bab),_0x527523['managers'][_0x5a5bab['Check_Manager']]=(_0x527523[_0x17fe09(0x1f5)][_0x5a5bab[_0x17fe09(0x20c)]]||0x0)+0x1,_0x30fafe[_0x5a5bab['id']]=_0x5ad849,_0x2af87e++;const _0x44eef5=Math['round'](_0x2af87e/_0xa5875f*0x64);teamCreationProgressBar[_0x17fe09(0x278)][_0x17fe09(0x250)]=_0x44eef5+'%',teamCreationProgressBar[_0x17fe09(0x1ae)]=_0x44eef5+'%',_0x45b972=(_0x45b972+0x1)%_0x3d83cd;}}_0x28d3be[_0x17fe09(0x2a0)]>0x0&&(console[_0x17fe09(0x22e)](_0x17fe09(0x212)+_0x28d3be[_0x17fe09(0x2a0)]+_0x17fe09(0x1de)+_0x3f4e54+_0x17fe09(0x25d)),_0x369b4b[_0x17fe09(0x230)](..._0x28d3be));}console[_0x17fe09(0x22e)](_0x17fe09(0x2dd),JSON['parse'](JSON[_0x17fe09(0x193)](_0x3fcf57))),console[_0x17fe09(0x22e)](_0x17fe09(0x1b0)+_0x369b4b['length']),teamCreationStatus[_0x17fe09(0x1ae)]=_0x17fe09(0x2e0),shuffleArray(_0x369b4b);for(const _0x1048f0 of _0x369b4b){let _0x339e8a=![];const _0x9f459b=_0x1048f0[_0x17fe09(0x20c)]||'UNKNOWN';for(const _0x49be10 of _0x4f0acc){const _0x29ef34=_0x3fcf57[_0x49be10],_0x4a83ff=_0x49be10!==_0x234582&&_0x29ef34[_0x17fe09(0x18a)][_0x17fe09(0x2a0)]>=teamSize;if(!_0x4a83ff&&!_0x29ef34[_0x17fe09(0x1f5)][_0x9f459b]){_0x29ef34['members'][_0x17fe09(0x230)](_0x1048f0),_0x29ef34[_0x17fe09(0x1f5)][_0x9f459b]=0x1,_0x30fafe[_0x1048f0['id']]=_0x49be10,_0x339e8a=!![];break;}}if(!_0x339e8a)for(const _0x510867 of _0x4f0acc){const _0x47504e=_0x3fcf57[_0x510867],_0x1a4726=_0x510867!==_0x234582&&_0x47504e['members'][_0x17fe09(0x2a0)]>=teamSize;if(!_0x1a4726){_0x47504e[_0x17fe09(0x18a)][_0x17fe09(0x230)](_0x1048f0),_0x47504e['managers'][_0x9f459b]=(_0x47504e[_0x17fe09(0x1f5)][_0x9f459b]||0x0)+0x1,_0x30fafe[_0x1048f0['id']]=_0x510867,_0x339e8a=!![];break;}}if(_0x339e8a){_0x2af87e++;const _0x3a7494=Math['round'](_0x2af87e/_0xa5875f*0x64);teamCreationProgressBar['style']['width']=_0x3a7494+'%',teamCreationProgressBar[_0x17fe09(0x1ae)]=_0x3a7494+'%';}else console[_0x17fe09(0x2a4)](_0x17fe09(0x206),_0x1048f0);}console[_0x17fe09(0x22e)]('Finished\x20Rule\x203\x20&\x204.\x20Final\x20team\x20assignments:',_0x30fafe),console[_0x17fe09(0x22e)](_0x17fe09(0x2d2),_0x3fcf57);if(Object[_0x17fe09(0x1c8)](_0x30fafe)['length']>0x0){teamCreationStatus[_0x17fe09(0x1ae)]='กำลังบันทึกข้อมูลทีม...';try{const _0x22fd94=writeBatch(db);Object[_0x17fe09(0x1c8)](_0x30fafe)[_0x17fe09(0x2a1)](_0x58073f=>{const _0x2ff9fd=_0x30fafe[_0x58073f],_0x2d6b2f=doc(db,'crsg',_0x58073f);_0x22fd94['update'](_0x2d6b2f,{'Check_Place':_0x2ff9fd});}),await _0x22fd94[_0x17fe09(0x1da)](),_0x2af87e<_0xa5875f?(teamCreationStatus['textContent']=_0x17fe09(0x236)+_0x2af87e+'/'+_0xa5875f+').',console[_0x17fe09(0x2a4)]('Mismatch\x20in\x20assigned\x20count!')):teamCreationStatus[_0x17fe09(0x1ae)]=_0x17fe09(0x18d),console['log']('Teams\x20assignment\x20updated\x20successfully.'),displaySelectedTeamMembers();}catch(_0x2a9d78){console[_0x17fe09(0x2a4)](_0x17fe09(0x1af),_0x2a9d78),teamCreationStatus['textContent']='เกิดข้อผิดพลาดในการบันทึก:\x20'+_0x2a9d78[_0x17fe09(0x1db)];}finally{resetTeamButton[_0x17fe09(0x252)]=![],createTeamButton[_0x17fe09(0x252)]=![];}}else teamCreationStatus[_0x17fe09(0x1ae)]=_0x17fe09(0x2bb),resetTeamButton[_0x17fe09(0x252)]=![],createTeamButton[_0x17fe09(0x252)]=![];}function displaySelectedTeamMembers(){const _0x438757=_0x1db9d3,_0x4c6580=teamSelect[_0x438757(0x1e2)];selectedTeamTableBody[_0x438757(0x1ac)]='';if(!_0x4c6580){selectedTeamTableBody[_0x438757(0x1ac)]=_0x438757(0x1b1);return;}const _0x34fcea=allEmployeesData[_0x438757(0x2b0)](_0x3238b9=>_0x3238b9['Check_Place']===_0x4c6580);if(_0x34fcea[_0x438757(0x2a0)]===0x0){selectedTeamTableBody[_0x438757(0x1ac)]=_0x438757(0x1b2)+_0x4c6580+_0x438757(0x194);return;}_0x34fcea[_0x438757(0x286)]((_0x2a956c,_0x201e57)=>(_0x2a956c[_0x438757(0x256)]||'')[_0x438757(0x2ab)](_0x201e57[_0x438757(0x256)]||'')),_0x34fcea[_0x438757(0x2a1)]((_0xf45ba9,_0xc0764d)=>{const _0x5c4dac=_0x438757,_0x48303d=document[_0x5c4dac(0x1f3)]('tr');_0x48303d[_0x5c4dac(0x269)]=_0xc0764d%0x2===0x0?_0x5c4dac(0x24e):_0x5c4dac(0x2c8);const _0x317c98=!!_0xf45ba9[_0x5c4dac(0x2d8)];_0x48303d[_0x5c4dac(0x1ac)]=_0x5c4dac(0x2a3)+(_0xc0764d+0x1)+'</td>\x20<!--\x20(เพิ่ม)\x20ลำดับ\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0xf45ba9['employeeId']||'')+_0x5c4dac(0x263)+(_0xf45ba9[_0x5c4dac(0x256)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0xf45ba9[_0x5c4dac(0x1e4)]||'')+_0x5c4dac(0x2c3)+(_0xf45ba9[_0x5c4dac(0x20c)]||'')+'</td>\x20<!--\x20(เพิ่ม)\x20สังกัด\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x317c98?'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียนแล้ว</span>':_0x5c4dac(0x1ad))+_0x5c4dac(0x1a6);const _0x46faea=document[_0x5c4dac(0x1f3)](_0x5c4dac(0x2e5));_0x46faea[_0x5c4dac(0x1ae)]=_0x5c4dac(0x2b7),_0x46faea['className']=_0x5c4dac(0x18c),_0x46faea[_0x5c4dac(0x1c1)]=()=>showEditTeamMemberModal(_0xf45ba9),_0x48303d[_0x5c4dac(0x1fe)][0x6][_0x5c4dac(0x191)](_0x46faea),selectedTeamTableBody[_0x5c4dac(0x191)](_0x48303d);});}function showEditTeamMemberModal(_0x3a883c){const _0x4cf8c0=_0x1db9d3;console[_0x4cf8c0(0x22e)](_0x4cf8c0(0x1bd),_0x3a883c),currentEditingDocId=_0x3a883c['id'],editMemberEmpId[_0x4cf8c0(0x1ae)]=_0x3a883c[_0x4cf8c0(0x1ea)]||_0x4cf8c0(0x26d),editMemberEmpName['textContent']=_0x3a883c[_0x4cf8c0(0x256)]||_0x4cf8c0(0x26d),editMemberError['textContent']='',editMemberTeamSelect[_0x4cf8c0(0x1ac)]='';const _0x49adaa=document[_0x4cf8c0(0x1f3)]('option');_0x49adaa[_0x4cf8c0(0x1e2)]='',_0x49adaa[_0x4cf8c0(0x1ae)]=_0x4cf8c0(0x2ba),editMemberTeamSelect[_0x4cf8c0(0x191)](_0x49adaa),teamNames[_0x4cf8c0(0x2a1)](_0x37fa0e=>{const _0x16b2b6=_0x4cf8c0,_0x1d1508=document[_0x16b2b6(0x1f3)](_0x16b2b6(0x200));_0x1d1508[_0x16b2b6(0x1e2)]=_0x37fa0e,_0x1d1508[_0x16b2b6(0x1ae)]=_0x37fa0e,editMemberTeamSelect['appendChild'](_0x1d1508);}),editMemberTeamSelect[_0x4cf8c0(0x1e2)]=_0x3a883c['Check_Place']||'',editTeamMemberModal[_0x4cf8c0(0x1a8)][_0x4cf8c0(0x1c2)](_0x4cf8c0(0x1f2));}function closeEditTeamMemberModal(){const _0x4259f2=_0x1db9d3;editTeamMemberModal[_0x4259f2(0x1a8)][_0x4259f2(0x219)](_0x4259f2(0x1f2)),currentEditingDocId=null;}async function saveEditTeamMemberChanges(){const _0x5016bb=_0x1db9d3;if(!currentEditingDocId)return;const _0x1b8c3a=editMemberTeamSelect[_0x5016bb(0x1e2)];editMemberError[_0x5016bb(0x1ae)]='',saveEditMemberModalButton[_0x5016bb(0x252)]=!![],deleteEditMemberModalButton[_0x5016bb(0x252)]=!![],closeEditMemberModalButton['disabled']=!![];try{const _0x5820a6=doc(db,_0x5016bb(0x1cf),currentEditingDocId);await updateDoc(_0x5820a6,{'Check_Place':_0x1b8c3a}),console[_0x5016bb(0x22e)](_0x5016bb(0x281)),closeEditTeamMemberModal();}catch(_0x436387){console[_0x5016bb(0x2a4)](_0x5016bb(0x2ca),_0x436387),editMemberError[_0x5016bb(0x1ae)]=_0x5016bb(0x26a)+_0x436387['message'];}finally{saveEditMemberModalButton['disabled']=![],deleteEditMemberModalButton[_0x5016bb(0x252)]=![],closeEditMemberModalButton[_0x5016bb(0x252)]=![];}}function handleShowConfirmDeleteMember(){const _0x450522=_0x1db9d3;if(!currentEditingDocId)return;currentConfirmAction=async()=>{const _0x27842c=_0x58a5;console['log'](_0x27842c(0x2ac),currentEditingDocId),saveEditMemberModalButton[_0x27842c(0x252)]=!![],deleteEditMemberModalButton[_0x27842c(0x252)]=!![],closeEditMemberModalButton[_0x27842c(0x252)]=!![];try{const _0x4eed9e=doc(db,_0x27842c(0x1cf),currentEditingDocId);await updateDoc(_0x4eed9e,{'Check_Place':''}),console[_0x27842c(0x22e)](_0x27842c(0x243)),closeEditTeamMemberModal(),confirmModal[_0x27842c(0x1a8)]['add'](_0x27842c(0x1f2));}catch(_0x1cc616){console[_0x27842c(0x2a4)](_0x27842c(0x2e3),_0x1cc616),editMemberError[_0x27842c(0x1ae)]='เกิดข้อผิดพลาด:\x20'+_0x1cc616[_0x27842c(0x1db)],confirmModal[_0x27842c(0x1a8)][_0x27842c(0x219)](_0x27842c(0x1f2));}finally{saveEditMemberModalButton[_0x27842c(0x252)]=![],deleteEditMemberModalButton[_0x27842c(0x252)]=![],closeEditMemberModalButton[_0x27842c(0x252)]=![],currentConfirmAction=null;}},confirmTitle[_0x450522(0x1ae)]=_0x450522(0x258),confirmText[_0x450522(0x1ae)]=_0x450522(0x21b)+editMemberEmpName[_0x450522(0x1ae)]+_0x450522(0x24f),confirmActionButton['textContent']=_0x450522(0x2b3),confirmActionButton['className']=_0x450522(0x1fb),confirmActionButton[_0x450522(0x252)]=![],confirmActionButton[_0x450522(0x1a8)]['remove']('hidden'),confirmActionButton[_0x450522(0x1c1)]=()=>{typeof currentConfirmAction==='function'&&currentConfirmAction();},closeConfirmButton[_0x450522(0x1ae)]=_0x450522(0x20f),closeConfirmButton[_0x450522(0x252)]=![],closeConfirmButton[_0x450522(0x1a8)][_0x450522(0x1c2)](_0x450522(0x1f2)),confirmModal['classList']['remove']('hidden');}function _0x435a(){const _0x4a452e=['<span\x20class=\x22text-xl\x20font-bold\x20text-gray-900\x22>','ชื่อเล่น','replace','รีเซ็ตข้อมูลทีมและสถานะลงทะเบียนสำเร็จ!','latestRegistrationsTableBody','contains','ttb-register.firebasestorage.app','escape','dashboard-content','.\x20Remaining:\x20','removeChild','18mPHmMN','length','forEach','สายงาน\x20(Department_th)','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22>','error','ไม่เหลือผู้เข้าร่วมกิจกรรมให้สุ่มแล้ว','คุณต้องการลบข้อมูลทีม\x20(Check_Place)\x20และสถานะการลงทะเบียน\x20(DateLogin)\x20ของพนักงานทั้งหมดหรือไม่?\x20(ข้อมูลพนักงานจะไม่ถูกลบ)','6SztSdj','trim','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','เป้าหมายที่เหลือ','localeCompare','Deleting\x20(blanking)\x20member:','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','hover:bg-gray-50','วันที่\x20','filter','2646564gwXCrf','saveAddMemberModalButton','ยืนยัน','th-TH','63052TcAmAH','</td>\x20<!--\x20(แก้ไข)\x20นี่คือ\x20\x22สังกัด\x22\x20(Check_Manager)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','แก้ไข','registrationBreakdownChart','กำลังรีเซ็ตข้อมูลทีมและสถานะลงทะเบียน...','--\x20ไม่ระบุทีม\x20--','ไม่มีพนักงานที่ต้องจัดทีมใหม่','รหัส:\x20','join','closeGroupViewModalButton','text-gray-500','<tr><td\x20colspan=\x224\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>ยังไม่มีผู้ได้รับการสุ่ม</td></tr>','participantsCountBox','addMemberError','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>',']\x20ใช่หรือไม่?\x20(พนักงานจะกลับเข้าไปอยู่ในกลุ่มที่สุ่มได้อีกครั้ง)','bg-orange-100','<p\x20class=\x22text-red-600\x20text-center\x20text-lg\x20mt-10\x22>เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','map','bg-gray-100','closeEditModalButton','Error\x20saving\x20team\x20member\x20changes:','รหัสพนักงาน','bg-red-100','employeeListTableBody','teamBoxesContainer','numeric','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ยังไม่มีผู้ลงทะเบียน</td></tr>','chart','Final\x20teams\x20status:','confirmModal','randomizeButton','digit4','UNKNOWN','text/csv;charset=utf-8;','DateLogin','get','body','กำลังจัดสรรกลุ่มใหญ่\x20(Rule\x202)...','querySelectorAll','Finished\x20Rule\x202.\x20Teams\x20status:','2-digit','from','กำลังจัดสรรกลุ่มปกติ\x20(Rule\x203)...','toLocaleString','download','Error\x20deleting\x20(blanking)\x20team\x20member:','สำเร็จ','button','NO_MANAGER','\x20rounded-b-lg\x22>\x20<!--\x20(แก้ไข)\x20พื้นหลังขาว\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','href','members','1070273157855','text-white\x20bg-orange-500\x20hover:bg-orange-600\x20text-xs\x20py-1\x20px-3\x20rounded\x20shadow','สร้างทีมสำเร็จ!','editEmpName','winnerDetailModal','สายงาน:\x20','appendChild','toMillis','stringify','</td></tr>','data','random','click','#3B82F6','groupViewTableBody','reduce','text-gray-700','กลุ่ม\x20(BU)','editMemberError','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','dataIndex','80%','digit1','Position_th','tab-register','#2563EB','bg-orange-200','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x20<!--\x20(เพิ่ม)\x20Cell\x20ใหม่สำหรับปุ่ม\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','ทีม\x20(Check_Place)','classList','startRandomizeButton','กำลังดำเนินการ...','Invalid\x20employee\x20data\x20for\x20cancel\x20registration.','innerHTML','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>','textContent','Error\x20updating\x20team\x20assignments:\x20','Normal\x20group\x20employees\x20(final):\x20','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>กรุณาเลือกทีม</td></tr>','<tr><td\x20colspan=\x227\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ไม่พบสมาชิกในทีม\x20','\x20rounded-t-lg\x22>\x20<!--\x20(แก้ไข)\x20พื้นหลังเทา\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xl\x20font-bold\x20text-blue-700\x20text-center\x22>ทีม\x20','searchEmployeeError','ceil','doughnut','กรุณาใส่รหัสพนักงาน','option[value=\x22NO_MANAGER\x22]','querySelector','Error\x20resetting\x20teams:\x20','border-transparent','update','Editing\x20team\x20member:','bg-green-100','--\x20ไม่ระบุสังกัด\x20--','ผู้ร่วมงาน','onclick','remove','editError','Registration\x20canceled\x20successfully.','1710lOTYAf','option[value=\x22','</td>\x20<!--\x20(แก้ไข)\x20ใช้\x20FullName_th\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','keys','confirmActionButton','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20(เพิ่ม)\x20Cell\x20สำหรับปุ่มลบ\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20text-center\x22></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','editEmpId','docId','สังกัด\x20(Check_Manager)','G-9DJLWJ5LQ1','crsg','closeWinnerModalButton','Error\x20saving\x20employee\x20changes:','219714rzcJJA','datasets','groupViewModalTitle','dataset','total','managerFilterSelect','https://ttb-register-default-rtdb.asia-southeast1.firebasedate.app','createObjectURL','commit','message','#E5E7EB','find','\x20from\x20','\x20คน','เวลาที่ลงทะเบียน','addEventListener','value','randomizeModal','BU_th','center','tab-team-list','warn','div','breakdownCenterTotal','employeeId',']\x20หรือไม่?\x20(สถานะจะเปลี่ยนเป็น\x20\x27ยังไม่ลงทะเบียน\x27)','CRSG_Registered_Users_','digit2','ttb-register.firebaseapp.com','modalParticipantsCount','drawnWinnersTableBody','bar','hidden','createElement','closeAddMemberModalButton','managers','ttb-register','ยืนยัน\x20Reset\x20Team','label','</p>\x20<!--\x20(แก้ไข)\x20เพิ่ม\x20\x22ทีม\x22,\x20\x22text-xl\x22\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22p-4\x20text-center\x20','ดำเนินการเสร็จแล้ว','px-3\x20py-1.5\x20text-xs\x20bg-red-600\x20text-white\x20rounded-md\x20hover:bg-red-700','saveEditModalButton','teamBarChart1','cells','searchEmployeeIdInput','option','toLocaleDateString','เกิดข้อผิดพลาด','<tr><td\x20colspan=\x226\x22\x20class=\x22p-6\x20text-center\x20text-gray-500\x22>ไม่พบข้อมูลพนักงานสำหรับสังกัด:\x20','ทีม:\x20','#BFDBFE','Could\x20not\x20assign\x20employee\x20(all\x20teams\x20full?):','teamCreationProgressBar','toDate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22p-3\x20text-center\x20','digit3','Error\x20updating\x20RandomTime:\x20','Check_Manager','Manager\x20counts:','tab-dashboard','ไม่','\x20<!--\x20(แก้ไข)\x20ใช้ตัวแปร\x20countText\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20text-center\x20mt-1\x22>สมาชิก</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Debug','Adding\x20remaining\x20','Employee\x20data\x20updated\x20successfully.','Admin\x20Signed\x20in\x20anonymously','setAttribute','Teams\x20and\x20login\x20status\x20reset\x20successfully.','addMemberTeamSelect','Processing\x20Large\x20Group:\x20','add','\x20for\x20','คุณต้องการยกเลิกการเป็นสมาชิกทีมของ\x20[','border-blue-600','pop','RandomTime','tab-group-view','editEmployeeModal','end','editMemberTeamSelect','เกิดข้อผิดพลาดในการรีเซ็ต:\x20','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','NickName','addMemberEmpBU','backgroundColor','targetCount','editMemberEmpName','change','editEmpManager','toLocaleTimeString','log','registrationDonutChart','push','ปิดหน้าต่าง','ยังไม่ลงทะเบียน','createTeamButton','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x22>','group-view-content','สร้างทีมสำเร็จบางส่วน\x20(','</td>\x20<!--\x20(แก้ไข)\x20นี่คือ\x20\x22กลุ่ม\x22\x20(BU_th)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','Firebase\x20initialization\x20failed:','1148127JZDSnE','bottom','</span>','#10B981','hover:border-gray-300','362118yeOSet','max','#93C5FD','parsed','Error\x20listening\x20to\x20snapshot:\x20','Team\x20member\x20fields\x20blanked\x20successfully.','Creating\x20teams\x20based\x20on\x20new\x20rules...','\x20teams:\x20','ยืนยันการ\x20Reset\x20Team','00000','cancelWinnerButton','getElementById','digit5','CSV\x20Download\x20triggered.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','groupViewModal','bg-white',']\x20หรือไม่?\x20(ข้อมูล\x20ทีม\x20จะถูกล้างค่า)','width','employee-list-content','disabled','Department_th','bg-gray-300','Generating\x20CSV...','FullName_th','toFixed','ยืนยันการยกเลิกการเป็นสมาชิกทีม','</td>\x20<!--\x20(เพิ่ม)\x20นี่คือ\x20\x22ทีม\x22\x20(Check_Place)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<!--\x20(ลบ)\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','short','เวลาที่สุ่ม\x20(RandomTime)','indexOf','\x20to\x20normal\x20group.','bg-red-200','3376488CKPFwP','winnerBU','80dVJkSF','slice','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x20font-medium\x22>','floor','saveEditMemberModalButton','currentDateTime','function','ชื่อ-นามสกุล','className','เกิดข้อผิดพลาด:\x20','จำนวนผู้เข้าร่วม','selectedTeamTableBody','N/A','#ffffff','labels','</span><span\x20class=\x22text-xl\x20font-bold\x20text-gray-400\x22>\x20/\x20','119ioRKdE','Total\x20to\x20assign:\x20','closeEditMemberModalButton','ใช่,\x20ยืนยันยกเลิก','donutPercentage','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-2\x20whitespace-nowrap\x22>','randomizeError','style','</p>','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียนแล้ว</span>','ผู้เข้าร่วมกิจกรรม','กำลังลบข้อมูล\x20....','registered','managerEmployeeCount','size','\x20เวลา\x20','Team\x20member\x20team\x20updated\x20successfully.','คุณต้องการยกเลิกการลงทะเบียนของ\x20[','winnerEmployeeId','กำลังเตรียมข้อมูล...','padStart','sort','Canceling\x20registration\x20for:','includes','#6b7280','addMemberModal','entries','278116dyzMnB','</td>\x20-->\x20<!--\x20(ลบ)\x20-->\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>','\x20with\x20RandomTime:','Large\x20group\x20managers:\x20','Check_Place','attendeesCount','getContext','ลบรายการ'];_0x435a=function(){return _0x4a452e;};return _0x435a();}function setupEditTeamMemberModalListeners(){const _0x155ccf=_0x1db9d3;closeEditMemberModalButton[_0x155ccf(0x1e1)](_0x155ccf(0x197),closeEditTeamMemberModal),saveEditMemberModalButton['addEventListener'](_0x155ccf(0x197),saveEditTeamMemberChanges),deleteEditMemberModalButton[_0x155ccf(0x1e1)]('click',handleShowConfirmDeleteMember);}function updateGroupView(_0x245419){const _0x46c0d0=_0x1db9d3;teamBoxesContainer[_0x46c0d0(0x1ac)]='';const _0x4e467f=groupViewManagerFilter[_0x46c0d0(0x1e2)],_0x4edcd5=_0x4e467f?_0x245419['filter'](_0x285368=>{const _0xc53bd3=_0x46c0d0;if(_0x4e467f===_0xc53bd3(0x2e6))return!_0x285368['Check_Manager']||_0x285368['Check_Manager'][_0xc53bd3(0x2a8)]()==='';return _0x285368[_0xc53bd3(0x20c)]===_0x4e467f;}):_0x245419,_0x778066=teamNames[_0x46c0d0(0x19a)]((_0x155431,_0x4dc7ee)=>{return _0x155431[_0x4dc7ee]={'total':0x0,'registered':0x0},_0x155431;},{});let _0x2754df=0x0;_0x4edcd5[_0x46c0d0(0x2a1)](_0x3665cf=>{const _0x5603df=_0x46c0d0,_0x9155af=_0x3665cf[_0x5603df(0x290)];if(_0x9155af&&teamNames['includes'](_0x9155af))_0x778066[_0x9155af][_0x5603df(0x1d6)]++,_0x3665cf[_0x5603df(0x2d8)]&&_0x778066[_0x9155af][_0x5603df(0x27d)]++;else(!_0x9155af||_0x9155af[_0x5603df(0x2a8)]()==='')&&_0x2754df++;}),teamNames['forEach'](_0x3aa7e0=>{const _0x29877c=_0x46c0d0,_0x2e2b8e=_0x778066[_0x3aa7e0],_0x178098=_0x2e2b8e['total'],_0x53355b=_0x2e2b8e[_0x29877c(0x27d)],_0xf3a8eb=document['createElement'](_0x29877c(0x1e8));_0xf3a8eb['className']='rounded-lg\x20shadow-sm\x20border\x20border-gray-200\x20cursor-pointer\x20hover:shadow-md\x20transition-shadow\x20overflow-hidden';let _0x38e50c=_0x29877c(0x2c8),_0x24a94c='bg-white',_0x6bc363;if(_0x53355b>0x0&&_0x53355b===_0x178098)_0x38e50c='bg-green-200',_0x24a94c=_0x29877c(0x1be),_0x6bc363=_0x29877c(0x294)+_0x53355b+_0x29877c(0x270)+_0x178098+'</span>';else _0x53355b>0x0&&_0x53355b<_0x178098?(_0x53355b<=0x5?(_0x38e50c=_0x29877c(0x25e),_0x24a94c=_0x29877c(0x2cc)):(_0x38e50c=_0x29877c(0x1a5),_0x24a94c=_0x29877c(0x2c5)),_0x6bc363=_0x29877c(0x294)+_0x53355b+_0x29877c(0x270)+_0x178098+_0x29877c(0x23b)):_0x6bc363='<p\x20class=\x22text-xl\x20font-bold\x20text-gray-900\x20text-center\x22>'+_0x178098+_0x29877c(0x279);_0xf3a8eb['innerHTML']=_0x29877c(0x209)+_0x38e50c+_0x29877c(0x1b3)+_0x3aa7e0+_0x29877c(0x1f9)+_0x24a94c+_0x29877c(0x188)+_0x6bc363+_0x29877c(0x210),_0xf3a8eb[_0x29877c(0x1e1)](_0x29877c(0x197),()=>showGroupViewModal(_0x3aa7e0,_0x245419)),teamBoxesContainer[_0x29877c(0x191)](_0xf3a8eb);}),teamNames['length']===0x0&&(teamBoxesContainer['innerHTML']='<p\x20class=\x22text-gray-500\x22>ไม่พบข้อมูลทีม</p>');}function showGroupViewModal(_0x35a0b2,_0x109dea){const _0x3ec019=_0x1db9d3;groupViewModalTitle[_0x3ec019(0x1ae)]='สมาชิกในทีม\x20'+_0x35a0b2,groupViewTableBody[_0x3ec019(0x1ac)]='';const _0x2211c3=_0x109dea[_0x3ec019(0x2b0)](_0x528624=>_0x528624[_0x3ec019(0x290)]===_0x35a0b2);if(_0x2211c3['length']===0x0){groupViewTableBody[_0x3ec019(0x1ac)]=_0x3ec019(0x1b2)+_0x35a0b2+_0x3ec019(0x194),groupViewModal[_0x3ec019(0x1a8)]['remove']('hidden');return;}_0x2211c3[_0x3ec019(0x286)]((_0x3b95bb,_0x291e40)=>{const _0x22033d=_0x3ec019,_0x22c56e=_0x3b95bb[_0x22033d(0x20c)]||'',_0x13ebd3=_0x291e40[_0x22033d(0x20c)]||'',_0x354485=_0x3b95bb[_0x22033d(0x256)]||'',_0x4bc1f0=_0x291e40[_0x22033d(0x256)]||'';if(_0x22c56e<_0x13ebd3)return-0x1;if(_0x22c56e>_0x13ebd3)return 0x1;return _0x354485[_0x22033d(0x2ab)](_0x4bc1f0);}),_0x2211c3['forEach']((_0x2aa10c,_0x1fecbe)=>{const _0x35999f=_0x3ec019,_0x46456f=document[_0x35999f(0x1f3)]('tr');_0x46456f['className']=_0x1fecbe%0x2===0x0?'bg-white':_0x35999f(0x2c8);const _0x17478b=!!_0x2aa10c[_0x35999f(0x2d8)];_0x46456f[_0x35999f(0x1ac)]=_0x35999f(0x2a3)+(_0x1fecbe+0x1)+_0x35999f(0x2c3)+(_0x2aa10c[_0x35999f(0x1ea)]||'')+_0x35999f(0x263)+(_0x2aa10c[_0x35999f(0x256)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x2aa10c['BU_th']||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-4\x20py-3\x20whitespace-nowrap\x22>'+(_0x2aa10c[_0x35999f(0x20c)]||'')+_0x35999f(0x225)+(_0x17478b?_0x35999f(0x27a):_0x35999f(0x1ad))+_0x35999f(0x2ad);const _0x451072=document['createElement'](_0x35999f(0x2e5));_0x451072[_0x35999f(0x1ae)]=_0x35999f(0x2b7),_0x451072[_0x35999f(0x269)]=_0x35999f(0x18c),_0x451072['onclick']=()=>showEditTeamMemberModal(_0x2aa10c),_0x46456f['cells'][0x6][_0x35999f(0x191)](_0x451072),groupViewTableBody[_0x35999f(0x191)](_0x46456f);}),groupViewModal[_0x3ec019(0x1a8)][_0x3ec019(0x1c2)]('hidden');}function setupGroupViewListeners(){const _0x46bc4f=_0x1db9d3;closeGroupViewModalButton[_0x46bc4f(0x1e1)](_0x46bc4f(0x197),()=>{const _0x424949=_0x46bc4f;groupViewModal['classList'][_0x424949(0x219)](_0x424949(0x1f2));}),groupViewManagerFilter[_0x46bc4f(0x1e1)](_0x46bc4f(0x22b),()=>updateGroupView(allEmployeesData));}function showConfirmCancelRegistration(_0x5a7f4d){const _0x1415e1=_0x1db9d3;if(!_0x5a7f4d||!_0x5a7f4d['id']){console[_0x1415e1(0x2a4)](_0x1415e1(0x1ab));return;}currentConfirmAction=async()=>{const _0x9cd057=_0x1415e1;console[_0x9cd057(0x22e)](_0x9cd057(0x287),_0x5a7f4d[_0x9cd057(0x256)]),confirmActionButton['disabled']=!![],closeConfirmButton[_0x9cd057(0x252)]=!![];try{const _0x539e92=doc(db,_0x9cd057(0x1cf),_0x5a7f4d['id']);await updateDoc(_0x539e92,{'DateLogin':null}),console[_0x9cd057(0x22e)](_0x9cd057(0x1c4)),confirmModal[_0x9cd057(0x1a8)][_0x9cd057(0x219)](_0x9cd057(0x1f2));}catch(_0x340030){console[_0x9cd057(0x2a4)]('Error\x20canceling\x20registration:',_0x340030),confirmText[_0x9cd057(0x1ae)]=_0x9cd057(0x26a)+_0x340030[_0x9cd057(0x1db)],confirmActionButton['disabled']=![],closeConfirmButton[_0x9cd057(0x252)]=![];}finally{currentConfirmAction=null;}},confirmTitle['textContent']='ยืนยันการยกเลิกการลงทะเบียน',confirmText[_0x1415e1(0x1ae)]=_0x1415e1(0x282)+_0x5a7f4d[_0x1415e1(0x256)]+_0x1415e1(0x1eb),confirmActionButton['textContent']='ยกเลิกการลงทะเบียน',confirmActionButton[_0x1415e1(0x269)]=_0x1415e1(0x1fb),confirmActionButton[_0x1415e1(0x252)]=![],confirmActionButton['classList'][_0x1415e1(0x1c2)](_0x1415e1(0x1f2)),confirmActionButton['onclick']=()=>{const _0x512a8d=_0x1415e1;typeof currentConfirmAction===_0x512a8d(0x267)&&currentConfirmAction();},closeConfirmButton[_0x1415e1(0x1ae)]=_0x1415e1(0x231),closeConfirmButton[_0x1415e1(0x252)]=![],closeConfirmButton[_0x1415e1(0x1a8)][_0x1415e1(0x1c2)](_0x1415e1(0x1f2)),confirmModal[_0x1415e1(0x1a8)][_0x1415e1(0x1c2)](_0x1415e1(0x1f2));}function updateRandomizerDataBasedOnAllEmployees(){const _0x52f289=_0x1db9d3;currentParticipants=allEmployeesData[_0x52f289(0x2b0)](_0x569095=>_0x569095[_0x52f289(0x2d8)]&&_0x569095[_0x52f289(0x290)]&&_0x569095[_0x52f289(0x290)][_0x52f289(0x2a8)]()!==''),availableToDraw=currentParticipants[_0x52f289(0x2b0)](_0x4d9855=>!_0x4d9855[_0x52f289(0x21e)]),alreadyDrawn=currentParticipants[_0x52f289(0x2b0)](_0xe46e0b=>_0xe46e0b[_0x52f289(0x21e)]),randomizeError[_0x52f289(0x1ae)]='';}function updateModalUI(){const _0x5e7347=_0x1db9d3;modalParticipantsCount['textContent']=availableToDraw[_0x5e7347(0x2a0)],modalDrawnCount[_0x5e7347(0x1ae)]=alreadyDrawn[_0x5e7347(0x2a0)],renderDrawnWinnersTable(),startRandomizeButton[_0x5e7347(0x252)]=availableToDraw[_0x5e7347(0x2a0)]===0x0;}function _0x58a5(_0x5e4588,_0x14e6b4){const _0x435a7e=_0x435a();return _0x58a5=function(_0x58a5cb,_0x28db5e){_0x58a5cb=_0x58a5cb-0x188;let _0x1a1231=_0x435a7e[_0x58a5cb];return _0x1a1231;},_0x58a5(_0x5e4588,_0x14e6b4);}function renderDrawnWinnersTable(){const _0x14cf45=_0x1db9d3;drawnWinnersTableBody[_0x14cf45(0x1ac)]='';if(alreadyDrawn[_0x14cf45(0x2a0)]===0x0){drawnWinnersTableBody['innerHTML']=_0x14cf45(0x2c0);return;}alreadyDrawn['sort']((_0x5894ce,_0x2ecc78)=>(_0x2ecc78[_0x14cf45(0x21e)]?_0x2ecc78['RandomTime'][_0x14cf45(0x208)]():0x0)-(_0x5894ce[_0x14cf45(0x21e)]?_0x5894ce['RandomTime']['toDate']():0x0)),alreadyDrawn['forEach'](_0xbe317d=>{const _0x1ba3f8=_0x14cf45,_0x2ab61b=document[_0x1ba3f8(0x1f3)]('tr');_0x2ab61b[_0x1ba3f8(0x269)]=_0x1ba3f8(0x2ae);const _0x41e52f=document['createElement']('button');_0x41e52f['textContent']='ยกเลิก',_0x41e52f['className']='text-red-600\x20hover:text-red-800\x20text-xs\x20py-1\x20px-2\x20rounded',_0x41e52f['onclick']=()=>handleShowConfirmCancelRandom(_0xbe317d['id'],_0xbe317d[_0x1ba3f8(0x256)]),_0x2ab61b[_0x1ba3f8(0x1ac)]=_0x1ba3f8(0x234)+(_0xbe317d[_0x1ba3f8(0x1ea)]||'')+_0x1ba3f8(0x276)+(_0xbe317d[_0x1ba3f8(0x256)]||'')+_0x1ba3f8(0x276)+(_0xbe317d['BU_th']||'')+_0x1ba3f8(0x2a9),_0x2ab61b[_0x1ba3f8(0x1fe)][0x3][_0x1ba3f8(0x191)](_0x41e52f),drawnWinnersTableBody['appendChild'](_0x2ab61b);});}async function updateRandomTime(_0x332bbb,_0x3180b6){const _0x450af9=_0x1db9d3;if(!_0x332bbb)return;console[_0x450af9(0x22e)]('Updating\x20doc\x20'+_0x332bbb+_0x450af9(0x28e),_0x3180b6);try{const _0x357f4f=doc(db,_0x450af9(0x1cf),_0x332bbb);await updateDoc(_0x357f4f,{'RandomTime':_0x3180b6}),console[_0x450af9(0x22e)]('Update\x20successful');}catch(_0x4f2afd){console[_0x450af9(0x2a4)](_0x450af9(0x20b),_0x4f2afd),randomizeError[_0x450af9(0x1ae)]='เกิดข้อผิดพลาดในการอัปเดต:\x20'+_0x4f2afd[_0x450af9(0x1db)];}}function handleShowConfirmCancelRandom(_0x2f5427,_0x1de984){const _0x442678=_0x1db9d3;docIdToCancel=_0x2f5427,currentConfirmAction=async()=>{const _0x169034=_0x58a5;await updateRandomTime(docIdToCancel,null),docIdToCancel=null,confirmModal['classList'][_0x169034(0x219)]('hidden'),!winnerDetailModal['classList']['contains'](_0x169034(0x1f2))&&winnerDetailModal[_0x169034(0x1a8)][_0x169034(0x219)](_0x169034(0x1f2));},confirmTitle['textContent']='ยืนยันการยกเลิกการสุ่ม',confirmText[_0x442678(0x1ae)]='คุณต้องการยกเลิกการสุ่มของ\x20['+_0x1de984+_0x442678(0x2c4),confirmActionButton[_0x442678(0x1ae)]=_0x442678(0x274),confirmActionButton[_0x442678(0x269)]=_0x442678(0x1fb),confirmActionButton['disabled']=![],confirmActionButton[_0x442678(0x1a8)][_0x442678(0x1c2)](_0x442678(0x1f2)),confirmActionButton[_0x442678(0x1c1)]=()=>{const _0x2d41a0=_0x442678;typeof currentConfirmAction===_0x2d41a0(0x267)&&currentConfirmAction();},closeConfirmButton['textContent']=_0x442678(0x20f),closeConfirmButton['disabled']=![],closeConfirmButton[_0x442678(0x1a8)][_0x442678(0x1c2)](_0x442678(0x1f2)),confirmModal[_0x442678(0x1a8)][_0x442678(0x1c2)](_0x442678(0x1f2));}async function handleRandomization(){const _0x2a026d=_0x1db9d3;if(availableToDraw[_0x2a026d(0x2a0)]===0x0){randomizeError[_0x2a026d(0x1ae)]=_0x2a026d(0x2a5);return;}startRandomizeButton[_0x2a026d(0x252)]=!![],randomizeError[_0x2a026d(0x1ae)]='';let _0x1b4a84=0x0;randomizationInterval=setInterval(()=>{const _0x5277d3=_0x2a026d;digits['forEach'](_0x4075ef=>{const _0x3dfcdf=_0x58a5;_0x4075ef[_0x3dfcdf(0x1ae)]=Math[_0x3dfcdf(0x264)](Math[_0x3dfcdf(0x196)]()*0xa);}),_0x1b4a84++;if(_0x1b4a84>0x14){clearInterval(randomizationInterval);const _0x336eff=availableToDraw[Math[_0x5277d3(0x264)](Math['random']()*availableToDraw['length'])],_0x5acc75=(_0x336eff[_0x5277d3(0x1ea)]||_0x5277d3(0x247))[_0x5277d3(0x262)](-0x5)[_0x5277d3(0x285)](0x5,'0');digits[_0x5277d3(0x2a1)]((_0x144ca3,_0x47911e)=>_0x144ca3['textContent']=_0x5acc75[_0x47911e]),updateRandomTime(_0x336eff['id'],serverTimestamp())['then'](()=>{const _0xd85963=_0x5277d3;winnerName['textContent']=_0x336eff[_0xd85963(0x256)]||_0xd85963(0x26d),winnerEmployeeId[_0xd85963(0x1ae)]=_0xd85963(0x2bc)+(_0x336eff[_0xd85963(0x1ea)]||_0xd85963(0x26d)),winnerTeam[_0xd85963(0x1ae)]=_0xd85963(0x204)+(_0x336eff['Check_Place']||'N/A'),winnerBU[_0xd85963(0x1ae)]=_0xd85963(0x190)+(_0x336eff['BU_th']||'N/A'),cancelWinnerButton['dataset'][_0xd85963(0x1cc)]=_0x336eff['id'],winnerDetailModal['classList'][_0xd85963(0x1c2)]('hidden'),startRandomizeButton['disabled']=![];});}},0x64);}async function handleCancelWinner(){const _0x1e4a37=_0x1db9d3,_0x250661=cancelWinnerButton['dataset'][_0x1e4a37(0x1cc)],_0x85d6e6=alreadyDrawn[_0x1e4a37(0x1dd)](_0x601a46=>_0x601a46['id']===_0x250661);handleShowConfirmCancelRandom(_0x250661,_0x85d6e6?.[_0x1e4a37(0x256)]||_0x1e4a37(0x26d));}function setupModalListeners(){const _0x5c2c52=_0x1db9d3;randomizeButton[_0x5c2c52(0x1e1)](_0x5c2c52(0x197),()=>{const _0x141951=_0x5c2c52;updateRandomizerDataBasedOnAllEmployees(),updateModalUI(),randomizeModal[_0x141951(0x1a8)]['remove'](_0x141951(0x1f2));}),closeRandomizeModalButton[_0x5c2c52(0x1e1)](_0x5c2c52(0x197),()=>{const _0x54162c=_0x5c2c52;randomizeModal[_0x54162c(0x1a8)]['add'](_0x54162c(0x1f2));}),startRandomizeButton[_0x5c2c52(0x1e1)](_0x5c2c52(0x197),handleRandomization),closeWinnerModalButton[_0x5c2c52(0x1e1)](_0x5c2c52(0x197),()=>{const _0x23371c=_0x5c2c52;winnerDetailModal[_0x23371c(0x1a8)][_0x23371c(0x219)](_0x23371c(0x1f2));}),cancelWinnerButton['addEventListener'](_0x5c2c52(0x197),handleCancelWinner),closeConfirmButton[_0x5c2c52(0x1e1)](_0x5c2c52(0x197),()=>{const _0x40b899=_0x5c2c52;confirmModal[_0x40b899(0x1a8)][_0x40b899(0x219)](_0x40b899(0x1f2)),confirmTitle[_0x40b899(0x1ae)]=_0x40b899(0x2b3),confirmText[_0x40b899(0x1ae)]='',confirmActionButton['disabled']=![],confirmActionButton[_0x40b899(0x1a8)]['remove'](_0x40b899(0x1f2)),closeConfirmButton[_0x40b899(0x1ae)]='ไม่',closeConfirmButton[_0x40b899(0x252)]=![],currentConfirmAction=null,docIdToCancel=null;}),downloadCsvButton['addEventListener'](_0x5c2c52(0x197),handleDownloadCSV);}function setupTeamTabListeners(){const _0x29b9bf=_0x1db9d3;resetTeamButton['addEventListener']('click',handleResetTeam),createTeamButton['addEventListener']('click',handleCreateTeam),teamSelect[_0x29b9bf(0x1e1)](_0x29b9bf(0x22b),displaySelectedTeamMembers);}function setupEmployeeListListeners(){const _0x55ce0e=_0x1db9d3;managerFilterSelect[_0x55ce0e(0x1e1)](_0x55ce0e(0x22b),()=>{updateEmployeeListTable(allEmployeesData);}),closeEditModalButton[_0x55ce0e(0x1e1)](_0x55ce0e(0x197),closeEditModal),saveEditModalButton[_0x55ce0e(0x1e1)](_0x55ce0e(0x197),saveEmployeeChanges);}function populateManagerFilter(_0x1c5e0b){const _0x3d73b6=_0x1db9d3,_0x34cb2f=managerFilterSelect['value'],_0x49d39b=managerFilterSelect[_0x3d73b6(0x2dc)](_0x3d73b6(0x200));_0x49d39b[_0x3d73b6(0x2a1)](_0x8fa8ec=>{const _0x55cf6e=_0x3d73b6;_0x8fa8ec[_0x55cf6e(0x1e2)]!==''&&_0x8fa8ec[_0x55cf6e(0x1c2)]();});const _0x157d61=Array[_0x3d73b6(0x2df)](_0x1c5e0b)[_0x3d73b6(0x286)]();_0x157d61[_0x3d73b6(0x2a1)](_0x532247=>{const _0x2c4fb6=_0x3d73b6;if(_0x532247&&_0x532247[_0x2c4fb6(0x2a8)]()!==''){const _0x47495a=document[_0x2c4fb6(0x1f3)](_0x2c4fb6(0x200));_0x47495a[_0x2c4fb6(0x1e2)]=_0x532247,_0x47495a['textContent']=_0x532247,managerFilterSelect['appendChild'](_0x47495a);}});if(_0x34cb2f&&managerFilterSelect[_0x3d73b6(0x1b9)](_0x3d73b6(0x1c6)+CSS[_0x3d73b6(0x29b)](_0x34cb2f)+'\x22]'))managerFilterSelect[_0x3d73b6(0x1e2)]=_0x34cb2f;else _0x34cb2f===''&&(managerFilterSelect['value']='');const _0x375c31=groupViewManagerFilter['value'],_0xd900aa=groupViewManagerFilter[_0x3d73b6(0x2dc)](_0x3d73b6(0x200));_0xd900aa[_0x3d73b6(0x2a1)](_0x33ed5e=>{const _0x35d452=_0x3d73b6;_0x33ed5e[_0x35d452(0x1e2)]!==''&&_0x33ed5e[_0x35d452(0x1c2)]();});if(!groupViewManagerFilter['querySelector'](_0x3d73b6(0x1b8))){const _0x414e3e=document[_0x3d73b6(0x1f3)](_0x3d73b6(0x200));_0x414e3e[_0x3d73b6(0x1e2)]='NO_MANAGER',_0x414e3e['textContent']=_0x3d73b6(0x1bf),groupViewManagerFilter['appendChild'](_0x414e3e);}_0x157d61[_0x3d73b6(0x2a1)](_0x15a1f6=>{const _0x23e411=_0x3d73b6;if(_0x15a1f6&&_0x15a1f6[_0x23e411(0x2a8)]()!==''){const _0x3fc07=document['createElement']('option');_0x3fc07['value']=_0x15a1f6,_0x3fc07['textContent']=_0x15a1f6,groupViewManagerFilter[_0x23e411(0x191)](_0x3fc07);}});if(_0x375c31&&groupViewManagerFilter[_0x3d73b6(0x1b9)](_0x3d73b6(0x1c6)+CSS[_0x3d73b6(0x29b)](_0x375c31)+'\x22]'))groupViewManagerFilter['value']=_0x375c31;else _0x375c31===''&&(groupViewManagerFilter[_0x3d73b6(0x1e2)]='');}function showEditModal(_0x20e2c7){const _0x336e38=_0x1db9d3;console[_0x336e38(0x22e)]('Editing:',_0x20e2c7),currentEditingDocId=_0x20e2c7['id'],editEmpId[_0x336e38(0x1ae)]=_0x20e2c7[_0x336e38(0x1ea)]||_0x336e38(0x26d),editEmpName[_0x336e38(0x1ae)]=_0x20e2c7[_0x336e38(0x256)]||_0x336e38(0x26d),editEmpManager['value']=_0x20e2c7['Check_Manager']||'',editEmpTeam[_0x336e38(0x1e2)]=_0x20e2c7['Check_Place']||'',editError[_0x336e38(0x1ae)]='',editEmployeeModal[_0x336e38(0x1a8)][_0x336e38(0x1c2)](_0x336e38(0x1f2));}function closeEditModal(){const _0x1bd83d=_0x1db9d3;editEmployeeModal[_0x1bd83d(0x1a8)]['add'](_0x1bd83d(0x1f2)),currentEditingDocId=null;}async function saveEmployeeChanges(){const _0x3c3100=_0x1db9d3;if(!currentEditingDocId)return;const _0x497d44=editEmpManager['value'],_0x1535c3=editEmpTeam[_0x3c3100(0x1e2)];editError[_0x3c3100(0x1ae)]='',saveEditModalButton['disabled']=!![];try{const _0x344a8e=doc(db,_0x3c3100(0x1cf),currentEditingDocId);await updateDoc(_0x344a8e,{'Check_Manager':_0x497d44,'Check_Place':_0x1535c3}),console[_0x3c3100(0x22e)](_0x3c3100(0x213)),closeEditModal();}catch(_0x432f43){console[_0x3c3100(0x2a4)]('Error\x20saving\x20employee\x20changes:',_0x432f43),editError[_0x3c3100(0x1ae)]=_0x3c3100(0x26a)+_0x432f43[_0x3c3100(0x1db)];}finally{saveEditModalButton[_0x3c3100(0x252)]=![];}}function handleSearchEmployee(){const _0x4091d9=_0x1db9d3,_0x314f53=searchEmployeeIdInput['value']['trim']();searchEmployeeError[_0x4091d9(0x1ae)]='';if(!_0x314f53){searchEmployeeError[_0x4091d9(0x1ae)]=_0x4091d9(0x1b7);return;}const _0x1c2e08=allEmployeesData[_0x4091d9(0x1dd)](_0x47a330=>_0x47a330[_0x4091d9(0x1ea)]===_0x314f53);_0x1c2e08?showAddMemberModal(_0x1c2e08):searchEmployeeError[_0x4091d9(0x1ae)]='ไม่พบรหัสพนักงานนี้ในระบบ';}function showAddMemberModal(_0x2cad16){const _0x2bf8ae=_0x1db9d3;currentAddingDocId=_0x2cad16['id'],addMemberError[_0x2bf8ae(0x1ae)]='',addMemberEmpId['textContent']=_0x2cad16[_0x2bf8ae(0x1ea)]||_0x2bf8ae(0x26d),addMemberEmpName[_0x2bf8ae(0x1ae)]=_0x2cad16[_0x2bf8ae(0x256)]||_0x2bf8ae(0x26d),addMemberEmpBU['textContent']=_0x2cad16['BU_th']||_0x2bf8ae(0x26d),addMemberManagerSelect[_0x2bf8ae(0x1ac)]='';const _0x43d95e=document['createElement'](_0x2bf8ae(0x200));_0x43d95e[_0x2bf8ae(0x1e2)]='',_0x43d95e[_0x2bf8ae(0x1ae)]=_0x2bf8ae(0x1bf),addMemberManagerSelect[_0x2bf8ae(0x191)](_0x43d95e);const _0x2ed3f4=new Set(allEmployeesData[_0x2bf8ae(0x2c7)](_0x1ec7aa=>_0x1ec7aa[_0x2bf8ae(0x20c)])[_0x2bf8ae(0x2b0)](Boolean)),_0x4f8d4b=Array['from'](_0x2ed3f4)[_0x2bf8ae(0x286)]();_0x4f8d4b['forEach'](_0x1cc06c=>{const _0x14c137=_0x2bf8ae,_0x32416e=document[_0x14c137(0x1f3)](_0x14c137(0x200));_0x32416e[_0x14c137(0x1e2)]=_0x1cc06c,_0x32416e[_0x14c137(0x1ae)]=_0x1cc06c,addMemberManagerSelect[_0x14c137(0x191)](_0x32416e);}),addMemberManagerSelect['value']=_0x2cad16[_0x2bf8ae(0x20c)]||'',addMemberTeamSelect[_0x2bf8ae(0x1ac)]='';const _0x5dbef8=document[_0x2bf8ae(0x1f3)](_0x2bf8ae(0x200));_0x5dbef8[_0x2bf8ae(0x1e2)]='',_0x5dbef8[_0x2bf8ae(0x1ae)]='--\x20ไม่ระบุทีม\x20--',addMemberTeamSelect[_0x2bf8ae(0x191)](_0x5dbef8),teamNames[_0x2bf8ae(0x2a1)](_0x364503=>{const _0x4b3c28=_0x2bf8ae,_0xce85cf=document[_0x4b3c28(0x1f3)]('option');_0xce85cf[_0x4b3c28(0x1e2)]=_0x364503,_0xce85cf[_0x4b3c28(0x1ae)]=_0x364503,addMemberTeamSelect['appendChild'](_0xce85cf);}),addMemberTeamSelect[_0x2bf8ae(0x1e2)]=_0x2cad16[_0x2bf8ae(0x290)]||'',addMemberModal['classList'][_0x2bf8ae(0x1c2)]('hidden');}function closeAddMemberModal(){const _0x7ebf05=_0x1db9d3;addMemberModal['classList'][_0x7ebf05(0x219)](_0x7ebf05(0x1f2)),currentAddingDocId=null,searchEmployeeIdInput[_0x7ebf05(0x1e2)]='',searchEmployeeError['textContent']='';}async function saveAddMemberChanges(){const _0x501f90=_0x1db9d3;if(!currentAddingDocId)return;const _0x384d1c=addMemberManagerSelect[_0x501f90(0x1e2)],_0x1884e9=addMemberTeamSelect[_0x501f90(0x1e2)];addMemberError['textContent']='',saveAddMemberModalButton[_0x501f90(0x252)]=!![],closeAddMemberModalButton[_0x501f90(0x252)]=!![];try{const _0x1a8c57=doc(db,'crsg',currentAddingDocId);await updateDoc(_0x1a8c57,{'Check_Manager':_0x384d1c,'Check_Place':_0x1884e9}),console[_0x501f90(0x22e)]('Employee\x20data\x20updated\x20via\x20Add\x20Member\x20modal.'),closeAddMemberModal();}catch(_0x321208){console[_0x501f90(0x2a4)](_0x501f90(0x1d1),_0x321208),addMemberError['textContent']=_0x501f90(0x26a)+_0x321208[_0x501f90(0x1db)];}finally{saveAddMemberModalButton[_0x501f90(0x252)]=![],closeAddMemberModalButton[_0x501f90(0x252)]=![];}}function setupAddMemberModalListeners(){const _0x333866=_0x1db9d3;searchEmployeeButton['addEventListener'](_0x333866(0x197),handleSearchEmployee),closeAddMemberModalButton[_0x333866(0x1e1)](_0x333866(0x197),closeAddMemberModal),saveAddMemberModalButton[_0x333866(0x1e1)](_0x333866(0x197),saveAddMemberChanges);}function handleDownloadCSV(){const _0x849b8a=_0x1db9d3;console[_0x849b8a(0x22e)](_0x849b8a(0x255));const _0x4c36cc=allEmployeesData[_0x849b8a(0x2b0)](_0x41575d=>{const _0x138f61=_0x849b8a,_0x4ba776=_0x41575d[_0x138f61(0x20c)]&&_0x41575d[_0x138f61(0x20c)][_0x138f61(0x2a8)]()!=='',_0x33eb58=_0x41575d['Check_Place']&&_0x41575d[_0x138f61(0x290)][_0x138f61(0x2a8)]()!=='',_0x21c855=!!_0x41575d[_0x138f61(0x2d8)],_0x1a41bb=_0x4ba776&&_0x33eb58,_0x3cc9d5=_0x21c855&&!_0x33eb58;return _0x1a41bb||_0x3cc9d5;});if(_0x4c36cc[_0x849b8a(0x2a0)]===0x0){console[_0x849b8a(0x1e7)]('No\x20data\x20to\x20download\x20based\x20on\x20criteria.');return;}const _0x5a6f4a=[_0x849b8a(0x2cb),_0x849b8a(0x268),_0x849b8a(0x295),'ตำแหน่ง\x20(Position_th)',_0x849b8a(0x2a2),_0x849b8a(0x19c),_0x849b8a(0x1cd),_0x849b8a(0x1a7),_0x849b8a(0x1e0),_0x849b8a(0x25b)],_0x2607c5=_0x444622=>{const _0x1df43d=_0x849b8a;if(_0x444622===null||_0x444622===undefined)return'\x22\x22';let _0x3c566c=String(_0x444622);return(_0x3c566c[_0x1df43d(0x288)]('\x22')||_0x3c566c[_0x1df43d(0x288)](',')||_0x3c566c[_0x1df43d(0x288)]('\x0a'))&&(_0x3c566c='\x22'+_0x3c566c[_0x1df43d(0x296)](/"/g,'\x22\x22')+'\x22'),_0x3c566c;};let _0x2b91af=_0x5a6f4a[_0x849b8a(0x2bd)](',')+'\x0a';_0x4c36cc['forEach'](_0x368595=>{const _0x41c1f2=_0x849b8a,_0x4d91a2=_0x368595[_0x41c1f2(0x2d8)]&&_0x368595['DateLogin'][_0x41c1f2(0x208)]?formatThaiTimestamp(_0x368595[_0x41c1f2(0x2d8)][_0x41c1f2(0x208)]()):'',_0x1256ce=_0x368595[_0x41c1f2(0x21e)]&&_0x368595[_0x41c1f2(0x21e)]['toDate']?formatThaiTimestamp(_0x368595['RandomTime'][_0x41c1f2(0x208)]()):'',_0x77f7bf=[_0x368595['employeeId']||'',_0x368595['FullName_th']||'',_0x368595[_0x41c1f2(0x226)]||'',_0x368595[_0x41c1f2(0x1a2)]||'',_0x368595[_0x41c1f2(0x253)]||'',_0x368595[_0x41c1f2(0x1e4)]||'',_0x368595['Check_Manager']||'',_0x368595['Check_Place']||'',_0x4d91a2,_0x1256ce];_0x2b91af+=_0x77f7bf[_0x41c1f2(0x2c7)](_0x2607c5)[_0x41c1f2(0x2bd)](',')+'\x0a';});const _0x558547=new Uint8Array([0xef,0xbb,0xbf]),_0x51e643=new Blob([_0x558547,_0x2b91af],{'type':_0x849b8a(0x2d7)}),_0x31d645=document[_0x849b8a(0x1f3)]('a'),_0xfd8b9e=URL[_0x849b8a(0x1d9)](_0x51e643);_0x31d645['setAttribute'](_0x849b8a(0x189),_0xfd8b9e);const _0x5d6227=new Date()['toISOString']()['slice'](0x0,0xa);_0x31d645[_0x849b8a(0x215)](_0x849b8a(0x2e2),_0x849b8a(0x1ec)+_0x5d6227+'.csv'),_0x31d645[_0x849b8a(0x278)]['visibility']=_0x849b8a(0x1f2),document[_0x849b8a(0x2da)]['appendChild'](_0x31d645),_0x31d645[_0x849b8a(0x197)](),document[_0x849b8a(0x2da)][_0x849b8a(0x29e)](_0x31d645),console[_0x849b8a(0x22e)](_0x849b8a(0x24b));}
        
    </script>
</body>
</html>


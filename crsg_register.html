<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRSG Summit 2025</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .input-error {
            border-color: #EF4444 !important; /* red-500 */
            border-width: 2px !important;
        }
        /* Animation for showing inputs */
        .fade-in-down {
            animation: fadeInDown 0.3s ease-out forwards;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom class สำหรับสถานะ Active ของ OTP */
        .otp-active {
            background-color: #0056ff !important;
            color: white !important;
            /* (แก้ไข) ปรับ Border เป็นสีดำตาม Requirement */
            border-color: #000000 !important; 
            border-width: 2px !important;
        }
        /* Custom class สำหรับสถานะ Active (สีส้ม) ของ Nickname */
        .nickname-active {
            background-color: #f97316 !important; /* Orange-500 */
            color: white !important;
            border-color: #f97316 !important;
        }
        /* ปรับสี Placeholder ตอนเป็นสีส้มให้อ่านง่ายขึ้น */
        .nickname-active::placeholder {
            color: #ffedd5;
        }
    </style>
</head>
<!-- ปรับตำแหน่งให้ห่างจากด้านบน 15% (pt-[15vh]) -->
<body class="bg-white flex flex-col items-center justify-start min-h-screen pt-[5vh] pb-10" style="background-color: #dee1e1;">

    <!-- กล่องลงทะเบียน -->
    <div id="registrationFormContainer" class="w-[95%] max-w-md p-8 space-y-6 bg-gray-50 rounded-lg shadow-md transition-colors duration-300">
        <h1 class="text-2xl font-bold text-center text-gray-900">CRSG Summit 2025</h1>
        <p id="eventDate" class="text-sm font-medium text-gray-700 text-center" style="margin-top: 2px;">วันที่ 24 พฤศจิกายน 2568</p>

        <div id="eventImageContainer" class="mt-6 w-[70%] mx-auto">
            <img src="./images/crsg.png">
        </div>  
              
        <!-- ส่วนแสดงข้อมูลพนักงาน (ซ่อนไว้ตอนเริ่ม) -->
        <div id="employeeInfoDisplay" class="hidden text-center space-y-2 py-4">
            <p id="infoFullName" class="text-lg font-bold text-gray-900"></p>
            <!-- ซ่อน Position และ Department -->
            <p id="infoPosition" class="text-sm text-gray-700 hidden"></p>
            <p id="infoDepartment" class="text-sm text-gray-700 hidden"></p>
            <!-- แสดง BU -->
            <p id="infoBU" class="text-sm text-gray-700"></p>
            <!-- (เพิ่ม) แสดง Check_Manager ใต้สังกัด -->
            <p id="infoManager" class="text-sm text-gray-700"></p>
        </div>

        <!-- ฟอร์มลงทะเบียน -->
        <form id="registrationForm" class="space-y-6" onsubmit="return false;"> <!-- Prevent default submit -->
            <div>
                <!-- 5 Input Boxes -->
                <div class="flex justify-center gap-2" id="otp-container">
                    <!-- (แก้ไข) เพิ่ม inputmode="numeric" และ oninput เพื่อกรองตัวเลข -->
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="0">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="1">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="2">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="3">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="4">
                </div>
                
                <p class="block text-sm font-medium text-gray-700 mt-3 text-center">กรอกรหัสพนักงานของท่านให้ถูกต้อง</p>

                <!-- Loading Indicator -->
                <p id="checkingIdIndicator" class="hidden text-center text-xs text-blue-600 mt-2">กำลังตรวจสอบ...</p>
            </div>
            
            <!-- Nickname Container -->
            <div id="nicknameContainer" class="hidden flex flex-col items-center fade-in-down">
                <input type="text" id="nickname" name="nickname" 
                       class="w-1/2 px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-center transition-colors duration-150" 
                       placeholder="ชื่อเล่น">
                
                <label for="nickname" class="block text-sm font-medium text-gray-700 mt-2 text-center">กรอกชื่อเล่นของคุณ ก่อนลงทะเบียน</label>
            </div>
            
            <!-- ปุ่ม Disabled ไว้ก่อน, กว้าง 70%, จัดกึ่งกลาง, สีพื้นหลัง #002d63 -->
            <button type="button" id="registerButton" disabled
                    class="block mx-auto w-[70%] px-4 py-2 font-medium text-white bg-[#002d63] rounded-md hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed">
                ลงทะเบียน
            </button>
        </form>
        
        <!-- พื้นที่แสดงข้อความ --><div id="message" class="text-center text-sm"></div>

        <div id="teamDisplay" class="hidden text-center border-t pt-4 mt-4">
            <h2 id="teamNameDisplay" class="text-8xl font-bold text-[#0056ff]"></h2> 
            <p class="text-sm font-medium text-gray-700 mt-1">ทีมของคุณ</p>
            
            <p id="registrationStatusMessage" class="text-sm mt-4"></p>
            <p id="registrationTimestamp" class="text-xs text-gray-500"></p>
        </div>
    </div>

    <!-- ส่วนแสดงสมาชิกในทีม -->
    <div id="teamMembersDisplay" class="hidden w-[95%] max-w-4xl p-6 bg-white rounded-lg shadow-md mt-8">
        <div class="flex flex-col md:flex-row justify-between md:items-center mb-4 gap-3">
            <h3 id="teamMembersHeader" class="text-lg font-semibold text-gray-800">สมาชิกทีม : ...</h3>
            <div class="flex items-center gap-4">
                <div>
                    <label for="teamSelect" class="text-sm font-medium mr-2">เลือกทีม:</label>
                    <select id="teamSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm py-2 px-3">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <span id="teamMembersCount" class="text-sm font-medium text-gray-600">สมาชิก ... คน</span>
            </div>
        </div>
        <div class="overflow-x-auto border rounded-lg">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                    </tr>
                </thead>
                <tbody id="teamMembersTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Data will be populated by JS -->
                </tbody>
            </table>
        </div>
    </div>


    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
const _0x2e5bd3=_0x2b2b;(function(_0x4b89dc,_0x2445d5){const _0x24cc13=_0x2b2b,_0x54459e=_0x4b89dc();while(!![]){try{const _0x22c6b7=-parseInt(_0x24cc13(0x92))/0x1*(-parseInt(_0x24cc13(0xa8))/0x2)+-parseInt(_0x24cc13(0x79))/0x3*(parseInt(_0x24cc13(0x7b))/0x4)+-parseInt(_0x24cc13(0xa1))/0x5*(parseInt(_0x24cc13(0x8d))/0x6)+-parseInt(_0x24cc13(0xbc))/0x7+parseInt(_0x24cc13(0xc5))/0x8*(parseInt(_0x24cc13(0xd8))/0x9)+-parseInt(_0x24cc13(0x9b))/0xa+parseInt(_0x24cc13(0xc1))/0xb;if(_0x22c6b7===_0x2445d5)break;else _0x54459e['push'](_0x54459e['shift']());}catch(_0x5bb57f){_0x54459e['push'](_0x54459e['shift']());}}}(_0x18a3,0x741dd));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';import{getFirestore,collection,getDocs,query,where,serverTimestamp,setLogLevel,limit,doc,updateDoc}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';import{getAuth,signInAnonymously}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';const firebaseConfig={'apiKey':'AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','authDomain':_0x2e5bd3(0xc2),'databaseURL':'https://ttb-register-default-rtdb.asia-southeast1.firebasedatabase.app','projectId':'ttb-register','storageBucket':_0x2e5bd3(0x72),'messagingSenderId':_0x2e5bd3(0xde),'appId':_0x2e5bd3(0xb5),'measurementId':_0x2e5bd3(0xd7)},teamNames=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','AA','BB','CC','DD','EE','FF','GG','HH','II','JJ','KK','LL','MM','NN','OO','PP','QQ'];let db,auth,currentEmployeeData=null;const registrationFormContainer=document['getElementById'](_0x2e5bd3(0x74)),otpInputs=document['querySelectorAll'](_0x2e5bd3(0xbe)),checkingIdIndicator=document['getElementById'](_0x2e5bd3(0x6b)),nicknameContainer=document['getElementById'](_0x2e5bd3(0x7f)),nicknameInput=document[_0x2e5bd3(0xab)](_0x2e5bd3(0xc0)),registerButton=document[_0x2e5bd3(0xab)](_0x2e5bd3(0xce)),messageDiv=document[_0x2e5bd3(0xab)](_0x2e5bd3(0x69)),teamDisplay=document[_0x2e5bd3(0xab)]('teamDisplay'),teamNameDisplay=document[_0x2e5bd3(0xab)](_0x2e5bd3(0x6f)),regStatusMsg=document[_0x2e5bd3(0xab)]('registrationStatusMessage'),regTimestamp=document[_0x2e5bd3(0xab)]('registrationTimestamp'),eventDate=document[_0x2e5bd3(0xab)](_0x2e5bd3(0xa6)),eventImageContainer=document['getElementById'](_0x2e5bd3(0x94)),registrationForm=document[_0x2e5bd3(0xab)](_0x2e5bd3(0xa9)),employeeInfoDisplay=document[_0x2e5bd3(0xab)](_0x2e5bd3(0x73)),infoFullName=document[_0x2e5bd3(0xab)](_0x2e5bd3(0xc9)),infoPosition=document['getElementById'](_0x2e5bd3(0x85)),infoDepartment=document['getElementById'](_0x2e5bd3(0x9a)),infoBU=document[_0x2e5bd3(0xab)]('infoBU'),infoManager=document[_0x2e5bd3(0xab)](_0x2e5bd3(0x6a)),teamMembersDisplay=document[_0x2e5bd3(0xab)](_0x2e5bd3(0xda)),teamMembersHeader=document[_0x2e5bd3(0xab)](_0x2e5bd3(0x84)),teamMembersCount=document[_0x2e5bd3(0xab)](_0x2e5bd3(0xb1)),teamMembersTableBody=document[_0x2e5bd3(0xab)](_0x2e5bd3(0xad)),teamSelect=document[_0x2e5bd3(0xab)](_0x2e5bd3(0xe3));try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel('Debug'),await signInAnonymously(auth),console[_0x2e5bd3(0xb2)](_0x2e5bd3(0x6e)),populateTeamDropdown(),setupOtpInputs(),otpInputs[0x0]['focus']();}catch(_0x1b29c1){console[_0x2e5bd3(0x78)]('Firebase\x20initialization\x20failed:',_0x1b29c1),document[_0x2e5bd3(0xab)](_0x2e5bd3(0x69))[_0x2e5bd3(0xc6)]=_0x2e5bd3(0xca)+_0x1b29c1[_0x2e5bd3(0x69)];}registerButton[_0x2e5bd3(0x7a)]('click',handleRegisterClick),teamSelect[_0x2e5bd3(0x7a)](_0x2e5bd3(0xac),()=>{const _0x4bf348=_0x2e5bd3,_0x44b48f=teamSelect[_0x4bf348(0xd4)];fetchAndDisplayTeamMembers(_0x44b48f);}),nicknameInput['addEventListener'](_0x2e5bd3(0xd1),()=>{const _0x3824a9=_0x2e5bd3;nicknameInput[_0x3824a9(0xd4)]['trim']()!==''?nicknameInput['classList'][_0x3824a9(0x93)](_0x3824a9(0xdc)):nicknameInput[_0x3824a9(0xaf)]['remove'](_0x3824a9(0xdc)),nicknameInput[_0x3824a9(0xd4)][_0x3824a9(0x7e)]()!==''&&currentEmployeeData?(registerButton[_0x3824a9(0x86)]=![],nicknameInput['classList'][_0x3824a9(0xd2)](_0x3824a9(0x8c))):registerButton[_0x3824a9(0x86)]=!![];});function formatThaiTimestamp(_0x368079){const _0x463d39=_0x2e5bd3;return _0x368079['toLocaleString'](_0x463d39(0x82),{'dateStyle':_0x463d39(0x99),'timeStyle':_0x463d39(0x88)});}function populateTeamDropdown(){const _0xeb869a=_0x2e5bd3;teamSelect['innerHTML']='',teamNames[_0xeb869a(0xcf)](_0x34ee8c=>{const _0x22004d=_0xeb869a,_0x50403b=document[_0x22004d(0x9c)]('option');_0x50403b[_0x22004d(0xd4)]=_0x34ee8c,_0x50403b[_0x22004d(0xc6)]=_0x34ee8c,teamSelect['appendChild'](_0x50403b);});}async function getCrsgDoc(_0x4db282){const _0x371063=_0x2e5bd3,_0x416c3a='crsg';console[_0x371063(0xb2)]('Querying\x20DB\x20for\x20ID\x20(String):',_0x4db282);const _0x312e31=query(collection(db,_0x416c3a),where(_0x371063(0xb4),'==',String(_0x4db282)),limit(0x1)),_0x36c5d3=await getDocs(_0x312e31);if(_0x36c5d3[_0x371063(0x90)])return null;const _0x46ee4b=_0x36c5d3['docs'][0x0];return{'id':_0x46ee4b['id'],'data':_0x46ee4b[_0x371063(0xcc)]()};}function _0x2b2b(_0x1daa55,_0x4c49ce){const _0x18a3ff=_0x18a3();return _0x2b2b=function(_0x2b2b9a,_0x3befe8){_0x2b2b9a=_0x2b2b9a-0x68;let _0x4bd9b4=_0x18a3ff[_0x2b2b9a];return _0x4bd9b4;},_0x2b2b(_0x1daa55,_0x4c49ce);}function updateInputStyle(_0x50f355){const _0x4f91b4=_0x2e5bd3;_0x50f355[_0x4f91b4(0xd4)][_0x4f91b4(0x7e)]()!==''?_0x50f355[_0x4f91b4(0xaf)][_0x4f91b4(0x93)]('otp-active'):_0x50f355[_0x4f91b4(0xaf)][_0x4f91b4(0xd2)](_0x4f91b4(0x6d));}function setupOtpInputs(){const _0x539f50=_0x2e5bd3;otpInputs[_0x539f50(0xcf)]((_0x3a31d8,_0x4ea029)=>{const _0x5918e5=_0x539f50;_0x3a31d8[_0x5918e5(0x7a)](_0x5918e5(0xd1),_0xd4064b=>{const _0x3082af=_0x5918e5;_0xd4064b['target']['value']=_0xd4064b[_0x3082af(0xd3)][_0x3082af(0xd4)][_0x3082af(0x80)](/[^0-9]/g,''),updateInputStyle(_0x3a31d8),messageDiv[_0x3082af(0xc6)]='',otpInputs[_0x3082af(0xcf)](_0x26bca3=>_0x26bca3[_0x3082af(0xaf)][_0x3082af(0xd2)](_0x3082af(0x8c))),currentEmployeeData&&resetRegistrationState(),_0xd4064b['target']['value'][_0x3082af(0xd6)]===0x1&&(_0x4ea029<otpInputs[_0x3082af(0xd6)]-0x1&&otpInputs[_0x4ea029+0x1][_0x3082af(0xcb)]()),checkOtpComplete();}),_0x3a31d8[_0x5918e5(0x7a)](_0x5918e5(0x87),_0x4e6d36=>{const _0x3eb46e=_0x5918e5;_0x4e6d36[_0x3eb46e(0x95)]===_0x3eb46e(0xa2)&&!_0x4e6d36[_0x3eb46e(0xd3)][_0x3eb46e(0xd4)]&&_0x4ea029>0x0&&otpInputs[_0x4ea029-0x1][_0x3eb46e(0xcb)]();}),_0x3a31d8['addEventListener']('paste',_0x1d783d=>{const _0x2e8d2d=_0x5918e5;_0x1d783d[_0x2e8d2d(0xa7)]();const _0x2ce345=_0x1d783d['clipboardData'][_0x2e8d2d(0x7c)](_0x2e8d2d(0x77))['trim'](),_0x5713bd=_0x2ce345[_0x2e8d2d(0x80)](/[^0-9]/g,'');if(_0x5713bd){const _0x515a2a=_0x5713bd['split']('');otpInputs['forEach']((_0x56fd47,_0x361a7f)=>{const _0x382f44=_0x2e8d2d;_0x515a2a[_0x361a7f]&&(_0x56fd47[_0x382f44(0xd4)]=_0x515a2a[_0x361a7f],updateInputStyle(_0x56fd47));}),checkOtpComplete();const _0x4a9662=Array[_0x2e8d2d(0x8e)](otpInputs)[_0x2e8d2d(0x96)](_0x35c678=>!_0x35c678[_0x2e8d2d(0xd4)]);if(_0x4a9662)_0x4a9662[_0x2e8d2d(0xcb)]();else otpInputs[0x4][_0x2e8d2d(0xcb)]();}});});}function checkOtpComplete(){const _0x1e4c81=_0x2e5bd3,_0x5750dc=Array['from'](otpInputs)[_0x1e4c81(0xaa)](_0x51356f=>_0x51356f[_0x1e4c81(0xd4)])[_0x1e4c81(0xba)]('');_0x5750dc[_0x1e4c81(0xd6)]===0x5?validateEmployeeId(_0x5750dc):resetRegistrationState();}function resetRegistrationState(){const _0x3b88bf=_0x2e5bd3;currentEmployeeData=null,nicknameContainer[_0x3b88bf(0xaf)][_0x3b88bf(0x93)](_0x3b88bf(0xe2)),nicknameInput[_0x3b88bf(0xd4)]='',nicknameInput[_0x3b88bf(0xaf)][_0x3b88bf(0xd2)](_0x3b88bf(0xdc)),registerButton['disabled']=!![];}async function validateEmployeeId(_0xea9c23){const _0x6f070c=_0x2e5bd3;checkingIdIndicator[_0x6f070c(0xaf)][_0x6f070c(0xd2)](_0x6f070c(0xe2)),otpInputs[_0x6f070c(0xcf)](_0x588710=>_0x588710['disabled']=!![]);try{const _0x5c074a=await getCrsgDoc(_0xea9c23);_0x5c074a?(currentEmployeeData=_0x5c074a,nicknameContainer['classList']['remove'](_0x6f070c(0xe2)),messageDiv[_0x6f070c(0xc6)]='',setTimeout(()=>nicknameInput['focus'](),0x12c)):(messageDiv[_0x6f070c(0xc6)]=_0x6f070c(0x7d),messageDiv[_0x6f070c(0x8a)]=_0x6f070c(0xa4),otpInputs[_0x6f070c(0xcf)](_0x5394c1=>{const _0x33b241=_0x6f070c;_0x5394c1[_0x33b241(0xd4)]='',_0x5394c1[_0x33b241(0xaf)]['remove'](_0x33b241(0x6d)),_0x5394c1['classList'][_0x33b241(0x93)](_0x33b241(0x8c)),_0x5394c1[_0x33b241(0x86)]=![];}),registerButton[_0x6f070c(0x86)]=!![],setTimeout(()=>otpInputs[0x0][_0x6f070c(0xcb)](),0x64));}catch(_0x12c619){console['error'](_0x6f070c(0x6c),_0x12c619),messageDiv[_0x6f070c(0xc6)]=_0x6f070c(0x98),messageDiv['className']='text-center\x20text-sm\x20text-red-600\x20mt-2',otpInputs[_0x6f070c(0xcf)](_0x1335a1=>_0x1335a1[_0x6f070c(0x86)]=![]);}finally{checkingIdIndicator[_0x6f070c(0xaf)]['add'](_0x6f070c(0xe2)),currentEmployeeData&&otpInputs[_0x6f070c(0xcf)](_0x32ad7c=>_0x32ad7c['disabled']=![]);}}async function handleRegisterClick(){const _0xd439ad=_0x2e5bd3,_0x35e64d=nicknameInput[_0xd439ad(0xd4)][_0xd439ad(0x7e)]();if(!currentEmployeeData||!_0x35e64d)return;registerButton[_0xd439ad(0x86)]=!![],registerButton[_0xd439ad(0xc6)]=_0xd439ad(0xe1),otpInputs[_0xd439ad(0xcf)](_0x4629a2=>_0x4629a2[_0xd439ad(0x86)]=!![]),nicknameInput[_0xd439ad(0x86)]=!![];const _0x469113=currentEmployeeData[_0xd439ad(0xcc)],_0x25ef26=currentEmployeeData['id'],_0x1f636f=_0x469113[_0xd439ad(0x91)]||_0xd439ad(0x83),_0x59f901=_0x1f636f===_0xd439ad(0x83);try{if(_0x469113['DateLogin']){const _0x13ffaf=_0x469113[_0xd439ad(0xb8)][_0xd439ad(0x70)]();if(_0x59f901){messageDiv[_0xd439ad(0x68)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>คุณได้ลงทะเบียนไปแล้ว</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>'+formatThaiTimestamp(_0x13ffaf)+_0xd439ad(0x9e),messageDiv[_0xd439ad(0x8a)]='text-center\x20text-sm\x20text-red-600',teamDisplay[_0xd439ad(0xaf)][_0xd439ad(0x93)](_0xd439ad(0xe2));const _0x532725=teamNames[0x0]||'A';teamSelect[_0xd439ad(0xd4)]=_0x532725,fetchAndDisplayTeamMembers(_0x532725);}else teamNameDisplay[_0xd439ad(0xc6)]=_0x1f636f,regStatusMsg[_0xd439ad(0xc6)]=_0xd439ad(0xb3),regStatusMsg[_0xd439ad(0x8a)]='text-sm\x20mt-4\x20text-yellow-700\x20font-medium',regTimestamp['textContent']=formatThaiTimestamp(_0x13ffaf),teamDisplay[_0xd439ad(0xaf)][_0xd439ad(0xd2)](_0xd439ad(0xe2)),teamSelect[_0xd439ad(0xd4)]=_0x1f636f,fetchAndDisplayTeamMembers(_0x1f636f);await updateDoc(doc(db,_0xd439ad(0xe0),_0x25ef26),{'NickName':_0x35e64d}),showSuccessState(_0x469113,_0x35e64d);return;}const _0x51eba2=await logRegistration(_0x25ef26,_0x35e64d);if(_0x59f901){messageDiv['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>ลงทะเบียนสำเร็จ\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และคุณไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ไม่มีทีม)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>'+formatThaiTimestamp(_0x51eba2)+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',messageDiv[_0xd439ad(0x8a)]=_0xd439ad(0xdb),teamDisplay[_0xd439ad(0xaf)][_0xd439ad(0x93)](_0xd439ad(0xe2));const _0x14de16=teamNames[0x0]||'A';teamSelect[_0xd439ad(0xd4)]=_0x14de16,fetchAndDisplayTeamMembers(_0x14de16);}else teamNameDisplay[_0xd439ad(0xc6)]=_0x1f636f,regStatusMsg[_0xd439ad(0xc6)]=_0xd439ad(0x75),regStatusMsg[_0xd439ad(0x8a)]=_0xd439ad(0xbb),regTimestamp[_0xd439ad(0xc6)]=formatThaiTimestamp(_0x51eba2),teamDisplay[_0xd439ad(0xaf)][_0xd439ad(0xd2)](_0xd439ad(0xe2)),teamSelect['value']=_0x1f636f,fetchAndDisplayTeamMembers(_0x1f636f);showSuccessState(_0x469113,_0x35e64d);}catch(_0x5db1f1){console[_0xd439ad(0x78)](_0xd439ad(0xcd),_0x5db1f1),messageDiv[_0xd439ad(0xc6)]=_0xd439ad(0xbd)+_0x5db1f1[_0xd439ad(0x69)],messageDiv['className']=_0xd439ad(0xdb),registerButton[_0xd439ad(0x86)]=![],registerButton[_0xd439ad(0xc6)]=_0xd439ad(0xd0),otpInputs['forEach'](_0x1879b3=>_0x1879b3[_0xd439ad(0x86)]=![]),nicknameInput[_0xd439ad(0x86)]=![];}}function showSuccessState(_0x28e004,_0x192c08){const _0x231ed7=_0x2e5bd3;if(registrationForm)registrationForm[_0x231ed7(0xaf)][_0x231ed7(0x93)](_0x231ed7(0xe2));if(eventDate)eventDate[_0x231ed7(0xaf)][_0x231ed7(0x93)]('hidden');if(eventImageContainer)eventImageContainer[_0x231ed7(0xaf)][_0x231ed7(0x93)](_0x231ed7(0xe2));if(infoFullName)infoFullName[_0x231ed7(0xc6)]=(_0x28e004['FullName_th']||'')+'\x20('+(_0x28e004[_0x231ed7(0xb4)]||'')+')';if(infoBU)infoBU['textContent']=_0x231ed7(0xd5)+(_0x28e004['BU_eng']||_0x28e004[_0x231ed7(0xa0)]||_0x231ed7(0xd9));if(infoManager)infoManager[_0x231ed7(0xc6)]='Check\x20Manager:\x20'+(_0x28e004[_0x231ed7(0xc8)]||'-');if(infoPosition)infoPosition[_0x231ed7(0xaf)][_0x231ed7(0x93)]('hidden');if(infoDepartment)infoDepartment[_0x231ed7(0xaf)]['add'](_0x231ed7(0xe2));if(employeeInfoDisplay)employeeInfoDisplay['classList'][_0x231ed7(0xd2)]('hidden');if(teamMembersDisplay)teamMembersDisplay['classList'][_0x231ed7(0xd2)]('hidden');}async function logRegistration(_0x556b7a,_0x15fcad){const _0xcb28e4=_0x2e5bd3,_0x3d1f4a=new Date();try{const _0x2c8a40=doc(db,_0xcb28e4(0xe0),_0x556b7a);return await updateDoc(_0x2c8a40,{'DateLogin':_0x3d1f4a,'NickName':_0x15fcad}),console[_0xcb28e4(0xb2)](_0xcb28e4(0xc3)),_0x3d1f4a;}catch(_0x1e6be1){console[_0xcb28e4(0x78)](_0xcb28e4(0xbf),_0x1e6be1);throw _0x1e6be1;}}function _0x18a3(){const _0x3bb8d5=['checkingIdIndicator','Validation\x20Error:','otp-active','Signed\x20in\x20anonymously','teamNameDisplay','toDate','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>ไม่พบสมาชิกในทีมนี้</td></tr>','ttb-register.firebasestorage.app','employeeInfoDisplay','registrationFormContainer','ลงทะเบียนเข้าร่วมงานสำเร็จ','bg-white','text','error','2592573eJSqGv','addEventListener','4yDpmFv','getData','ไม่พบรหัสพนักงานนี้ในระบบ','trim','nicknameContainer','replace','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-red-500\x22>เกิดข้อผิดพลาดในการโหลดข้อมูล</td></tr>','th-TH','ไม่พบข้อมูลที่นั่ง','teamMembersHeader','infoPosition','disabled','keydown','medium','กำลังโหลด...','className','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>','input-error','6ZjApil','from','สมาชิก\x20','empty','Check_Place','1QgcxHG','add','eventImageContainer','key','find','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>','เกิดข้อผิดพลาดในการตรวจสอบข้อมูล','long','infoDepartment','108800MXQGkz','createElement','bg-yellow-100\x20border-b\x20border-yellow-200','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','appendChild','BU_th','324455uePRBd','Backspace','FullName_th','text-center\x20text-sm\x20text-red-600\x20mt-2','localeCompare','eventDate','preventDefault','317838JinRZn','registrationForm','map','getElementById','change','teamMembersTableBody','bg-gray-50','classList','NickName','teamMembersCount','log','คุณได้ลงทะเบียนไปแล้วเมื่อ','employeeId','1:1070273157855:web:5c8120e1df27e233d8676a','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>','sort','DateLogin','Error\x20fetching\x20team\x20members:\x20','join','text-sm\x20mt-4\x20text-green-600\x20font-medium','5820269cDSqxS','เกิดข้อผิดพลาด:\x20','.otp-input','Error\x20logging\x20registration:\x20','nickname','14483898khHaDN','ttb-register.firebaseapp.com','Registration\x20Logged\x20successfully.','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>','1234248AFMrtN','textContent','push','Check_Manager','infoFullName','เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','focus','data','Registration\x20Error:\x20','registerButton','forEach','ลงทะเบียน','input','remove','target','value','สังกัด:\x20','length','G-9DJLWJ5LQ1','45zzQoSP','ไม่พบข้อมูลสังกัด','teamMembersDisplay','text-center\x20text-sm\x20text-red-600','nickname-active','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','1070273157855','\x20คน','crsg','กำลังบันทึก...','hidden','teamSelect','innerHTML','message','infoManager'];_0x18a3=function(){return _0x3bb8d5;};return _0x18a3();}async function fetchAndDisplayTeamMembers(_0x503173){const _0x508139=_0x2e5bd3;if(!_0x503173){teamMembersDisplay['classList']['add'](_0x508139(0xe2));return;}teamMembersHeader[_0x508139(0xc6)]='สมาชิกทีม\x20:\x20'+_0x503173,teamMembersCount['textContent']=_0x508139(0x89),teamMembersTableBody[_0x508139(0x68)]='<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>กำลังโหลดข้อมูล...</td></tr>';try{const _0x10e1a8='crsg',_0x16be5d=query(collection(db,_0x10e1a8),where(_0x508139(0x91),'==',_0x503173)),_0xe43948=await getDocs(_0x16be5d),_0x18428f=[];_0xe43948[_0x508139(0xcf)](_0x2286e1=>{const _0x400217=_0x508139;_0x18428f[_0x400217(0xc7)](_0x2286e1[_0x400217(0xcc)]());}),_0x18428f[_0x508139(0xb7)]((_0x550eec,_0x3e1007)=>(_0x550eec[_0x508139(0xa3)]||'')[_0x508139(0xa5)](_0x3e1007[_0x508139(0xa3)]||'')),teamMembersCount[_0x508139(0xc6)]=_0x508139(0x8f)+_0x18428f[_0x508139(0xd6)]+_0x508139(0xdf);if(_0x18428f[_0x508139(0xd6)]===0x0){teamMembersTableBody['innerHTML']=_0x508139(0x71);return;}teamMembersTableBody[_0x508139(0x68)]='',_0x18428f['forEach']((_0x3a9406,_0x787a04)=>{const _0x5a9dfc=_0x508139,_0x3e0c53=!!_0x3a9406[_0x5a9dfc(0xb8)],_0x26f19d=_0x3e0c53?_0x5a9dfc(0xb6):_0x5a9dfc(0x97),_0xa21bc2=_0x3a9406[_0x5a9dfc(0xb0)]?(_0x3a9406[_0x5a9dfc(0xa3)]||'')+'\x20('+_0x3a9406[_0x5a9dfc(0xb0)]+')':_0x3a9406[_0x5a9dfc(0xa3)]||'',_0x5dd731=document[_0x5a9dfc(0x9c)]('tr');_0x3e0c53?_0x5dd731[_0x5a9dfc(0x8a)]=_0x5a9dfc(0x9d):_0x5dd731[_0x5a9dfc(0x8a)]=_0x787a04%0x2===0x0?_0x5a9dfc(0x76):_0x5a9dfc(0xae),_0x5dd731['innerHTML']=_0x5a9dfc(0xc4)+_0xa21bc2+_0x5a9dfc(0x8b)+(_0x3a9406[_0x5a9dfc(0xc8)]||'')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>'+_0x26f19d+_0x5a9dfc(0xdd),teamMembersTableBody[_0x5a9dfc(0x9f)](_0x5dd731);});}catch(_0x12456e){console[_0x508139(0x78)](_0x508139(0xb9),_0x12456e),teamMembersTableBody[_0x508139(0x68)]=_0x508139(0x81),teamMembersCount['textContent']='เกิดข้อผิดพลาด';}}
        
    </script>
</body>
</html>
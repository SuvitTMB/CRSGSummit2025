<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRSG Summit 2025</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .input-error {
            border-color: #EF4444 !important; /* red-500 */
            border-width: 2px !important;
        }
        /* Animation for showing inputs */
        .fade-in-down {
            animation: fadeInDown 0.3s ease-out forwards;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom class สำหรับสถานะ Active ของ OTP */
        .otp-active {
            background-color: #0056ff !important;
            color: white !important;
            /* (แก้ไข) ปรับ Border เป็นสีดำตาม Requirement */
            border-color: #000000 !important; 
            border-width: 2px !important;
        }
        /* Custom class สำหรับสถานะ Active (สีส้ม) ของ Nickname */
        .nickname-active {
            background-color: #f97316 !important; /* Orange-500 */
            color: white !important;
            border-color: #f97316 !important;
        }
        /* ปรับสี Placeholder ตอนเป็นสีส้มให้อ่านง่ายขึ้น */
        .nickname-active::placeholder {
            color: #ffedd5;
        }
    </style>
</head>
<!-- ปรับตำแหน่งให้ห่างจากด้านบน 15% (pt-[15vh]) -->
<body class="bg-white flex flex-col items-center justify-start min-h-screen pt-[5vh] pb-10" style="background-color: #dee1e1;">

    <!-- กล่องลงทะเบียน -->
    <div id="registrationFormContainer" class="w-[95%] max-w-md p-8 space-y-6 bg-gray-50 rounded-lg shadow-md transition-colors duration-300">
        <h1 class="text-2xl font-bold text-center text-gray-900"><center><img src="./images/crsg.png" style="width:130%"></center></h1>
        <p id="eventDate" class="text-sm font-medium text-gray-700 text-center" style="margin: -10px auto 40px auto;">วันที่ 24 พฤศจิกายน 2568</p>
              
        <!-- ส่วนแสดงข้อมูลพนักงาน (ซ่อนไว้ตอนเริ่ม) -->
        <div id="employeeInfoDisplay" class="hidden text-center space-y-2 py-4">
            <p id="infoFullName" class="text-lg font-bold text-gray-900"></p>
            <!-- ซ่อน Position และ Department -->
            <p id="infoPosition" class="text-sm text-gray-700 hidden"></p>
            <p id="infoDepartment" class="text-sm text-gray-700 hidden"></p>
            <!-- แสดง BU -->
            <p id="infoBU" class="text-sm text-gray-700"></p>
            <!-- (เพิ่ม) แสดง Check_Manager ใต้สังกัด -->
            <p id="infoManager" class="text-sm text-gray-700"></p>
        </div>

        <!-- ฟอร์มลงทะเบียน -->
        <form id="registrationForm" class="space-y-6" onsubmit="return false;"> <!-- Prevent default submit -->
            <div>
                <!-- 5 Input Boxes -->
                <div class="flex justify-center gap-2" id="otp-container">
                    <!-- (แก้ไข) เพิ่ม inputmode="numeric" และ oninput เพื่อกรองตัวเลข -->
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="0">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="1">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="2">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="3">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="4">
                </div>
                
                <p class="block text-sm font-medium text-gray-700 mt-3 text-center">กรอกรหัสพนักงานของท่านให้ถูกต้อง</p>

                <!-- Loading Indicator -->
                <p id="checkingIdIndicator" class="hidden text-center text-xs text-blue-600 mt-2">กำลังตรวจสอบ...</p>
            </div>
            
            <!-- Nickname Container -->
            <div id="nicknameContainer" class="hidden flex flex-col items-center fade-in-down">
                <input type="text" id="nickname" name="nickname" 
                       class="w-1/2 px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-center transition-colors duration-150" 
                       placeholder="ชื่อเล่น">
                
                <label for="nickname" class="block text-sm font-medium text-gray-700 mt-2 text-center">กรอกชื่อเล่นของคุณ ก่อนลงทะเบียน</label>
            </div>
            
            <!-- ปุ่ม Disabled ไว้ก่อน, กว้าง 70%, จัดกึ่งกลาง, สีพื้นหลัง #002d63 -->
            <button type="button" id="registerButton" disabled
                    class="block mx-auto w-[70%] px-4 py-2 font-medium text-white bg-[#002d63] rounded-md hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed">
                ลงทะเบียน
            </button>
        </form>
        
        <!-- พื้นที่แสดงข้อความ --><div id="message" class="text-center text-sm"></div>

        <div id="teamDisplay" class="hidden text-center border-t pt-4 mt-4">
            <h2 id="teamNameDisplay" class="text-8xl font-bold text-[#0056ff]"></h2> 
            <p class="text-sm font-medium text-gray-700 mt-1">ทีมของคุณ</p>
            
            <p id="registrationStatusMessage" class="text-sm mt-4"></p>
            <p id="registrationTimestamp" class="text-xs text-gray-500"></p>
        </div>
    </div>

    <!-- ส่วนแสดงสมาชิกในทีม -->
    <div id="teamMembersDisplay" class="hidden w-[95%] max-w-4xl p-6 bg-white rounded-lg shadow-md mt-8">
        <div class="flex flex-col md:flex-row justify-between md:items-center mb-4 gap-3">
            <h3 id="teamMembersHeader" class="text-lg font-semibold text-gray-800">สมาชิกทีม : ...</h3>
            <div class="flex items-center gap-4">
                <div>
                    <label for="teamSelect" class="text-sm font-medium mr-2">เลือกทีม:</label>
                    <select id="teamSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm py-2 px-3">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <span id="teamMembersCount" class="text-sm font-medium text-gray-600">สมาชิก ... คน</span>
            </div>
        </div>
        <div class="overflow-x-auto border rounded-lg">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                    </tr>
                </thead>
                <tbody id="teamMembersTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Data will be populated by JS -->
                </tbody>
            </table>
        </div>
    </div>


    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
const _0xe7a817=_0xa911;(function(_0x34071f,_0x2e544e){const _0xac8814=_0xa911,_0x2f8b27=_0x34071f();while(!![]){try{const _0x171081=-parseInt(_0xac8814(0x10a))/0x1+parseInt(_0xac8814(0x149))/0x2+parseInt(_0xac8814(0x13a))/0x3*(parseInt(_0xac8814(0x112))/0x4)+parseInt(_0xac8814(0xfb))/0x5*(parseInt(_0xac8814(0xdd))/0x6)+parseInt(_0xac8814(0x148))/0x7+-parseInt(_0xac8814(0x103))/0x8*(-parseInt(_0xac8814(0x11e))/0x9)+-parseInt(_0xac8814(0xf7))/0xa*(parseInt(_0xac8814(0x154))/0xb);if(_0x171081===_0x2e544e)break;else _0x2f8b27['push'](_0x2f8b27['shift']());}catch(_0x205aec){_0x2f8b27['push'](_0x2f8b27['shift']());}}}(_0x3a90,0xdd9fc));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';import{getFirestore,collection,getDocs,query,where,serverTimestamp,setLogLevel,limit,doc,updateDoc}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';import{getAuth,signInAnonymously}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';const firebaseConfig={'apiKey':_0xe7a817(0xec),'authDomain':_0xe7a817(0x134),'databaseURL':_0xe7a817(0x156),'projectId':_0xe7a817(0x137),'storageBucket':_0xe7a817(0xe9),'messagingSenderId':_0xe7a817(0xf9),'appId':'1:1070273157855:web:5c8120e1df27e233d8676a','measurementId':_0xe7a817(0xe3)},teamNames=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','AA','BB','CC','DD','EE','FF','GG','HH','II','JJ','KK','LL','MM','NN','OO','PP','QQ'];let db,auth,currentEmployeeData=null;const registrationFormContainer=document[_0xe7a817(0x151)](_0xe7a817(0x106)),otpInputs=document['querySelectorAll'](_0xe7a817(0x109)),checkingIdIndicator=document[_0xe7a817(0x151)](_0xe7a817(0x13b)),nicknameContainer=document[_0xe7a817(0x151)](_0xe7a817(0x118)),nicknameInput=document[_0xe7a817(0x151)](_0xe7a817(0x159)),registerButton=document[_0xe7a817(0x151)](_0xe7a817(0x12c)),messageDiv=document[_0xe7a817(0x151)]('message'),teamDisplay=document[_0xe7a817(0x151)](_0xe7a817(0xe2)),teamNameDisplay=document['getElementById'](_0xe7a817(0x158)),regStatusMsg=document[_0xe7a817(0x151)](_0xe7a817(0xe8)),regTimestamp=document[_0xe7a817(0x151)](_0xe7a817(0x10f)),eventDate=document[_0xe7a817(0x151)](_0xe7a817(0x14b)),eventImageContainer=document[_0xe7a817(0x151)](_0xe7a817(0x144)),registrationForm=document[_0xe7a817(0x151)](_0xe7a817(0x14c)),employeeInfoDisplay=document['getElementById'](_0xe7a817(0xf0)),infoFullName=document[_0xe7a817(0x151)](_0xe7a817(0x123)),infoPosition=document[_0xe7a817(0x151)](_0xe7a817(0xea)),infoDepartment=document[_0xe7a817(0x151)]('infoDepartment'),infoBU=document[_0xe7a817(0x151)](_0xe7a817(0x12a)),infoManager=document[_0xe7a817(0x151)]('infoManager'),teamMembersDisplay=document[_0xe7a817(0x151)](_0xe7a817(0xfe)),teamMembersHeader=document['getElementById'](_0xe7a817(0x10d)),teamMembersCount=document['getElementById']('teamMembersCount'),teamMembersTableBody=document['getElementById'](_0xe7a817(0x138)),teamSelect=document[_0xe7a817(0x151)](_0xe7a817(0xf3));try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel(_0xe7a817(0xe5)),await signInAnonymously(auth),console[_0xe7a817(0x13f)](_0xe7a817(0xdc)),populateTeamDropdown(),setupOtpInputs(),otpInputs[0x0]['focus']();}catch(_0x1d7e15){console[_0xe7a817(0xfa)](_0xe7a817(0xf1),_0x1d7e15),document[_0xe7a817(0x151)]('message')[_0xe7a817(0x117)]=_0xe7a817(0x14a)+_0x1d7e15[_0xe7a817(0xf8)];}registerButton['addEventListener'](_0xe7a817(0x129),handleRegisterClick),teamSelect[_0xe7a817(0x10c)](_0xe7a817(0xef),()=>{const _0x157c1d=_0xe7a817,_0x3d02b1=teamSelect[_0x157c1d(0x12b)];fetchAndDisplayTeamMembers(_0x3d02b1);}),nicknameInput[_0xe7a817(0x10c)](_0xe7a817(0x139),()=>{const _0x22902f=_0xe7a817;nicknameInput[_0x22902f(0x12b)]['trim']()!==''?nicknameInput['classList'][_0x22902f(0x124)](_0x22902f(0x104)):nicknameInput[_0x22902f(0xdf)][_0x22902f(0x132)]('nickname-active'),nicknameInput['value'][_0x22902f(0x116)]()!==''&&currentEmployeeData?(registerButton[_0x22902f(0x146)]=![],nicknameInput[_0x22902f(0xdf)][_0x22902f(0x132)](_0x22902f(0x11c))):registerButton[_0x22902f(0x146)]=!![];});function formatThaiTimestamp(_0x320a33){const _0xd00fe5=_0xe7a817;return _0x320a33['toLocaleString']('th-TH',{'dateStyle':_0xd00fe5(0x11f),'timeStyle':_0xd00fe5(0x12f)});}function populateTeamDropdown(){const _0x45ded5=_0xe7a817;teamSelect[_0x45ded5(0x120)]='',teamNames['forEach'](_0xa937b0=>{const _0x266d4d=_0x45ded5,_0x269dbb=document[_0x266d4d(0x14e)]('option');_0x269dbb['value']=_0xa937b0,_0x269dbb[_0x266d4d(0x117)]=_0xa937b0,teamSelect[_0x266d4d(0x12e)](_0x269dbb);});}async function getCrsgDoc(_0xeaae19){const _0x322f3c=_0xe7a817,_0x53fc4e=_0x322f3c(0xe1);console[_0x322f3c(0x13f)](_0x322f3c(0x10e),_0xeaae19);const _0x2ba6fc=query(collection(db,_0x53fc4e),where(_0x322f3c(0xdb),'==',String(_0xeaae19)),limit(0x1)),_0x5b34ae=await getDocs(_0x2ba6fc);if(_0x5b34ae[_0x322f3c(0x143)])return null;const _0x2ff2a0=_0x5b34ae[_0x322f3c(0x113)][0x0];return{'id':_0x2ff2a0['id'],'data':_0x2ff2a0['data']()};}function updateInputStyle(_0x2db8a4){const _0x380140=_0xe7a817;_0x2db8a4[_0x380140(0x12b)]['trim']()!==''?_0x2db8a4[_0x380140(0xdf)][_0x380140(0x124)](_0x380140(0x14d)):_0x2db8a4[_0x380140(0xdf)][_0x380140(0x132)]('otp-active');}function _0x3a90(){const _0x83963e=['infoFullName','add','กำลังโหลด...','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>คุณได้ลงทะเบียนไปแล้ว</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>','paste','ไม่พบข้อมูลที่นั่ง','click','infoBU','value','registerButton','BU_eng','appendChild','medium','Validation\x20Error:','สมาชิก\x20','remove','localeCompare','ttb-register.firebaseapp.com','hidden','Registration\x20Error:\x20','ttb-register','teamMembersTableBody','input','3615SrzooA','checkingIdIndicator','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>','เกิดข้อผิดพลาดในการตรวจสอบข้อมูล','ลงทะเบียน','log','forEach','replace','find','empty','eventImageContainer','NickName','disabled','key','10536771KqIhev','1803994ZAGlOd','เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','eventDate','registrationForm','otp-active','createElement','เกิดข้อผิดพลาด:\x20','push','getElementById','data','สมาชิกทีม\x20:\x20','11UdvvGf','คุณได้ลงทะเบียนไปแล้วเมื่อ','https://ttb-register-default-rtdb.asia-southeast1.firebasedatabase.app','target','teamNameDisplay','nickname','FullName_th','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>','employeeId','Signed\x20in\x20anonymously','444XVrcLh','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','classList','กำลังบันทึก...','crsg','teamDisplay','G-9DJLWJ5LQ1','text-center\x20text-sm\x20text-red-600','Debug','from','sort','registrationStatusMessage','ttb-register.firebasestorage.app','infoPosition','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','focus','Check_Manager','change','employeeInfoDisplay','Firebase\x20initialization\x20failed:','toDate','teamSelect','DateLogin','className','text-sm\x20mt-4\x20text-yellow-700\x20font-medium','22886700NGTNzf','message','1070273157855','error','90630RccUqC','length','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>กำลังโหลดข้อมูล...</td></tr>','teamMembersDisplay','clipboardData','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>ไม่พบสมาชิกในทีมนี้</td></tr>','text-center\x20text-sm\x20text-red-600\x20mt-2','map','5752LrlWvL','nickname-active','BU_th','registrationFormContainer','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','join','.otp-input','1183914tuZJif','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>','addEventListener','teamMembersHeader','Querying\x20DB\x20for\x20ID\x20(String):','registrationTimestamp','preventDefault','split','300DDPjim','docs','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-red-500\x22>เกิดข้อผิดพลาดในการโหลดข้อมูล</td></tr>','\x20คน','trim','textContent','nicknameContainer','Error\x20fetching\x20team\x20members:\x20','Registration\x20Logged\x20successfully.','ลงทะเบียนเข้าร่วมงานสำเร็จ','input-error','Error\x20logging\x20registration:\x20','6777CtnnEz','long','innerHTML','Backspace','getData'];_0x3a90=function(){return _0x83963e;};return _0x3a90();}function setupOtpInputs(){const _0x1199f4=_0xe7a817;otpInputs[_0x1199f4(0x140)]((_0x204a5f,_0x243a44)=>{const _0x363364=_0x1199f4;_0x204a5f['addEventListener'](_0x363364(0x139),_0x10420f=>{const _0x43334f=_0x363364;_0x10420f[_0x43334f(0x157)][_0x43334f(0x12b)]=_0x10420f[_0x43334f(0x157)]['value'][_0x43334f(0x141)](/[^0-9]/g,''),updateInputStyle(_0x204a5f),messageDiv[_0x43334f(0x117)]='',otpInputs[_0x43334f(0x140)](_0x1d1fdf=>_0x1d1fdf['classList']['remove'](_0x43334f(0x11c))),currentEmployeeData&&resetRegistrationState(),_0x10420f[_0x43334f(0x157)][_0x43334f(0x12b)][_0x43334f(0xfc)]===0x1&&(_0x243a44<otpInputs[_0x43334f(0xfc)]-0x1&&otpInputs[_0x243a44+0x1][_0x43334f(0xed)]()),checkOtpComplete();}),_0x204a5f[_0x363364(0x10c)]('keydown',_0x39fd32=>{const _0x8c8a47=_0x363364;_0x39fd32[_0x8c8a47(0x147)]===_0x8c8a47(0x121)&&!_0x39fd32[_0x8c8a47(0x157)]['value']&&_0x243a44>0x0&&otpInputs[_0x243a44-0x1][_0x8c8a47(0xed)]();}),_0x204a5f[_0x363364(0x10c)](_0x363364(0x127),_0x8d636=>{const _0x4ee491=_0x363364;_0x8d636[_0x4ee491(0x110)]();const _0x5f35bd=_0x8d636[_0x4ee491(0xff)][_0x4ee491(0x122)]('text')[_0x4ee491(0x116)](),_0x5e193b=_0x5f35bd[_0x4ee491(0x141)](/[^0-9]/g,'');if(_0x5e193b){const _0x2fc9a9=_0x5e193b[_0x4ee491(0x111)]('');otpInputs[_0x4ee491(0x140)]((_0xb6032c,_0x50c90c)=>{const _0x547a36=_0x4ee491;_0x2fc9a9[_0x50c90c]&&(_0xb6032c[_0x547a36(0x12b)]=_0x2fc9a9[_0x50c90c],updateInputStyle(_0xb6032c));}),checkOtpComplete();const _0x4e3353=Array[_0x4ee491(0xe6)](otpInputs)[_0x4ee491(0x142)](_0x202409=>!_0x202409[_0x4ee491(0x12b)]);if(_0x4e3353)_0x4e3353[_0x4ee491(0xed)]();else otpInputs[0x4]['focus']();}});});}function checkOtpComplete(){const _0x38cc38=_0xe7a817,_0x1f5057=Array[_0x38cc38(0xe6)](otpInputs)[_0x38cc38(0x102)](_0x403e1e=>_0x403e1e['value'])[_0x38cc38(0x108)]('');_0x1f5057[_0x38cc38(0xfc)]===0x5?validateEmployeeId(_0x1f5057):resetRegistrationState();}function resetRegistrationState(){const _0x140f93=_0xe7a817;currentEmployeeData=null,nicknameContainer[_0x140f93(0xdf)][_0x140f93(0x124)](_0x140f93(0x135)),nicknameInput[_0x140f93(0x12b)]='',nicknameInput[_0x140f93(0xdf)][_0x140f93(0x132)](_0x140f93(0x104)),registerButton[_0x140f93(0x146)]=!![];}async function validateEmployeeId(_0x949a1d){const _0x5eb27c=_0xe7a817;checkingIdIndicator[_0x5eb27c(0xdf)][_0x5eb27c(0x132)](_0x5eb27c(0x135)),otpInputs[_0x5eb27c(0x140)](_0x4fe72b=>_0x4fe72b[_0x5eb27c(0x146)]=!![]);try{const _0xe1992=await getCrsgDoc(_0x949a1d);_0xe1992?(currentEmployeeData=_0xe1992,nicknameContainer['classList']['remove'](_0x5eb27c(0x135)),messageDiv[_0x5eb27c(0x117)]='',setTimeout(()=>nicknameInput[_0x5eb27c(0xed)](),0x12c)):(messageDiv['textContent']='ไม่พบรหัสพนักงานนี้ในระบบ',messageDiv[_0x5eb27c(0xf5)]=_0x5eb27c(0x101),otpInputs[_0x5eb27c(0x140)](_0xe17dfe=>{const _0x540035=_0x5eb27c;_0xe17dfe[_0x540035(0x12b)]='',_0xe17dfe[_0x540035(0xdf)]['remove'](_0x540035(0x14d)),_0xe17dfe['classList'][_0x540035(0x124)](_0x540035(0x11c)),_0xe17dfe[_0x540035(0x146)]=![];}),registerButton[_0x5eb27c(0x146)]=!![],setTimeout(()=>otpInputs[0x0]['focus'](),0x64));}catch(_0x1ce445){console['error'](_0x5eb27c(0x130),_0x1ce445),messageDiv[_0x5eb27c(0x117)]=_0x5eb27c(0x13d),messageDiv[_0x5eb27c(0xf5)]=_0x5eb27c(0x101),otpInputs['forEach'](_0x450f37=>_0x450f37['disabled']=![]);}finally{checkingIdIndicator[_0x5eb27c(0xdf)][_0x5eb27c(0x124)](_0x5eb27c(0x135)),currentEmployeeData&&otpInputs[_0x5eb27c(0x140)](_0xfc92b=>_0xfc92b[_0x5eb27c(0x146)]=![]);}}async function handleRegisterClick(){const _0x1a60f6=_0xe7a817,_0xc457e2=nicknameInput['value']['trim']();if(!currentEmployeeData||!_0xc457e2)return;registerButton[_0x1a60f6(0x146)]=!![],registerButton['textContent']=_0x1a60f6(0xe0),otpInputs[_0x1a60f6(0x140)](_0x4ca494=>_0x4ca494[_0x1a60f6(0x146)]=!![]),nicknameInput['disabled']=!![];const _0x29a395=currentEmployeeData['data'],_0x276fb5=currentEmployeeData['id'],_0x1b961f=_0x29a395['Check_Place']||_0x1a60f6(0x128),_0x465e38=_0x1b961f===_0x1a60f6(0x128);try{if(_0x29a395[_0x1a60f6(0xf4)]){const _0x3b1913=_0x29a395[_0x1a60f6(0xf4)][_0x1a60f6(0xf2)]();if(_0x465e38){messageDiv['innerHTML']=_0x1a60f6(0x126)+formatThaiTimestamp(_0x3b1913)+_0x1a60f6(0xeb),messageDiv['className']=_0x1a60f6(0xe4),teamDisplay[_0x1a60f6(0xdf)][_0x1a60f6(0x124)](_0x1a60f6(0x135));const _0x43388=teamNames[0x0]||'A';teamSelect['value']=_0x43388,fetchAndDisplayTeamMembers(_0x43388);}else teamNameDisplay[_0x1a60f6(0x117)]=_0x1b961f,regStatusMsg[_0x1a60f6(0x117)]=_0x1a60f6(0x155),regStatusMsg['className']=_0x1a60f6(0xf6),regTimestamp[_0x1a60f6(0x117)]=formatThaiTimestamp(_0x3b1913),teamDisplay[_0x1a60f6(0xdf)][_0x1a60f6(0x132)](_0x1a60f6(0x135)),teamSelect[_0x1a60f6(0x12b)]=_0x1b961f,fetchAndDisplayTeamMembers(_0x1b961f);await updateDoc(doc(db,_0x1a60f6(0xe1),_0x276fb5),{'NickName':_0xc457e2}),showSuccessState(_0x29a395,_0xc457e2);return;}const _0x5c36d8=await logRegistration(_0x276fb5,_0xc457e2);if(_0x465e38){messageDiv['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>ลงทะเบียนสำเร็จ\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และคุณไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ไม่มีทีม)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>'+formatThaiTimestamp(_0x5c36d8)+_0x1a60f6(0xde),messageDiv[_0x1a60f6(0xf5)]=_0x1a60f6(0xe4),teamDisplay['classList'][_0x1a60f6(0x124)](_0x1a60f6(0x135));const _0x46f8b6=teamNames[0x0]||'A';teamSelect[_0x1a60f6(0x12b)]=_0x46f8b6,fetchAndDisplayTeamMembers(_0x46f8b6);}else teamNameDisplay[_0x1a60f6(0x117)]=_0x1b961f,regStatusMsg[_0x1a60f6(0x117)]=_0x1a60f6(0x11b),regStatusMsg[_0x1a60f6(0xf5)]='text-sm\x20mt-4\x20text-green-600\x20font-medium',regTimestamp[_0x1a60f6(0x117)]=formatThaiTimestamp(_0x5c36d8),teamDisplay[_0x1a60f6(0xdf)]['remove']('hidden'),teamSelect[_0x1a60f6(0x12b)]=_0x1b961f,fetchAndDisplayTeamMembers(_0x1b961f);showSuccessState(_0x29a395,_0xc457e2);}catch(_0x14811a){console[_0x1a60f6(0xfa)](_0x1a60f6(0x136),_0x14811a),messageDiv[_0x1a60f6(0x117)]=_0x1a60f6(0x14f)+_0x14811a[_0x1a60f6(0xf8)],messageDiv[_0x1a60f6(0xf5)]=_0x1a60f6(0xe4),registerButton[_0x1a60f6(0x146)]=![],registerButton[_0x1a60f6(0x117)]=_0x1a60f6(0x13e),otpInputs[_0x1a60f6(0x140)](_0x4ff4e6=>_0x4ff4e6[_0x1a60f6(0x146)]=![]),nicknameInput[_0x1a60f6(0x146)]=![];}}function showSuccessState(_0x58f7c4,_0x50e3f3){const _0x42d95a=_0xe7a817;if(registrationForm)registrationForm['classList']['add'](_0x42d95a(0x135));if(eventDate)eventDate[_0x42d95a(0xdf)][_0x42d95a(0x124)](_0x42d95a(0x135));if(eventImageContainer)eventImageContainer[_0x42d95a(0xdf)][_0x42d95a(0x124)](_0x42d95a(0x135));if(infoFullName)infoFullName[_0x42d95a(0x117)]=(_0x58f7c4[_0x42d95a(0x15a)]||'')+'\x20('+(_0x58f7c4[_0x42d95a(0xdb)]||'')+')';if(infoBU)infoBU['textContent']=''+(_0x58f7c4[_0x42d95a(0x12d)]||_0x58f7c4[_0x42d95a(0x105)]||'ไม่พบข้อมูลสังกัด');if(infoManager)infoManager[_0x42d95a(0x117)]=''+(_0x58f7c4['Check_Manager']||'-');if(infoPosition)infoPosition['classList'][_0x42d95a(0x124)](_0x42d95a(0x135));if(infoDepartment)infoDepartment[_0x42d95a(0xdf)][_0x42d95a(0x124)](_0x42d95a(0x135));if(employeeInfoDisplay)employeeInfoDisplay[_0x42d95a(0xdf)][_0x42d95a(0x132)]('hidden');if(teamMembersDisplay)teamMembersDisplay[_0x42d95a(0xdf)]['remove']('hidden');}async function logRegistration(_0x4f527d,_0x37417d){const _0x275f38=_0xe7a817,_0x4d4788=new Date();try{const _0x274b36=doc(db,_0x275f38(0xe1),_0x4f527d);return await updateDoc(_0x274b36,{'DateLogin':_0x4d4788,'NickName':_0x37417d}),console[_0x275f38(0x13f)](_0x275f38(0x11a)),_0x4d4788;}catch(_0x4a78b6){console[_0x275f38(0xfa)](_0x275f38(0x11d),_0x4a78b6);throw _0x4a78b6;}}function _0xa911(_0x2c7e5e,_0x51b99b){const _0x3a90db=_0x3a90();return _0xa911=function(_0xa911a0,_0x512d4c){_0xa911a0=_0xa911a0-0xdb;let _0x546a0a=_0x3a90db[_0xa911a0];return _0x546a0a;},_0xa911(_0x2c7e5e,_0x51b99b);}async function fetchAndDisplayTeamMembers(_0x37bf49){const _0x5b2796=_0xe7a817;if(!_0x37bf49){teamMembersDisplay['classList'][_0x5b2796(0x124)]('hidden');return;}teamMembersHeader[_0x5b2796(0x117)]=_0x5b2796(0x153)+_0x37bf49,teamMembersCount['textContent']=_0x5b2796(0x125),teamMembersTableBody[_0x5b2796(0x120)]=_0x5b2796(0xfd);try{const _0x1188e4=_0x5b2796(0xe1),_0x53c1fd=query(collection(db,_0x1188e4),where('Check_Place','==',_0x37bf49)),_0x386528=await getDocs(_0x53c1fd),_0x1273e1=[];_0x386528[_0x5b2796(0x140)](_0x2d1788=>{const _0x1fea47=_0x5b2796;_0x1273e1[_0x1fea47(0x150)](_0x2d1788[_0x1fea47(0x152)]());}),_0x1273e1[_0x5b2796(0xe7)]((_0x54f3ee,_0x11f3ba)=>(_0x54f3ee[_0x5b2796(0x15a)]||'')[_0x5b2796(0x133)](_0x11f3ba['FullName_th']||'')),teamMembersCount[_0x5b2796(0x117)]=_0x5b2796(0x131)+_0x1273e1[_0x5b2796(0xfc)]+_0x5b2796(0x115);if(_0x1273e1['length']===0x0){teamMembersTableBody[_0x5b2796(0x120)]=_0x5b2796(0x100);return;}teamMembersTableBody['innerHTML']='',_0x1273e1[_0x5b2796(0x140)](_0x47c5e2=>{const _0x930b60=_0x5b2796,_0x2ac7b2=!!_0x47c5e2[_0x930b60(0xf4)],_0xfd76a=_0x2ac7b2?'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>':_0x930b60(0x10b),_0x4a2e4c=_0x47c5e2[_0x930b60(0x145)]?(_0x47c5e2[_0x930b60(0x15a)]||'')+'\x20('+_0x47c5e2[_0x930b60(0x145)]+')':_0x47c5e2['FullName_th']||'',_0x226274=document[_0x930b60(0x14e)]('tr');_0x226274['innerHTML']=_0x930b60(0x13c)+_0x4a2e4c+_0x930b60(0x15b)+(_0x47c5e2[_0x930b60(0xee)]||'')+_0x930b60(0x15b)+_0xfd76a+_0x930b60(0x107),teamMembersTableBody[_0x930b60(0x12e)](_0x226274);});}catch(_0x47ae6b){console[_0x5b2796(0xfa)](_0x5b2796(0x119),_0x47ae6b),teamMembersTableBody[_0x5b2796(0x120)]=_0x5b2796(0x114),teamMembersCount[_0x5b2796(0x117)]='เกิดข้อผิดพลาด';}}
        
    </script>
</body>
</html>
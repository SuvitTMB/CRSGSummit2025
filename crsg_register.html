<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRSG Summit 2025</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .input-error {
            border-color: #EF4444 !important; /* red-500 */
            border-width: 2px !important;
        }
        /* Animation for showing inputs */
        .fade-in-down {
            animation: fadeInDown 0.3s ease-out forwards;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom class สำหรับสถานะ Active ของ OTP */
        .otp-active {
            background-color: #0056ff !important;
            color: white !important;
            /* (แก้ไข) ปรับ Border เป็นสีดำตาม Requirement */
            border-color: #000000 !important; 
            border-width: 2px !important;
        }
        /* Custom class สำหรับสถานะ Active (สีส้ม) ของ Nickname */
        .nickname-active {
            background-color: #f97316 !important; /* Orange-500 */
            color: white !important;
            border-color: #f97316 !important;
        }
        /* ปรับสี Placeholder ตอนเป็นสีส้มให้อ่านง่ายขึ้น */
        .nickname-active::placeholder {
            color: #ffedd5;
        }
    </style>
</head>
<!-- ปรับตำแหน่งให้ห่างจากด้านบน 15% (pt-[15vh]) -->
<body class="bg-white flex flex-col items-center justify-start min-h-screen pt-[15vh] pb-10" style="background-color: #dee1e1;">

    <!-- กล่องลงทะเบียน -->
    <div id="registrationFormContainer" class="w-[95%] max-w-md p-8 space-y-6 bg-gray-50 rounded-lg shadow-md transition-colors duration-300">
        <h1 class="text-2xl font-bold text-center text-gray-900">CRSG Summit 2025</h1>
        <p id="eventDate" class="text-sm font-medium text-gray-700 text-center" style="margin-top: 2px;">วันที่ 24 พฤศจิกายน 2568</p>

        <div id="eventImageContainer" class="mt-6 w-[70%] mx-auto">
            <img src="./images/crsg.png">
        </div>  
              
        <!-- ส่วนแสดงข้อมูลพนักงาน (ซ่อนไว้ตอนเริ่ม) -->
        <div id="employeeInfoDisplay" class="hidden text-center space-y-2 py-4">
            <p id="infoFullName" class="text-lg font-bold text-gray-900"></p>
            <!-- ซ่อน Position และ Department -->
            <p id="infoPosition" class="text-sm text-gray-700 hidden"></p>
            <p id="infoDepartment" class="text-sm text-gray-700 hidden"></p>
            <!-- แสดง BU -->
            <p id="infoBU" class="text-sm text-gray-700"></p>
            <!-- (เพิ่ม) แสดง Check_Manager ใต้สังกัด -->
            <p id="infoManager" class="text-sm text-gray-700"></p>
        </div>

        <!-- ฟอร์มลงทะเบียน -->
        <form id="registrationForm" class="space-y-6" onsubmit="return false;"> <!-- Prevent default submit -->
            <div>
                <!-- 5 Input Boxes -->
                <div class="flex justify-center gap-2" id="otp-container">
                    <!-- (แก้ไข) เพิ่ม inputmode="numeric" และ oninput เพื่อกรองตัวเลข -->
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="0">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="1">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="2">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="3">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="4">
                </div>
                
                <p class="block text-sm font-medium text-gray-700 mt-3 text-center">กรอกรหัสพนักงานของท่านให้ถูกต้อง</p>

                <!-- Loading Indicator -->
                <p id="checkingIdIndicator" class="hidden text-center text-xs text-blue-600 mt-2">กำลังตรวจสอบ...</p>
            </div>
            
            <!-- Nickname Container -->
            <div id="nicknameContainer" class="hidden flex flex-col items-center fade-in-down">
                <input type="text" id="nickname" name="nickname" 
                       class="w-1/2 px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-center transition-colors duration-150" 
                       placeholder="ชื่อเล่น">
                
                <label for="nickname" class="block text-sm font-medium text-gray-700 mt-2 text-center">กรอกชื่อเล่นของคุณ ก่อนลงทะเบียน</label>
            </div>
            
            <!-- ปุ่ม Disabled ไว้ก่อน, กว้าง 70%, จัดกึ่งกลาง, สีพื้นหลัง #002d63 -->
            <button type="button" id="registerButton" disabled
                    class="block mx-auto w-[70%] px-4 py-2 font-medium text-white bg-[#002d63] rounded-md hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed">
                ลงทะเบียน
            </button>
        </form>
        
        <!-- พื้นที่แสดงข้อความ --><div id="message" class="text-center text-sm"></div>

        <div id="teamDisplay" class="hidden text-center border-t pt-4 mt-4">
            <h2 id="teamNameDisplay" class="text-8xl font-bold text-[#0056ff]"></h2> 
            <p class="text-sm font-medium text-gray-700 mt-1">ทีมของคุณ</p>
            
            <p id="registrationStatusMessage" class="text-sm mt-4"></p>
            <p id="registrationTimestamp" class="text-xs text-gray-500"></p>
        </div>
    </div>

    <!-- ส่วนแสดงสมาชิกในทีม -->
    <div id="teamMembersDisplay" class="hidden w-[95%] max-w-4xl p-6 bg-white rounded-lg shadow-md mt-8">
        <div class="flex flex-col md:flex-row justify-between md:items-center mb-4 gap-3">
            <h3 id="teamMembersHeader" class="text-lg font-semibold text-gray-800">สมาชิกทีม : ...</h3>
            <div class="flex items-center gap-4">
                <div>
                    <label for="teamSelect" class="text-sm font-medium mr-2">เลือกทีม:</label>
                    <select id="teamSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm py-2 px-3">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <span id="teamMembersCount" class="text-sm font-medium text-gray-600">สมาชิก ... คน</span>
            </div>
        </div>
        <div class="overflow-x-auto border rounded-lg">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                    </tr>
                </thead>
                <tbody id="teamMembersTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Data will be populated by JS -->
                </tbody>
            </table>
        </div>
    </div>


    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
const _0x509f56=_0x26ab;function _0x26ab(_0x178a10,_0x13d0d0){const _0x46d23e=_0x46d2();return _0x26ab=function(_0x26abd3,_0x1a7290){_0x26abd3=_0x26abd3-0x99;let _0x471ed1=_0x46d23e[_0x26abd3];return _0x471ed1;},_0x26ab(_0x178a10,_0x13d0d0);}(function(_0x1a3816,_0x1503fd){const _0x33a785=_0x26ab,_0x55b3cb=_0x1a3816();while(!![]){try{const _0x665b63=parseInt(_0x33a785(0xa4))/0x1+parseInt(_0x33a785(0x114))/0x2*(-parseInt(_0x33a785(0x9f))/0x3)+-parseInt(_0x33a785(0xd4))/0x4+-parseInt(_0x33a785(0xb1))/0x5+parseInt(_0x33a785(0xcd))/0x6+parseInt(_0x33a785(0x10c))/0x7*(parseInt(_0x33a785(0x99))/0x8)+-parseInt(_0x33a785(0xac))/0x9;if(_0x665b63===_0x1503fd)break;else _0x55b3cb['push'](_0x55b3cb['shift']());}catch(_0xac1134){_0x55b3cb['push'](_0x55b3cb['shift']());}}}(_0x46d2,0xb5da2));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';import{getFirestore,collection,getDocs,query,where,serverTimestamp,setLogLevel,limit,doc,updateDoc}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';import{getAuth,signInAnonymously}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';const firebaseConfig={'apiKey':_0x509f56(0xd2),'authDomain':_0x509f56(0xfb),'databaseURL':_0x509f56(0xe3),'projectId':_0x509f56(0xdd),'storageBucket':_0x509f56(0xd3),'messagingSenderId':_0x509f56(0xee),'appId':_0x509f56(0x105),'measurementId':'G-9DJLWJ5LQ1'},teamNames=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','AA','BB','CC','DD','EE','FF','GG','HH','II','JJ','KK','LL','MM','NN','OO','PP','QQ'];let db,auth,currentEmployeeData=null;const registrationFormContainer=document[_0x509f56(0x104)](_0x509f56(0xa5)),otpInputs=document[_0x509f56(0xec)](_0x509f56(0x10e)),checkingIdIndicator=document[_0x509f56(0x104)](_0x509f56(0xa2)),nicknameContainer=document[_0x509f56(0x104)](_0x509f56(0xc0)),nicknameInput=document[_0x509f56(0x104)]('nickname'),registerButton=document[_0x509f56(0x104)]('registerButton'),messageDiv=document[_0x509f56(0x104)](_0x509f56(0xba)),teamDisplay=document['getElementById'](_0x509f56(0x116)),teamNameDisplay=document['getElementById']('teamNameDisplay'),regStatusMsg=document[_0x509f56(0x104)](_0x509f56(0xd6)),regTimestamp=document[_0x509f56(0x104)](_0x509f56(0xea)),eventDate=document['getElementById'](_0x509f56(0x9d)),eventImageContainer=document[_0x509f56(0x104)](_0x509f56(0x10a)),registrationForm=document[_0x509f56(0x104)]('registrationForm'),employeeInfoDisplay=document[_0x509f56(0x104)](_0x509f56(0xb6)),infoFullName=document[_0x509f56(0x104)](_0x509f56(0xfd)),infoPosition=document[_0x509f56(0x104)](_0x509f56(0x9a)),infoDepartment=document[_0x509f56(0x104)](_0x509f56(0xf7)),infoBU=document[_0x509f56(0x104)](_0x509f56(0x113)),infoManager=document['getElementById'](_0x509f56(0x112)),teamMembersDisplay=document[_0x509f56(0x104)]('teamMembersDisplay'),teamMembersHeader=document[_0x509f56(0x104)]('teamMembersHeader'),teamMembersCount=document['getElementById']('teamMembersCount'),teamMembersTableBody=document['getElementById'](_0x509f56(0x115)),teamSelect=document[_0x509f56(0x104)](_0x509f56(0xf3));try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel(_0x509f56(0xf6)),await signInAnonymously(auth),console['log'](_0x509f56(0xed)),populateTeamDropdown(),setupOtpInputs(),otpInputs[0x0][_0x509f56(0xf5)]();}catch(_0xe4c09){console['error'](_0x509f56(0xd1),_0xe4c09),document[_0x509f56(0x104)](_0x509f56(0xba))[_0x509f56(0xbf)]=_0x509f56(0xe0)+_0xe4c09[_0x509f56(0xba)];}registerButton[_0x509f56(0xc6)]('click',handleRegisterClick),teamSelect[_0x509f56(0xc6)]('change',()=>{const _0xbac692=_0x509f56,_0x44205d=teamSelect[_0xbac692(0xe4)];fetchAndDisplayTeamMembers(_0x44205d);}),nicknameInput['addEventListener'](_0x509f56(0xc1),()=>{const _0x4d411f=_0x509f56;nicknameInput['value'][_0x4d411f(0xfc)]()!==''?nicknameInput[_0x4d411f(0xdb)][_0x4d411f(0xca)](_0x4d411f(0x106)):nicknameInput['classList'][_0x4d411f(0xaf)]('nickname-active'),nicknameInput[_0x4d411f(0xe4)][_0x4d411f(0xfc)]()!==''&&currentEmployeeData?(registerButton['disabled']=![],nicknameInput[_0x4d411f(0xdb)][_0x4d411f(0xaf)]('input-error')):registerButton[_0x4d411f(0xb7)]=!![];});function formatThaiTimestamp(_0x534ab8){const _0x126a1d=_0x509f56;return _0x534ab8[_0x126a1d(0x109)]('th-TH',{'dateStyle':_0x126a1d(0xce),'timeStyle':_0x126a1d(0xd5)});}function _0x46d2(){const _0x37a2d4=['2343594LdUTWR','คุณได้ลงทะเบียนไปแล้วเมื่อ','กำลังบันทึก...','checkingIdIndicator','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>ลงทะเบียนสำเร็จ\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และคุณไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ไม่มีทีม)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>','725256xcUmXm','registrationFormContainer','FullName_th','Error\x20fetching\x20team\x20members:\x20','ไม่พบรหัสพนักงานนี้ในระบบ','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','crsg','paste','6414552MUbYAe','เกิดข้อผิดพลาด','Check_Manager','remove','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>ไม่พบสมาชิกในทีมนี้</td></tr>','239065TMWksH','สมาชิก\x20','length','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','bg-gray-50','employeeInfoDisplay','disabled','className','target','message','text-sm\x20mt-4\x20text-yellow-700\x20font-medium','bg-white','error','createElement','textContent','nicknameContainer','input','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','data','log','text-center\x20text-sm\x20text-red-600\x20mt-2','addEventListener','appendChild','Registration\x20Logged\x20successfully.','sort','add','from','Backspace','690612cXbCbL','long','find','ไม่พบข้อมูลที่นั่ง','Firebase\x20initialization\x20failed:','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','ttb-register.firebasestorage.app','103476zghwfo','medium','registrationStatusMessage','ไม่พบข้อมูลสังกัด','hidden','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>','Querying\x20DB\x20for\x20ID\x20(String):','classList','กำลังโหลด...','ttb-register','Check\x20Manager:\x20','เกิดข้อผิดพลาดในการตรวจสอบข้อมูล','เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','Check_Place','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-red-500\x22>เกิดข้อผิดพลาดในการโหลดข้อมูล</td></tr>','https://ttb-register-default-rtdb.asia-southeast1.firebasedatabase.app','value','Error\x20logging\x20registration:\x20','employeeId','docs','BU_eng','ลงทะเบียนเข้าร่วมงานสำเร็จ','registrationTimestamp','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>กำลังโหลดข้อมูล...</td></tr>','querySelectorAll','Signed\x20in\x20anonymously','1070273157855','replace','bg-yellow-100\x20border-b\x20border-yellow-200','clipboardData','key','teamSelect','Validation\x20Error:','focus','Debug','infoDepartment','text','text-center\x20text-sm\x20text-red-600','empty','ttb-register.firebaseapp.com','trim','infoFullName','NickName','otp-active','BU_th','getData','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>','input-error','getElementById','1:1070273157855:web:5c8120e1df27e233d8676a','nickname-active','push','preventDefault','toLocaleString','eventImageContainer','DateLogin','5152406tdWKuk','option','.otp-input','innerHTML','forEach','map','infoManager','infoBU','2KPhCdX','teamMembersTableBody','teamDisplay','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>คุณได้ลงทะเบียนไปแล้ว</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>','16ChHlFT','infoPosition','สมาชิกทีม\x20:\x20','\x20คน','eventDate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>'];_0x46d2=function(){return _0x37a2d4;};return _0x46d2();}function populateTeamDropdown(){const _0x52e479=_0x509f56;teamSelect[_0x52e479(0x10f)]='',teamNames[_0x52e479(0x110)](_0x25a581=>{const _0x122f4c=_0x52e479,_0x1abe04=document[_0x122f4c(0xbe)](_0x122f4c(0x10d));_0x1abe04[_0x122f4c(0xe4)]=_0x25a581,_0x1abe04[_0x122f4c(0xbf)]=_0x25a581,teamSelect[_0x122f4c(0xc7)](_0x1abe04);});}async function getCrsgDoc(_0x5bbcc9){const _0x1f2880=_0x509f56,_0x379893=_0x1f2880(0xaa);console[_0x1f2880(0xc4)](_0x1f2880(0xda),_0x5bbcc9);const _0x1fc336=query(collection(db,_0x379893),where(_0x1f2880(0xe6),'==',String(_0x5bbcc9)),limit(0x1)),_0x60a856=await getDocs(_0x1fc336);if(_0x60a856[_0x1f2880(0xfa)])return null;const _0xd8fc93=_0x60a856[_0x1f2880(0xe7)][0x0];return{'id':_0xd8fc93['id'],'data':_0xd8fc93[_0x1f2880(0xc3)]()};}function updateInputStyle(_0x230fb5){const _0x2a6b75=_0x509f56;_0x230fb5[_0x2a6b75(0xe4)][_0x2a6b75(0xfc)]()!==''?_0x230fb5['classList'][_0x2a6b75(0xca)](_0x2a6b75(0xff)):_0x230fb5[_0x2a6b75(0xdb)][_0x2a6b75(0xaf)](_0x2a6b75(0xff));}function setupOtpInputs(){otpInputs['forEach']((_0x3a6ab7,_0x7e2cd2)=>{const _0xe6e27f=_0x26ab;_0x3a6ab7['addEventListener'](_0xe6e27f(0xc1),_0x1901bf=>{const _0x558dbf=_0xe6e27f;_0x1901bf[_0x558dbf(0xb9)]['value']=_0x1901bf[_0x558dbf(0xb9)][_0x558dbf(0xe4)][_0x558dbf(0xef)](/[^0-9]/g,''),updateInputStyle(_0x3a6ab7),messageDiv[_0x558dbf(0xbf)]='',otpInputs['forEach'](_0xeac43b=>_0xeac43b[_0x558dbf(0xdb)]['remove'](_0x558dbf(0x103))),currentEmployeeData&&resetRegistrationState(),_0x1901bf[_0x558dbf(0xb9)]['value'][_0x558dbf(0xb3)]===0x1&&(_0x7e2cd2<otpInputs[_0x558dbf(0xb3)]-0x1&&otpInputs[_0x7e2cd2+0x1]['focus']()),checkOtpComplete();}),_0x3a6ab7[_0xe6e27f(0xc6)]('keydown',_0x58c46b=>{const _0x3ddd79=_0xe6e27f;_0x58c46b[_0x3ddd79(0xf2)]===_0x3ddd79(0xcc)&&!_0x58c46b[_0x3ddd79(0xb9)]['value']&&_0x7e2cd2>0x0&&otpInputs[_0x7e2cd2-0x1][_0x3ddd79(0xf5)]();}),_0x3a6ab7[_0xe6e27f(0xc6)](_0xe6e27f(0xab),_0x4681cb=>{const _0x1ef954=_0xe6e27f;_0x4681cb[_0x1ef954(0x108)]();const _0x1b8e16=_0x4681cb[_0x1ef954(0xf1)][_0x1ef954(0x101)](_0x1ef954(0xf8))[_0x1ef954(0xfc)](),_0x2b393b=_0x1b8e16['replace'](/[^0-9]/g,'');if(_0x2b393b){const _0x2bbca2=_0x2b393b['split']('');otpInputs[_0x1ef954(0x110)]((_0x529dfc,_0x47eb76)=>{const _0x52685d=_0x1ef954;_0x2bbca2[_0x47eb76]&&(_0x529dfc[_0x52685d(0xe4)]=_0x2bbca2[_0x47eb76],updateInputStyle(_0x529dfc));}),checkOtpComplete();const _0x566e40=Array[_0x1ef954(0xcb)](otpInputs)[_0x1ef954(0xcf)](_0x5ea759=>!_0x5ea759[_0x1ef954(0xe4)]);if(_0x566e40)_0x566e40[_0x1ef954(0xf5)]();else otpInputs[0x4][_0x1ef954(0xf5)]();}});});}function checkOtpComplete(){const _0x536328=_0x509f56,_0x102651=Array['from'](otpInputs)[_0x536328(0x111)](_0x6c1d36=>_0x6c1d36[_0x536328(0xe4)])['join']('');_0x102651[_0x536328(0xb3)]===0x5?validateEmployeeId(_0x102651):resetRegistrationState();}function resetRegistrationState(){const _0x2c88e5=_0x509f56;currentEmployeeData=null,nicknameContainer[_0x2c88e5(0xdb)][_0x2c88e5(0xca)](_0x2c88e5(0xd8)),nicknameInput['value']='',nicknameInput[_0x2c88e5(0xdb)][_0x2c88e5(0xaf)](_0x2c88e5(0x106)),registerButton[_0x2c88e5(0xb7)]=!![];}async function validateEmployeeId(_0x17725b){const _0x284642=_0x509f56;checkingIdIndicator[_0x284642(0xdb)]['remove'](_0x284642(0xd8)),otpInputs[_0x284642(0x110)](_0xe53f93=>_0xe53f93[_0x284642(0xb7)]=!![]);try{const _0x5bdd4a=await getCrsgDoc(_0x17725b);_0x5bdd4a?(currentEmployeeData=_0x5bdd4a,nicknameContainer[_0x284642(0xdb)]['remove'](_0x284642(0xd8)),messageDiv[_0x284642(0xbf)]='',setTimeout(()=>nicknameInput[_0x284642(0xf5)](),0x12c)):(messageDiv[_0x284642(0xbf)]=_0x284642(0xa8),messageDiv[_0x284642(0xb8)]=_0x284642(0xc5),otpInputs[_0x284642(0x110)](_0x403b3e=>{const _0x30d93c=_0x284642;_0x403b3e[_0x30d93c(0xe4)]='',_0x403b3e[_0x30d93c(0xdb)][_0x30d93c(0xaf)](_0x30d93c(0xff)),_0x403b3e['classList'][_0x30d93c(0xca)](_0x30d93c(0x103)),_0x403b3e[_0x30d93c(0xb7)]=![];}),registerButton[_0x284642(0xb7)]=!![],setTimeout(()=>otpInputs[0x0]['focus'](),0x64));}catch(_0xe783e1){console[_0x284642(0xbd)](_0x284642(0xf4),_0xe783e1),messageDiv[_0x284642(0xbf)]=_0x284642(0xdf),messageDiv[_0x284642(0xb8)]='text-center\x20text-sm\x20text-red-600\x20mt-2',otpInputs[_0x284642(0x110)](_0x184bb4=>_0x184bb4['disabled']=![]);}finally{checkingIdIndicator[_0x284642(0xdb)][_0x284642(0xca)]('hidden'),currentEmployeeData&&otpInputs[_0x284642(0x110)](_0xc59543=>_0xc59543[_0x284642(0xb7)]=![]);}}async function handleRegisterClick(){const _0x277ec0=_0x509f56,_0x492074=nicknameInput[_0x277ec0(0xe4)][_0x277ec0(0xfc)]();if(!currentEmployeeData||!_0x492074)return;registerButton[_0x277ec0(0xb7)]=!![],registerButton[_0x277ec0(0xbf)]=_0x277ec0(0xa1),otpInputs[_0x277ec0(0x110)](_0xcceb40=>_0xcceb40[_0x277ec0(0xb7)]=!![]),nicknameInput[_0x277ec0(0xb7)]=!![];const _0x3b281f=currentEmployeeData[_0x277ec0(0xc3)],_0x46f89b=currentEmployeeData['id'],_0x4715b1=_0x3b281f['Check_Place']||_0x277ec0(0xd0),_0x1b2e21=_0x4715b1===_0x277ec0(0xd0);try{if(_0x3b281f[_0x277ec0(0x10b)]){const _0x5db08c=_0x3b281f['DateLogin']['toDate']();if(_0x1b2e21){messageDiv['innerHTML']=_0x277ec0(0x117)+formatThaiTimestamp(_0x5db08c)+_0x277ec0(0xc2),messageDiv[_0x277ec0(0xb8)]=_0x277ec0(0xf9),teamDisplay['classList'][_0x277ec0(0xca)](_0x277ec0(0xd8));const _0x2f23c3=teamNames[0x0]||'A';teamSelect[_0x277ec0(0xe4)]=_0x2f23c3,fetchAndDisplayTeamMembers(_0x2f23c3);}else teamNameDisplay['textContent']=_0x4715b1,regStatusMsg['textContent']=_0x277ec0(0xa0),regStatusMsg[_0x277ec0(0xb8)]=_0x277ec0(0xbb),regTimestamp[_0x277ec0(0xbf)]=formatThaiTimestamp(_0x5db08c),teamDisplay['classList'][_0x277ec0(0xaf)](_0x277ec0(0xd8)),teamSelect[_0x277ec0(0xe4)]=_0x4715b1,fetchAndDisplayTeamMembers(_0x4715b1);await updateDoc(doc(db,_0x277ec0(0xaa),_0x46f89b),{'NickName':_0x492074}),showSuccessState(_0x3b281f,_0x492074);return;}const _0x3823fc=await logRegistration(_0x46f89b,_0x492074);if(_0x1b2e21){messageDiv['innerHTML']=_0x277ec0(0xa3)+formatThaiTimestamp(_0x3823fc)+_0x277ec0(0xa9),messageDiv[_0x277ec0(0xb8)]='text-center\x20text-sm\x20text-red-600',teamDisplay[_0x277ec0(0xdb)][_0x277ec0(0xca)](_0x277ec0(0xd8));const _0x253c30=teamNames[0x0]||'A';teamSelect['value']=_0x253c30,fetchAndDisplayTeamMembers(_0x253c30);}else teamNameDisplay['textContent']=_0x4715b1,regStatusMsg['textContent']=_0x277ec0(0xe9),regStatusMsg[_0x277ec0(0xb8)]='text-sm\x20mt-4\x20text-green-600\x20font-medium',regTimestamp['textContent']=formatThaiTimestamp(_0x3823fc),teamDisplay[_0x277ec0(0xdb)][_0x277ec0(0xaf)](_0x277ec0(0xd8)),teamSelect[_0x277ec0(0xe4)]=_0x4715b1,fetchAndDisplayTeamMembers(_0x4715b1);showSuccessState(_0x3b281f,_0x492074);}catch(_0x2368dc){console['error']('Registration\x20Error:\x20',_0x2368dc),messageDiv[_0x277ec0(0xbf)]='เกิดข้อผิดพลาด:\x20'+_0x2368dc[_0x277ec0(0xba)],messageDiv[_0x277ec0(0xb8)]=_0x277ec0(0xf9),registerButton[_0x277ec0(0xb7)]=![],registerButton[_0x277ec0(0xbf)]='ลงทะเบียน',otpInputs[_0x277ec0(0x110)](_0x3a1f67=>_0x3a1f67[_0x277ec0(0xb7)]=![]),nicknameInput[_0x277ec0(0xb7)]=![];}}function showSuccessState(_0x1c84b8,_0x4963c7){const _0x111d37=_0x509f56;if(registrationForm)registrationForm[_0x111d37(0xdb)][_0x111d37(0xca)](_0x111d37(0xd8));if(eventDate)eventDate[_0x111d37(0xdb)][_0x111d37(0xca)](_0x111d37(0xd8));if(eventImageContainer)eventImageContainer['classList']['add'](_0x111d37(0xd8));if(infoFullName)infoFullName['textContent']=(_0x1c84b8[_0x111d37(0xa6)]||'')+'\x20('+(_0x1c84b8[_0x111d37(0xe6)]||'')+')';if(infoBU)infoBU[_0x111d37(0xbf)]='สังกัด:\x20'+(_0x1c84b8[_0x111d37(0xe8)]||_0x1c84b8[_0x111d37(0x100)]||_0x111d37(0xd7));if(infoManager)infoManager[_0x111d37(0xbf)]=_0x111d37(0xde)+(_0x1c84b8[_0x111d37(0xae)]||'-');if(infoPosition)infoPosition[_0x111d37(0xdb)][_0x111d37(0xca)]('hidden');if(infoDepartment)infoDepartment['classList'][_0x111d37(0xca)](_0x111d37(0xd8));if(employeeInfoDisplay)employeeInfoDisplay[_0x111d37(0xdb)]['remove'](_0x111d37(0xd8));if(teamMembersDisplay)teamMembersDisplay[_0x111d37(0xdb)][_0x111d37(0xaf)]('hidden');}async function logRegistration(_0x51b166,_0x43d2d2){const _0xeb2f8f=_0x509f56,_0x10d83=new Date();try{const _0x5648a1=doc(db,'crsg',_0x51b166);return await updateDoc(_0x5648a1,{'DateLogin':_0x10d83,'NickName':_0x43d2d2}),console[_0xeb2f8f(0xc4)](_0xeb2f8f(0xc8)),_0x10d83;}catch(_0x92d16){console[_0xeb2f8f(0xbd)](_0xeb2f8f(0xe5),_0x92d16);throw _0x92d16;}}async function fetchAndDisplayTeamMembers(_0x5e6c64){const _0x34e748=_0x509f56;if(!_0x5e6c64){teamMembersDisplay[_0x34e748(0xdb)][_0x34e748(0xca)](_0x34e748(0xd8));return;}teamMembersHeader[_0x34e748(0xbf)]=_0x34e748(0x9b)+_0x5e6c64,teamMembersCount[_0x34e748(0xbf)]=_0x34e748(0xdc),teamMembersTableBody[_0x34e748(0x10f)]=_0x34e748(0xeb);try{const _0x21b653=_0x34e748(0xaa),_0x5358c5=query(collection(db,_0x21b653),where(_0x34e748(0xe1),'==',_0x5e6c64)),_0x88d064=await getDocs(_0x5358c5),_0x5dfb2d=[];_0x88d064[_0x34e748(0x110)](_0x1329ea=>{const _0x2d3fc4=_0x34e748;_0x5dfb2d[_0x2d3fc4(0x107)](_0x1329ea[_0x2d3fc4(0xc3)]());}),_0x5dfb2d[_0x34e748(0xc9)]((_0x4ee8ce,_0x4a0c26)=>(_0x4ee8ce[_0x34e748(0xa6)]||'')['localeCompare'](_0x4a0c26[_0x34e748(0xa6)]||'')),teamMembersCount[_0x34e748(0xbf)]=_0x34e748(0xb2)+_0x5dfb2d['length']+_0x34e748(0x9c);if(_0x5dfb2d[_0x34e748(0xb3)]===0x0){teamMembersTableBody[_0x34e748(0x10f)]=_0x34e748(0xb0);return;}teamMembersTableBody['innerHTML']='',_0x5dfb2d[_0x34e748(0x110)]((_0x12d835,_0x378001)=>{const _0x7b6205=_0x34e748,_0x5dd661=!!_0x12d835[_0x7b6205(0x10b)],_0x48434d=_0x5dd661?'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>':_0x7b6205(0x102),_0x528558=_0x12d835[_0x7b6205(0xfe)]?(_0x12d835[_0x7b6205(0xa6)]||'')+'\x20('+_0x12d835[_0x7b6205(0xfe)]+')':_0x12d835[_0x7b6205(0xa6)]||'',_0x15b34c=document[_0x7b6205(0xbe)]('tr');_0x5dd661?_0x15b34c[_0x7b6205(0xb8)]=_0x7b6205(0xf0):_0x15b34c[_0x7b6205(0xb8)]=_0x378001%0x2===0x0?_0x7b6205(0xbc):_0x7b6205(0xb5),_0x15b34c[_0x7b6205(0x10f)]=_0x7b6205(0x9e)+_0x528558+_0x7b6205(0xd9)+(_0x12d835['Check_Manager']||'')+_0x7b6205(0xd9)+_0x48434d+_0x7b6205(0xb4),teamMembersTableBody['appendChild'](_0x15b34c);});}catch(_0x33633b){console[_0x34e748(0xbd)](_0x34e748(0xa7),_0x33633b),teamMembersTableBody[_0x34e748(0x10f)]=_0x34e748(0xe2),teamMembersCount[_0x34e748(0xbf)]=_0x34e748(0xad);}}
        
    </script>
</body>
</html>
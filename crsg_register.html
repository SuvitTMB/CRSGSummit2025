<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRSG Summit 2025</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .input-error {
            border-color: #EF4444 !important; /* red-500 */
            border-width: 2px !important;
        }
        /* Animation for showing inputs */
        .fade-in-down {
            animation: fadeInDown 0.3s ease-out forwards;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom class สำหรับสถานะ Active ของ OTP */
        .otp-active {
            background-color: #0056ff !important;
            color: white !important;
            /* (แก้ไข) ปรับ Border เป็นสีดำตาม Requirement */
            border-color: #000000 !important; 
            border-width: 2px !important;
        }
        /* Custom class สำหรับสถานะ Active (สีส้ม) ของ Nickname */
        .nickname-active {
            background-color: #f97316 !important; /* Orange-500 */
            color: white !important;
            border-color: #f97316 !important;
        }
        /* ปรับสี Placeholder ตอนเป็นสีส้มให้อ่านง่ายขึ้น */
        .nickname-active::placeholder {
            color: #ffedd5;
        }
    </style>
</head>
<!-- ปรับตำแหน่งให้ห่างจากด้านบน 15% (pt-[15vh]) -->
<body class="bg-white flex flex-col items-center justify-start min-h-screen pt-[5vh] pb-10" style="background-color: #dee1e1;">

    <!-- กล่องลงทะเบียน -->
    <div id="registrationFormContainer" class="w-[95%] max-w-md p-8 space-y-6 bg-gray-50 rounded-lg shadow-md transition-colors duration-300">
        <h1 class="text-2xl font-bold text-center text-gray-900"><center><img src="./images/crsg.png" style="width:130%;"></center></h1>
        <p id="eventDate" class="text-sm font-medium text-gray-700 text-center" style="margin: -20px auto 40px auto;">วันที่ 24 พฤศจิกายน 2568</p>
              
        <!-- ส่วนแสดงข้อมูลพนักงาน (ซ่อนไว้ตอนเริ่ม) -->
        <div id="employeeInfoDisplay" class="hidden text-center space-y-2 py-4">
            <p id="infoFullName" class="text-lg font-bold text-gray-900"></p>
            <!-- ซ่อน Position และ Department -->
            <p id="infoPosition" class="text-sm text-gray-700 hidden"></p>
            <p id="infoDepartment" class="text-sm text-gray-700 hidden"></p>
            <!-- แสดง BU -->
            <p id="infoBU" class="text-sm text-gray-700"></p>
            <!-- (เพิ่ม) แสดง Check_Manager ใต้สังกัด -->
            <p id="infoManager" class="text-sm text-gray-700"></p>
        </div>

        <!-- ฟอร์มลงทะเบียน -->
        <form id="registrationForm" class="space-y-6" onsubmit="return false;"> <!-- Prevent default submit -->
            <div>
                <!-- 5 Input Boxes -->
                <div class="flex justify-center gap-2" id="otp-container">
                    <!-- (แก้ไข) เพิ่ม inputmode="numeric" และ oninput เพื่อกรองตัวเลข -->
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="0">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="1">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="2">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="3">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="4">
                </div>
                
                <p class="block text-sm font-medium text-gray-700 mt-3 text-center">กรุณากรอกรหัสพนักงานของท่าน</p>

                <!-- Loading Indicator -->
                <p id="checkingIdIndicator" class="hidden text-center text-xs text-blue-600 mt-2">กำลังตรวจสอบ...</p>
            </div>
            
            <!-- Nickname Container -->
            <div id="nicknameContainer" class="hidden flex flex-col items-center fade-in-down">
                <input type="text" id="nickname" name="nickname" 
                       class="w-1/2 px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-center transition-colors duration-150" 
                       placeholder="ชื่อเล่น">
                
                <label for="nickname" class="block text-sm font-medium text-gray-700 mt-2 text-center">กรอกชื่อเล่นของคุณ ก่อนลงทะเบียน</label>
            </div>
            
            <!-- ปุ่ม Disabled ไว้ก่อน, กว้าง 70%, จัดกึ่งกลาง, สีพื้นหลัง #002d63 -->
            <button type="button" id="registerButton" disabled
                    class="block mx-auto w-[70%] px-4 py-2 font-medium text-white bg-[#002d63] rounded-md hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed">
                ลงทะเบียน
            </button>
        </form>
        
        <!-- พื้นที่แสดงข้อความ --><div id="message" class="text-center text-sm"></div>

        <div id="teamDisplay" class="hidden text-center border-t pt-4 mt-4">
            <h2 id="teamNameDisplay" class="text-8xl font-bold text-[#0056ff]"></h2> 
            <p class="text-sm font-medium text-gray-700 mt-1">ทีมของคุณ</p>
            
            <p id="registrationStatusMessage" class="text-sm mt-4"></p>
            <p id="registrationTimestamp" class="text-xs text-gray-500"></p>
        </div>
    </div>

    <!-- ส่วนแสดงสมาชิกในทีม -->
    <div id="teamMembersDisplay" class="hidden w-[95%] max-w-4xl p-6 bg-white rounded-lg shadow-md mt-8">
        <div class="flex flex-col md:flex-row justify-between md:items-center mb-4 gap-3">
            <h3 id="teamMembersHeader" class="text-lg font-semibold text-gray-800">สมาชิกทีม : ...</h3>
            <div class="flex items-center gap-4">
                <div>
                    <label for="teamSelect" class="text-sm font-medium mr-2">เลือกทีม:</label>
                    <select id="teamSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm py-2 px-3">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <span id="teamMembersCount" class="text-sm font-medium text-gray-600">สมาชิก ... คน</span>
            </div>
        </div>
        <div class="overflow-x-auto border rounded-lg">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                    </tr>
                </thead>
                <tbody id="teamMembersTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Data will be populated by JS -->
                </tbody>
            </table>
        </div>
    </div>


    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
const _0x3d9ab0=_0x3dde;(function(_0x15a786,_0x1a5bdc){const _0x5d3d36=_0x3dde,_0x999738=_0x15a786();while(!![]){try{const _0x1dba5f=parseInt(_0x5d3d36(0x15b))/0x1*(-parseInt(_0x5d3d36(0x19a))/0x2)+parseInt(_0x5d3d36(0x165))/0x3+-parseInt(_0x5d3d36(0x15f))/0x4*(-parseInt(_0x5d3d36(0x196))/0x5)+-parseInt(_0x5d3d36(0x141))/0x6+parseInt(_0x5d3d36(0x150))/0x7+-parseInt(_0x5d3d36(0x14c))/0x8*(-parseInt(_0x5d3d36(0x190))/0x9)+parseInt(_0x5d3d36(0x134))/0xa*(-parseInt(_0x5d3d36(0x16b))/0xb);if(_0x1dba5f===_0x1a5bdc)break;else _0x999738['push'](_0x999738['shift']());}catch(_0x55941f){_0x999738['push'](_0x999738['shift']());}}}(_0x825c,0xae264));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';import{getFirestore,collection,getDocs,query,where,serverTimestamp,setLogLevel,limit,doc,updateDoc}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';import{getAuth,signInAnonymously}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';const firebaseConfig={'apiKey':_0x3d9ab0(0x173),'authDomain':_0x3d9ab0(0x192),'databaseURL':_0x3d9ab0(0x17c),'projectId':'ttb-register','storageBucket':'ttb-register.firebasestorage.app','messagingSenderId':_0x3d9ab0(0x1a0),'appId':_0x3d9ab0(0x166),'measurementId':_0x3d9ab0(0x158)},teamNames=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','AA','BB','CC','DD','EE','FF','GG','HH','II','JJ','KK','LL','MM','NN','OO','PP','QQ'];let db,auth,currentEmployeeData=null;const registrationFormContainer=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x144)),otpInputs=document[_0x3d9ab0(0x172)]('.otp-input'),checkingIdIndicator=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x1ab)),nicknameContainer=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x159)),nicknameInput=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x198)),registerButton=document[_0x3d9ab0(0x160)]('registerButton'),messageDiv=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x1a6)),teamDisplay=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x175)),teamNameDisplay=document[_0x3d9ab0(0x160)]('teamNameDisplay'),regStatusMsg=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x178)),regTimestamp=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x147)),eventDate=document['getElementById'](_0x3d9ab0(0x136)),eventImageContainer=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x17f)),registrationForm=document['getElementById']('registrationForm'),employeeInfoDisplay=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x153)),infoFullName=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x1a2)),infoPosition=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x151)),infoDepartment=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x13d)),infoBU=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x18d)),infoManager=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x16c)),teamMembersDisplay=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x15e)),teamMembersHeader=document[_0x3d9ab0(0x160)]('teamMembersHeader'),teamMembersCount=document['getElementById']('teamMembersCount'),teamMembersTableBody=document['getElementById'](_0x3d9ab0(0x13e)),teamSelect=document[_0x3d9ab0(0x160)](_0x3d9ab0(0x14a));function _0x3dde(_0x166fbd,_0x4ece8d){const _0x825c32=_0x825c();return _0x3dde=function(_0x3dded5,_0x2d549d){_0x3dded5=_0x3dded5-0x134;let _0x2b2d98=_0x825c32[_0x3dded5];return _0x2b2d98;},_0x3dde(_0x166fbd,_0x4ece8d);}try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel(_0x3d9ab0(0x13a)),await signInAnonymously(auth),console[_0x3d9ab0(0x140)](_0x3d9ab0(0x14f)),populateTeamDropdown(),setupOtpInputs(),otpInputs[0x0]['focus']();}catch(_0x2985aa){console[_0x3d9ab0(0x18c)](_0x3d9ab0(0x163),_0x2985aa),document[_0x3d9ab0(0x160)]('message')[_0x3d9ab0(0x183)]=_0x3d9ab0(0x189)+_0x2985aa[_0x3d9ab0(0x1a6)];}registerButton[_0x3d9ab0(0x142)](_0x3d9ab0(0x1a9),handleRegisterClick),teamSelect[_0x3d9ab0(0x142)]('change',()=>{const _0x3c8dd8=_0x3d9ab0,_0x21b93a=teamSelect[_0x3c8dd8(0x199)];fetchAndDisplayTeamMembers(_0x21b93a);}),nicknameInput[_0x3d9ab0(0x142)](_0x3d9ab0(0x137),()=>{const _0x3f99a7=_0x3d9ab0;nicknameInput[_0x3f99a7(0x199)][_0x3f99a7(0x155)]()!==''?nicknameInput[_0x3f99a7(0x1a7)]['add'](_0x3f99a7(0x167)):nicknameInput[_0x3f99a7(0x1a7)][_0x3f99a7(0x14e)](_0x3f99a7(0x167)),nicknameInput[_0x3f99a7(0x199)][_0x3f99a7(0x155)]()!==''&&currentEmployeeData?(registerButton[_0x3f99a7(0x169)]=![],nicknameInput['classList']['remove'](_0x3f99a7(0x170))):registerButton[_0x3f99a7(0x169)]=!![];});function _0x825c(){const _0x5ec23f=['Signed\x20in\x20anonymously','4064795MbNONT','infoPosition','medium','employeeInfoDisplay','forEach','trim','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>','localeCompare','G-9DJLWJ5LQ1','nicknameContainer','Check_Manager','1268087EwAKVO','data','empty','teamMembersDisplay','4TlNlTL','getElementById','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>','add','Firebase\x20initialization\x20failed:','focus','3912390bCUtpA','1:1070273157855:web:5c8120e1df27e233d8676a','nickname-active','bg-yellow-100\x20border-b\x20border-yellow-200','disabled','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>','469447YwRyuh','infoManager','BU_eng','appendChild','Querying\x20DB\x20for\x20ID\x20(String):','input-error','bg-gray-50','querySelectorAll','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','toDate','teamDisplay','คุณได้ลงทะเบียนไปแล้วเมื่อ','push','registrationStatusMessage','crsg','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','replace','https://ttb-register-default-rtdb.asia-southeast1.firebasedatabase.app','find','FullName_th','eventImageContainer','createElement','กำลังบันทึก...','paste','textContent','Registration\x20Error:\x20','Error\x20fetching\x20team\x20members:\x20','NickName','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','ไม่พบข้อมูลสังกัด','เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','target','getData','error','infoBU','bg-white','otp-active','9LNIxjC','เกิดข้อผิดพลาดในการตรวจสอบข้อมูล','ttb-register.firebaseapp.com','กำลังโหลด...','BU_th','สมาชิกทีม\x20:\x20','1985835QAaPHo','toLocaleString','nickname','value','2ugPDPu','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>ไม่พบสมาชิกในทีมนี้</td></tr>','hidden','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>','Backspace','text-sm\x20mt-4\x20text-green-600\x20font-medium','1070273157855','text-center\x20text-sm\x20text-red-600','infoFullName','DateLogin','ไม่พบข้อมูลที่นั่ง','from','message','classList','employeeId','click','innerHTML','checkingIdIndicator','className','70AMenuh','Check_Place','eventDate','input','ลงทะเบียน','option','Debug','th-TH','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>กำลังโหลดข้อมูล...</td></tr>','infoDepartment','teamMembersTableBody','text-center\x20text-sm\x20text-red-600\x20mt-2','log','4648068LIcjJt','addEventListener','ลงทะเบียนเข้าร่วมงานสำเร็จ','registrationFormContainer','length','เกิดข้อผิดพลาด','registrationTimestamp','Error\x20logging\x20registration:\x20','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-red-500\x22>เกิดข้อผิดพลาดในการโหลดข้อมูล</td></tr>','teamSelect','Validation\x20Error:','6182704PlmXqq','preventDefault','remove'];_0x825c=function(){return _0x5ec23f;};return _0x825c();}function formatThaiTimestamp(_0x13c4b3){const _0x285d3a=_0x3d9ab0;return _0x13c4b3[_0x285d3a(0x197)](_0x285d3a(0x13b),{'dateStyle':'long','timeStyle':_0x285d3a(0x152)});}function populateTeamDropdown(){const _0x312870=_0x3d9ab0;teamSelect[_0x312870(0x1aa)]='',teamNames[_0x312870(0x154)](_0x1b24a2=>{const _0x425276=_0x312870,_0x4d20ea=document[_0x425276(0x180)](_0x425276(0x139));_0x4d20ea[_0x425276(0x199)]=_0x1b24a2,_0x4d20ea[_0x425276(0x183)]=_0x1b24a2,teamSelect[_0x425276(0x16e)](_0x4d20ea);});}async function getCrsgDoc(_0x30c1ac){const _0x413607=_0x3d9ab0,_0x16a8dd=_0x413607(0x179);console[_0x413607(0x140)](_0x413607(0x16f),_0x30c1ac);const _0x1e5aad=query(collection(db,_0x16a8dd),where(_0x413607(0x1a8),'==',String(_0x30c1ac)),limit(0x1)),_0x5424d4=await getDocs(_0x1e5aad);if(_0x5424d4[_0x413607(0x15d)])return null;const _0x5af860=_0x5424d4['docs'][0x0];return{'id':_0x5af860['id'],'data':_0x5af860[_0x413607(0x15c)]()};}function updateInputStyle(_0xbb7325){const _0xeff517=_0x3d9ab0;_0xbb7325['value'][_0xeff517(0x155)]()!==''?_0xbb7325[_0xeff517(0x1a7)][_0xeff517(0x162)](_0xeff517(0x18f)):_0xbb7325['classList'][_0xeff517(0x14e)](_0xeff517(0x18f));}function setupOtpInputs(){const _0x3f4324=_0x3d9ab0;otpInputs[_0x3f4324(0x154)]((_0x328edf,_0x10ab26)=>{const _0x4fbf90=_0x3f4324;_0x328edf[_0x4fbf90(0x142)](_0x4fbf90(0x137),_0x19f445=>{const _0x17f57b=_0x4fbf90;_0x19f445[_0x17f57b(0x18a)][_0x17f57b(0x199)]=_0x19f445[_0x17f57b(0x18a)][_0x17f57b(0x199)][_0x17f57b(0x17b)](/[^0-9]/g,''),updateInputStyle(_0x328edf),messageDiv[_0x17f57b(0x183)]='',otpInputs[_0x17f57b(0x154)](_0x28b1b0=>_0x28b1b0['classList'][_0x17f57b(0x14e)](_0x17f57b(0x170))),currentEmployeeData&&resetRegistrationState(),_0x19f445['target'][_0x17f57b(0x199)][_0x17f57b(0x145)]===0x1&&(_0x10ab26<otpInputs[_0x17f57b(0x145)]-0x1&&otpInputs[_0x10ab26+0x1][_0x17f57b(0x164)]()),checkOtpComplete();}),_0x328edf[_0x4fbf90(0x142)]('keydown',_0x52809c=>{const _0x19e329=_0x4fbf90;_0x52809c['key']===_0x19e329(0x19e)&&!_0x52809c[_0x19e329(0x18a)]['value']&&_0x10ab26>0x0&&otpInputs[_0x10ab26-0x1][_0x19e329(0x164)]();}),_0x328edf[_0x4fbf90(0x142)](_0x4fbf90(0x182),_0x316d45=>{const _0x2943c0=_0x4fbf90;_0x316d45[_0x2943c0(0x14d)]();const _0x19dec7=_0x316d45['clipboardData'][_0x2943c0(0x18b)]('text')[_0x2943c0(0x155)](),_0xcf0fb6=_0x19dec7['replace'](/[^0-9]/g,'');if(_0xcf0fb6){const _0x50e089=_0xcf0fb6['split']('');otpInputs[_0x2943c0(0x154)]((_0x31d83f,_0x3c72db)=>{const _0x28a027=_0x2943c0;_0x50e089[_0x3c72db]&&(_0x31d83f[_0x28a027(0x199)]=_0x50e089[_0x3c72db],updateInputStyle(_0x31d83f));}),checkOtpComplete();const _0x45c463=Array[_0x2943c0(0x1a5)](otpInputs)[_0x2943c0(0x17d)](_0x3459cc=>!_0x3459cc[_0x2943c0(0x199)]);if(_0x45c463)_0x45c463[_0x2943c0(0x164)]();else otpInputs[0x4][_0x2943c0(0x164)]();}});});}function checkOtpComplete(){const _0x31f822=_0x3d9ab0,_0x5c9ffd=Array['from'](otpInputs)['map'](_0x28dc2b=>_0x28dc2b[_0x31f822(0x199)])['join']('');_0x5c9ffd[_0x31f822(0x145)]===0x5?validateEmployeeId(_0x5c9ffd):resetRegistrationState();}function resetRegistrationState(){const _0x4d5497=_0x3d9ab0;currentEmployeeData=null,nicknameContainer[_0x4d5497(0x1a7)][_0x4d5497(0x162)](_0x4d5497(0x19c)),nicknameInput[_0x4d5497(0x199)]='',nicknameInput[_0x4d5497(0x1a7)][_0x4d5497(0x14e)](_0x4d5497(0x167)),registerButton[_0x4d5497(0x169)]=!![];}async function validateEmployeeId(_0x359d9b){const _0x37f809=_0x3d9ab0;checkingIdIndicator[_0x37f809(0x1a7)]['remove']('hidden'),otpInputs[_0x37f809(0x154)](_0x58686c=>_0x58686c['disabled']=!![]);try{const _0x475915=await getCrsgDoc(_0x359d9b);_0x475915?(currentEmployeeData=_0x475915,nicknameContainer[_0x37f809(0x1a7)][_0x37f809(0x14e)](_0x37f809(0x19c)),messageDiv[_0x37f809(0x183)]='',setTimeout(()=>nicknameInput[_0x37f809(0x164)](),0x12c)):(messageDiv[_0x37f809(0x183)]='ไม่พบรหัสพนักงานนี้ในระบบ',messageDiv[_0x37f809(0x1ac)]=_0x37f809(0x13f),otpInputs[_0x37f809(0x154)](_0x2ec5b5=>{const _0x2c8dbc=_0x37f809;_0x2ec5b5[_0x2c8dbc(0x199)]='',_0x2ec5b5[_0x2c8dbc(0x1a7)][_0x2c8dbc(0x14e)](_0x2c8dbc(0x18f)),_0x2ec5b5[_0x2c8dbc(0x1a7)][_0x2c8dbc(0x162)]('input-error'),_0x2ec5b5[_0x2c8dbc(0x169)]=![];}),registerButton[_0x37f809(0x169)]=!![],setTimeout(()=>otpInputs[0x0][_0x37f809(0x164)](),0x64));}catch(_0x3c25df){console['error'](_0x37f809(0x14b),_0x3c25df),messageDiv[_0x37f809(0x183)]=_0x37f809(0x191),messageDiv[_0x37f809(0x1ac)]=_0x37f809(0x13f),otpInputs[_0x37f809(0x154)](_0x1fe2cb=>_0x1fe2cb[_0x37f809(0x169)]=![]);}finally{checkingIdIndicator['classList'][_0x37f809(0x162)]('hidden'),currentEmployeeData&&otpInputs[_0x37f809(0x154)](_0x11c3b3=>_0x11c3b3[_0x37f809(0x169)]=![]);}}async function handleRegisterClick(){const _0x4537f7=_0x3d9ab0,_0x1e3f71=nicknameInput[_0x4537f7(0x199)][_0x4537f7(0x155)]();if(!currentEmployeeData||!_0x1e3f71)return;registerButton['disabled']=!![],registerButton[_0x4537f7(0x183)]=_0x4537f7(0x181),otpInputs['forEach'](_0x1ad055=>_0x1ad055['disabled']=!![]),nicknameInput[_0x4537f7(0x169)]=!![];const _0x1136e9=currentEmployeeData[_0x4537f7(0x15c)],_0x4e3403=currentEmployeeData['id'],_0x417ae7=_0x1136e9[_0x4537f7(0x135)]||'ไม่พบข้อมูลที่นั่ง',_0x350613=_0x417ae7===_0x4537f7(0x1a4);try{if(_0x1136e9[_0x4537f7(0x1a3)]){const _0x4e7c24=_0x1136e9[_0x4537f7(0x1a3)][_0x4537f7(0x174)]();if(_0x350613){messageDiv[_0x4537f7(0x1aa)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>คุณได้ลงทะเบียนไปแล้ว</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>'+formatThaiTimestamp(_0x4e7c24)+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',messageDiv[_0x4537f7(0x1ac)]='text-center\x20text-sm\x20text-red-600',teamDisplay[_0x4537f7(0x1a7)][_0x4537f7(0x162)]('hidden');const _0x4a397e=teamNames[0x0]||'A';teamSelect[_0x4537f7(0x199)]=_0x4a397e,fetchAndDisplayTeamMembers(_0x4a397e);}else teamNameDisplay[_0x4537f7(0x183)]=_0x417ae7,regStatusMsg[_0x4537f7(0x183)]=_0x4537f7(0x176),regStatusMsg[_0x4537f7(0x1ac)]='text-sm\x20mt-4\x20text-yellow-700\x20font-medium',regTimestamp[_0x4537f7(0x183)]=formatThaiTimestamp(_0x4e7c24),teamDisplay['classList'][_0x4537f7(0x14e)](_0x4537f7(0x19c)),teamSelect[_0x4537f7(0x199)]=_0x417ae7,fetchAndDisplayTeamMembers(_0x417ae7);await updateDoc(doc(db,_0x4537f7(0x179),_0x4e3403),{'NickName':_0x1e3f71}),showSuccessState(_0x1136e9,_0x1e3f71);return;}const _0x59c9c7=await logRegistration(_0x4e3403,_0x1e3f71);if(_0x350613){messageDiv[_0x4537f7(0x1aa)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>ลงทะเบียนสำเร็จ\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และคุณไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ไม่มีทีม)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>'+formatThaiTimestamp(_0x59c9c7)+_0x4537f7(0x187),messageDiv[_0x4537f7(0x1ac)]=_0x4537f7(0x1a1),teamDisplay['classList'][_0x4537f7(0x162)](_0x4537f7(0x19c));const _0x3ddc48=teamNames[0x0]||'A';teamSelect[_0x4537f7(0x199)]=_0x3ddc48,fetchAndDisplayTeamMembers(_0x3ddc48);}else teamNameDisplay[_0x4537f7(0x183)]=_0x417ae7,regStatusMsg[_0x4537f7(0x183)]=_0x4537f7(0x143),regStatusMsg[_0x4537f7(0x1ac)]=_0x4537f7(0x19f),regTimestamp[_0x4537f7(0x183)]=formatThaiTimestamp(_0x59c9c7),teamDisplay[_0x4537f7(0x1a7)][_0x4537f7(0x14e)](_0x4537f7(0x19c)),teamSelect[_0x4537f7(0x199)]=_0x417ae7,fetchAndDisplayTeamMembers(_0x417ae7);showSuccessState(_0x1136e9,_0x1e3f71);}catch(_0x22b54f){console['error'](_0x4537f7(0x184),_0x22b54f),messageDiv[_0x4537f7(0x183)]='เกิดข้อผิดพลาด:\x20'+_0x22b54f[_0x4537f7(0x1a6)],messageDiv['className']=_0x4537f7(0x1a1),registerButton[_0x4537f7(0x169)]=![],registerButton['textContent']=_0x4537f7(0x138),otpInputs['forEach'](_0x1f56dc=>_0x1f56dc[_0x4537f7(0x169)]=![]),nicknameInput['disabled']=![];}}function showSuccessState(_0x26b3b3,_0x3412d4){const _0x520b4a=_0x3d9ab0;if(registrationForm)registrationForm[_0x520b4a(0x1a7)][_0x520b4a(0x162)](_0x520b4a(0x19c));if(eventDate)eventDate[_0x520b4a(0x1a7)][_0x520b4a(0x162)](_0x520b4a(0x19c));if(eventImageContainer)eventImageContainer[_0x520b4a(0x1a7)]['add'](_0x520b4a(0x19c));if(infoFullName)infoFullName[_0x520b4a(0x183)]=(_0x26b3b3[_0x520b4a(0x17e)]||'')+'\x20('+(_0x26b3b3['employeeId']||'')+')';if(infoBU)infoBU[_0x520b4a(0x183)]=''+(_0x26b3b3[_0x520b4a(0x16d)]||_0x26b3b3[_0x520b4a(0x194)]||_0x520b4a(0x188));if(infoManager)infoManager[_0x520b4a(0x183)]=''+(_0x26b3b3[_0x520b4a(0x15a)]||'-');if(infoPosition)infoPosition[_0x520b4a(0x1a7)][_0x520b4a(0x162)](_0x520b4a(0x19c));if(infoDepartment)infoDepartment[_0x520b4a(0x1a7)][_0x520b4a(0x162)]('hidden');if(employeeInfoDisplay)employeeInfoDisplay[_0x520b4a(0x1a7)][_0x520b4a(0x14e)](_0x520b4a(0x19c));if(teamMembersDisplay)teamMembersDisplay[_0x520b4a(0x1a7)][_0x520b4a(0x14e)](_0x520b4a(0x19c));}async function logRegistration(_0x8be328,_0x52138b){const _0xd3ccf=_0x3d9ab0,_0x1855d8=new Date();try{const _0x2b2a76=doc(db,_0xd3ccf(0x179),_0x8be328);return await updateDoc(_0x2b2a76,{'DateLogin':_0x1855d8,'NickName':_0x52138b}),console[_0xd3ccf(0x140)]('Registration\x20Logged\x20successfully.'),_0x1855d8;}catch(_0x2933b0){console[_0xd3ccf(0x18c)](_0xd3ccf(0x148),_0x2933b0);throw _0x2933b0;}}async function fetchAndDisplayTeamMembers(_0xf895b6){const _0xcf4ca8=_0x3d9ab0;if(!_0xf895b6){teamMembersDisplay[_0xcf4ca8(0x1a7)][_0xcf4ca8(0x162)](_0xcf4ca8(0x19c));return;}teamMembersHeader[_0xcf4ca8(0x183)]=_0xcf4ca8(0x195)+_0xf895b6,teamMembersCount[_0xcf4ca8(0x183)]=_0xcf4ca8(0x193),teamMembersTableBody[_0xcf4ca8(0x1aa)]=_0xcf4ca8(0x13c);try{const _0x5b73b7=_0xcf4ca8(0x179),_0x584fce=query(collection(db,_0x5b73b7),where(_0xcf4ca8(0x135),'==',_0xf895b6)),_0xbc191f=await getDocs(_0x584fce),_0x516772=[];_0xbc191f[_0xcf4ca8(0x154)](_0x2bca2a=>{const _0xd2a742=_0xcf4ca8;_0x516772[_0xd2a742(0x177)](_0x2bca2a['data']());}),_0x516772['sort']((_0x3494e6,_0x47e8a0)=>(_0x3494e6['FullName_th']||'')[_0xcf4ca8(0x157)](_0x47e8a0[_0xcf4ca8(0x17e)]||'')),teamMembersCount[_0xcf4ca8(0x183)]='สมาชิก\x20'+_0x516772[_0xcf4ca8(0x145)]+'\x20คน';if(_0x516772[_0xcf4ca8(0x145)]===0x0){teamMembersTableBody['innerHTML']=_0xcf4ca8(0x19b);return;}teamMembersTableBody[_0xcf4ca8(0x1aa)]='',_0x516772[_0xcf4ca8(0x154)]((_0x43a7e0,_0x4bd8b5)=>{const _0x2e38bd=_0xcf4ca8,_0xb06acf=!!_0x43a7e0[_0x2e38bd(0x1a3)],_0x4ac7ee=_0xb06acf?_0x2e38bd(0x16a):_0x2e38bd(0x156),_0x34c0bd=_0x43a7e0[_0x2e38bd(0x186)]?(_0x43a7e0[_0x2e38bd(0x17e)]||'')+'\x20('+_0x43a7e0['NickName']+')':_0x43a7e0[_0x2e38bd(0x17e)]||'',_0x1b5a33=document[_0x2e38bd(0x180)]('tr');_0xb06acf?_0x1b5a33[_0x2e38bd(0x1ac)]=_0x2e38bd(0x168):_0x1b5a33['className']=_0x4bd8b5%0x2===0x0?_0x2e38bd(0x18e):_0x2e38bd(0x171),_0x1b5a33[_0x2e38bd(0x1aa)]=_0x2e38bd(0x19d)+_0x34c0bd+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>'+(_0x43a7e0[_0x2e38bd(0x15a)]||'')+_0x2e38bd(0x161)+_0x4ac7ee+_0x2e38bd(0x17a),teamMembersTableBody[_0x2e38bd(0x16e)](_0x1b5a33);});}catch(_0x465ac9){console[_0xcf4ca8(0x18c)](_0xcf4ca8(0x185),_0x465ac9),teamMembersTableBody[_0xcf4ca8(0x1aa)]=_0xcf4ca8(0x149),teamMembersCount['textContent']=_0xcf4ca8(0x146);}}
        
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRSG Summit 2025</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .input-error {
            border-color: #EF4444 !important; /* red-500 */
            border-width: 2px !important;
        }
        /* Animation for showing inputs */
        .fade-in-down {
            animation: fadeInDown 0.3s ease-out forwards;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom class สำหรับสถานะ Active ของ OTP */
        .otp-active {
            background-color: #0056ff !important;
            color: white !important;
            /* (แก้ไข) ปรับ Border เป็นสีดำตาม Requirement */
            border-color: #000000 !important; 
            border-width: 2px !important;
        }
        /* Custom class สำหรับสถานะ Active (สีส้ม) ของ Nickname */
        .nickname-active {
            background-color: #f97316 !important; /* Orange-500 */
            color: white !important;
            border-color: #f97316 !important;
        }
        /* ปรับสี Placeholder ตอนเป็นสีส้มให้อ่านง่ายขึ้น */
        .nickname-active::placeholder {
            color: #ffedd5;
        }
    </style>
</head>
<!-- ปรับตำแหน่งให้ห่างจากด้านบน 15% (pt-[15vh]) -->
<body class="bg-white flex flex-col items-center justify-start min-h-screen pt-[5vh] pb-10" style="background-color: #dee1e1;">

    <!-- กล่องลงทะเบียน -->
    <div id="registrationFormContainer" class="w-[95%] max-w-md p-8 space-y-6 bg-gray-50 rounded-lg shadow-md transition-colors duration-300">
        <h1 class="text-2xl font-bold text-center text-gray-900"><center><img src="./images/crsg.png" style="width:130%;"></center></h1>
        <p id="eventDate" class="text-sm font-medium text-gray-700 text-center" style="margin: -20px auto 40px auto;">วันที่ 24 พฤศจิกายน 2568</p>
              
        <!-- ส่วนแสดงข้อมูลพนักงาน (ซ่อนไว้ตอนเริ่ม) -->
        <div id="employeeInfoDisplay" class="hidden text-center space-y-2 py-4">
            <p id="infoFullName" class="text-lg font-bold text-gray-900"></p>
            <!-- ซ่อน Position และ Department -->
            <p id="infoPosition" class="text-sm text-gray-700 hidden"></p>
            <p id="infoDepartment" class="text-sm text-gray-700 hidden"></p>
            <!-- แสดง BU -->
            <p id="infoBU" class="text-sm text-gray-700"></p>
            <!-- (เพิ่ม) แสดง Check_Manager ใต้สังกัด -->
            <p id="infoManager" class="text-sm text-gray-700"></p>
        </div>

        <!-- ฟอร์มลงทะเบียน -->
        <form id="registrationForm" class="space-y-6" onsubmit="return false;"> <!-- Prevent default submit -->
            <div>
                <!-- 5 Input Boxes -->
                <div class="flex justify-center gap-2" id="otp-container">
                    <!-- (แก้ไข) เพิ่ม inputmode="numeric" และ oninput เพื่อกรองตัวเลข -->
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="0">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="1">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="2">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="3">
                    <input type="text" inputmode="numeric" maxlength="1" class="otp-input w-12 h-14 text-center text-3xl font-bold border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all uppercase" data-index="4">
                </div>
                
                <p class="block text-sm font-medium text-gray-700 mt-3 text-center">กรุณากรอกรหัสพนักงานของท่าน</p>

                <!-- Loading Indicator -->
                <p id="checkingIdIndicator" class="hidden text-center text-xs text-blue-600 mt-2">กำลังตรวจสอบ...</p>
            </div>
            
            <!-- Nickname Container -->
            <div id="nicknameContainer" class="hidden flex flex-col items-center fade-in-down">
                <input type="text" id="nickname" name="nickname" 
                       class="w-1/2 px-3 py-2 mt-1 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-center transition-colors duration-150" 
                       placeholder="ชื่อเล่น">
                
                <label for="nickname" class="block text-sm font-medium text-gray-700 mt-2 text-center">กรอกชื่อเล่นของคุณ ก่อนลงทะเบียน</label>
            </div>
            
            <!-- ปุ่ม Disabled ไว้ก่อน, กว้าง 70%, จัดกึ่งกลาง, สีพื้นหลัง #002d63 -->
            <button type="button" id="registerButton" disabled
                    class="block mx-auto w-[70%] px-4 py-2 font-medium text-white bg-[#002d63] rounded-md hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed">
                ลงทะเบียน
            </button>
        </form>
        
        <!-- พื้นที่แสดงข้อความ --><div id="message" class="text-center text-sm"></div>

        <div id="teamDisplay" class="hidden text-center border-t pt-4 mt-4">
            <h2 id="teamNameDisplay" class="text-8xl font-bold text-[#0056ff]"></h2> 
            <p class="text-sm font-medium text-gray-700 mt-1">ทีมของคุณ</p>
            
            <p id="registrationStatusMessage" class="text-sm mt-4"></p>
            <p id="registrationTimestamp" class="text-xs text-gray-500"></p>
        </div>
    </div>

    <!-- ส่วนแสดงสมาชิกในทีม -->
    <div id="teamMembersDisplay" class="hidden w-[95%] max-w-4xl p-6 bg-white rounded-lg shadow-md mt-8">
        <div class="flex flex-col md:flex-row justify-between md:items-center mb-4 gap-3">
            <h3 id="teamMembersHeader" class="text-lg font-semibold text-gray-800">สมาชิกทีม : ...</h3>
            <div class="flex items-center gap-4">
                <div>
                    <label for="teamSelect" class="text-sm font-medium mr-2">เลือกทีม:</label>
                    <select id="teamSelect" class="rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-sm py-2 px-3">
                        <!-- Options will be populated by JS -->
                    </select>
                </div>
                <span id="teamMembersCount" class="text-sm font-medium text-gray-600">สมาชิก ... คน</span>
            </div>
        </div>
        <div class="overflow-x-auto border rounded-lg">
            <table class="min-w-full text-sm">
                <thead class="bg-gray-100">
                    <tr>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">ชื่อ-นามสกุล</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สังกัด</th>
                        <th class="px-3 py-2 text-left font-medium text-gray-600 uppercase tracking-wider">สถานะ</th>
                    </tr>
                </thead>
                <tbody id="teamMembersTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Data will be populated by JS -->
                </tbody>
            </table>
        </div>
    </div>


    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
function _0x140c(_0x232aed,_0x49ad1a){const _0x19ddc7=_0x19dd();return _0x140c=function(_0x140c9c,_0x483e55){_0x140c9c=_0x140c9c-0xbe;let _0x42b339=_0x19ddc7[_0x140c9c];return _0x42b339;},_0x140c(_0x232aed,_0x49ad1a);}const _0x3b3bd3=_0x140c;(function(_0x58d540,_0x575809){const _0x3d9dd3=_0x140c,_0x47ed51=_0x58d540();while(!![]){try{const _0x51824a=-parseInt(_0x3d9dd3(0x13c))/0x1+-parseInt(_0x3d9dd3(0x137))/0x2+parseInt(_0x3d9dd3(0xf2))/0x3+parseInt(_0x3d9dd3(0x133))/0x4*(parseInt(_0x3d9dd3(0xe5))/0x5)+-parseInt(_0x3d9dd3(0xf5))/0x6*(parseInt(_0x3d9dd3(0x134))/0x7)+-parseInt(_0x3d9dd3(0x117))/0x8+parseInt(_0x3d9dd3(0xc3))/0x9*(parseInt(_0x3d9dd3(0xde))/0xa);if(_0x51824a===_0x575809)break;else _0x47ed51['push'](_0x47ed51['shift']());}catch(_0x20a5a8){_0x47ed51['push'](_0x47ed51['shift']());}}}(_0x19dd,0xe1ca2));import{initializeApp}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';import{getFirestore,collection,getDocs,query,where,serverTimestamp,setLogLevel,limit,doc,updateDoc}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';import{getAuth,signInAnonymously}from'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';const firebaseConfig={'apiKey':_0x3b3bd3(0xbf),'authDomain':_0x3b3bd3(0xfd),'databaseURL':_0x3b3bd3(0xca),'projectId':_0x3b3bd3(0xd5),'storageBucket':_0x3b3bd3(0x113),'messagingSenderId':_0x3b3bd3(0x107),'appId':_0x3b3bd3(0xf0),'measurementId':_0x3b3bd3(0xd9)},teamNames=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','AA','BB','CC','DD','EE','FF','GG','HH','II','JJ','KK','LL','MM','NN','OO','PP','QQ'];let db,auth,currentEmployeeData=null;const registrationFormContainer=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x104)),otpInputs=document[_0x3b3bd3(0xdb)]('.otp-input'),checkingIdIndicator=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x129)),nicknameContainer=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x111)),nicknameInput=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x12e)),registerButton=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x124)),messageDiv=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x122)),teamDisplay=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0xd6)),teamNameDisplay=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x131)),regStatusMsg=document['getElementById'](_0x3b3bd3(0xf1)),regTimestamp=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x13f)),eventDate=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x10b)),eventImageContainer=document['getElementById']('eventImageContainer'),registrationForm=document['getElementById'](_0x3b3bd3(0xe6)),employeeInfoDisplay=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x136)),infoFullName=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x10d)),infoPosition=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x11d)),infoDepartment=document['getElementById'](_0x3b3bd3(0xc8)),infoBU=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0xc0)),infoManager=document['getElementById'](_0x3b3bd3(0x115)),teamMembersDisplay=document['getElementById'](_0x3b3bd3(0xcb)),teamMembersHeader=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0x116)),teamMembersCount=document[_0x3b3bd3(0xe1)]('teamMembersCount'),teamMembersTableBody=document[_0x3b3bd3(0xe1)](_0x3b3bd3(0xfc)),teamSelect=document[_0x3b3bd3(0xe1)]('teamSelect');try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel(_0x3b3bd3(0x13d)),await signInAnonymously(auth),console[_0x3b3bd3(0xe8)]('Signed\x20in\x20anonymously'),populateTeamDropdown(),setupOtpInputs(),otpInputs[0x0]['focus']();}catch(_0x176e36){console[_0x3b3bd3(0x105)]('Firebase\x20initialization\x20failed:',_0x176e36),document[_0x3b3bd3(0xe1)]('message')['textContent']='เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20'+_0x176e36[_0x3b3bd3(0x122)];}registerButton[_0x3b3bd3(0xce)]('click',handleRegisterClick),teamSelect[_0x3b3bd3(0xce)](_0x3b3bd3(0xd2),()=>{const _0x20149a=_0x3b3bd3,_0x8ddfd=teamSelect[_0x20149a(0x10a)];fetchAndDisplayTeamMembers(_0x8ddfd);}),nicknameInput[_0x3b3bd3(0xce)](_0x3b3bd3(0xfa),()=>{const _0x40d1e2=_0x3b3bd3;nicknameInput[_0x40d1e2(0x10a)][_0x40d1e2(0xfb)]()!==''?nicknameInput['classList'][_0x40d1e2(0x112)](_0x40d1e2(0xee)):nicknameInput[_0x40d1e2(0x102)][_0x40d1e2(0x101)](_0x40d1e2(0xee)),nicknameInput[_0x40d1e2(0x10a)][_0x40d1e2(0xfb)]()!==''&&currentEmployeeData?(registerButton[_0x40d1e2(0xe2)]=![],nicknameInput[_0x40d1e2(0x102)][_0x40d1e2(0x101)](_0x40d1e2(0xbe))):registerButton[_0x40d1e2(0xe2)]=!![];});function formatThaiTimestamp(_0x5999c8){const _0xcc23e4=_0x3b3bd3;return _0x5999c8['toLocaleString'](_0xcc23e4(0xdf),{'dateStyle':_0xcc23e4(0xc7),'timeStyle':'medium'});}function populateTeamDropdown(){const _0x22b713=_0x3b3bd3;teamSelect[_0x22b713(0x127)]='',teamNames['forEach'](_0x9b0e44=>{const _0xd49b92=_0x22b713,_0x40e15e=document['createElement'](_0xd49b92(0x114));_0x40e15e[_0xd49b92(0x10a)]=_0x9b0e44,_0x40e15e[_0xd49b92(0x12f)]=_0x9b0e44,teamSelect[_0xd49b92(0xc6)](_0x40e15e);});}async function getCrsgDoc(_0x53a450){const _0x47a730=_0x3b3bd3,_0x3cfbc6=_0x47a730(0x108);console['log'](_0x47a730(0xd4),_0x53a450);const _0x2c3a7e=query(collection(db,_0x3cfbc6),where('employeeId','==',String(_0x53a450)),limit(0x1)),_0x1191f4=await getDocs(_0x2c3a7e);if(_0x1191f4['empty'])return null;const _0x3f48f4=_0x1191f4[_0x47a730(0x139)][0x0];return{'id':_0x3f48f4['id'],'data':_0x3f48f4[_0x47a730(0xc4)]()};}function _0x19dd(){const _0x47d2bc=['className','sort','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','remove','classList','bg-gray-50','registrationFormContainer','error','text','1070273157855','crsg','paste','value','eventDate','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>ลงทะเบียนสำเร็จ\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และคุณไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ไม่มีทีม)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>','infoFullName','toDate','text-center\x20text-sm\x20text-red-600','\x20คน','nicknameContainer','add','ttb-register.firebasestorage.app','option','infoManager','teamMembersHeader','5073832GKbmyn','ลงทะเบียนเข้าร่วมงานสำเร็จ','เกิดข้อผิดพลาด','สมาชิก\x20','bg-yellow-100\x20border-b\x20border-yellow-200','เกิดข้อผิดพลาดในการตรวจสอบข้อมูล','infoPosition','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','forEach','BU_th','Check_Place','message','กำลังโหลด...','registerButton','target','push','innerHTML','keydown','checkingIdIndicator','ไม่พบข้อมูลที่นั่ง','preventDefault','bg-white','focus','nickname','textContent','Registration\x20Error:\x20','teamNameDisplay','Check\x20Manager:\x20','4KDzXoI','7zHtvgV','Error\x20fetching\x20team\x20members:\x20','employeeInfoDisplay','504858KdcPBr','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>ไม่พบสมาชิกในทีมนี้</td></tr>','docs','กำลังบันทึก...','hidden','770731DQHJsv','Debug','split','registrationTimestamp','input-error','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','infoBU','NickName','BU_eng','14697vbMIUk','data','FullName_th','appendChild','long','infoDepartment','</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','https://ttb-register-default-rtdb.asia-southeast1.firebasedatabase.app','teamMembersDisplay','Backspace','สมาชิกทีม\x20:\x20','addEventListener','DateLogin','key','from','change','text-sm\x20mt-4\x20text-green-600\x20font-medium','Querying\x20DB\x20for\x20ID\x20(String):','ttb-register','teamDisplay','ไม่พบข้อมูลสังกัด','สังกัด:\x20','G-9DJLWJ5LQ1','join','querySelectorAll','<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-gray-100\x20text-gray-800\x22>ยังไม่ลงทะเบียน</span>','createElement','11830tjizMO','th-TH','localeCompare','getElementById','disabled','ไม่พบรหัสพนักงานนี้ในระบบ','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>','4030645KYWDro','registrationForm','otp-active','log','<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-gray-500\x22>กำลังโหลดข้อมูล...</td></tr>','employeeId','</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22px-3\x20py-2\x20whitespace-nowrap\x22>','replace','text-sm\x20mt-4\x20text-yellow-700\x20font-medium','nickname-active','getData','1:1070273157855:web:5c8120e1df27e233d8676a','registrationStatusMessage','3608358QewNZT','length','clipboardData','8151186UuLQbK','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>คุณได้ลงทะเบียนไปแล้ว</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>และไม่ได้เป็นผู้เข้าร่วมกิจกรรม\x20(ผู้ร่วมงาน)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-gray-500\x20mt-2\x22>','text-center\x20text-sm\x20text-red-600\x20mt-2','Registration\x20Logged\x20successfully.','Error\x20logging\x20registration:\x20','input','trim','teamMembersTableBody','ttb-register.firebaseapp.com'];_0x19dd=function(){return _0x47d2bc;};return _0x19dd();}function updateInputStyle(_0x16b845){const _0x5987ff=_0x3b3bd3;_0x16b845[_0x5987ff(0x10a)][_0x5987ff(0xfb)]()!==''?_0x16b845[_0x5987ff(0x102)][_0x5987ff(0x112)](_0x5987ff(0xe7)):_0x16b845[_0x5987ff(0x102)][_0x5987ff(0x101)](_0x5987ff(0xe7));}function setupOtpInputs(){otpInputs['forEach']((_0x289962,_0xc31a52)=>{const _0x130332=_0x140c;_0x289962[_0x130332(0xce)](_0x130332(0xfa),_0x4adae6=>{const _0xfdc1cd=_0x130332;_0x4adae6[_0xfdc1cd(0x125)]['value']=_0x4adae6[_0xfdc1cd(0x125)]['value'][_0xfdc1cd(0xec)](/[^0-9]/g,''),updateInputStyle(_0x289962),messageDiv[_0xfdc1cd(0x12f)]='',otpInputs[_0xfdc1cd(0x11f)](_0x18fb8e=>_0x18fb8e[_0xfdc1cd(0x102)][_0xfdc1cd(0x101)](_0xfdc1cd(0xbe))),currentEmployeeData&&resetRegistrationState(),_0x4adae6[_0xfdc1cd(0x125)][_0xfdc1cd(0x10a)][_0xfdc1cd(0xf3)]===0x1&&(_0xc31a52<otpInputs[_0xfdc1cd(0xf3)]-0x1&&otpInputs[_0xc31a52+0x1][_0xfdc1cd(0x12d)]()),checkOtpComplete();}),_0x289962[_0x130332(0xce)](_0x130332(0x128),_0x28ea7b=>{const _0x492cb2=_0x130332;_0x28ea7b[_0x492cb2(0xd0)]===_0x492cb2(0xcc)&&!_0x28ea7b[_0x492cb2(0x125)][_0x492cb2(0x10a)]&&_0xc31a52>0x0&&otpInputs[_0xc31a52-0x1][_0x492cb2(0x12d)]();}),_0x289962['addEventListener'](_0x130332(0x109),_0x4ac093=>{const _0xc22e42=_0x130332;_0x4ac093[_0xc22e42(0x12b)]();const _0x31684c=_0x4ac093[_0xc22e42(0xf4)][_0xc22e42(0xef)](_0xc22e42(0x106))[_0xc22e42(0xfb)](),_0x3b2aa5=_0x31684c[_0xc22e42(0xec)](/[^0-9]/g,'');if(_0x3b2aa5){const _0x547aff=_0x3b2aa5[_0xc22e42(0x13e)]('');otpInputs[_0xc22e42(0x11f)]((_0xa8e4fa,_0x449d4d)=>{_0x547aff[_0x449d4d]&&(_0xa8e4fa['value']=_0x547aff[_0x449d4d],updateInputStyle(_0xa8e4fa));}),checkOtpComplete();const _0x509eff=Array[_0xc22e42(0xd1)](otpInputs)['find'](_0x10c3ed=>!_0x10c3ed['value']);if(_0x509eff)_0x509eff['focus']();else otpInputs[0x4][_0xc22e42(0x12d)]();}});});}function checkOtpComplete(){const _0x3709c8=_0x3b3bd3,_0x3e1c8a=Array[_0x3709c8(0xd1)](otpInputs)['map'](_0x11a72f=>_0x11a72f[_0x3709c8(0x10a)])[_0x3709c8(0xda)]('');_0x3e1c8a['length']===0x5?validateEmployeeId(_0x3e1c8a):resetRegistrationState();}function resetRegistrationState(){const _0x2f79fc=_0x3b3bd3;currentEmployeeData=null,nicknameContainer[_0x2f79fc(0x102)]['add'](_0x2f79fc(0x13b)),nicknameInput[_0x2f79fc(0x10a)]='',nicknameInput[_0x2f79fc(0x102)]['remove']('nickname-active'),registerButton['disabled']=!![];}async function validateEmployeeId(_0x494361){const _0x3f78fc=_0x3b3bd3;checkingIdIndicator[_0x3f78fc(0x102)]['remove'](_0x3f78fc(0x13b)),otpInputs[_0x3f78fc(0x11f)](_0xf7e317=>_0xf7e317[_0x3f78fc(0xe2)]=!![]);try{const _0xa347cb=await getCrsgDoc(_0x494361);_0xa347cb?(currentEmployeeData=_0xa347cb,nicknameContainer['classList'][_0x3f78fc(0x101)](_0x3f78fc(0x13b)),messageDiv[_0x3f78fc(0x12f)]='',setTimeout(()=>nicknameInput[_0x3f78fc(0x12d)](),0x12c)):(messageDiv[_0x3f78fc(0x12f)]=_0x3f78fc(0xe3),messageDiv[_0x3f78fc(0xfe)]=_0x3f78fc(0xf7),otpInputs[_0x3f78fc(0x11f)](_0x38bd4d=>{const _0x31f498=_0x3f78fc;_0x38bd4d[_0x31f498(0x10a)]='',_0x38bd4d[_0x31f498(0x102)][_0x31f498(0x101)](_0x31f498(0xe7)),_0x38bd4d[_0x31f498(0x102)]['add'](_0x31f498(0xbe)),_0x38bd4d[_0x31f498(0xe2)]=![];}),registerButton['disabled']=!![],setTimeout(()=>otpInputs[0x0]['focus'](),0x64));}catch(_0x45e44c){console['error']('Validation\x20Error:',_0x45e44c),messageDiv[_0x3f78fc(0x12f)]=_0x3f78fc(0x11c),messageDiv[_0x3f78fc(0xfe)]='text-center\x20text-sm\x20text-red-600\x20mt-2',otpInputs['forEach'](_0x36b0ba=>_0x36b0ba[_0x3f78fc(0xe2)]=![]);}finally{checkingIdIndicator[_0x3f78fc(0x102)][_0x3f78fc(0x112)](_0x3f78fc(0x13b)),currentEmployeeData&&otpInputs['forEach'](_0x216f4b=>_0x216f4b[_0x3f78fc(0xe2)]=![]);}}async function handleRegisterClick(){const _0x4985b8=_0x3b3bd3,_0xfe776c=nicknameInput[_0x4985b8(0x10a)][_0x4985b8(0xfb)]();if(!currentEmployeeData||!_0xfe776c)return;registerButton[_0x4985b8(0xe2)]=!![],registerButton['textContent']=_0x4985b8(0x13a),otpInputs[_0x4985b8(0x11f)](_0x475c4e=>_0x475c4e[_0x4985b8(0xe2)]=!![]),nicknameInput[_0x4985b8(0xe2)]=!![];const _0x2a49c1=currentEmployeeData[_0x4985b8(0xc4)],_0x2383d1=currentEmployeeData['id'],_0x198d07=_0x2a49c1['Check_Place']||_0x4985b8(0x12a),_0xee39a7=_0x198d07==='ไม่พบข้อมูลที่นั่ง';try{if(_0x2a49c1[_0x4985b8(0xcf)]){const _0x2714e0=_0x2a49c1[_0x4985b8(0xcf)][_0x4985b8(0x10e)]();if(_0xee39a7){messageDiv[_0x4985b8(0x127)]=_0x4985b8(0xf6)+formatThaiTimestamp(_0x2714e0)+_0x4985b8(0x100),messageDiv[_0x4985b8(0xfe)]='text-center\x20text-sm\x20text-red-600',teamDisplay[_0x4985b8(0x102)][_0x4985b8(0x112)]('hidden');const _0x55a557=teamNames[0x0]||'A';teamSelect[_0x4985b8(0x10a)]=_0x55a557,fetchAndDisplayTeamMembers(_0x55a557);}else teamNameDisplay[_0x4985b8(0x12f)]=_0x198d07,regStatusMsg[_0x4985b8(0x12f)]='คุณได้ลงทะเบียนไปแล้วเมื่อ',regStatusMsg[_0x4985b8(0xfe)]=_0x4985b8(0xed),regTimestamp['textContent']=formatThaiTimestamp(_0x2714e0),teamDisplay[_0x4985b8(0x102)][_0x4985b8(0x101)](_0x4985b8(0x13b)),teamSelect[_0x4985b8(0x10a)]=_0x198d07,fetchAndDisplayTeamMembers(_0x198d07);await updateDoc(doc(db,_0x4985b8(0x108),_0x2383d1),{'NickName':_0xfe776c}),showSuccessState(_0x2a49c1,_0xfe776c);return;}const _0x53984d=await logRegistration(_0x2383d1,_0xfe776c);if(_0xee39a7){messageDiv[_0x4985b8(0x127)]=_0x4985b8(0x10c)+formatThaiTimestamp(_0x53984d)+_0x4985b8(0xc9),messageDiv['className']=_0x4985b8(0x10f),teamDisplay[_0x4985b8(0x102)][_0x4985b8(0x112)](_0x4985b8(0x13b));const _0x424f80=teamNames[0x0]||'A';teamSelect[_0x4985b8(0x10a)]=_0x424f80,fetchAndDisplayTeamMembers(_0x424f80);}else teamNameDisplay[_0x4985b8(0x12f)]=_0x198d07,regStatusMsg['textContent']=_0x4985b8(0x118),regStatusMsg['className']=_0x4985b8(0xd3),regTimestamp[_0x4985b8(0x12f)]=formatThaiTimestamp(_0x53984d),teamDisplay[_0x4985b8(0x102)][_0x4985b8(0x101)](_0x4985b8(0x13b)),teamSelect[_0x4985b8(0x10a)]=_0x198d07,fetchAndDisplayTeamMembers(_0x198d07);showSuccessState(_0x2a49c1,_0xfe776c);}catch(_0x45ffb0){console[_0x4985b8(0x105)](_0x4985b8(0x130),_0x45ffb0),messageDiv[_0x4985b8(0x12f)]='เกิดข้อผิดพลาด:\x20'+_0x45ffb0['message'],messageDiv[_0x4985b8(0xfe)]=_0x4985b8(0x10f),registerButton[_0x4985b8(0xe2)]=![],registerButton[_0x4985b8(0x12f)]='ลงทะเบียน',otpInputs[_0x4985b8(0x11f)](_0x2a7d3d=>_0x2a7d3d[_0x4985b8(0xe2)]=![]),nicknameInput[_0x4985b8(0xe2)]=![];}}function showSuccessState(_0xfc4a37,_0x4cf41b){const _0x135187=_0x3b3bd3;if(registrationForm)registrationForm[_0x135187(0x102)][_0x135187(0x112)]('hidden');if(eventDate)eventDate[_0x135187(0x102)][_0x135187(0x112)](_0x135187(0x13b));if(eventImageContainer)eventImageContainer[_0x135187(0x102)][_0x135187(0x112)](_0x135187(0x13b));if(infoFullName)infoFullName[_0x135187(0x12f)]=(_0xfc4a37[_0x135187(0xc5)]||'')+'\x20('+(_0xfc4a37[_0x135187(0xea)]||'')+')';if(infoBU)infoBU[_0x135187(0x12f)]=_0x135187(0xd8)+(_0xfc4a37[_0x135187(0xc2)]||_0xfc4a37[_0x135187(0x120)]||_0x135187(0xd7));if(infoManager)infoManager[_0x135187(0x12f)]=_0x135187(0x132)+(_0xfc4a37['Check_Manager']||'-');if(infoPosition)infoPosition['classList'][_0x135187(0x112)](_0x135187(0x13b));if(infoDepartment)infoDepartment[_0x135187(0x102)][_0x135187(0x112)]('hidden');if(employeeInfoDisplay)employeeInfoDisplay[_0x135187(0x102)][_0x135187(0x101)](_0x135187(0x13b));if(teamMembersDisplay)teamMembersDisplay[_0x135187(0x102)][_0x135187(0x101)](_0x135187(0x13b));}async function logRegistration(_0x4cbc39,_0x5ebc7b){const _0x3cdcaf=_0x3b3bd3,_0x1506ac=new Date();try{const _0x469708=doc(db,_0x3cdcaf(0x108),_0x4cbc39);return await updateDoc(_0x469708,{'DateLogin':_0x1506ac,'NickName':_0x5ebc7b}),console[_0x3cdcaf(0xe8)](_0x3cdcaf(0xf8)),_0x1506ac;}catch(_0x44604f){console[_0x3cdcaf(0x105)](_0x3cdcaf(0xf9),_0x44604f);throw _0x44604f;}}async function fetchAndDisplayTeamMembers(_0x2fa699){const _0x8f40b4=_0x3b3bd3;if(!_0x2fa699){teamMembersDisplay['classList'][_0x8f40b4(0x112)](_0x8f40b4(0x13b));return;}teamMembersHeader['textContent']=_0x8f40b4(0xcd)+_0x2fa699,teamMembersCount[_0x8f40b4(0x12f)]=_0x8f40b4(0x123),teamMembersTableBody['innerHTML']=_0x8f40b4(0xe9);try{const _0x274f53='crsg',_0x271a1d=query(collection(db,_0x274f53),where(_0x8f40b4(0x121),'==',_0x2fa699)),_0x5aa53f=await getDocs(_0x271a1d),_0x24e44f=[];_0x5aa53f[_0x8f40b4(0x11f)](_0x3d4a04=>{const _0x5b6ce8=_0x8f40b4;_0x24e44f[_0x5b6ce8(0x126)](_0x3d4a04[_0x5b6ce8(0xc4)]());}),_0x24e44f[_0x8f40b4(0xff)]((_0x164694,_0x2c8774)=>(_0x164694[_0x8f40b4(0xc5)]||'')[_0x8f40b4(0xe0)](_0x2c8774[_0x8f40b4(0xc5)]||'')),teamMembersCount[_0x8f40b4(0x12f)]=_0x8f40b4(0x11a)+_0x24e44f[_0x8f40b4(0xf3)]+_0x8f40b4(0x110);if(_0x24e44f[_0x8f40b4(0xf3)]===0x0){teamMembersTableBody[_0x8f40b4(0x127)]=_0x8f40b4(0x138);return;}teamMembersTableBody['innerHTML']='',_0x24e44f[_0x8f40b4(0x11f)]((_0xbc8083,_0x4f25da)=>{const _0x431275=_0x8f40b4,_0x58a664=!!_0xbc8083[_0x431275(0xcf)],_0x3e3014=_0x58a664?'<span\x20class=\x22inline-flex\x20items-center\x20px-2\x20py-0.5\x20rounded-full\x20text-xs\x20font-medium\x20bg-green-100\x20text-green-800\x22>ลงทะเบียน</span>':_0x431275(0xdc),_0x2a9391=_0xbc8083[_0x431275(0xc1)]?(_0xbc8083[_0x431275(0xc5)]||'')+'\x20('+_0xbc8083['NickName']+')':_0xbc8083[_0x431275(0xc5)]||'',_0x3bd841=document[_0x431275(0xdd)]('tr');_0x58a664?_0x3bd841['className']=_0x431275(0x11b):_0x3bd841[_0x431275(0xfe)]=_0x4f25da%0x2===0x0?_0x431275(0x12c):_0x431275(0x103),_0x3bd841[_0x431275(0x127)]=_0x431275(0xe4)+_0x2a9391+_0x431275(0xeb)+(_0xbc8083['Check_Manager']||'')+_0x431275(0xeb)+_0x3e3014+_0x431275(0x11e),teamMembersTableBody[_0x431275(0xc6)](_0x3bd841);});}catch(_0x443a52){console[_0x8f40b4(0x105)](_0x8f40b4(0x135),_0x443a52),teamMembersTableBody[_0x8f40b4(0x127)]='<tr><td\x20colspan=\x223\x22\x20class=\x22p-4\x20text-center\x20text-red-500\x22>เกิดข้อผิดพลาดในการโหลดข้อมูล</td></tr>',teamMembersCount[_0x8f40b4(0x12f)]=_0x8f40b4(0x119);}}
        
    </script>
</body>
</html>
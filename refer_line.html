<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refer-Friend</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        /* (เพิ่ม) สไตล์สำหรับช่อง OTP Input */
        .otp-input {
            transition: all 0.15s ease-in-out;
        }
        .otp-input:disabled {
            background-color: #f3f4f6; /* bg-gray-100 */
        }
        .img {
              margin: 15px auto !important;
        }
    </style>
</head>
<!-- (แก้ไข) ปรับ margin-top (pt-8 = 2rem) -->
<body class="bg-white flex flex-col items-center justify-center min-h-screen pt-8 pb-10" style="background-color: #dee1e1;">

    <!-- กล่องลงทะเบียน -->
    <!-- (แก้ไข) เปลี่ยน bg-gray-50 เป็น bg-white และเพิ่ม 'relative' สำหรับ Overlay -->
    <div id="registrationFormContainer" class="w-[95%] max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md transition-colors duration-300 relative">
        <h1 class="text-2xl font-bold text-center text-gray-900">ศึกชิงเจ้าบัลลังก์แห่งการ REFERRAL</h1>
        <!-- *** แก้ไข: เพิ่ม id="eventDate" *** -->
        <p id="eventDate" class="text-sm font-medium text-gray-700 text-center" style="margin-top: 2px;">วันที่ 17 พฤศจิกายน 2568</p>

        <!-- *** แก้ไข: เพิ่ม id="eventImageContainer" *** -->
        <!-- (แก้ไข) เปลี่ยน mt-6 เป็น my-4 (margin top/bottom 16px) -->
        <div id="eventImageContainer" class="my-4 w-[70%] mx-auto">
            <img src="./images/refer_friend.jpg">
        </div>
              
        <!-- *** (แก้ไข) ปรับปรุงโครงสร้างการแสดงข้อมูลพนักงาน *** -->
        <div id="employeeInfoDisplay" class="hidden text-center space-y-2 py-4">
            <!-- 1. ชื่อ-นามสกุล (Name) (รหัสพนักงาน) (EmpID) -->
            <p id="infoFullName" class="text-lg font-bold text-gray-900"></p> 
            
            <!-- (แก้ไข) 2 & 3. (EmpZone) และ (EmpRH) ในบรรทัดเดียวกัน -->
            <p id="infoEmpZoneRH" class="text-sm text-gray-700"></p>
            
            <!-- 4. เพิ่มเส้นกั้น (แก้ไข) ปรับ margin เป็น my-4 (16px) -->
            <hr class="my-4 border-gray-300"> 

            <!-- (แก้ไข) 5. เปลี่ยนข้อความจาก "ให้คุณไปหาสมาชิกทีม" เป็น "โจทย์ของคุณคือ" -->
            <p class="text-md font-semibold text-blue-600">โจทย์ของคุณคือ</p> 

            <!-- (เพิ่ม) กล่องสีส้มสำหรับ MapZone -->
            <div class="mt-2 p-3 bg-orange-100 border border-orange-300 rounded-lg shadow-sm">
                <!-- (แก้ไข) 6. (MapZone) ปรับเป็น ตัวหนา, สีส้มเข้ม และใช้ text-lg เพื่อเน้น -->
                <p id="infoMapZone" class="text-lg font-extrabold text-orange-700"></p> 
            </div>

            <!-- (เพิ่ม) ปุ่ม Refer Friend สำเร็จ (แก้ไข) ลบ w-full เพื่อลดขนาดปุ่ม -->
            <div class="text-center">
                <button type="button" id="referralSuccessButton" class="px-6 py-2 mt-6 font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed">
                    Refer Friend สำเร็จ
                </button>
            </div>
        </div>

        <!-- ฟอร์มลงทะเบียน -->
        <form id="registrationForm" class="space-y-4">
            
            <!-- (แก้ไข) เปลี่ยนเป็นช่อง OTP 5 ช่อง -->
            <div>
                <!-- (ลบ) ลบ Label "รหัสพนักงาน" -->
                <div id="otpContainer" class="flex justify-center gap-1 sm:gap-2">
                    <!-- (แก้ไข) เพิ่มขนาดตัวอักษรเป็น text-2xl -->
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                <!-- (เพิ่ม) Helper text และเว้นช่องว่างด้านล่าง (mb-4) -->
                <div style="height:5px;"></div>
                <p class="text-xs text-gray-500 text-center mt-2 mb-4">ใส่รหัสพนักงานของคุณให้ถูกต้องก่อนกด ลงทะเบียน</p>
            </div>
            
            <!-- (ลบ) ช่องชื่อเล่น -->
            
            <button type="button" id="registerButton"
                    class="w-full px-4 py-2 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400"
                    disabled> <!-- (เพิ่ม) disabled ปุ่มไว้ตอนเริ่ม -->
                ลงทะเบียน
            </button>
        </form>
        
        <!-- พื้นที่แสดงข้อความ (สำหรับข้อผิดพลาดหลัก) --><div id="message" class="text-center text-sm"></div>

        <!-- (ลบ) ลบส่วนแสดงข้อความลงทะเบียนสำเร็จ (teamDisplay) -->
        <div id="teamDisplay" class="hidden text-center border-t pt-4 mt-4">
            <h2 id="teamNameDisplay" class="text-8xl font-bold text-[#0056ff]"></h2> 
            <p class="text-sm font-medium text-gray-700 mt-1">ทีมของคุณ</p>
            
            <p id="registrationStatusMessage" class="text-sm mt-4"></p>
            <p id="registrationTimestamp" class="text-xs text-gray-500"></p>
        </div>

        <!-- (เพิ่ม) Loading Overlay สำหรับ Spinner -->
        <div id="loadingOverlay" class="hidden absolute inset-0 bg-white bg-opacity-80 flex flex-col items-center justify-center space-y-4 rounded-lg z-20">
            <svg class="animate-spin h-12 w-12 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <!-- (แก้ไข) ปรับเลข Countdown เริ่มต้นเป็น 3 -->
            <p class="text-lg font-medium text-gray-700">กำลังตรวจสอบข้อมูล... <span id="spinnerCountdown">3</span></p>
        </div>
    </div>

    <!-- (เพิ่ม) Lightbox (Modal) สำหรับแจ้งเตือน Error -->
    <div id="errorLightbox" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
            <!-- (แก้ไข) ปรับขนาด Font จาก text-base เป็น text-sm -->
            <p id="errorLightboxMessage" class="text-sm text-gray-800 mb-6">ไม่พบรหัสพนักงานนี้ในระบบ<br>กรุณากรอกรหัสพนักงานใหม่อีกครั้ง</p>
            <button id="closeLightboxButton" class="w-full px-4 py-2 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                ปิด
            </button>
        </div>
    </div>

    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
        // นำเข้า Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // (แก้ไข) เพิ่ม 'or'
        import { getFirestore, collection, getDocs, query, where, serverTimestamp, setLogLevel, limit, doc, updateDoc, or } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"; 

        // --- *** ข้อสำคัญ: สำหรับแก้ไข "Missing or insufficient permissions." *** ---
        // (ส่วนนี้เหมือนเดิม)
        // ... (Security Rules comment block) ...
        // --- *************************************************************** ---


        // --- *** 1. ใส่ Firebase Config ของคุณที่นี่ *** ---
const _0x4bd180=_0x81b6;(function(_0x357113,_0x3ad933){const _0x25531d=_0x81b6,_0x5e8527=_0x357113();while(!![]){try{const _0xe2115=-parseInt(_0x25531d(0x11f))/0x1*(parseInt(_0x25531d(0x163))/0x2)+parseInt(_0x25531d(0x10a))/0x3*(parseInt(_0x25531d(0x13b))/0x4)+parseInt(_0x25531d(0x133))/0x5*(parseInt(_0x25531d(0x113))/0x6)+parseInt(_0x25531d(0x160))/0x7+parseInt(_0x25531d(0x115))/0x8+parseInt(_0x25531d(0x155))/0x9*(-parseInt(_0x25531d(0x138))/0xa)+-parseInt(_0x25531d(0x125))/0xb*(parseInt(_0x25531d(0x109))/0xc);if(_0xe2115===_0x3ad933)break;else _0x5e8527['push'](_0x5e8527['shift']());}catch(_0x2d0045){_0x5e8527['push'](_0x5e8527['shift']());}}}(_0x282f,0x8af35));const firebaseConfig={'apiKey':_0x4bd180(0x15c),'authDomain':_0x4bd180(0x104),'databaseURL':_0x4bd180(0x12f),'projectId':_0x4bd180(0x112),'storageBucket':_0x4bd180(0x123),'messagingSenderId':_0x4bd180(0x126),'appId':'1:1070273157855:web:5c8120e1df27e233d8676a','measurementId':_0x4bd180(0x137)};let db,auth,currentEmployeeDocId=null;const registrationFormContainer=document['getElementById'](_0x4bd180(0x124)),otpContainer=document[_0x4bd180(0x15e)](_0x4bd180(0x12c)),otpInputs=otpContainer?Array['from'](otpContainer[_0x4bd180(0x106)](_0x4bd180(0x157))):[],registerButton=document[_0x4bd180(0x15e)](_0x4bd180(0x110)),messageDiv=document[_0x4bd180(0x15e)](_0x4bd180(0x10f)),teamDisplay=document[_0x4bd180(0x15e)](_0x4bd180(0x111)),teamNameDisplay=document['getElementById'](_0x4bd180(0x120)),regStatusMsg=document[_0x4bd180(0x15e)]('registrationStatusMessage'),regTimestamp=document['getElementById']('registrationTimestamp'),eventDate=document[_0x4bd180(0x15e)](_0x4bd180(0x102)),eventImageContainer=document[_0x4bd180(0x15e)]('eventImageContainer'),registrationForm=document['getElementById'](_0x4bd180(0x10e)),employeeInfoDisplay=document['getElementById'](_0x4bd180(0x153)),infoFullName=document[_0x4bd180(0x15e)]('infoFullName'),infoEmpZoneRH=document[_0x4bd180(0x15e)](_0x4bd180(0x159)),infoMapZone=document[_0x4bd180(0x15e)]('infoMapZone'),referralSuccessButton=document[_0x4bd180(0x15e)](_0x4bd180(0x107)),loadingOverlay=document[_0x4bd180(0x15e)](_0x4bd180(0x127)),spinnerCountdown=document[_0x4bd180(0x15e)](_0x4bd180(0x101)),errorLightbox=document[_0x4bd180(0x15e)](_0x4bd180(0x128)),closeLightboxButton=document[_0x4bd180(0x15e)](_0x4bd180(0x11e));let countdownInterval;function _0x282f(){const _0x30b876=['toLocaleString','bg-gray-500','EmpZone','innerHTML','hidden','key','เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','long','forEach','hover:bg-green-700','MapZone','trim','Signed\x20in\x20anonymously','length','Firebase\x20initialization\x20failed:','No\x20employee\x20doc\x20ID\x20found.','disabled','addEventListener','employeeInfoDisplay','border-red-500','63HRZGHk','Registration\x20Logged\x20successfully.','.otp-input','DateLogin','infoEmpZoneRH','bg-blue-200','log','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','classList','getElementById','EmpRH','4833878glPSyP','textContent','replace','4StsfKG','getData','click','className','text','spinnerCountdown','eventDate','ลงทะเบียนเรียบร้อย','ttb-register.firebaseapp.com','bg-gray-100','querySelectorAll','referralSuccessButton','ReferralTimestamp','492UTqYyV','3NRDOdp','Error\x20during\x20registration\x20process:\x20','empty','value','registrationForm','message','registerButton','teamDisplay','ttb-register','6nihiTX','preventDefault','4138088fKIeOd','กรุณากรอกรหัสพนักงานให้ครบ\x205\x20หลัก','ลงทะเบียน','Refer\x20Friend\x20สำเร็จ','text-center\x20text-sm\x20p-3\x20bg-red-50\x20border\x20border-red-200\x20rounded-md','บันทึกไม่สำเร็จ\x20(ลองอีกครั้ง)','remove','เกิดข้อผิดพลาด:\x20','Name','closeLightboxButton','260228voXgDE','teamNameDisplay','N/A','data','ttb-register.firebasestorage.app','registrationFormContainer','50039gcxjiK','1070273157855','loadingOverlay','errorLightbox','input','text-center\x20text-sm\x20text-red-600','FullName_th','otpContainer','includes','clipboardData','https://ttb-register-default-rtdb.asia-southeast1.firebasedatabase.app','th-TH','กำลังบันทึก...','bg-green-600','1022615VuBKNw','Error\x20saving\x20referral\x20timestamp:\x20','focus','error','G-9DJLWJ5LQW','1503410kZHScJ','paste','บันทึกเวลาสำเร็จ','3664620viXsmF','เกิดข้อผิดพลาด','add','referfriend','permissions','target'];_0x282f=function(){return _0x30b876;};return _0x282f();}function checkOtpCompleteness(){const _0xbeb3ad=_0x4bd180;let _0x2e0e=!![];otpInputs[_0xbeb3ad(0x149)](_0x4b6e6b=>{const _0x58a7d5=_0xbeb3ad;_0x4b6e6b[_0x58a7d5(0x10d)][_0x58a7d5(0x14c)]()[_0x58a7d5(0x14e)]===0x0&&(_0x2e0e=![]);}),registerButton[_0xbeb3ad(0x151)]=!_0x2e0e;}try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel('Debug'),signInAnonymously(auth),console[_0x4bd180(0x15b)](_0x4bd180(0x14d)),otpInputs['length']>0x0&&otpInputs[0x0]['focus'](),closeLightboxButton[_0x4bd180(0x152)](_0x4bd180(0xfe),()=>{const _0x10eea4=_0x4bd180;errorLightbox[_0x10eea4(0x15d)][_0x10eea4(0x13d)](_0x10eea4(0x145)),registerButton['disabled']=![],registerButton[_0x10eea4(0x161)]=_0x10eea4(0x117),otpInputs['forEach'](_0x285ea2=>{const _0x4dc35d=_0x10eea4;_0x285ea2[_0x4dc35d(0x151)]=![],_0x285ea2[_0x4dc35d(0x15d)][_0x4dc35d(0x11b)](_0x4dc35d(0x105)),_0x285ea2[_0x4dc35d(0x15d)][_0x4dc35d(0x11b)](_0x4dc35d(0x15a)),_0x285ea2[_0x4dc35d(0x10d)]='';}),otpInputs[_0x10eea4(0x14e)]>0x0&&otpInputs[0x0][_0x10eea4(0x135)](),checkOtpCompleteness();}),referralSuccessButton[_0x4bd180(0x152)]('click',handleReferralSuccess);}catch(_0x282e97){console[_0x4bd180(0x136)](_0x4bd180(0x14f),_0x282e97),document[_0x4bd180(0x15e)](_0x4bd180(0x10f))[_0x4bd180(0x161)]=_0x4bd180(0x147)+_0x282e97['message'];}registerButton[_0x4bd180(0x152)](_0x4bd180(0xfe),handleRegisterCheck);otpContainer&&otpInputs[_0x4bd180(0x149)]((_0xf57415,_0x3681f7)=>{const _0x24d164=_0x4bd180;_0xf57415['addEventListener'](_0x24d164(0x129),_0x478886=>{const _0x5acb1f=_0x24d164;_0xf57415[_0x5acb1f(0x10d)]=_0xf57415[_0x5acb1f(0x10d)]['replace'](/[^0-9]/g,'');const _0x59a814=_0xf57415[_0x5acb1f(0x10d)];if(_0x59a814[_0x5acb1f(0x14e)]===0x1)_0xf57415[_0x5acb1f(0x15d)][_0x5acb1f(0x13d)](_0x5acb1f(0x15a)),_0x3681f7<otpInputs[_0x5acb1f(0x14e)]-0x1&&otpInputs[_0x3681f7+0x1][_0x5acb1f(0x135)]();else _0x59a814['length']===0x0&&_0xf57415[_0x5acb1f(0x15d)][_0x5acb1f(0x11b)]('bg-blue-200');checkOtpCompleteness();}),_0xf57415['addEventListener']('keydown',_0x22ada5=>{const _0x2bedbc=_0x24d164;_0x22ada5[_0x2bedbc(0x146)]==='Backspace'&&_0xf57415['value']===''&&_0x3681f7>0x0&&(_0x22ada5[_0x2bedbc(0x114)](),otpInputs[_0x3681f7-0x1][_0x2bedbc(0x135)](),otpInputs[_0x3681f7-0x1]['select']());}),_0xf57415['addEventListener'](_0x24d164(0x139),_0x4656c3=>{const _0x1e20f5=_0x24d164;_0x4656c3[_0x1e20f5(0x114)]();const _0x21ce69=_0x4656c3[_0x1e20f5(0x12e)][_0x1e20f5(0x164)](_0x1e20f5(0x100))[_0x1e20f5(0x14c)]()[_0x1e20f5(0x162)](/[^0-9]/g,'');if(_0x21ce69['length']===otpInputs[_0x1e20f5(0x14e)])otpInputs[_0x1e20f5(0x149)]((_0x465c1b,_0x3df0c1)=>{const _0x238230=_0x1e20f5;_0x465c1b['value']=_0x21ce69[_0x3df0c1]||'',_0x465c1b['value']?_0x465c1b['classList'][_0x238230(0x13d)](_0x238230(0x15a)):_0x465c1b[_0x238230(0x15d)][_0x238230(0x11b)]('bg-blue-200');}),otpInputs[otpInputs['length']-0x1]['focus']();else{if(_0x21ce69[_0x1e20f5(0x14e)]>0x0){let _0x38dfb9=_0x3681f7;for(let _0x2c6673=0x0;_0x2c6673<_0x21ce69[_0x1e20f5(0x14e)]&&_0x38dfb9<otpInputs['length'];_0x2c6673++){otpInputs[_0x38dfb9][_0x1e20f5(0x10d)]=_0x21ce69[_0x2c6673],otpInputs[_0x38dfb9][_0x1e20f5(0x15d)]['add']('bg-blue-200'),_0x38dfb9<otpInputs[_0x1e20f5(0x14e)]-0x1&&otpInputs[_0x38dfb9+0x1]['focus'](),_0x38dfb9++;}}}setTimeout(checkOtpCompleteness,0x0);}),_0xf57415['addEventListener'](_0x24d164(0x135),_0x3572f2=>{const _0x5b91b3=_0x24d164;_0x3572f2[_0x5b91b3(0x140)]['select']();});});function _0x81b6(_0x5d1b4d,_0x522ae9){const _0x282fae=_0x282f();return _0x81b6=function(_0x81b62b,_0x4a0f16){_0x81b62b=_0x81b62b-0xfe;let _0x177f05=_0x282fae[_0x81b62b];return _0x177f05;},_0x81b6(_0x5d1b4d,_0x522ae9);}function formatThaiTimestamp(_0x106171){const _0x13aeef=_0x4bd180;return _0x106171[_0x13aeef(0x141)](_0x13aeef(0x130),{'dateStyle':_0x13aeef(0x148),'timeStyle':'medium'});}function handleRegisterCheck(){const _0x131274=_0x4bd180;let _0x1cb4af='';otpInputs[_0x131274(0x149)](_0xb1b9a6=>{const _0x6b2ee5=_0x131274;_0x1cb4af+=_0xb1b9a6[_0x6b2ee5(0x10d)][_0x6b2ee5(0x14c)]();}),otpInputs['forEach'](_0x564694=>_0x564694[_0x131274(0x15d)][_0x131274(0x11b)](_0x131274(0x154)));if(_0x1cb4af[_0x131274(0x14e)]<0x5){messageDiv['textContent']=_0x131274(0x116),messageDiv[_0x131274(0xff)]='text-center\x20text-sm\x20text-red-600',otpInputs[_0x131274(0x149)](_0x13ecc0=>{const _0x3efe30=_0x131274;!_0x13ecc0[_0x3efe30(0x10d)]&&_0x13ecc0[_0x3efe30(0x15d)][_0x3efe30(0x13d)](_0x3efe30(0x154));});return;}registerButton[_0x131274(0x151)]=!![],registerButton['textContent']='กำลังตรวจสอบ...',otpInputs['forEach'](_0x5b0fe8=>{const _0xac00e2=_0x131274;_0x5b0fe8[_0xac00e2(0x151)]=!![],_0x5b0fe8[_0xac00e2(0x15d)][_0xac00e2(0x13d)]('bg-gray-100');}),messageDiv[_0x131274(0x161)]='',loadingOverlay[_0x131274(0x15d)][_0x131274(0x11b)]('hidden');let _0x2410e5=0x3;spinnerCountdown[_0x131274(0x161)]=''+_0x2410e5,countdownInterval&&clearInterval(countdownInterval),countdownInterval=setInterval(()=>{const _0x16ac6c=_0x131274;_0x2410e5--,spinnerCountdown[_0x16ac6c(0x161)]=''+_0x2410e5,_0x2410e5<=0x0&&clearInterval(countdownInterval);},0x3e8),setTimeout(()=>{performFirebaseCheck(_0x1cb4af);},0xbb8);}async function performFirebaseCheck(_0x2b177c){const _0x2141bf=_0x4bd180;loadingOverlay[_0x2141bf(0x15d)][_0x2141bf(0x13d)](_0x2141bf(0x145));countdownInterval&&clearInterval(countdownInterval);try{const _0x33c50d=await getCrsgDoc(_0x2b177c);if(!_0x33c50d){errorLightbox['classList'][_0x2141bf(0x11b)](_0x2141bf(0x145));return;}const _0x80922b=_0x33c50d[_0x2141bf(0x122)],_0x195daa=_0x33c50d['id'];currentEmployeeDocId=_0x195daa;if(_0x80922b[_0x2141bf(0x158)]){registrationForm[_0x2141bf(0x15d)][_0x2141bf(0x13d)](_0x2141bf(0x145)),infoFullName['textContent']=(_0x80922b[_0x2141bf(0x11d)]||_0x80922b[_0x2141bf(0x12b)]||'')+'\x20('+_0x2b177c+')';const _0x1c2aed=_0x80922b[_0x2141bf(0x143)]||_0x2141bf(0x121),_0x278638=_0x80922b['EmpRH']||'N/A';infoEmpZoneRH['textContent']=_0x1c2aed+'\x20|\x20'+_0x278638,infoMapZone[_0x2141bf(0x161)]=''+(_0x80922b['MapZone']||_0x2141bf(0x121));_0x80922b[_0x2141bf(0x108)]?(referralSuccessButton[_0x2141bf(0x151)]=!![],referralSuccessButton[_0x2141bf(0x161)]='บันทึกการจับคู่แล้ว',referralSuccessButton[_0x2141bf(0x15d)][_0x2141bf(0x11b)](_0x2141bf(0x132),'hover:bg-green-700'),referralSuccessButton[_0x2141bf(0x15d)][_0x2141bf(0x13d)]('bg-gray-500')):(referralSuccessButton[_0x2141bf(0x151)]=![],referralSuccessButton[_0x2141bf(0x161)]=_0x2141bf(0x118),referralSuccessButton[_0x2141bf(0x15d)]['add'](_0x2141bf(0x132),_0x2141bf(0x14a)),referralSuccessButton[_0x2141bf(0x15d)][_0x2141bf(0x11b)](_0x2141bf(0x142)));employeeInfoDisplay[_0x2141bf(0x15d)][_0x2141bf(0x11b)](_0x2141bf(0x145)),registerButton[_0x2141bf(0x161)]=_0x2141bf(0x103);return;}logRegistration(_0x195daa),registrationForm[_0x2141bf(0x15d)][_0x2141bf(0x13d)](_0x2141bf(0x145)),infoFullName[_0x2141bf(0x161)]=(_0x80922b[_0x2141bf(0x11d)]||_0x80922b[_0x2141bf(0x12b)]||'')+'\x20('+_0x2b177c+')';const _0x1b7077=_0x80922b['EmpZone']||_0x2141bf(0x121),_0x5d8f55=_0x80922b[_0x2141bf(0x15f)]||'N/A';infoEmpZoneRH[_0x2141bf(0x161)]=_0x1b7077+'\x20|\x20'+_0x5d8f55,infoMapZone[_0x2141bf(0x161)]=''+(_0x80922b[_0x2141bf(0x14b)]||_0x2141bf(0x121)),referralSuccessButton['disabled']=![],referralSuccessButton[_0x2141bf(0x161)]='Refer\x20Friend\x20สำเร็จ',referralSuccessButton[_0x2141bf(0x15d)][_0x2141bf(0x13d)]('bg-green-600',_0x2141bf(0x14a)),referralSuccessButton[_0x2141bf(0x15d)][_0x2141bf(0x11b)](_0x2141bf(0x142)),employeeInfoDisplay[_0x2141bf(0x15d)][_0x2141bf(0x11b)](_0x2141bf(0x145)),registerButton[_0x2141bf(0x161)]=_0x2141bf(0x103);}catch(_0x7d4cf7){console[_0x2141bf(0x136)](_0x2141bf(0x10b),_0x7d4cf7),_0x7d4cf7[_0x2141bf(0x10f)][_0x2141bf(0x12d)](_0x2141bf(0x13f))?(messageDiv[_0x2141bf(0x144)]='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22font-bold\x20text-red-700\x22>เกิดข้อผิดพลาด:\x20ไม่มีสิทธิ์\x20(Missing\x20or\x20insufficient\x20permissions)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22mt-2\x20text-sm\x20text-gray-700\x22>ปัญหานี้เกิดจาก\x20Security\x20Rules\x20ใน\x20Firebase\x20ของคุณ</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22mt-1\x20text-sm\x20text-gray-700\x22>กรุณาดู\x20<strong\x20class=\x22text-black\x22>\x22ข้อสำคัญ\x22</strong>\x20ในคอมเมนต์\x20(หมายเหตุ)\x20ในไฟล์นี้</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22mt-1\x20text-sm\x20text-gray-700\x22>ซึ่งอยู่ที่ประมาณบรรทัดที่\x20113\x20เพื่อดูวิธีแก้ไขครับ</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20',messageDiv[_0x2141bf(0xff)]=_0x2141bf(0x119)):(messageDiv[_0x2141bf(0x161)]=_0x2141bf(0x11c)+_0x7d4cf7[_0x2141bf(0x10f)],messageDiv[_0x2141bf(0xff)]=_0x2141bf(0x12a)),registerButton['disabled']=![],registerButton[_0x2141bf(0x161)]=_0x2141bf(0x117),teamDisplay[_0x2141bf(0x15d)][_0x2141bf(0x13d)]('hidden'),otpInputs['forEach'](_0x23cdc9=>{const _0x36386c=_0x2141bf;_0x23cdc9[_0x36386c(0x151)]=![],_0x23cdc9[_0x36386c(0x15d)][_0x36386c(0x11b)](_0x36386c(0x105));}),employeeInfoDisplay['classList']['add']('hidden'),eventDate[_0x2141bf(0x15d)][_0x2141bf(0x11b)](_0x2141bf(0x145)),eventImageContainer[_0x2141bf(0x15d)]['remove']('hidden'),registrationForm[_0x2141bf(0x15d)][_0x2141bf(0x11b)](_0x2141bf(0x145));}}async function getCrsgDoc(_0x521e17){const _0x3c236b=_0x4bd180,_0x2f0964=_0x3c236b(0x13e),_0x5a4569=query(collection(db,_0x2f0964),or(where('EmpID','==',_0x521e17),where('employeeId','==',_0x521e17)),limit(0x1)),_0xdd6e06=await getDocs(_0x5a4569);if(_0xdd6e06[_0x3c236b(0x10c)])return null;const _0x4616af=_0xdd6e06['docs'][0x0];return{'id':_0x4616af['id'],'data':_0x4616af['data']()};}async function logRegistration(_0x336e91){const _0x4d94b1=_0x4bd180,_0x1070f1=new Date();try{const _0x5ed634=doc(db,_0x4d94b1(0x13e),_0x336e91);return await updateDoc(_0x5ed634,{'DateLogin':_0x1070f1}),console[_0x4d94b1(0x15b)](_0x4d94b1(0x156)),_0x1070f1;}catch(_0x2a103d){console[_0x4d94b1(0x136)]('Error\x20logging\x20registration:\x20',_0x2a103d);throw _0x2a103d;}}async function handleReferralSuccess(){const _0x46def9=_0x4bd180;if(!currentEmployeeDocId){console['error'](_0x46def9(0x150)),referralSuccessButton['disabled']=!![],referralSuccessButton[_0x46def9(0x161)]=_0x46def9(0x13c);return;}referralSuccessButton[_0x46def9(0x151)]=!![],referralSuccessButton['textContent']=_0x46def9(0x131);try{const _0x5c308f=doc(db,_0x46def9(0x13e),currentEmployeeDocId);await updateDoc(_0x5c308f,{'ReferralTimestamp':serverTimestamp()}),console[_0x46def9(0x15b)]('Referral\x20timestamp\x20saved.'),referralSuccessButton[_0x46def9(0x161)]=_0x46def9(0x13a),referralSuccessButton[_0x46def9(0x15d)][_0x46def9(0x11b)](_0x46def9(0x132),'hover:bg-green-700'),referralSuccessButton[_0x46def9(0x15d)][_0x46def9(0x13d)](_0x46def9(0x142));}catch(_0x1377d9){console['error'](_0x46def9(0x134),_0x1377d9),referralSuccessButton[_0x46def9(0x161)]=_0x46def9(0x11a),referralSuccessButton[_0x46def9(0x151)]=![];}}
        
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game : Refer-Friend</title>
    <!-- โหลด Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        /* (เพิ่ม) สไตล์สำหรับช่อง OTP Input */
        .otp-input {
            transition: all 0.15s ease-in-out;
        }
        .otp-input:disabled {
            background-color: #f3f4f6; /* bg-gray-100 */
        }
        .img {
              margin: 15px auto !important;
        }
    </style>
</head>
<!-- (แก้ไข) ปรับ margin-top (pt-8 = 2rem) -->
<body class="bg-white flex flex-col items-center justify-center min-h-screen pt-8 pb-10" style="background-color: #dee1e1;">

    <!-- กล่องลงทะเบียน -->
    <!-- (แก้ไข) เปลี่ยน bg-gray-50 เป็น bg-white และเพิ่ม 'relative' สำหรับ Overlay -->
    <div id="registrationFormContainer" class="w-[95%] max-w-md p-8 space-y-6 bg-white rounded-lg shadow-md transition-colors duration-300 relative">
        <h1 class="text-xl font-bold text-center text-gray-900">ศึกชิงเจ้าบัลลังก์แห่งการ REFERRAL</h1>

        <!-- *** แก้ไข: เพิ่ม id="eventImageContainer" *** -->
        <!-- (แก้ไข) เปลี่ยน mt-6 เป็น my-4 (margin top/bottom 16px) -->
        <div style="height:3px;"></div>
        <div id="eventImageContainer" class="my-4 w-[70%] mx-auto">
            <img src="./images/refer_friend.jpg">
        </div>
        <div style="height:3px;"></div>
              
        <!-- *** (แก้ไข) ปรับปรุงโครงสร้างการแสดงข้อมูลพนักงาน *** -->
        <div id="employeeInfoDisplay" class="hidden text-center space-y-2 py-4" style="padding-top:0rem;">
            <!-- 1. ชื่อ-นามสกุล (Name) (รหัสพนักงาน) (EmpID) -->
            <p id="infoFullName" class="text-lg font-bold text-gray-900"></p> 
            
            <!-- 2. (EmpZone) -->
            <p id="infoEmpZone" class="text-sm text-gray-700"></p> 
            
            <!-- 3. (EmpRH) -->
            <p id="infoEmpRH" class="text-sm text-gray-700" style="line-height:0.6rem;"></p> 

            <!-- 4. เพิ่มเส้นกั้น (แก้ไข) ปรับ margin เป็น my-4 (16px) -->
            <hr class="my-4 border-gray-300" style="margin:25px auto;"> 

            <!-- 5. ให้คุณไปหาสมาชิกทีม -->
            <p class="text-md font-semibold text-blue-600">Refer ไปหาเพื่อนที่</p> 

            <!-- 6. (MapZone) (แก้ไข) ปรับขนาด font เป็น text-sm และลบ space-y-2 -->
            <p id="infoMapZone" class="text-sm text-gray-700 mt-2"></p> 

            <!-- 7. (MapRH) (แก้ไข) ปรับขนาด font เป็น text-sm และ mt-0.5 เพื่อให้ชิด MapZone มากขึ้น -->
            <p id="infoMapRH" class="text-sm text-gray-700 mt-0.5" style="line-height:0.6rem;"></p> 

            <!-- (เพิ่ม) ปุ่ม Refer Friend สำเร็จ (แก้ไข) ลบ w-full เพื่อลดขนาดปุ่ม -->
            <div class="text-center">
                <button type="button" id="referralSuccessButton" class="px-6 py-2 mt-6 font-medium text-white bg-green-600 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 ease-in-out disabled:bg-gray-400 disabled:cursor-not-allowed">
                    Refer Friend สำเร็จ
                </button>
            </div>
        </div>

        <!-- ฟอร์มลงทะเบียน -->
        <form id="registrationForm" class="space-y-4">
            
            <!-- (แก้ไข) เปลี่ยนเป็นช่อง OTP 5 ช่อง -->
            <div>
                <!-- (ลบ) ลบ Label "รหัสพนักงาน" -->
                <div id="otpContainer" class="flex justify-center gap-1 sm:gap-2">
                    <!-- (แก้ไข) เพิ่มขนาดตัวอักษรเป็น text-2xl -->
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <input type="tel" maxlength="1" class="otp-input w-9 h-11 sm:w-10 sm:h-12 text-center text-2xl font-semibold border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                </div>
                <!-- (เพิ่ม) Helper text และเว้นช่องว่างด้านล่าง (mb-4) -->
                <div style="height:5px;"></div>
                <p class="text-xs text-gray-500 text-center mt-2 mb-4">ใส่รหัสพนักงานของคุณให้ถูกต้องก่อนกด ลงทะเบียน</p>
            </div>
                       
            <button type="button" id="registerButton"
                    class="w-full px-4 py-2 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:bg-gray-400"
                    disabled> <!-- (เพิ่ม) disabled ปุ่มไว้ตอนเริ่ม -->
                ลงทะเบียน
            </button>
        </form>
        
        <!-- พื้นที่แสดงข้อความ (สำหรับข้อผิดพลาดหลัก) -->
         <div id="message" class="text-center text-sm"></div>

        <!-- (ลบ) ลบส่วนแสดงข้อความลงทะเบียนสำเร็จ (teamDisplay) -->
        <div id="teamDisplay" class="hidden text-center border-t pt-4 mt-4">
            <h2 id="teamNameDisplay" class="text-8xl font-bold text-[#0056ff]"></h2> 
            <p class="text-sm font-medium text-gray-700 mt-1">ทีมของคุณ</p>
            
            <p id="registrationStatusMessage" class="text-sm mt-4"></p>
            <p id="registrationTimestamp" class="text-xs text-gray-500"></p>
        </div>

        <!-- (เพิ่ม) Loading Overlay สำหรับ Spinner -->
        <div id="loadingOverlay" class="hidden absolute inset-0 bg-white bg-opacity-80 flex flex-col items-center justify-center space-y-4 rounded-lg z-20">
            <svg class="animate-spin h-12 w-12 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <!-- (แก้ไข) ปรับเลข Countdown เริ่มต้นเป็น 3 -->
            <p class="text-lg font-medium text-gray-700">กำลังตรวจสอบข้อมูล... <span id="spinnerCountdown">3</span></p>
        </div>
    </div>

    <!-- (เพิ่ม) Lightbox (Modal) สำหรับแจ้งเตือน Error -->
    <div id="errorLightbox" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
            <!-- (แก้ไข) ปรับขนาด Font จาก text-base เป็น text-sm -->
            <p id="errorLightboxMessage" class="text-sm text-gray-800 mb-6">ไม่พบรหัสพนักงานนี้ในระบบ<br>กรุณากรอกรหัสพนักงานใหม่อีกครั้ง</p>
            <button id="closeLightboxButton" class="w-full px-4 py-2 font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                ปิด
            </button>
        </div>
    </div>

    <!-- Firebase SDK และการเชื่อมต่อ --><script type="module">
        // นำเข้า Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        // (แก้ไข) เพิ่ม 'or'
        import { getFirestore, collection, getDocs, query, where, serverTimestamp, setLogLevel, limit, doc, updateDoc, or } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"; 

const _0x5c93bd=_0x15a0;(function(_0x292db9,_0x982a69){const _0x17b91a=_0x15a0,_0x38dc6c=_0x292db9();while(!![]){try{const _0x23291a=-parseInt(_0x17b91a(0x1e4))/0x1+-parseInt(_0x17b91a(0x1a8))/0x2+-parseInt(_0x17b91a(0x1ae))/0x3+-parseInt(_0x17b91a(0x1a3))/0x4+-parseInt(_0x17b91a(0x1dd))/0x5+parseInt(_0x17b91a(0x1df))/0x6*(parseInt(_0x17b91a(0x1c6))/0x7)+parseInt(_0x17b91a(0x1ba))/0x8;if(_0x23291a===_0x982a69)break;else _0x38dc6c['push'](_0x38dc6c['shift']());}catch(_0x3e851d){_0x38dc6c['push'](_0x38dc6c['shift']());}}}(_0x4741,0xca090));const firebaseConfig={'apiKey':_0x5c93bd(0x1ca),'authDomain':_0x5c93bd(0x1e7),'databaseURL':_0x5c93bd(0x1f1),'projectId':_0x5c93bd(0x1c5),'storageBucket':'ttb-register.firebasestorage.app','messagingSenderId':_0x5c93bd(0x1d8),'appId':_0x5c93bd(0x1bc),'measurementId':'G-9DJLWJ5LQW'};let db,auth,currentEmployeeDocId=null;const registrationFormContainer=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x19c)),otpContainer=document['getElementById'](_0x5c93bd(0x1a2)),otpInputs=otpContainer?Array['from'](otpContainer[_0x5c93bd(0x1b9)]('.otp-input')):[],registerButton=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1ea)),messageDiv=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1b4)),teamDisplay=document[_0x5c93bd(0x1cc)]('teamDisplay'),teamNameDisplay=document['getElementById'](_0x5c93bd(0x1a0)),regStatusMsg=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1ed)),regTimestamp=document['getElementById'](_0x5c93bd(0x1e3)),eventDate=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1ee)),eventImageContainer=document[_0x5c93bd(0x1cc)]('eventImageContainer'),registrationForm=document[_0x5c93bd(0x1cc)]('registrationForm'),employeeInfoDisplay=document['getElementById'](_0x5c93bd(0x1c2)),infoFullName=document[_0x5c93bd(0x1cc)]('infoFullName'),infoEmpZone=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1bd)),infoEmpRH=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1b3)),infoMapZone=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1f4)),infoMapRH=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1af)),referralSuccessButton=document[_0x5c93bd(0x1cc)]('referralSuccessButton'),loadingOverlay=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1a6)),spinnerCountdown=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1a9)),errorLightbox=document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1b2)),closeLightboxButton=document['getElementById']('closeLightboxButton');let countdownInterval;function _0x4741(){const _0x141a8a=['hidden','ลงทะเบียนเรียบร้อย','registerButton','bg-gray-500','เกิดข้อผิดพลาดในการเชื่อมต่อฐานข้อมูล:\x20','registrationStatusMessage','eventDate','text-center\x20text-sm\x20p-3\x20bg-red-50\x20border\x20border-red-200\x20rounded-md','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22font-bold\x20text-red-700\x22>เกิดข้อผิดพลาด:\x20ไม่มีสิทธิ์\x20(Missing\x20or\x20insufficient\x20permissions)</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22mt-2\x20text-sm\x20text-gray-700\x22>ปัญหานี้เกิดจาก\x20Security\x20Rules\x20ใน\x20Firebase\x20ของคุณ</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22mt-1\x20text-sm\x20text-gray-700\x22>กรุณาดู\x20<strong\x20class=\x22text-black\x22>\x22ข้อสำคัญ\x22</strong>\x20ในคอมเมนต์\x20(หมายเหตุ)\x20ในไฟล์นี้</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22mt-1\x20text-sm\x20text-gray-700\x22>ซึ่งอยู่ที่ประมาณบรรทัดที่\x20113\x20เพื่อดูวิธีแก้ไขครับ</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','https://ttb-register-default-rtdb.asia-southeast1.firebasedatabase.app','th-TH','add','infoMapZone','Error\x20logging\x20registration:\x20','docs','Registration\x20Logged\x20successfully.','Refer\x20Friend\x20สำเร็จ','EmpZone','forEach','medium','registrationFormContainer','referfriend','N/A','MapRH','teamNameDisplay','Name','otpContainer','4116524HHhQxs','bg-blue-200','Signed\x20in\x20anonymously','loadingOverlay','className','260024rGyMKL','spinnerCountdown','addEventListener','disabled','long','hover:bg-green-700','1420209tOZeKi','infoMapRH','key','remove','errorLightbox','infoEmpRH','message','text-center\x20text-sm\x20text-red-600','log','ลงทะเบียน','border-red-500','querySelectorAll','16601360pgogjB','clipboardData','1:1070273157855:web:5c8120e1df27e233d8676a','infoEmpZone','bg-green-600','employeeId','ReferralTimestamp','trim','employeeInfoDisplay','FullName_th','replace','ttb-register','189eKIBOK','Firebase\x20initialization\x20failed:','MapZone','EmpID','AIzaSyAgWMzWcZPzyzoBu5eQzj2y59nKsxTWurQ','data','getElementById','toLocaleString','length','Backspace','error','includes','Error\x20during\x20registration\x20process:\x20','preventDefault','text','innerHTML','keydown','permissions','1070273157855','บันทึกไม่สำเร็จ\x20(ลองอีกครั้ง)','select','focus','textContent','853160adAPHj','EmpRH','135822Hcmvbo','value','กำลังบันทึก...','bg-gray-100','registrationTimestamp','55655HoaJgN','empty','classList','ttb-register.firebaseapp.com'];_0x4741=function(){return _0x141a8a;};return _0x4741();}function _0x15a0(_0x11f439,_0x335b1e){const _0x47417c=_0x4741();return _0x15a0=function(_0x15a0c6,_0x19085f){_0x15a0c6=_0x15a0c6-0x198;let _0xea57a4=_0x47417c[_0x15a0c6];return _0xea57a4;},_0x15a0(_0x11f439,_0x335b1e);}function checkOtpCompleteness(){const _0x3a04bb=_0x5c93bd;let _0x19c99e=!![];otpInputs[_0x3a04bb(0x19a)](_0x218bd9=>{const _0x143a71=_0x3a04bb;_0x218bd9['value']['trim']()[_0x143a71(0x1ce)]===0x0&&(_0x19c99e=![]);}),registerButton['disabled']=!_0x19c99e;}try{const app=initializeApp(firebaseConfig);db=getFirestore(app),auth=getAuth(app),setLogLevel('Debug'),signInAnonymously(auth),console['log'](_0x5c93bd(0x1a5)),otpInputs[_0x5c93bd(0x1ce)]>0x0&&otpInputs[0x0][_0x5c93bd(0x1db)](),closeLightboxButton[_0x5c93bd(0x1aa)]('click',()=>{const _0x74e003=_0x5c93bd;errorLightbox['classList'][_0x74e003(0x1f3)](_0x74e003(0x1e8)),registerButton[_0x74e003(0x1ab)]=![],registerButton[_0x74e003(0x1dc)]=_0x74e003(0x1b7),otpInputs[_0x74e003(0x19a)](_0x1b4b56=>{const _0x3e3867=_0x74e003;_0x1b4b56[_0x3e3867(0x1ab)]=![],_0x1b4b56[_0x3e3867(0x1e6)][_0x3e3867(0x1b1)]('bg-gray-100'),_0x1b4b56['classList'][_0x3e3867(0x1b1)](_0x3e3867(0x1a4)),_0x1b4b56[_0x3e3867(0x1e0)]='';}),otpInputs[_0x74e003(0x1ce)]>0x0&&otpInputs[0x0][_0x74e003(0x1db)](),checkOtpCompleteness();}),referralSuccessButton[_0x5c93bd(0x1aa)]('click',handleReferralSuccess);}catch(_0x512b92){console['error'](_0x5c93bd(0x1c7),_0x512b92),document[_0x5c93bd(0x1cc)](_0x5c93bd(0x1b4))[_0x5c93bd(0x1dc)]=_0x5c93bd(0x1ec)+_0x512b92['message'];}registerButton[_0x5c93bd(0x1aa)]('click',handleRegisterCheck);otpContainer&&otpInputs[_0x5c93bd(0x19a)]((_0x397d66,_0x26f9b0)=>{const _0x33e031=_0x5c93bd;_0x397d66[_0x33e031(0x1aa)]('input',_0x49f82b=>{const _0x257274=_0x33e031;_0x397d66[_0x257274(0x1e0)]=_0x397d66[_0x257274(0x1e0)][_0x257274(0x1c4)](/[^0-9]/g,'');const _0x6cfb81=_0x397d66['value'];if(_0x6cfb81[_0x257274(0x1ce)]===0x1)_0x397d66[_0x257274(0x1e6)]['add'](_0x257274(0x1a4)),_0x26f9b0<otpInputs[_0x257274(0x1ce)]-0x1&&otpInputs[_0x26f9b0+0x1][_0x257274(0x1db)]();else _0x6cfb81['length']===0x0&&_0x397d66[_0x257274(0x1e6)][_0x257274(0x1b1)]('bg-blue-200');checkOtpCompleteness();}),_0x397d66['addEventListener'](_0x33e031(0x1d6),_0x159a0d=>{const _0x4b8331=_0x33e031;_0x159a0d[_0x4b8331(0x1b0)]===_0x4b8331(0x1cf)&&_0x397d66['value']===''&&_0x26f9b0>0x0&&(_0x159a0d[_0x4b8331(0x1d3)](),otpInputs[_0x26f9b0-0x1][_0x4b8331(0x1db)](),otpInputs[_0x26f9b0-0x1][_0x4b8331(0x1da)]());}),_0x397d66[_0x33e031(0x1aa)]('paste',_0x3cd38=>{const _0x572bfa=_0x33e031;_0x3cd38[_0x572bfa(0x1d3)]();const _0x5ba438=_0x3cd38[_0x572bfa(0x1bb)]['getData'](_0x572bfa(0x1d4))[_0x572bfa(0x1c1)]()[_0x572bfa(0x1c4)](/[^0-9]/g,'');if(_0x5ba438[_0x572bfa(0x1ce)]===otpInputs[_0x572bfa(0x1ce)])otpInputs['forEach']((_0x4631b6,_0x3b9332)=>{const _0x2e48b6=_0x572bfa;_0x4631b6[_0x2e48b6(0x1e0)]=_0x5ba438[_0x3b9332]||'',_0x4631b6[_0x2e48b6(0x1e0)]?_0x4631b6[_0x2e48b6(0x1e6)][_0x2e48b6(0x1f3)](_0x2e48b6(0x1a4)):_0x4631b6['classList'][_0x2e48b6(0x1b1)](_0x2e48b6(0x1a4));}),otpInputs[otpInputs['length']-0x1][_0x572bfa(0x1db)]();else{if(_0x5ba438['length']>0x0){let _0x83f216=_0x26f9b0;for(let _0x23d78e=0x0;_0x23d78e<_0x5ba438['length']&&_0x83f216<otpInputs[_0x572bfa(0x1ce)];_0x23d78e++){otpInputs[_0x83f216]['value']=_0x5ba438[_0x23d78e],otpInputs[_0x83f216][_0x572bfa(0x1e6)][_0x572bfa(0x1f3)](_0x572bfa(0x1a4)),_0x83f216<otpInputs[_0x572bfa(0x1ce)]-0x1&&otpInputs[_0x83f216+0x1]['focus'](),_0x83f216++;}}}setTimeout(checkOtpCompleteness,0x0);}),_0x397d66['addEventListener']('focus',_0x300335=>{const _0x18b905=_0x33e031;_0x300335['target'][_0x18b905(0x1da)]();});});function formatThaiTimestamp(_0x47695e){const _0x175762=_0x5c93bd;return _0x47695e[_0x175762(0x1cd)](_0x175762(0x1f2),{'dateStyle':_0x175762(0x1ac),'timeStyle':_0x175762(0x19b)});}function handleRegisterCheck(){const _0x4f63dc=_0x5c93bd;let _0x439caa='';otpInputs[_0x4f63dc(0x19a)](_0xd8f9c2=>{const _0x20c111=_0x4f63dc;_0x439caa+=_0xd8f9c2[_0x20c111(0x1e0)][_0x20c111(0x1c1)]();}),otpInputs[_0x4f63dc(0x19a)](_0x5eca14=>_0x5eca14[_0x4f63dc(0x1e6)][_0x4f63dc(0x1b1)](_0x4f63dc(0x1b8)));if(_0x439caa['length']<0x5){messageDiv[_0x4f63dc(0x1dc)]='กรุณากรอกรหัสพนักงานให้ครบ\x205\x20หลัก',messageDiv[_0x4f63dc(0x1a7)]=_0x4f63dc(0x1b5),otpInputs[_0x4f63dc(0x19a)](_0x478974=>{const _0x2cade0=_0x4f63dc;!_0x478974['value']&&_0x478974[_0x2cade0(0x1e6)][_0x2cade0(0x1f3)](_0x2cade0(0x1b8));});return;}registerButton[_0x4f63dc(0x1ab)]=!![],registerButton[_0x4f63dc(0x1dc)]='กำลังตรวจสอบ...',otpInputs[_0x4f63dc(0x19a)](_0x3bcb38=>{const _0x2068e3=_0x4f63dc;_0x3bcb38[_0x2068e3(0x1ab)]=!![],_0x3bcb38[_0x2068e3(0x1e6)]['add'](_0x2068e3(0x1e2));}),messageDiv[_0x4f63dc(0x1dc)]='',loadingOverlay[_0x4f63dc(0x1e6)][_0x4f63dc(0x1b1)]('hidden');let _0x75605e=0x3;spinnerCountdown['textContent']=''+_0x75605e,countdownInterval&&clearInterval(countdownInterval),countdownInterval=setInterval(()=>{const _0x4bb710=_0x4f63dc;_0x75605e--,spinnerCountdown[_0x4bb710(0x1dc)]=''+_0x75605e,_0x75605e<=0x0&&clearInterval(countdownInterval);},0x3e8),setTimeout(()=>{performFirebaseCheck(_0x439caa);},0xbb8);}async function performFirebaseCheck(_0x1109b2){const _0x18cba7=_0x5c93bd;loadingOverlay[_0x18cba7(0x1e6)][_0x18cba7(0x1f3)](_0x18cba7(0x1e8));countdownInterval&&clearInterval(countdownInterval);try{const _0x25115a=await getCrsgDoc(_0x1109b2);if(!_0x25115a){errorLightbox[_0x18cba7(0x1e6)][_0x18cba7(0x1b1)]('hidden');return;}const _0x94aa83=_0x25115a[_0x18cba7(0x1cb)],_0x4527dc=_0x25115a['id'];currentEmployeeDocId=_0x4527dc;if(_0x94aa83['DateLogin']){registrationForm[_0x18cba7(0x1e6)][_0x18cba7(0x1f3)]('hidden'),infoFullName[_0x18cba7(0x1dc)]=(_0x94aa83[_0x18cba7(0x1a1)]||_0x94aa83['FullName_th']||'')+'\x20('+_0x1109b2+')',infoEmpZone[_0x18cba7(0x1dc)]=''+(_0x94aa83[_0x18cba7(0x199)]||_0x18cba7(0x19e)),infoEmpRH['textContent']=''+(_0x94aa83[_0x18cba7(0x1de)]||_0x18cba7(0x19e)),infoMapZone[_0x18cba7(0x1dc)]=''+(_0x94aa83[_0x18cba7(0x1c8)]||_0x18cba7(0x19e)),infoMapRH[_0x18cba7(0x1dc)]=''+(_0x94aa83[_0x18cba7(0x19f)]||_0x18cba7(0x19e));_0x94aa83[_0x18cba7(0x1c0)]?(referralSuccessButton[_0x18cba7(0x1ab)]=!![],referralSuccessButton['textContent']='บันทึกการจับคู่แล้ว',referralSuccessButton[_0x18cba7(0x1e6)][_0x18cba7(0x1b1)](_0x18cba7(0x1be),'hover:bg-green-700'),referralSuccessButton[_0x18cba7(0x1e6)][_0x18cba7(0x1f3)](_0x18cba7(0x1eb))):(referralSuccessButton[_0x18cba7(0x1ab)]=![],referralSuccessButton[_0x18cba7(0x1dc)]=_0x18cba7(0x198),referralSuccessButton[_0x18cba7(0x1e6)][_0x18cba7(0x1f3)](_0x18cba7(0x1be),_0x18cba7(0x1ad)),referralSuccessButton[_0x18cba7(0x1e6)][_0x18cba7(0x1b1)](_0x18cba7(0x1eb)));employeeInfoDisplay[_0x18cba7(0x1e6)][_0x18cba7(0x1b1)](_0x18cba7(0x1e8)),registerButton[_0x18cba7(0x1dc)]=_0x18cba7(0x1e9);return;}logRegistration(_0x4527dc),registrationForm[_0x18cba7(0x1e6)][_0x18cba7(0x1f3)]('hidden'),infoFullName['textContent']=(_0x94aa83[_0x18cba7(0x1a1)]||_0x94aa83[_0x18cba7(0x1c3)]||'')+'\x20('+_0x1109b2+')',infoEmpZone['textContent']=''+(_0x94aa83[_0x18cba7(0x199)]||'N/A'),infoEmpRH[_0x18cba7(0x1dc)]=''+(_0x94aa83[_0x18cba7(0x1de)]||_0x18cba7(0x19e)),infoMapZone[_0x18cba7(0x1dc)]=''+(_0x94aa83[_0x18cba7(0x1c8)]||'N/A'),infoMapRH[_0x18cba7(0x1dc)]=''+(_0x94aa83['MapRH']||_0x18cba7(0x19e)),referralSuccessButton['disabled']=![],referralSuccessButton[_0x18cba7(0x1dc)]='Refer\x20Friend\x20สำเร็จ',referralSuccessButton[_0x18cba7(0x1e6)][_0x18cba7(0x1f3)](_0x18cba7(0x1be),_0x18cba7(0x1ad)),referralSuccessButton['classList'][_0x18cba7(0x1b1)](_0x18cba7(0x1eb)),employeeInfoDisplay[_0x18cba7(0x1e6)]['remove'](_0x18cba7(0x1e8)),registerButton[_0x18cba7(0x1dc)]=_0x18cba7(0x1e9);}catch(_0x1dd94c){console['error'](_0x18cba7(0x1d2),_0x1dd94c),_0x1dd94c[_0x18cba7(0x1b4)][_0x18cba7(0x1d1)](_0x18cba7(0x1d7))?(messageDiv[_0x18cba7(0x1d5)]=_0x18cba7(0x1f0),messageDiv[_0x18cba7(0x1a7)]=_0x18cba7(0x1ef)):(messageDiv[_0x18cba7(0x1dc)]='เกิดข้อผิดพลาด:\x20'+_0x1dd94c[_0x18cba7(0x1b4)],messageDiv[_0x18cba7(0x1a7)]=_0x18cba7(0x1b5)),registerButton[_0x18cba7(0x1ab)]=![],registerButton[_0x18cba7(0x1dc)]=_0x18cba7(0x1b7),teamDisplay[_0x18cba7(0x1e6)][_0x18cba7(0x1f3)](_0x18cba7(0x1e8)),otpInputs[_0x18cba7(0x19a)](_0x55b71e=>{const _0xb6b978=_0x18cba7;_0x55b71e['disabled']=![],_0x55b71e[_0xb6b978(0x1e6)][_0xb6b978(0x1b1)](_0xb6b978(0x1e2));}),employeeInfoDisplay[_0x18cba7(0x1e6)]['add'](_0x18cba7(0x1e8)),eventDate[_0x18cba7(0x1e6)][_0x18cba7(0x1b1)]('hidden'),eventImageContainer[_0x18cba7(0x1e6)]['remove'](_0x18cba7(0x1e8)),registrationForm[_0x18cba7(0x1e6)][_0x18cba7(0x1b1)](_0x18cba7(0x1e8));}}async function getCrsgDoc(_0x5f54a8){const _0x321033=_0x5c93bd,_0x123bbe='referfriend',_0x4560e6=query(collection(db,_0x123bbe),or(where(_0x321033(0x1c9),'==',_0x5f54a8),where(_0x321033(0x1bf),'==',_0x5f54a8)),limit(0x1)),_0x3e453f=await getDocs(_0x4560e6);if(_0x3e453f[_0x321033(0x1e5)])return null;const _0x3ada10=_0x3e453f[_0x321033(0x1f6)][0x0];return{'id':_0x3ada10['id'],'data':_0x3ada10[_0x321033(0x1cb)]()};}async function logRegistration(_0x55b2c1){const _0x26d8c6=_0x5c93bd,_0x10655c=new Date();try{const _0x2201ad=doc(db,_0x26d8c6(0x19d),_0x55b2c1);return await updateDoc(_0x2201ad,{'DateLogin':_0x10655c}),console[_0x26d8c6(0x1b6)](_0x26d8c6(0x1f7)),_0x10655c;}catch(_0x3850af){console[_0x26d8c6(0x1d0)](_0x26d8c6(0x1f5),_0x3850af);throw _0x3850af;}}async function handleReferralSuccess(){const _0x3dc864=_0x5c93bd;if(!currentEmployeeDocId){console[_0x3dc864(0x1d0)]('No\x20employee\x20doc\x20ID\x20found.'),referralSuccessButton['disabled']=!![],referralSuccessButton[_0x3dc864(0x1dc)]='เกิดข้อผิดพลาด';return;}referralSuccessButton[_0x3dc864(0x1ab)]=!![],referralSuccessButton[_0x3dc864(0x1dc)]=_0x3dc864(0x1e1);try{const _0x446733=doc(db,_0x3dc864(0x19d),currentEmployeeDocId);await updateDoc(_0x446733,{'ReferralTimestamp':serverTimestamp()}),console['log']('Referral\x20timestamp\x20saved.'),referralSuccessButton[_0x3dc864(0x1dc)]='บันทึกเวลาสำเร็จ',referralSuccessButton[_0x3dc864(0x1e6)]['remove']('bg-green-600','hover:bg-green-700'),referralSuccessButton[_0x3dc864(0x1e6)]['add'](_0x3dc864(0x1eb));}catch(_0x1008c8){console['error']('Error\x20saving\x20referral\x20timestamp:\x20',_0x1008c8),referralSuccessButton[_0x3dc864(0x1dc)]=_0x3dc864(0x1d9),referralSuccessButton[_0x3dc864(0x1ab)]=![];}}
        
    </script>
</body>
</html>